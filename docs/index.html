<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Documentation complète du plugin QGIS Pôle Aérien - Contrôle qualité et analyse des poteaux aériens ENEDIS pour projets FTTH">
    <meta name="keywords" content="QGIS, Pôle Aérien, FTTH, ENEDIS, C6, CAP FT, COMAC, Police C6">
    <title>Pôle Aérien - Documentation Technique Complète</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- No external chart library - Pure SVG diagrams -->
    
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #dbeafe;
            --secondary: #64748b;
            --accent: #f59e0b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
            --border: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --radius: 12px;
            --radius-sm: 8px;
            --transition: all 0.2s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 16px;
        }

        /* Navigation */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: transparent;
            backdrop-filter: none;
            border-bottom: 1px solid transparent;
            z-index: 1000;
            padding: 0 2rem;
            transition: background 0.3s ease, border-color 0.3s ease, backdrop-filter 0.3s ease;
        }

        .navbar-scrolled {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom-color: var(--border);
        }

        .navbar-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 64px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 600;
            font-size: 1.25rem;
            color: #ffffff;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .navbar-scrolled .logo {
            color: var(--text-primary);
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
            transition: color 0.3s ease, border-color 0.3s ease;
            padding: 0.5rem 0;
            border-bottom: 2px solid transparent;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: #ffffff;
            border-bottom-color: rgba(255, 255, 255, 0.6);
        }

        .navbar-scrolled .nav-links a {
            color: var(--text-secondary);
        }

        .navbar-scrolled .nav-links a:hover,
        .navbar-scrolled .nav-links a.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        /* Nav Dropdown */
        .nav-dropdown {
            position: relative;
            padding-bottom: 8px;
            margin-bottom: -8px;
        }

        .nav-dropdown-menu {
            display: none;
            position: absolute;
            top: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(16px);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 8px 0;
            min-width: 160px;
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.1), 0 4px 8px rgba(0, 0, 0, 0.05);
            list-style: none;
            z-index: 1000;
        }

        .nav-dropdown-menu::before {
            content: '';
            position: absolute;
            top: -6px;
            left: 50%;
            transform: translateX(-50%) rotate(45deg);
            width: 10px;
            height: 10px;
            background: rgba(255, 255, 255, 0.98);
            border-top: 1px solid var(--border);
            border-left: 1px solid var(--border);
        }

        .nav-dropdown:hover .nav-dropdown-menu {
            display: block;
            animation: dropdownFadeIn 0.2s ease;
        }

        @keyframes dropdownFadeIn {
            from { opacity: 0; transform: translateX(-50%) translateY(6px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        .nav-dropdown-menu li a {
            display: block;
            padding: 8px 20px;
            font-size: 0.82rem;
            font-weight: 600;
            border-bottom: none;
            transition: background 0.15s ease;
        }

        .nav-dropdown-menu li a:hover {
            background: var(--bg-tertiary);
            border-bottom-color: transparent;
        }

        /* Hero Section */
        .hero {
            position: relative;
            min-height: 100vh;
            display: flex;
            align-items: flex-end;
            justify-content: flex-start;
            background-image: url('image/poleaerien.jpeg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(
                to top,
                rgba(15, 23, 42, 0.88) 0%,
                rgba(15, 23, 42, 0.55) 35%,
                rgba(15, 23, 42, 0.15) 65%,
                transparent 100%
            );
            z-index: 1;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            max-width: 720px;
            padding: 0 3rem 4rem;
            text-align: left;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.12);
            color: #fde68a;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 1.25rem;
            border: 1px solid rgba(253, 230, 138, 0.25);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            letter-spacing: 0.02em;
        }

        .hero h1 {
            font-size: clamp(2rem, 4.5vw, 3.2rem);
            font-weight: 700;
            line-height: 1.15;
            margin-bottom: 1rem;
            color: #ffffff;
            background: none;
            -webkit-background-clip: unset;
            -webkit-text-fill-color: unset;
            background-clip: unset;
            text-shadow: 0 2px 20px rgba(0, 0, 0, 0.3);
        }

        .hero p {
            font-size: 1.05rem;
            color: rgba(255, 255, 255, 0.78);
            max-width: 540px;
            margin: 0 0 1.75rem;
            line-height: 1.65;
        }

        .hero-buttons {
            display: flex;
            gap: 0.875rem;
            flex-wrap: wrap;
        }

        .hero .btn-primary {
            background: rgba(255, 255, 255, 0.95);
            color: #1e293b;
            border: none;
        }

        .hero .btn-primary:hover {
            background: #ffffff;
            transform: translateY(-1px);
        }

        .hero .btn-secondary {
            background: transparent;
            color: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .hero .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .hero-scroll {
            position: absolute;
            bottom: 1.5rem;
            right: 3rem;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.75rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            animation: pulse-down 2s ease-in-out infinite;
        }

        @keyframes pulse-down {
            0%, 100% { transform: translateY(0); opacity: 0.5; }
            50% { transform: translateY(6px); opacity: 0.9; }
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.875rem 1.75rem;
            border-radius: var(--radius-sm);
            font-weight: 500;
            font-size: 0.95rem;
            text-decoration: none;
            transition: var(--transition);
            cursor: pointer;
            border: none;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-tertiary);
            border-color: var(--primary);
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 4rem 2rem;
        }

        /* Section */
        section {
            margin-bottom: 5rem;
            scroll-margin-top: 80px;
        }

        .section-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .section-header h2 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
        }

        .section-header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .card {
            background: var(--bg-primary);
            border-radius: var(--radius);
            padding: 1.75rem;
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-4px);
            border-color: var(--primary);
        }

        .card-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .card-icon.blue { background: #dbeafe; color: #2563eb; }
        .card-icon.green { background: #d1fae5; color: #059669; }
        .card-icon.orange { background: #ffedd5; color: #ea580c; }
        .card-icon.purple { background: #ede9fe; color: #7c3aed; }
        .card-icon.red { background: #fee2e2; color: #dc2626; }

        .card h3 {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .card p {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        /* Stats Section */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: var(--bg-primary);
            border-radius: var(--radius);
            padding: 1.5rem;
            text-align: center;
            border: 1px solid var(--border);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Animated Counter */
        .counter-section {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            border-radius: var(--radius);
            padding: 3rem 2rem;
            margin: 3rem 0;
        }

        .counter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 2rem;
            max-width: 1000px;
            margin: 0 auto;
        }

        .counter-item {
            text-align: center;
            padding: 1.5rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius);
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
        }

        .counter-item:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.1);
            border-color: var(--primary);
        }

        .counter-number {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }

        .counter-label {
            color: #94a3b8;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .counter-sublabel {
            color: #64748b;
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }

        /* Timeline Section */
        .timeline-section {
            position: relative;
            padding: 2rem 0;
        }

        .timeline-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(180deg, var(--primary) 0%, #a78bfa 50%, #10b981 100%);
            transform: translateX(-50%);
            border-radius: 2px;
        }

        .timeline-item {
            display: flex;
            justify-content: flex-end;
            padding-right: calc(50% + 30px);
            position: relative;
            margin-bottom: 3rem;
        }

        .timeline-item:nth-child(even) {
            justify-content: flex-start;
            padding-right: 0;
            padding-left: calc(50% + 30px);
        }

        .timeline-dot {
            position: absolute;
            left: 50%;
            top: 20px;
            width: 20px;
            height: 20px;
            background: var(--primary);
            border-radius: 50%;
            transform: translateX(-50%);
            border: 4px solid var(--bg-secondary);
            z-index: 10;
            box-shadow: 0 0 20px rgba(37, 99, 235, 0.4);
        }

        .timeline-item:nth-child(2) .timeline-dot { background: #8b5cf6; }
        .timeline-item:nth-child(3) .timeline-dot { background: #10b981; }
        .timeline-item:nth-child(4) .timeline-dot { background: #f59e0b; }

        .timeline-content {
            background: var(--bg-primary);
            border-radius: var(--radius);
            padding: 1.5rem;
            max-width: 400px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .timeline-content:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-3px);
        }

        .timeline-date {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: var(--primary-light);
            color: var(--primary);
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .timeline-content h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .timeline-content p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin: 0;
        }

        .timeline-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.2rem 0.5rem;
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-top: 0.5rem;
        }

        @media (max-width: 768px) {
            .timeline-line { left: 20px; }
            .timeline-item,
            .timeline-item:nth-child(even) {
                padding-left: 50px;
                padding-right: 0;
                justify-content: flex-start;
            }
            .timeline-dot { left: 20px; }
        }

        /* Lifecycle Diagram */
        .lifecycle-container {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #1e1b4b 100%);
            border-radius: var(--radius);
            padding: 2rem;
            margin: 2rem 0;
        }

        /* Audit Report Section */
        .audit-section {
            background: var(--bg-primary);
            border-radius: var(--radius);
            padding: 2rem;
            border: 1px solid var(--border);
            margin: 2rem 0;
        }

        .audit-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .audit-card {
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
            overflow: hidden;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .audit-card:hover {
            box-shadow: var(--shadow-lg);
            transform: scale(1.02);
        }

        .audit-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-bottom: 1px solid var(--border);
        }

        .audit-card-content {
            padding: 1rem;
        }

        .audit-card h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .audit-card p {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin: 0;
        }

        /* DAG Diagram */
        .dag-container {
            background: linear-gradient(180deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: var(--radius);
            padding: 2rem;
            margin: 2rem 0;
            overflow-x: auto;
        }

        .dag-node {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dag-node:hover {
            filter: brightness(1.1) drop-shadow(0 4px 12px rgba(0,0,0,0.15));
        }

        .dag-edge {
            stroke-dasharray: 8 4;
            animation: dagFlow 1s linear infinite;
        }

        @keyframes dagFlow {
            0% { stroke-dashoffset: 12; }
            100% { stroke-dashoffset: 0; }
        }

        /* Charts Section */
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
        }

        .chart-card {
            background: var(--bg-primary);
            border-radius: var(--radius);
            padding: 1.5rem;
            border: 1px solid var(--border);
        }

        .chart-card h3 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .chart-wrapper {
            position: relative;
            height: 280px;
        }

        /* Workflow Section */
        .workflow {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .workflow-step {
            display: flex;
            gap: 1.5rem;
            align-items: flex-start;
        }

        .step-number {
            width: 48px;
            height: 48px;
            min-width: 48px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.25rem;
        }

        .step-content {
            flex: 1;
            background: var(--bg-primary);
            border-radius: var(--radius);
            padding: 1.5rem;
            border: 1px solid var(--border);
        }

        .step-content h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .step-content p {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        /* Code Block */
        .code-block {
            background: #1e293b;
            border-radius: var(--radius-sm);
            padding: 1.25rem;
            margin-top: 1rem;
            overflow-x: auto;
        }

        .code-block code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            color: #e2e8f0;
            line-height: 1.7;
        }

        .code-comment { color: #64748b; }
        .code-keyword { color: #f472b6; }
        .code-string { color: #a5f3fc; }
        .code-function { color: #fbbf24; }

        /* Table */
        .table-container {
            background: var(--bg-primary);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 1rem 1.25rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--bg-tertiary);
            font-weight: 600;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
        }

        td {
            font-size: 0.95rem;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover td {
            background: var(--bg-secondary);
        }

        td code {
            background: var(--bg-tertiary);
            padding: 0.15rem 0.5rem;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--primary-dark);
            white-space: nowrap;
        }

        .badge {
            display: inline-flex;
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-blue { background: #dbeafe; color: #1d4ed8; }
        .badge-green { background: #d1fae5; color: #047857; }
        .badge-orange { background: #ffedd5; color: #c2410c; }

        /* Accordion */
        .accordion {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .accordion-item {
            background: var(--bg-primary);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .accordion-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.25rem 1.5rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .accordion-header:hover {
            background: var(--bg-secondary);
        }

        .accordion-header h4 {
            font-weight: 600;
            font-size: 1rem;
        }

        .accordion-icon {
            font-size: 1.25rem;
            color: var(--text-muted);
            transition: var(--transition);
        }

        .accordion-item.active .accordion-icon {
            transform: rotate(45deg);
        }

        .accordion-content {
            padding: 0 1.5rem;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), padding 0.3s ease;
            opacity: 0;
            transform: translateY(-8px);
        }

        .accordion-item.active .accordion-content {
            padding: 0 1.5rem 1.5rem;
            max-height: 1000px;
            opacity: 1;
            transform: translateY(0);
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), 
                        padding 0.3s ease,
                        opacity 0.3s ease 0.1s,
                        transform 0.3s ease 0.1s;
        }

        .accordion-content p {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        /* Footer */
        .footer {
            background: var(--text-primary);
            color: var(--text-muted);
            padding: 3rem 2rem;
            margin-top: 4rem;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1.5rem;
        }

        .footer-logo {
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .footer-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .footer-links a {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .footer-links a:hover {
            color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .navbar-content {
                padding: 0 1rem;
            }

            .nav-links {
                display: none;
            }

            .hero {
                min-height: 100svh;
            }

            .hero-content {
                padding: 0 1.5rem 3rem;
            }

            .hero h1 {
                font-size: 1.75rem;
            }

            .hero-scroll {
                display: none;
            }

            .main-content {
                padding: 2rem 1rem;
            }

            .charts-container {
                grid-template-columns: 1fr;
            }

            .chart-wrapper {
                height: 220px;
            }

            .workflow-step {
                flex-direction: column;
                gap: 1rem;
            }

            .footer-content {
                flex-direction: column;
                text-align: center;
            }
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-in {
            animation: fadeInUp 0.6s ease forwards;
        }

        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }

        /* Architecture Diagrams */
        .diagram-container {
            background: var(--bg-primary);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .diagram-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .diagram-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: var(--primary);
            border-radius: 2px;
        }

        .architecture-svg {
            width: 100%;
            height: auto;
            max-height: 500px;
            font-family: 'Inter', sans-serif;
            font-size: 12px;
        }

        .architecture-svg .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .architecture-svg .node:hover {
            filter: brightness(1.1);
        }

        .architecture-svg .node:hover rect,
        .architecture-svg .node:hover circle {
            stroke-width: 3;
        }

        .architecture-svg .flow-arrow {
            stroke-dasharray: 8 4;
            animation: flowAnimation 1.5s linear infinite;
        }

        @keyframes flowAnimation {
            0% { stroke-dashoffset: 12; }
            100% { stroke-dashoffset: 0; }
        }

        .architecture-svg .pulse {
            animation: pulseAnimation 2s ease-in-out infinite;
        }

        @keyframes pulseAnimation {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .diagram-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
            padding-bottom: 0.5rem;
        }

        .diagram-tab {
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            background: transparent;
            border: none;
            color: var(--text-secondary);
        }

        .diagram-tab:hover {
            background: var(--bg-tertiary);
        }

        .diagram-tab.active {
            background: var(--primary);
            color: white;
        }

        .diagram-panel {
            display: none;
        }

        .diagram-panel.active {
            display: block;
        }

        .info-tooltip {
            position: absolute;
            background: var(--text-primary);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: var(--radius-sm);
            font-size: 0.85rem;
            max-width: 250px;
            z-index: 100;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease;
            box-shadow: var(--shadow-lg);
        }

        .info-tooltip.visible {
            opacity: 1;
        }

        /* Zone Climatique Section */
        .zone-section {
            background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 50%, #0f172a 100%);
            border-radius: var(--radius);
            padding: 3rem;
            margin-bottom: 3rem;
            position: relative;
            overflow: hidden;
        }

        .zone-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            pointer-events: none;
        }

        .zone-header {
            text-align: center;
            margin-bottom: 2.5rem;
            position: relative;
            z-index: 1;
        }

        .zone-header h2 {
            color: white;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .zone-header p {
            color: #94a3b8;
            font-size: 1.1rem;
        }

        .zone-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(37, 99, 235, 0.2);
            border: 1px solid rgba(37, 99, 235, 0.3);
            color: #60a5fa;
            padding: 0.4rem 1rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 1rem;
        }

        .zone-content {
            display: grid;
            grid-template-columns: 1fr 1.2fr;
            gap: 3rem;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        @media (max-width: 900px) {
            .zone-content {
                grid-template-columns: 1fr;
            }
        }

        /* France Map */
        .france-map-container {
            position: relative;
        }

        .france-map {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            display: block;
        }

        .france-map .zone-zvn {
            fill: #3b82f6;
            fill-opacity: 0.6;
            stroke: #60a5fa;
            stroke-width: 2;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .france-map .zone-zvf {
            fill: #ef4444;
            fill-opacity: 0.6;
            stroke: #f87171;
            stroke-width: 2;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .france-map .zone-zvn:hover {
            fill-opacity: 0.9;
            filter: drop-shadow(0 0 20px rgba(59, 130, 246, 0.5));
        }

        .france-map .zone-zvf:hover {
            fill-opacity: 0.9;
            filter: drop-shadow(0 0 20px rgba(239, 68, 68, 0.5));
        }

        .map-legend {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1.5rem;
        }

        .map-legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: white;
            font-size: 0.9rem;
        }

        .map-legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .map-legend-dot.zvn { background: #3b82f6; box-shadow: 0 0 10px rgba(59, 130, 246, 0.5); }
        .map-legend-dot.zvf { background: #ef4444; box-shadow: 0 0 10px rgba(239, 68, 68, 0.5); }

        /* Portees Comparator */
        .portees-comparator {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            padding: 2rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .comparator-title {
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .comparator-title svg {
            color: #fbbf24;
        }

        .portee-row {
            display: grid;
            grid-template-columns: 60px 1fr 1fr;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-sm);
            transition: all 0.3s ease;
        }

        .portee-row:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(5px);
        }

        .portee-label {
            color: #e2e8f0;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .portee-bar-container {
            position: relative;
            height: 28px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 14px;
            overflow: hidden;
        }

        .portee-bar {
            height: 100%;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .portee-bar.zvn {
            background: linear-gradient(90deg, #2563eb, #3b82f6);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.4);
        }

        .portee-bar.zvf {
            background: linear-gradient(90deg, #dc2626, #ef4444);
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.4);
        }

        .comparator-footer {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .zone-info-card {
            flex: 1;
            min-width: 200px;
            padding: 1rem;
            border-radius: var(--radius-sm);
            text-align: center;
        }

        .zone-info-card.zvn {
            background: rgba(59, 130, 246, 0.15);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .zone-info-card.zvf {
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .zone-info-card h4 {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .zone-info-card.zvn h4 { color: #60a5fa; }
        .zone-info-card.zvf h4 { color: #f87171; }

        .zone-info-card p {
            color: #94a3b8;
            font-size: 0.85rem;
        }

        /* Pulse animation for active zone */
        @keyframes zonePulse {
            0%, 100% { stroke-opacity: 1; }
            50% { stroke-opacity: 0.5; }
        }

        .zone-active {
            animation: zonePulse 2s ease-in-out infinite;
        }

        /* Wind animation */
        @keyframes windFlow {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }

        .wind-line {
            animation: windFlow 3s ease-in-out infinite;
        }

        .wind-line:nth-child(2) { animation-delay: 0.5s; }
        .wind-line:nth-child(3) { animation-delay: 1s; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar" role="navigation" aria-label="Navigation principale">
        <div class="navbar-content">
            <a href="#demarrage" class="logo">
                <span class="logo-icon">PA</span>
                Pôle Aérien
            </a>
            <ul class="nav-links">
                <li><a href="#demarrage" class="active">Demarrage</a></li>
                <li><a href="#interface">Interface</a></li>
                <li class="nav-dropdown">
                    <a href="#modules-section" style="color: #a855f7; font-weight: 600;">Modules <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="display:inline-block;vertical-align:middle;margin-left:2px;"><path d="M6 9l6 6 6-6"/></svg></a>
                    <ul class="nav-dropdown-menu">
                        <li><a href="#maj-consolidation" style="color: #f59e0b;">MAJ BD</a></li>
                        <li><a href="#mod-capft" style="color: #34d399;">CAP FT</a></li>
                        <li><a href="#modules-section" style="color: #3b82f6;">COMAC</a></li>
                        <li><a href="#mod-c6bd" style="color: #ec4899;">C6 vs BD</a></li>
                        <li><a href="#police-c6" style="color: #a855f7;">Police C6</a></li>
                        <li><a href="#modules-section" style="color: #ef4444;">C6-C3A-C7</a></li>
                    </ul>
                </li>
                <li><a href="#analytics">Architecture</a></li>
                <li><a href="#zones">Zones NFC</a></li>
                <li><a href="#timeline">Timeline</a></li>
                <li><a href="#faq">FAQ</a></li>
            </ul>
        </div>
    </nav>

    <!-- Hero -->
    <header class="hero" id="demarrage" style="scroll-margin-top: 0;">
        <div class="hero-content">
            <span class="hero-badge">Plugin QGIS v3.0</span>
            <h1>Pole Aerien</h1>
            <p>Controle qualite et analyse des poteaux aeriens ENEDIS (FT/BT). 6 modules d'analyse, execution par lot, rapports Excel.</p>
            <div class="hero-buttons">
                <a href="#reference" class="btn btn-primary">
                    Decouvrir
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                </a>
                <a href="#modules-section" class="btn btn-secondary">Modules</a>
            </div>
        </div>
        <div class="hero-scroll">
            <span>scroll</span>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7 7 7-7"/></svg>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Features Section -->
        <section id="features">
            <div class="section-header">
                <h2>Fonctionnalités principales</h2>
                <p>Un ensemble d'outils puissants pour gérer vos données terrain</p>
            </div>
            
            <div class="cards-grid">
                <article class="card animate-in">
                    <div class="card-icon blue">
                        <img src="../images/icon-sync.svg" alt="Sync" width="28" height="28" style="filter: brightness(0) invert(1);">
                    </div>
                    <h3>Mise a jour FT/BT</h3>
                    <p>Import du fichier FT-BT KO Excel, analyse des correspondances poteaux, puis mise a jour SQL directe PostgreSQL en thread background avec rollback atomique et triggers auto.</p>
                </article>

                <article class="card animate-in delay-1">
                    <div class="card-icon green">
                        <img src="../images/icon-success.svg" alt="Validation" width="28" height="28" style="filter: brightness(0) invert(1);">
                    </div>
                    <h3>Verification CAP_FT</h3>
                    <p>Comparaison des poteaux FT de la base de donnees QGIS avec les fiches appuis du dossier CAP FT. Detection des ecarts et generation de rapport Excel.</p>
                </article>

                <article class="card animate-in delay-2">
                    <div class="card-icon orange">
                        <img src="../images/icon-database.svg" alt="Database" width="28" height="28" style="filter: brightness(0) invert(1);">
                    </div>
                    <h3>Controle COMAC</h3>
                    <p>Validation croisee des poteaux BT avec les exports COMAC. Verification des cables via PostgreSQL natif (schema comac), comparaison capacites et detection anomalies.</p>
                </article>

                <article class="card animate-in delay-3">
                    <div class="card-icon purple">
                        <img src="../images/icon-chart.svg" alt="Chart" width="28" height="28" style="filter: brightness(0) invert(1);">
                    </div>
                    <h3>Comparaison C6 vs BD</h3>
                    <p>Croisement asynchrone des annexes C6 Excel avec les couches QGIS via QgsSpatialIndex. Auto-detection des fichiers C6 par nom d'etude. Export rapport Excel.</p>
                </article>

                <article class="card animate-in">
                    <div class="card-icon red">
                        <img src="../images/icon-search.svg" alt="Search" width="28" height="28" style="filter: brightness(0) invert(1);">
                    </div>
                    <h3>Police C6</h3>
                    <p>Analyse complete via fddcpi2 : SRO, cables decoupes PostgreSQL, intersection appuis, comparaison C6. Filtres CDI/posemode, exclusion appuis EDF, verification securite NFC.</p>
                </article>

                <article class="card animate-in delay-1">
                    <div class="card-icon blue">
                        <img src="../images/icon-folder-open.svg" alt="Folder" width="28" height="28" style="filter: brightness(0) invert(1);">
                    </div>
                    <h3>Interface unifiee</h3>
                    <p>Un seul dialog pour tout : selection du dossier projet, detection automatique des fichiers, choix des modules, execution sequentielle et journal en temps reel.</p>
                </article>

                <article class="card animate-in delay-2">
                    <div class="card-icon red">
                        <img src="../images/icon-warning.svg" alt="Security" width="28" height="28" style="filter: brightness(0) invert(1);">
                    </div>
                    <h3>Verification Securite</h3>
                    <p>Controle automatique des portees cables selon norme NFC 11201-A1 et zones climatiques ZVN/ZVF. Integration dans les rapports Police C6 et COMAC.</p>
                </article>
            </div>
        </section>

        <!-- Animated Counters Section -->
        <div class="counter-section">
            <div class="counter-grid">
                <div class="counter-item">
                    <div class="counter-number" data-target="11900">0</div>
                    <div class="counter-label">Lignes de code</div>
                    <div class="counter-sublabel">Python pur (hors auto-gen)</div>
                </div>
                <div class="counter-item">
                    <div class="counter-number" data-target="34">0</div>
                    <div class="counter-label">Fichiers Python</div>
                    <div class="counter-sublabel">Architecture modulaire</div>
                </div>
                <div class="counter-item">
                    <div class="counter-number" data-target="6">0</div>
                    <div class="counter-label">Workflows async</div>
                    <div class="counter-sublabel">QgsTask + signaux Qt</div>
                </div>
                <div class="counter-item">
                    <div class="counter-number" data-target="591">0</div>
                    <div class="counter-label">Cables references</div>
                    <div class="counter-sublabel">PostgreSQL (schema comac)</div>
                </div>
                <div class="counter-item">
                    <div class="counter-number" data-target="6">0</div>
                    <div class="counter-label">Modules metier</div>
                    <div class="counter-sublabel">Execution par lot</div>
                </div>
            </div>
        </div>

        <!-- Reference Table Section -->
        <section id="reference" style="margin-top: 4rem;">
            <div class="section-header">
                <h2>Architecture et fichiers</h2>
                <p>Vue d'ensemble des composants du plugin v3.0</p>
            </div>

            <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                <span style="width: 4px; height: 20px; background: var(--primary); border-radius: 2px; display: inline-block;"></span>
                Modules d'analyse
            </h3>
            <div class="table-container" style="margin-bottom: 2.5rem;">
                <table>
                    <thead>
                        <tr>
                            <th>Ordre</th>
                            <th>Module</th>
                            <th>Fichier metier</th>
                            <th>Workflow</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge badge-orange">0</span></td>
                            <td><strong>MAJ FT/BT</strong></td>
                            <td><code>Maj_Ft_Bt.py</code></td>
                            <td><code>maj_workflow.py</code></td>
                            <td>Import Excel FT-BT KO, MAJ SQL directe PostgreSQL en background, rollback atomique, triggers auto</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-blue">1</span></td>
                            <td><strong>C6 vs BD</strong></td>
                            <td><code>C6_vs_Bd.py</code></td>
                            <td><code>c6bd_workflow.py</code></td>
                            <td>Comparaison annexes C6 Excel vs couches QGIS, QgsSpatialIndex, auto-detection champ etude</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-green">2</span></td>
                            <td><strong>CAP FT</strong></td>
                            <td><code>CapFt.py</code></td>
                            <td><code>capft_workflow.py</code></td>
                            <td>Verification poteaux FT vs fiches appuis, detection ecarts, rapport Excel</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-blue">3</span></td>
                            <td><strong>COMAC</strong></td>
                            <td><code>Comac.py</code></td>
                            <td><code>comac_workflow.py</code></td>
                            <td>Validation BT + VérifCabCOMAC (fddcpi2, CDI+posemode, capacites), PostgreSQL schema comac</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-blue">4</span></td>
                            <td><strong>Police C6</strong></td>
                            <td><code>PoliceC6.py</code></td>
                            <td><code>police_workflow.py</code></td>
                            <td>Analyse fddcpi2 complete, filtres spatiaux bbox, CDI/posemode, exclusion EDF, securite NFC</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-orange">5</span></td>
                            <td><strong>C6-C3A-C7</strong></td>
                            <td><code>C6_vs_C3A_vs_Bd.py</code></td>
                            <td><code>c6c3a_workflow.py</code></td>
                            <td>Croisement annexes C6, C3A et C7, detection incoherences inter-documents</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                <span style="width: 4px; height: 20px; background: var(--success); border-radius: 2px; display: inline-block;"></span>
                Infrastructure et services
            </h3>
            <div class="table-container" style="margin-bottom: 2.5rem;">
                <table>
                    <thead>
                        <tr>
                            <th>Couche</th>
                            <th>Fichier</th>
                            <th>Role</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge badge-blue">UI</span></td>
                            <td><code>PoleAerien.py</code></td>
                            <td>Point d'entree (128 lignes), toolbar, instanciation workflows, lazy init dialog</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-blue">UI</span></td>
                            <td><code>dialog_v2.py</code></td>
                            <td>PoleAerienDialogV2 : interface unifiee, QSplitter, QgsCollapsibleGroupBox, journal</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-blue">UI</span></td>
                            <td><code>batch_orchestrator.py</code></td>
                            <td>Pont dialog-workflows, cache fddcpi2 inter-modules, parametres</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-blue">UI</span></td>
                            <td><code>batch_runner.py</code></td>
                            <td>Execution sequentielle des modules, progression globale par sous-plage</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-blue">UI</span></td>
                            <td><code>project_detector.py</code></td>
                            <td>Auto-detection structure projet (FT-BT KO, CAP FT, COMAC, GraceTHD, C7, C3A)</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-green">Async</span></td>
                            <td><code>async_tasks.py</code></td>
                            <td>6 QgsTask (CapFtTask, ComacTask, C6BdTask, C6C3ATask, PoliceC6Task, MajSqlBg)</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-green">Async</span></td>
                            <td><code>maj_sql_background.py</code></td>
                            <td>MajSqlBackgroundTask : MAJ SQL directe PostgreSQL en thread background</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-orange">Regles</span></td>
                            <td><code>security_rules.py</code></td>
                            <td>Verification portees NFC 11201-A1, zones ZVN/ZVF, guards division par zero</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-orange">Regles</span></td>
                            <td><code>pcm_parser.py</code></td>
                            <td>Parsing XML fiches PCM (ISO-8859-1), extraction donnees etude</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-orange">Regles</span></td>
                            <td><code>comac_loader.py</code></td>
                            <td>Fusion PCM + Excel COMAC, detection automatique zones ZVF/ZVN</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-orange">Regles</span></td>
                            <td><code>cable_analyzer.py</code></td>
                            <td>Comptage cables par appui, filtre CDI + posemode(1,2), capacites_compatibles()</td>
                        </tr>
                        <tr>
                            <td><span class="badge" style="background: #fee2e2; color: #dc2626;">Donnees</span></td>
                            <td><code>comac_db_reader.py</code></td>
                            <td>PostgreSQL only (schema comac), cache thread-safe, 591 cables references</td>
                        </tr>
                        <tr>
                            <td><span class="badge" style="background: #fee2e2; color: #dc2626;">Donnees</span></td>
                            <td><code>db_connection.py</code></td>
                            <td>Connexion psycopg2 auto (credentials QGIS), fddcpi2() cables decoupes</td>
                        </tr>
                        <tr>
                            <td><span class="badge" style="background: #fee2e2; color: #dc2626;">Donnees</span></td>
                            <td><code>qgis_utils.py</code></td>
                            <td>get_layer_safe(), normalize_appui_num(), build_spatial_index(), extraire_appuis</td>
                        </tr>
                        <tr>
                            <td><span class="badge" style="background: #fee2e2; color: #dc2626;">Donnees</span></td>
                            <td><code>core_utils.py</code></td>
                            <td>Fonctions pures Python : safe_float, safe_int, build_export_path, parse_bool</td>
                        </tr>
                        <tr>
                            <td><span class="badge" style="background: #fee2e2; color: #dc2626;">Donnees</span></td>
                            <td><code>excel_helpers.py</code></td>
                            <td>Utilitaires export Excel (openpyxl), formatage feuilles rapport</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                <span style="width: 4px; height: 20px; background: var(--danger); border-radius: 2px; display: inline-block;"></span>
                Couches QGIS requises
            </h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Couche</th>
                            <th>Type</th>
                            <th>Source</th>
                            <th>Utilisation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>infra_pt_pot</strong></td>
                            <td>Points</td>
                            <td>PostgreSQL</td>
                            <td>Poteaux FT/BT (champ inf_num), base de tous les modules</td>
                        </tr>
                        <tr>
                            <td><strong>etude_cap_ft</strong></td>
                            <td>Polygones</td>
                            <td>PostgreSQL</td>
                            <td>Zones d'etude FT pour CAP FT, C6 vs BD, Police C6</td>
                        </tr>
                        <tr>
                            <td><strong>etude_comac</strong></td>
                            <td>Polygones</td>
                            <td>PostgreSQL</td>
                            <td>Zones d'etude BT pour COMAC</td>
                        </tr>
                        <tr>
                            <td><strong>bpe</strong></td>
                            <td>Points</td>
                            <td>GraceTHD</td>
                            <td>Boitiers de protection (Police C6)</td>
                        </tr>
                        <tr>
                            <td><strong>t_cheminement</strong></td>
                            <td>Lignes</td>
                            <td>GraceTHD</td>
                            <td>Chemins reseau (filtre cm_typ_imp != 7)</td>
                        </tr>
                        <tr>
                            <td><strong>t_cableline</strong></td>
                            <td>Lignes</td>
                            <td>GraceTHD</td>
                            <td>Trace geometrique des cables</td>
                        </tr>
                        <tr>
                            <td><strong>t_noeud</strong></td>
                            <td>Points</td>
                            <td>GraceTHD</td>
                            <td>Points d'ancrage reseau</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Timeline Section -->
        <section id="timeline" style="margin-top: 4rem;">
            <div class="section-header">
                <h2>Evolution du plugin</h2>
                <p>Historique des versions majeures et fonctionnalites ajoutees</p>
            </div>

            <div class="timeline-section">
                <div class="timeline-line"></div>
                
                <div class="timeline-item">
                    <div class="timeline-dot" style="background: #10b981; width: 24px; height: 24px; box-shadow: 0 0 25px rgba(16,185,129,0.6);"></div>
                    <div class="timeline-content" style="border-color: #10b981;">
                        <span class="timeline-date" style="background: #d1fae5; color: #059669;">Fevrier 2026</span>
                        <h4>v3.0 - Interface unifiee</h4>
                        <p><strong>Reecriture complete de l'interface :</strong> suppression de l'ancien dialog a onglets (PoleAerienDialog, UIStateController, LogManager, ui_pages, ui_feedback, aboutdialog). Nouveau dialog unique PoleAerienDialogV2 avec detection automatique du projet, execution par lot sequentielle via BatchRunner + BatchOrchestrator. PoleAerien.py reduit de 2100 a 128 lignes. 11 fichiers obsoletes supprimes.</p>
                        <span class="timeline-badge" style="background: rgba(16,185,129,0.15); color: #10b981;">ACTUELLE</span>
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="timeline-dot" style="background: #a855f7;"></div>
                    <div class="timeline-content" style="border-color: #a855f7;">
                        <span class="timeline-date" style="background: #f3e8ff; color: #7c3aed;">Janvier 2026</span>
                        <h4>v2.3.0 - Refactoring Majeur</h4>
                        <p><strong>Architecture Workflows :</strong> God Object decouple en 6 workflows async. Police C6 : filtres spatiaux bbox, CDI/posemode, exclusion EDF. MAJ BD : chemin unique SQL background. COMAC : migration PostgreSQL. Suppression 900+ lignes dead code.</p>
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <span class="timeline-date">Decembre 2025</span>
                        <h4>v2.2.0 - Securite NFC</h4>
                        <p>Module verification securite NFC 11201-A1, detection zones climatiques ZVN/ZVF, feuille VERIF_SECURITE.</p>
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <span class="timeline-date">Octobre 2025</span>
                        <h4>v2.1.0 - Police C6</h4>
                        <p>Analyse croisee C6/C3A/C7, couches erreur temporaires, integration donnees reseau.</p>
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <span class="timeline-date">2024</span>
                        <h4>v2.0.0 - Refonte complete</h4>
                        <p>Architecture MVC, execution asynchrone QgsTask, 6 modules d'analyse independants.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Lifecycle Diagram Section -->
        <section id="lifecycle" style="margin-top: 4rem;">
            <div class="section-header">
                <h2>Cycle de vie QGIS</h2>
                <p>Comprendre le fonctionnement interne du plugin dans QGIS</p>
            </div>

            <!-- Main Lifecycle Diagram -->
            <div class="lifecycle-container">
                <svg viewBox="0 0 1200 500" xmlns="http://www.w3.org/2000/svg" style="width: 100%; max-height: 520px;">
                    <defs>
                        <marker id="arrow-life" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#60a5fa"/>
                        </marker>
                        <filter id="glow-life" x="-50%" y="-50%" width="200%" height="200%">
                            <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                            <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
                        </filter>
                    </defs>
                    
                    <!-- Background grid -->
                    <pattern id="grid-life" width="30" height="30" patternUnits="userSpaceOnUse">
                        <path d="M 30 0 L 0 0 0 30" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
                    </pattern>
                    <rect width="1200" height="500" fill="url(#grid-life)"/>

                    <!-- Step 1: QGIS Start -->
                    <g filter="url(#glow-life)">
                        <rect x="40" y="200" width="150" height="100" rx="12" fill="rgba(59,130,246,0.3)" stroke="#3b82f6" stroke-width="2"/>
                        <text x="115" y="230" text-anchor="middle" fill="white" font-size="13" font-weight="700">1. QGIS Start</text>
                        <text x="115" y="250" text-anchor="middle" fill="#93c5fd" font-size="10">classFactory(iface)</text>
                        <text x="115" y="270" text-anchor="middle" fill="#60a5fa" font-size="9">__init__.py:64</text>
                        <text x="115" y="285" text-anchor="middle" fill="#bfdbfe" font-size="8">Retourne PoleAerien</text>
                    </g>

                    <!-- Arrow 1 -->
                    <path d="M 190 250 L 230 250" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-life)" class="flow-arrow"/>

                    <!-- Step 2: __init__ -->
                    <g filter="url(#glow-life)">
                        <rect x="230" y="170" width="180" height="160" rx="12" fill="rgba(139,92,246,0.3)" stroke="#8b5cf6" stroke-width="2"/>
                        <text x="320" y="195" text-anchor="middle" fill="white" font-size="13" font-weight="700">2. __init__(iface)</text>
                        <text x="320" y="215" text-anchor="middle" fill="#c4b5fd" font-size="9">• 6 Workflows (signaux)</text>
                        <text x="320" y="232" text-anchor="middle" fill="#c4b5fd" font-size="9">• Toolbar creation</text>
                        <text x="320" y="249" text-anchor="middle" fill="#c4b5fd" font-size="9">• Dialog lazy (None)</text>
                        <text x="320" y="266" text-anchor="middle" fill="#c4b5fd" font-size="9">• BatchRunner (None)</text>
                        <text x="320" y="283" text-anchor="middle" fill="#c4b5fd" font-size="9">• BatchOrchestrator (None)</text>
                        <text x="320" y="305" text-anchor="middle" fill="#a78bfa" font-size="8">PoleAerien.py:30-58</text>
                        <text x="320" y="320" text-anchor="middle" fill="#ddd6fe" font-size="7">Workflows: Maj, CapFt, Comac, C6Bd, C6C3A, Police</text>
                    </g>

                    <!-- Arrow 2 -->
                    <path d="M 410 250 L 460 250" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-life)" class="flow-arrow"/>

                    <!-- Step 3: initGui -->
                    <g filter="url(#glow-life)">
                        <rect x="460" y="200" width="160" height="100" rx="12" fill="rgba(16,185,129,0.3)" stroke="#10b981" stroke-width="2"/>
                        <text x="540" y="230" text-anchor="middle" fill="white" font-size="13" font-weight="700">3. initGui()</text>
                        <text x="540" y="250" text-anchor="middle" fill="#6ee7b7" font-size="9">• Menu QGIS</text>
                        <text x="540" y="267" text-anchor="middle" fill="#6ee7b7" font-size="9">• Toolbar icon</text>
                        <text x="540" y="284" text-anchor="middle" fill="#34d399" font-size="8">Ligne 82-88</text>
                    </g>

                    <!-- Arrow 3 -->
                    <path d="M 620 250 L 670 250" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-life)" class="flow-arrow"/>

                    <!-- Step 4: run -->
                    <g filter="url(#glow-life)">
                        <rect x="670" y="160" width="180" height="180" rx="12" fill="rgba(251,191,36,0.3)" stroke="#fbbf24" stroke-width="2"/>
                        <text x="760" y="185" text-anchor="middle" fill="white" font-size="13" font-weight="700">4. run()</text>
                        <text x="760" y="205" text-anchor="middle" fill="#fcd34d" font-size="9">• Lazy init DialogV2</text>
                        <text x="760" y="222" text-anchor="middle" fill="#fcd34d" font-size="9">• Init BatchRunner</text>
                        <text x="760" y="239" text-anchor="middle" fill="#fcd34d" font-size="9">• Init BatchOrchestrator</text>
                        <text x="760" y="256" text-anchor="middle" fill="#fcd34d" font-size="9">• init_default_layers()</text>
                        <text x="760" y="273" text-anchor="middle" fill="#fcd34d" font-size="9">• dlg.show() non-modal</text>
                        <text x="760" y="290" text-anchor="middle" fill="#fcd34d" font-size="9">• dlg.raise_() + activate</text>
                        <text x="760" y="315" text-anchor="middle" fill="#f59e0b" font-size="8">Ligne 112-128</text>
                        <text x="760" y="330" text-anchor="middle" fill="#fef3c7" font-size="7">Dialog non-modal, QGIS reste utilisable</text>
                    </g>

                    <!-- Arrow 4 -->
                    <path d="M 850 250 L 900 250" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-life)" class="flow-arrow"/>

                    <!-- Step 5: unload -->
                    <g filter="url(#glow-life)">
                        <rect x="900" y="190" width="160" height="120" rx="12" fill="rgba(239,68,68,0.3)" stroke="#ef4444" stroke-width="2"/>
                        <text x="980" y="220" text-anchor="middle" fill="white" font-size="13" font-weight="700">5. unload()</text>
                        <text x="980" y="240" text-anchor="middle" fill="#fca5a5" font-size="9">• dlg.close()</text>
                        <text x="980" y="257" text-anchor="middle" fill="#fca5a5" font-size="9">• Remove menu</text>
                        <text x="980" y="274" text-anchor="middle" fill="#fca5a5" font-size="9">• Remove toolbar icons</text>
                        <text x="980" y="291" text-anchor="middle" fill="#f87171" font-size="9">• del toolbar</text>
                    </g>

                    <!-- Loop arrow back -->
                    <path d="M 760 340 Q 760 430 400 430 Q 115 430 115 300" stroke="rgba(96,165,250,0.4)" stroke-width="2" fill="none" stroke-dasharray="8 4" marker-end="url(#arrow-life)"/>
                    <text x="450" y="460" text-anchor="middle" fill="#94a3b8" font-size="11" font-style="italic">↻ Utilisateur relance le plugin</text>

                    <!-- Title & Metadata -->
                    <text x="50" y="40" fill="#e2e8f0" font-size="14" font-weight="700">CYCLE DE VIE PLUGIN QGIS</text>
                    <rect x="50" y="50" width="280" height="90" rx="8" fill="rgba(255,255,255,0.08)" stroke="rgba(255,255,255,0.15)" stroke-width="1"/>
                    
                    <!-- File Icon -->
                    <g transform="translate(65, 65)">
                        <rect width="10" height="13" rx="1" fill="none" stroke="#94a3b8" stroke-width="1.2"/>
                        <line x1="2" y1="4" x2="8" y2="4" stroke="#94a3b8" stroke-width="1"/>
                        <line x1="2" y1="7" x2="8" y2="7" stroke="#94a3b8" stroke-width="1"/>
                        <line x1="2" y1="10" x2="6" y2="10" stroke="#94a3b8" stroke-width="1"/>
                    </g>
                    <text x="82" y="75" fill="#94a3b8" font-size="10" font-weight="600">Fichier principal:</text>
                    <text x="210" y="75" fill="#60a5fa" font-size="10" font-weight="700">PoleAerien.py</text>
                    
                    <!-- Code Icon -->
                    <g transform="translate(65, 85)">
                        <polyline points="0,6.5 3,3.5 0,0.5" fill="none" stroke="#94a3b8" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                        <polyline points="10,0.5 7,3.5 10,6.5" fill="none" stroke="#94a3b8" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                        <line x1="4.5" y1="0" x2="5.5" y2="7" stroke="#94a3b8" stroke-width="1.2" stroke-linecap="round"/>
                    </g>
                    <text x="82" y="95" fill="#94a3b8" font-size="10" font-weight="600">Lignes de code:</text>
                    <text x="210" y="95" fill="#60a5fa" font-size="10" font-weight="700">128 lignes</text>
                    
                    <!-- Version Icon -->
                    <g transform="translate(65, 105)">
                        <circle cx="5" cy="5" r="4.5" fill="none" stroke="#94a3b8" stroke-width="1.2"/>
                        <text x="5" y="8" text-anchor="middle" fill="#94a3b8" font-size="6" font-weight="700">v</text>
                    </g>
                    <text x="82" y="115" fill="#94a3b8" font-size="10" font-weight="600">Version:</text>
                    <text x="210" y="115" fill="#60a5fa" font-size="10" font-weight="700">v3.0</text>
                    <text x="65" y="130" fill="#94a3b8" font-size="9">QGIS 3.28+ | PostgreSQL natif</text>
                </svg>
            </div>

            <!-- Detailed Explanation Cards -->
            <div class="cards-grid" style="margin-top: 3rem;">
                <div class="card">
                    <div class="card-icon blue">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                            <path d="M2 17l10 5 10-5M2 12l10 5 10-5"/>
                        </svg>
                    </div>
                    <h3>1. Démarrage QGIS</h3>
                    <p><strong>classFactory(iface)</strong> dans <code>__init__.py</code> est appelée par QGIS au démarrage. Cette fonction instancie et retourne l'objet <code>PoleAerien</code>.</p>
                </div>

                <div class="card">
                    <div class="card-icon purple">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"/>
                        </svg>
                    </div>
                    <h3>2. Initialisation</h3>
                    <p><strong>__init__(iface)</strong> configure le plugin : instanciation de 6 workflows (Maj, CapFt, Comac, C6Bd, C6C3A, Police), creation de la toolbar. Le dialog, le BatchRunner et le BatchOrchestrator sont initialises en lazy dans <code>run()</code>.</p>
                </div>

                <div class="card">
                    <div class="card-icon green">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <line x1="9" y1="9" x2="15" y2="15"/>
                            <line x1="15" y1="9" x2="9" y2="15"/>
                        </svg>
                    </div>
                    <h3>3. Interface GUI</h3>
                    <p><strong>initGui()</strong> ajoute l'icône du plugin au menu QGIS et à la toolbar. L'action est connectée à la méthode <code>run()</code>.</p>
                </div>

                <div class="card">
                    <div class="card-icon orange">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="5 3 19 12 5 21 5 3"/>
                        </svg>
                    </div>
                    <h3>4. Execution</h3>
                    <p><strong>run()</strong> cree le PoleAerienDialogV2 (lazy init), le BatchRunner et le BatchOrchestrator au premier appel. Initialise les couches par defaut, puis affiche le dialog en mode non-modal avec <code>show()</code>. QGIS reste utilisable pendant que le dialog est ouvert.</p>
                </div>

                <div class="card">
                    <div class="card-icon red">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="3 6 5 6 21 6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                            <line x1="10" y1="11" x2="10" y2="17"/>
                            <line x1="14" y1="11" x2="14" y2="17"/>
                        </svg>
                    </div>
                    <h3>5. Nettoyage</h3>
                    <p><strong>unload()</strong> nettoie les ressources : fermeture du dialog, retrait des actions du menu QGIS, suppression des icones de la toolbar.</p>
                </div>

                <div class="card">
                    <div class="card-icon blue">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="23 4 23 10 17 10"/>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                        </svg>
                    </div>
                    <h3>Workflows asynchrones</h3>
                    <p>6 workflows (<code>QObject</code>) orchestrent les modules métier. Ils délèguent l'exécution à <code>async_tasks.py</code> (QgsTask) en arrière-plan. Signaux standardisés : progress_changed, message_received, analysis_finished, error_occurred.</p>
                </div>
            </div>

            <!-- Technical Details Accordion -->
            <div class="accordion" style="margin-top: 3rem;">
                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                                <rect x="2" y="7" width="20" height="14" rx="2" ry="2"/>
                                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
                            </svg>
                            Détails techniques : Initialisation des composants
                        </h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p><strong>Dans __init__() (lignes 30-58) :</strong></p>
                        <ul style="color: var(--text-secondary); font-size: 0.95rem; line-height: 1.8; margin-left: 1.5rem;">
                            <li><code>self.maj_workflow = MajWorkflow()</code> - Workflow MAJ FT/BT</li>
                            <li><code>self.comac_workflow = ComacWorkflow()</code> - Workflow COMAC</li>
                            <li><code>self.capft_workflow = CapFtWorkflow()</code> - Workflow CAP FT</li>
                            <li><code>self.c6bd_workflow = C6BdWorkflow()</code> - Workflow C6 vs BD</li>
                            <li><code>self.police_workflow = PoliceWorkflow()</code> - Workflow Police C6</li>
                            <li><code>self.c6c3a_workflow = C6C3AWorkflow()</code> - Workflow C6-C3A-C7</li>
                            <li><code>self._dlg = None</code> - Dialog lazy init dans run()</li>
                            <li>Creation toolbar : <code>self.toolbar = self.iface.addToolBar()</code></li>
                        </ul>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                            Details techniques : Detection automatique du projet
                        </h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p><strong>project_detector.py</strong> analyse le dossier projet selectionne et detecte automatiquement :</p>
                        <ul style="color: var(--text-secondary); font-size: 0.95rem; line-height: 1.8; margin-left: 1.5rem;">
                            <li><strong>FT-BT KO</strong> : fichier Excel a la racine (pattern FT-BT KO*.xlsx)</li>
                            <li><strong>CAP FT</strong> : sous-dossier CAP FT/ contenant les etudes par CMD</li>
                            <li><strong>COMAC</strong> : sous-dossier COMAC/ ou ExportComac/</li>
                            <li><strong>C6</strong> : = dossier CAP FT (les annexes C6 sont les Excel d'etude FTTH-NGE-ETUDE-*.xlsx)</li>
                            <li><strong>GraceTHD</strong> : BASE DE DONNEES/NGE/ (verifie bpe.shp ou t_cheminement.shp)</li>
                            <li><strong>C7, C3A</strong> : fichiers ou dossiers a la racine</li>
                        </ul>
                        <p>Les modules sont automatiquement coches selon les fichiers detectes.</p>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                <polyline points="22 4 12 14.01 9 11.01"/>
                            </svg>
                            Details techniques : Execution par lot (BatchRunner)
                        </h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p><strong>BatchRunner</strong> execute les modules selectionnes de facon sequentielle. Le <strong>BatchOrchestrator</strong> fait le lien entre le dialog, le runner et les workflows :</p>
                        <ul style="color: var(--text-secondary); font-size: 0.95rem; line-height: 1.8; margin-left: 1.5rem;">
                            <li>L'utilisateur clique "Demarrer" avec les modules coches</li>
                            <li>Le BatchRunner lance les modules un par un dans l'ordre</li>
                            <li>Le BatchOrchestrator traduit les parametres du dialog en appels workflow</li>
                            <li>Les signaux workflow (progress, message, finished, error) sont relies au dialog</li>
                            <li>La progression globale est calculee par sous-plage (module 2/4 = 25-50%)</li>
                            <li>A la fin, un rapport Excel unifie est genere si possible</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Interface Section -->
        <section id="interface" style="margin-top: 4rem;">
            <div class="section-header">
                <h2>Interface unifiee</h2>
                <p>Un seul dialog pour toutes les operations</p>
            </div>

            <div class="audit-section">
                <h3 style="margin-bottom: 1.5rem; font-size: 1.1rem;">Structure du dialog PoleAerienDialogV2</h3>
                <div class="cards-grid">
                    <div class="card">
                        <div class="card-icon blue">
                            <img src="../images/icon-folder-open.svg" alt="Folder" width="24" height="24" style="filter: brightness(0) invert(1);">
                        </div>
                        <h3>Dossier projet</h3>
                        <p>Selection du dossier projet avec detection automatique de la structure (FT-BT KO, CAP FT, COMAC, GraceTHD, C7, C3A). Dossier d'export configurable separement.</p>
                    </div>
                    <div class="card">
                        <div class="card-icon green">
                            <img src="../images/icon-layers.svg" alt="Layers" width="24" height="24" style="filter: brightness(0) invert(1);">
                        </div>
                        <h3>Couches QGIS</h3>
                        <p>3 QgsMapLayerComboBox avec auto-detection : <code>infra_pt_pot</code> (points), <code>etude_cap_ft</code> (polygones), <code>etude_comac</code> (polygones). Filtres par type de geometrie.</p>
                    </div>
                    <div class="card">
                        <div class="card-icon purple">
                            <img src="../images/icon-check.svg" alt="Check" width="24" height="24" style="filter: brightness(0) invert(1);">
                        </div>
                        <h3>Modules d'analyse</h3>
                        <p>6 modules avec cases a cocher, auto-coches selon la detection. Boutons "Tout cocher / Tout decocher". Indicateurs [OK] / [--] par module.</p>
                    </div>
                    <div class="card">
                        <div class="card-icon orange">
                            <img src="../images/icon-chart.svg" alt="Log" width="24" height="24" style="filter: brightness(0) invert(1);">
                        </div>
                        <h3>Journal et progression</h3>
                        <p>QTextBrowser avec messages colores (info/succes/warning/erreur). Barre de progression animee (SmoothProgressController). Export du journal en fichier texte.</p>
                    </div>
                </div>

                <div style="margin-top: 2rem; padding: 1.5rem; background: var(--bg-tertiary); border-radius: var(--radius-sm); border: 1px solid var(--border);">
                    <h4 style="margin-bottom: 1rem; font-size: 1rem;">Structure du dossier projet attendue</h4>
                    <div class="code-block">
                        <code>
<span class="code-string">63041-B1I-PMZ-00003/</span>
  <span class="code-function">FT-BT KO B1L_00003.xlsx</span>       <span class="code-comment">-- MAJ BD</span>
  <span class="code-function">CAP FT/</span>                        <span class="code-comment">-- CAP_FT + C6 browse dir</span>
    CMD 1/
      FTTH-NGE-ETUDE-B1L-63041-7/  <span class="code-comment">-- Annexe C6 = study xlsx</span>
    CMD 2/...
  <span class="code-function">COMAC/</span>                         <span class="code-comment">-- COMAC</span>
  <span class="code-function">BASE DE DONNEES/</span>
    <span class="code-function">NGE/</span>                         <span class="code-comment">-- GraceTHD (bpe.shp, t_cheminement.shp)</span>
                        </code>
                    </div>
                </div>
            </div>
        </section>

        <!-- Architecture Section -->
        <section id="analytics">
            <div class="section-header">
                <h2>Architecture du plugin</h2>
                <p>Schémas explicatifs du fonctionnement des composants</p>
            </div>

            <!-- Diagram Tabs -->
            <div class="diagram-tabs">
                <button class="diagram-tab active" onclick="showDiagram('global')">Vue globale</button>
                <button class="diagram-tab" onclick="showDiagram('layers')">Architecture en couches</button>
                <button class="diagram-tab" onclick="showDiagram('dataflow')">Flux de données</button>
                <button class="diagram-tab" onclick="showDiagram('modules')">Modules détaillés</button>
                <button class="diagram-tab" onclick="showDiagram('security')">Vérif Sécurité</button>
                <button class="diagram-tab" onclick="showDiagram('dag')" style="background: rgba(16,185,129,0.1); border: 1px solid #10b981;">DAG Imports</button>
            </div>

            <!-- Architecture en couches -->
            <div id="diagram-layers" class="diagram-panel">
                <div class="diagram-container">
                    <h3 class="diagram-title">Architecture applicative en couches</h3>
                    <svg class="architecture-svg" viewBox="0 0 1100 800" xmlns="http://www.w3.org/2000/svg" style="max-height: 820px;">
                        <defs>
                            <marker id="arrow-dep" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
                            </marker>
                            <linearGradient id="grad-ui" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#7c3aed;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="grad-ctrl" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#2563eb;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="grad-metier" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="grad-rules" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#f59e0b;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#d97706;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="grad-data" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#ef4444;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#dc2626;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <rect width="1100" height="800" fill="#f8fafc"/>

                        <!-- COUCHE 1: UI -->
                        <g class="node">
                            <rect x="50" y="30" width="1000" height="100" rx="12" fill="url(#grad-ui)" stroke="#7c3aed" stroke-width="2" opacity="0.95"/>
                            <text x="80" y="60" font-weight="700" fill="white" font-size="16">COUCHE UI (Qt)</text>
                            
                            <rect x="80" y="75" width="160" height="40" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="160" y="92" text-anchor="middle" fill="white" font-size="11" font-weight="600">PoleAerien.py</text>
                            <text x="160" y="105" text-anchor="middle" fill="#ddd6fe" font-size="9">Point d'entree (128 lig.)</text>

                            <rect x="260" y="75" width="180" height="40" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="350" y="92" text-anchor="middle" fill="white" font-size="11" font-weight="600">dialog_v2.py</text>
                            <text x="350" y="105" text-anchor="middle" fill="#ddd6fe" font-size="9">PoleAerienDialogV2</text>

                            <rect x="460" y="75" width="180" height="40" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="550" y="92" text-anchor="middle" fill="white" font-size="11" font-weight="600">batch_orchestrator.py</text>
                            <text x="550" y="105" text-anchor="middle" fill="#ddd6fe" font-size="9">Dialog - Workflows</text>

                            <rect x="660" y="75" width="160" height="40" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="740" y="92" text-anchor="middle" fill="white" font-size="11" font-weight="600">batch_runner.py</text>
                            <text x="740" y="105" text-anchor="middle" fill="#ddd6fe" font-size="9">Execution sequentielle</text>

                            <rect x="840" y="75" width="160" height="40" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="920" y="92" text-anchor="middle" fill="white" font-size="11" font-weight="600">project_detector.py</text>
                            <text x="920" y="105" text-anchor="middle" fill="#ddd6fe" font-size="9">Auto-detection projet</text>
                        </g>

                        <!-- Flèche UI → Orchestration -->
                        <path d="M 550 130 L 550 155" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrow-dep)" stroke-dasharray="5,3"/>

                        <!-- COUCHE 2: WORKFLOWS (NOUVELLE ARCHITECTURE) -->
                        <g class="node">
                            <rect x="50" y="155" width="1000" height="140" rx="12" fill="url(#grad-ctrl)" stroke="#2563eb" stroke-width="2" opacity="0.95"/>
                            <text x="80" y="180" font-weight="700" fill="white" font-size="16">COUCHE WORKFLOWS (Orchestration)</text>
                            
                            <!-- Ligne 1: 3 workflows -->
                            <rect x="80" y="195" width="140" height="40" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="150" y="210" text-anchor="middle" fill="white" font-size="10" font-weight="600">MajWorkflow</text>
                            <text x="150" y="223" text-anchor="middle" fill="#bfdbfe" font-size="8">MAJ FT/BT</text>

                            <rect x="235" y="195" width="140" height="40" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="305" y="210" text-anchor="middle" fill="white" font-size="10" font-weight="600">CapFtWorkflow</text>
                            <text x="305" y="223" text-anchor="middle" fill="#bfdbfe" font-size="8">Vérif FT</text>

                            <rect x="390" y="195" width="140" height="40" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="460" y="210" text-anchor="middle" fill="white" font-size="10" font-weight="600">ComacWorkflow</text>
                            <text x="460" y="223" text-anchor="middle" fill="#bfdbfe" font-size="8">Vérif BT</text>

                            <!-- Ligne 2: 3 workflows -->
                            <rect x="80" y="245" width="140" height="40" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="150" y="260" text-anchor="middle" fill="white" font-size="10" font-weight="600">C6BdWorkflow</text>
                            <text x="150" y="273" text-anchor="middle" fill="#bfdbfe" font-size="8">C6 vs BD</text>

                            <rect x="235" y="245" width="140" height="40" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="305" y="260" text-anchor="middle" fill="white" font-size="10" font-weight="600">C6C3AWorkflow</text>
                            <text x="305" y="273" text-anchor="middle" fill="#bfdbfe" font-size="8">C6/C3A/C7</text>

                            <rect x="390" y="245" width="140" height="40" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="460" y="260" text-anchor="middle" fill="white" font-size="10" font-weight="600">PoliceWorkflow</text>
                            <text x="460" y="273" text-anchor="middle" fill="#bfdbfe" font-size="8">Police C6</text>

                            <!-- Infrastructure async -->
                            <rect x="550" y="195" width="220" height="90" rx="8" fill="rgba(255,255,255,0.15)" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                            <text x="660" y="215" text-anchor="middle" fill="white" font-size="10" font-weight="600">Infrastructure Async</text>
                            <text x="660" y="235" text-anchor="middle" fill="#bfdbfe" font-size="8">async_tasks.py (QgsTask)</text>
                            <text x="660" y="250" text-anchor="middle" fill="#bfdbfe" font-size="8">maj_sql_background.py</text>
                            <text x="660" y="265" text-anchor="middle" fill="#bfdbfe" font-size="8">SmoothProgressController</text>
                            <text x="660" y="280" text-anchor="middle" fill="#bfdbfe" font-size="8">TaskSignals (Qt)</text>
                        </g>

                        <!-- Flèche Workflows → Métier -->
                        <path d="M 550 295 L 550 320" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrow-dep)" stroke-dasharray="5,3"/>

                        <!-- COUCHE 3: MÉTIER -->
                        <g class="node">
                            <rect x="50" y="320" width="1000" height="120" rx="12" fill="url(#grad-metier)" stroke="#059669" stroke-width="2" opacity="0.95"/>
                            <text x="80" y="345" font-weight="700" fill="white" font-size="16">COUCHE MÉTIER (Logique Business)</text>
                            
                            <rect x="80" y="360" width="140" height="30" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="150" y="378" text-anchor="middle" fill="white" font-size="10" font-weight="600">Maj_Ft_Bt.py</text>

                            <rect x="235" y="360" width="110" height="30" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="290" y="378" text-anchor="middle" fill="white" font-size="10" font-weight="600">CapFt.py</text>

                            <rect x="360" y="360" width="110" height="30" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="415" y="378" text-anchor="middle" fill="white" font-size="10" font-weight="600">Comac.py</text>

                            <rect x="485" y="360" width="130" height="30" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="550" y="378" text-anchor="middle" fill="white" font-size="10" font-weight="600">C6_vs_Bd.py</text>

                            <rect x="630" y="360" width="180" height="30" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="720" y="378" text-anchor="middle" fill="white" font-size="10" font-weight="600">C6_vs_C3A_vs_Bd.py</text>

                            <rect x="825" y="360" width="130" height="30" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="890" y="378" text-anchor="middle" fill="white" font-size="10" font-weight="600">PoliceC6.py</text>

                            <rect x="240" y="395" width="140" height="40" rx="8" fill="rgba(255,255,255,0.3)" stroke="white" stroke-width="1"/>
                            <text x="310" y="414" text-anchor="middle" fill="white" font-size="11" font-weight="600">cable_analyzer.py</text>
                            <text x="310" y="429" text-anchor="middle" fill="#d1fae5" font-size="9">CDI + posemode</text>

                            <rect x="400" y="395" width="140" height="40" rx="8" fill="rgba(255,255,255,0.3)" stroke="white" stroke-width="1"/>
                            <text x="470" y="414" text-anchor="middle" fill="white" font-size="11" font-weight="600">qgis_utils.py</text>
                            <text x="470" y="429" text-anchor="middle" fill="#d1fae5" font-size="9">+ core_utils.py</text>

                            <rect x="560" y="395" width="140" height="40" rx="8" fill="rgba(255,255,255,0.3)" stroke="white" stroke-width="1"/>
                            <text x="630" y="414" text-anchor="middle" fill="white" font-size="11" font-weight="600">db_connection.py</text>
                            <text x="630" y="429" text-anchor="middle" fill="#d1fae5" font-size="9">fddcpi2() + psycopg2</text>
                        </g>

                        <!-- Flèche Métier → Règles -->
                        <path d="M 550 440 L 550 465" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrow-dep)" stroke-dasharray="5,3"/>

                        <!-- COUCHE 4: RÈGLES & VALIDATION -->
                        <g class="node">
                            <rect x="50" y="465" width="1000" height="120" rx="12" fill="url(#grad-rules)" stroke="#d97706" stroke-width="2" opacity="0.95"/>
                            <text x="80" y="490" font-weight="700" fill="white" font-size="16">COUCHE RÈGLES &amp; VALIDATION</text>
                            
                            <rect x="80" y="505" width="160" height="75" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="160" y="522" text-anchor="middle" fill="white" font-size="11" font-weight="600">security_rules.py</text>
                            <text x="160" y="535" text-anchor="middle" fill="#fef3c7" font-size="8">PORTEES_MAX</text>
                            <text x="160" y="545" text-anchor="middle" fill="#fef3c7" font-size="8">verifier_portee()</text>
                            <text x="160" y="555" text-anchor="middle" fill="#fef3c7" font-size="8">NFC 11201-A1</text>
                            <text x="160" y="570" text-anchor="middle" fill="#fde68a" font-size="7">Guards division/0</text>

                            <rect x="260" y="505" width="160" height="75" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="340" y="522" text-anchor="middle" fill="white" font-size="11" font-weight="600">pcm_parser.py</text>
                            <text x="340" y="535" text-anchor="middle" fill="#fef3c7" font-size="8">parse_pcm_file()</text>
                            <text x="340" y="545" text-anchor="middle" fill="#fef3c7" font-size="8">EtudePCM</text>
                            <text x="340" y="555" text-anchor="middle" fill="#fef3c7" font-size="8">XML → dataclass</text>
                            <text x="340" y="570" text-anchor="middle" fill="#fde68a" font-size="7">ISO-8859-1</text>

                            <rect x="440" y="505" width="160" height="75" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="520" y="522" text-anchor="middle" fill="white" font-size="11" font-weight="600">comac_loader.py</text>
                            <text x="520" y="535" text-anchor="middle" fill="#fef3c7" font-size="8">load_etude_comac()</text>
                            <text x="520" y="545" text-anchor="middle" fill="#fef3c7" font-size="8">Fusion PCM+Excel</text>
                            <text x="520" y="555" text-anchor="middle" fill="#fef3c7" font-size="8">Détection ZVF/ZVN</text>
                            <text x="520" y="570" text-anchor="middle" fill="#fde68a" font-size="7">Auto-detect zones</text>
                        </g>

                        <!-- Flèche Règles → Données -->
                        <path d="M 550 585 L 550 610" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrow-dep)" stroke-dasharray="5,3"/>

                        <!-- COUCHE 5: DONNÉES -->
                        <g class="node">
                            <rect x="50" y="610" width="1000" height="110" rx="12" fill="url(#grad-data)" stroke="#dc2626" stroke-width="2" opacity="0.95"/>
                            <text x="80" y="635" font-weight="700" fill="white" font-size="16">COUCHE DONNÉES</text>
                            
                            <rect x="80" y="650" width="200" height="65" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="180" y="667" text-anchor="middle" fill="white" font-size="11" font-weight="600">comac_db_reader.py</text>
                            <text x="180" y="680" text-anchor="middle" fill="#fee2e2" font-size="8">get_cable_capacite()</text>
                            <text x="180" y="690" text-anchor="middle" fill="#fee2e2" font-size="8">get_zone_vent_*()</text>
                            <text x="180" y="700" text-anchor="middle" fill="#fee2e2" font-size="8">Cache thread-safe</text>

                            <rect x="300" y="650" width="120" height="65" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="360" y="667" text-anchor="middle" fill="white" font-size="10" font-weight="600">PostgreSQL</text>
                            <text x="360" y="680" text-anchor="middle" fill="#fee2e2" font-size="8">cables (591)</text>
                            <text x="360" y="690" text-anchor="middle" fill="#fee2e2" font-size="8">hypotheses</text>
                            <text x="360" y="700" text-anchor="middle" fill="#fee2e2" font-size="8">schema comac</text>

                            <rect x="440" y="650" width="120" height="65" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="500" y="667" text-anchor="middle" fill="white" font-size="10" font-weight="600">fddcpi2()</text>
                            <text x="500" y="680" text-anchor="middle" fill="#fee2e2" font-size="8">cables decoupes</text>
                            <text x="500" y="690" text-anchor="middle" fill="#fee2e2" font-size="8">cab_type, posemode</text>
                            <text x="500" y="700" text-anchor="middle" fill="#fee2e2" font-size="8">SQL function PG</text>

                            <rect x="580" y="650" width="140" height="65" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="650" y="667" text-anchor="middle" fill="white" font-size="10" font-weight="600">Couches QGIS</text>
                            <text x="650" y="680" text-anchor="middle" fill="#fee2e2" font-size="8">infra_pt_pot</text>
                            <text x="650" y="690" text-anchor="middle" fill="#fee2e2" font-size="8">etude_cap_ft</text>
                            <text x="650" y="700" text-anchor="middle" fill="#fee2e2" font-size="8">EPSG:2154</text>

                            <rect x="740" y="650" width="120" height="65" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="800" y="667" text-anchor="middle" fill="white" font-size="10" font-weight="600">Fichiers Excel</text>
                            <text x="800" y="680" text-anchor="middle" fill="#fee2e2" font-size="8">FT/BT KO</text>
                            <text x="800" y="690" text-anchor="middle" fill="#fee2e2" font-size="8">C6, C3A, C7</text>
                            <text x="800" y="700" text-anchor="middle" fill="#fee2e2" font-size="8">CAP_FT, COMAC</text>
                        </g>

                        <!-- Annotations statistiques -->
                        <g opacity="0.9">
                            <rect x="50" y="735" width="1000" height="50" rx="8" fill="white" stroke="#e2e8f0" stroke-width="1"/>
                            <!-- Chart icon SVG -->
                            <g transform="translate(80, 745)">
                                <rect x="0" y="8" width="3" height="8" fill="#3b82f6" rx="1"/>
                                <rect x="5" y="4" width="3" height="12" fill="#3b82f6" rx="1"/>
                                <rect x="10" y="0" width="3" height="16" fill="#3b82f6" rx="1"/>
                            </g>
                            <text x="100" y="757" font-weight="600" fill="#334155" font-size="11">Statistiques v3.0</text>
                            <text x="250" y="757" fill="#64748b" font-size="10">~24 fichiers Python</text>
                            <text x="400" y="757" fill="#64748b" font-size="10">~9500 lignes</text>
                            <text x="520" y="757" fill="#64748b" font-size="10">6 workflows</text>
                            <text x="640" y="757" fill="#64748b" font-size="10">6 modules métier</text>
                            <text x="790" y="757" fill="#64748b" font-size="10">Thread-safe async</text>
                            <g transform="translate(940, 747)">
                                <circle cx="5" cy="5" r="8" fill="#10b981"/>
                                <polyline points="2,5 4.5,7.5 8,3" fill="none" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </g>
                            <text x="960" y="757" fill="#10b981" font-size="10" font-weight="600">QGIS 3.28+</text>
                            
                            <text x="80" y="775" fill="#94a3b8" font-size="9">Architecture en 5 couches : UI → Workflows → Métier → Règles → Données</text>
                        </g>
                    </svg>

                    <div class="legend" style="margin-top: 1.5rem;">
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);"></div>
                            <span>Couche UI (Interface utilisateur)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></div>
                            <span>Couche Orchestration (Async, signaux)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #10b981, #059669);"></div>
                            <span>Couche Métier (Logique business)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></div>
                            <span>Couche Règles (Validation, sécurité)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #ef4444, #dc2626);"></div>
                            <span>Couche Données (CSV, QGIS, Excel)</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Global Architecture Diagram - Clean Hierarchical Flow -->
            <div id="diagram-global" class="diagram-panel active">
                <div class="diagram-container" style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%); border: none;">
                    <h3 class="diagram-title" style="color: white;">Vue d'ensemble - Architecture en flux (v3.0)</h3>
                    <svg class="architecture-svg" viewBox="0 0 1200 700" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <!-- Gradients modernes -->
                            <linearGradient id="grad-core" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#1d4ed8;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="grad-gold" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#fbbf24;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#f59e0b;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="grad-emerald" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#34d399;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#10b981;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="grad-violet" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#a78bfa;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#7c3aed;stop-opacity:1" />
                            </linearGradient>
                            <filter id="glow-blue" x="-50%" y="-50%" width="200%" height="200%">
                                <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
                                <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
                            </filter>
                            <filter id="glow-gold" x="-50%" y="-50%" width="200%" height="200%">
                                <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                                <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
                            </filter>
                            <marker id="arrow-neon" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto">
                                <polygon points="0 0, 12 4, 0 8" fill="#60a5fa"/>
                            </marker>
                        </defs>
                        
                        <!-- Background pattern -->
                        <pattern id="grid-dark" width="40" height="40" patternUnits="userSpaceOnUse">
                            <path d="M 40 0 L 0 0 0 40" fill="none" stroke="rgba(255,255,255,0.03)" stroke-width="1"/>
                        </pattern>
                        <rect width="1200" height="700" fill="url(#grid-dark)"/>

                        <!-- Visual Zones (Background grouping) -->
                        <rect x="30" y="150" width="180" height="400" rx="16" fill="rgba(251,191,36,0.08)" stroke="rgba(251,191,36,0.2)" stroke-width="1"/>
                        <text x="120" y="180" text-anchor="middle" fill="#fbbf24" font-size="10" font-weight="600">INPUTS</text>
                        
                        <rect x="250" y="100" width="200" height="500" rx="16" fill="rgba(59,130,246,0.08)" stroke="rgba(59,130,246,0.2)" stroke-width="1"/>
                        <text x="350" y="130" text-anchor="middle" fill="#60a5fa" font-size="10" font-weight="600">CORE</text>
                        
                        <rect x="490" y="50" width="320" height="600" rx="16" fill="rgba(139,92,246,0.08)" stroke="rgba(139,92,246,0.2)" stroke-width="1"/>
                        <text x="650" y="80" text-anchor="middle" fill="#a78bfa" font-size="10" font-weight="600">WORKFLOWS</text>
                        
                        <rect x="850" y="100" width="320" height="500" rx="16" fill="rgba(16,185,129,0.08)" stroke="rgba(16,185,129,0.2)" stroke-width="1"/>
                        <text x="1010" y="130" text-anchor="middle" fill="#34d399" font-size="10" font-weight="600">MODULES</text>

                        <!-- COLONNE 2: CORE -->
                        <g class="node" filter="url(#glow-blue)">
                            <rect x="270" y="280" width="160" height="140" rx="16" fill="url(#grad-core)" stroke="#60a5fa" stroke-width="3"/>
                            <text x="350" y="310" text-anchor="middle" font-weight="700" fill="white" font-size="18">CORE</text>
                            <text x="350" y="335" text-anchor="middle" fill="#bfdbfe" font-size="12">PoleAerien.py</text>
                            <text x="350" y="355" text-anchor="middle" fill="#93c5fd" font-size="10">Point d'entree</text>
                            <text x="350" y="375" text-anchor="middle" fill="#60a5fa" font-size="9">128 lignes</text>
                        </g>

                        <!-- COLONNE 3: WORKFLOWS (Centre) -->
                        <g class="node">
                            <rect x="520" y="150" width="240" height="60" rx="10" fill="rgba(251,191,36,0.2)" stroke="#fbbf24" stroke-width="2"/>
                            <text x="550" y="175" text-anchor="start" font-weight="600" fill="#fbbf24" font-size="11">MajWorkflow</text>
                            <text x="550" y="193" text-anchor="start" fill="#fde68a" font-size="8">maj_workflow.py</text>
                            <circle cx="730" cy="180" r="18" fill="#fbbf24"/>
                            <text x="730" y="186" text-anchor="middle" fill="#78350f" font-size="11" font-weight="700">0</text>
                        </g>

                        <g class="node">
                            <rect x="520" y="225" width="240" height="60" rx="10" fill="rgba(52,211,153,0.2)" stroke="#34d399" stroke-width="2"/>
                            <text x="550" y="250" text-anchor="start" font-weight="600" fill="#34d399" font-size="11">CapFtWorkflow</text>
                            <text x="550" y="268" text-anchor="start" fill="#a7f3d0" font-size="8">capft_workflow.py</text>
                            <circle cx="730" cy="255" r="18" fill="#34d399"/>
                            <text x="730" y="261" text-anchor="middle" fill="#064e3b" font-size="11" font-weight="700">2</text>
                        </g>

                        <g class="node">
                            <rect x="520" y="300" width="240" height="60" rx="10" fill="rgba(59,130,246,0.2)" stroke="#3b82f6" stroke-width="2"/>
                            <text x="550" y="325" text-anchor="start" font-weight="600" fill="#60a5fa" font-size="11">ComacWorkflow</text>
                            <text x="550" y="343" text-anchor="start" fill="#bfdbfe" font-size="8">comac_workflow.py</text>
                            <circle cx="730" cy="330" r="18" fill="#3b82f6"/>
                            <text x="730" y="336" text-anchor="middle" fill="white" font-size="11" font-weight="700">3</text>
                        </g>

                        <g class="node">
                            <rect x="520" y="375" width="240" height="60" rx="10" fill="rgba(236,72,153,0.2)" stroke="#ec4899" stroke-width="2"/>
                            <text x="550" y="400" text-anchor="start" font-weight="600" fill="#f472b6" font-size="11">C6BdWorkflow</text>
                            <text x="550" y="418" text-anchor="start" fill="#fbcfe8" font-size="8">c6bd_workflow.py</text>
                            <circle cx="730" cy="405" r="18" fill="#ec4899"/>
                            <text x="730" y="411" text-anchor="middle" fill="white" font-size="11" font-weight="700">1</text>
                        </g>

                        <g class="node">
                            <rect x="520" y="450" width="240" height="60" rx="10" fill="rgba(139,92,246,0.2)" stroke="#8b5cf6" stroke-width="2"/>
                            <text x="550" y="475" text-anchor="start" font-weight="600" fill="#a78bfa" font-size="11">C6C3AWorkflow</text>
                            <text x="550" y="493" text-anchor="start" fill="#ddd6fe" font-size="8">c6c3a_workflow.py</text>
                            <circle cx="730" cy="480" r="18" fill="#8b5cf6"/>
                            <text x="730" y="486" text-anchor="middle" fill="white" font-size="11" font-weight="700">5</text>
                        </g>

                        <g class="node">
                            <rect x="520" y="525" width="240" height="60" rx="10" fill="rgba(168,85,247,0.2)" stroke="#a855f7" stroke-width="2"/>
                            <text x="550" y="550" text-anchor="start" font-weight="600" fill="#c084fc" font-size="11">PoliceWorkflow</text>
                            <text x="550" y="568" text-anchor="start" fill="#e9d5ff" font-size="8">police_workflow.py</text>
                            <circle cx="730" cy="555" r="18" fill="#a855f7"/>
                            <text x="730" y="561" text-anchor="middle" fill="white" font-size="11" font-weight="700">4</text>
                        </g>

                        <!-- COLONNE 4: MODULES (Droite) -->
                        <g class="node">
                            <rect x="880" y="150" width="270" height="60" rx="10" fill="rgba(251,191,36,0.15)" stroke="#fbbf24" stroke-width="2"/>
                            <text x="1015" y="175" text-anchor="middle" fill="#fbbf24" font-size="12" font-weight="600">MAJ FT/BT</text>
                            <text x="1015" y="193" text-anchor="middle" fill="#fcd34d" font-size="9">Maj_Ft_Bt.py (800 lignes)</text>
                        </g>

                        <g class="node">
                            <rect x="880" y="225" width="270" height="60" rx="10" fill="rgba(52,211,153,0.15)" stroke="#34d399" stroke-width="2"/>
                            <text x="1015" y="250" text-anchor="middle" fill="#34d399" font-size="12" font-weight="600">CAP_FT</text>
                            <text x="1015" y="268" text-anchor="middle" fill="#6ee7b7" font-size="9">CapFt.py (154 lignes)</text>
                        </g>

                        <g class="node">
                            <rect x="880" y="300" width="270" height="60" rx="10" fill="rgba(59,130,246,0.15)" stroke="#3b82f6" stroke-width="2"/>
                            <text x="1015" y="325" text-anchor="middle" fill="#60a5fa" font-size="12" font-weight="600">COMAC</text>
                            <text x="1015" y="343" text-anchor="middle" fill="#93c5fd" font-size="9">Comac.py (564 lignes)</text>
                        </g>

                        <g class="node">
                            <rect x="880" y="375" width="270" height="60" rx="10" fill="rgba(236,72,153,0.15)" stroke="#ec4899" stroke-width="2"/>
                            <text x="1015" y="400" text-anchor="middle" fill="#f472b6" font-size="12" font-weight="600">C6 vs BD</text>
                            <text x="1015" y="418" text-anchor="middle" fill="#f9a8d4" font-size="9">C6_vs_Bd.py (382 lignes)</text>
                        </g>

                        <g class="node">
                            <rect x="880" y="450" width="270" height="60" rx="10" fill="rgba(139,92,246,0.15)" stroke="#8b5cf6" stroke-width="2"/>
                            <text x="1015" y="475" text-anchor="middle" fill="#a78bfa" font-size="12" font-weight="600">C6/C3A/C7/BD</text>
                            <text x="1015" y="493" text-anchor="middle" fill="#c4b5fd" font-size="9">C6_vs_C3A_vs_Bd.py (406 lignes)</text>
                        </g>

                        <g class="node">
                            <rect x="880" y="525" width="270" height="60" rx="10" fill="rgba(168,85,247,0.15)" stroke="#a855f7" stroke-width="2"/>
                            <text x="1015" y="550" text-anchor="middle" fill="#c084fc" font-size="12" font-weight="600">Police C6</text>
                            <text x="1015" y="568" text-anchor="middle" fill="#e9d5ff" font-size="9">PoliceC6.py (718 lignes)</text>
                        </g>

                        <!-- COLONNE 1: INPUTS (Gauche) -->
                        <g class="node" filter="url(#glow-gold)">
                            <rect x="50" y="200" width="140" height="70" rx="12" fill="url(#grad-gold)" stroke="#fbbf24" stroke-width="2"/>
                            <text x="120" y="225" text-anchor="middle" font-weight="600" fill="#78350f" font-size="12">EXCEL</text>
                            <text x="120" y="245" text-anchor="middle" fill="#92400e" font-size="9">FT/BT, C6</text>
                            <text x="120" y="258" text-anchor="middle" fill="#a16207" font-size="9">C3A, C7</text>
                        </g>

                        <g class="node">
                            <rect x="50" y="290" width="140" height="70" rx="12" fill="url(#grad-emerald)" stroke="#34d399" stroke-width="2"/>
                            <text x="120" y="315" text-anchor="middle" font-weight="600" fill="#064e3b" font-size="12">QGIS</text>
                            <text x="120" y="335" text-anchor="middle" fill="#065f46" font-size="9">infra_pt_pot</text>
                            <text x="120" y="348" text-anchor="middle" fill="#047857" font-size="9">études</text>
                        </g>

                        <g class="node">
                            <rect x="50" y="380" width="140" height="70" rx="12" fill="rgba(99,102,241,0.8)" stroke="#818cf8" stroke-width="2"/>
                            <text x="120" y="405" text-anchor="middle" font-weight="600" fill="white" font-size="12">COMAC_DB</text>
                            <text x="120" y="425" text-anchor="middle" fill="#c7d2fe" font-size="9">PostgreSQL</text>
                            <text x="120" y="438" text-anchor="middle" fill="#a5b4fc" font-size="9">591 câbles</text>
                        </g>


                        <!-- UI Dialog (Haut) -->
                        <g class="node">
                            <rect x="270" y="150" width="160" height="80" rx="16" fill="url(#grad-violet)" stroke="#a78bfa" stroke-width="2"/>
                            <text x="350" y="180" text-anchor="middle" font-weight="600" fill="white" font-size="13">INTERFACE UI</text>
                            <text x="350" y="198" text-anchor="middle" fill="#ddd6fe" font-size="10">PoleAerienDialogV2</text>
                            <text x="350" y="215" text-anchor="middle" fill="#c4b5fd" font-size="9">Dialog unifie</text>
                        </g>
                        <path d="M 350 230 L 350 280" stroke="#a78bfa" stroke-width="2" fill="none" marker-end="url(#arrow-neon)" opacity="0.7"/>

                        <!-- CONNEXIONS: Inputs → CORE (simples flèches) -->
                        <path d="M 190 235 L 270 320" stroke="#fbbf24" stroke-width="2" fill="none" opacity="0.4" stroke-dasharray="4 2"/>
                        <path d="M 190 325 L 270 340" stroke="#34d399" stroke-width="2" fill="none" opacity="0.4" stroke-dasharray="4 2"/>
                        <path d="M 190 415 L 270 380" stroke="#818cf8" stroke-width="2" fill="none" opacity="0.4" stroke-dasharray="4 2"/>

                        <!-- CONNEXIONS: CORE → Workflows (flèches horizontales) -->
                        <path d="M 430 310 L 520 180" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-neon)" opacity="0.6" class="flow-arrow"/>
                        <path d="M 430 330 L 520 255" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-neon)" opacity="0.6" class="flow-arrow"/>
                        <path d="M 430 350 L 520 330" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-neon)" opacity="0.6" class="flow-arrow"/>
                        <path d="M 430 370 L 520 405" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-neon)" opacity="0.6" class="flow-arrow"/>
                        <path d="M 430 390 L 520 480" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-neon)" opacity="0.6" class="flow-arrow"/>
                        <path d="M 430 410 L 520 555" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-neon)" opacity="0.6" class="flow-arrow"/>

                        <!-- CONNEXIONS: Workflows → Modules (flèches horizontales directes) -->
                        <path d="M 760 180 L 880 180" stroke="#fbbf24" stroke-width="2.5" fill="none" marker-end="url(#arrow-neon)" opacity="0.8" class="flow-arrow"/>
                        <path d="M 760 255 L 880 255" stroke="#34d399" stroke-width="2.5" fill="none" marker-end="url(#arrow-neon)" opacity="0.8" class="flow-arrow"/>
                        <path d="M 760 330 L 880 330" stroke="#3b82f6" stroke-width="2.5" fill="none" marker-end="url(#arrow-neon)" opacity="0.8" class="flow-arrow"/>
                        <path d="M 760 405 L 880 405" stroke="#ec4899" stroke-width="2.5" fill="none" marker-end="url(#arrow-neon)" opacity="0.8" class="flow-arrow"/>
                        <path d="M 760 480 L 880 480" stroke="#8b5cf6" stroke-width="2.5" fill="none" marker-end="url(#arrow-neon)" opacity="0.8" class="flow-arrow"/>
                        <path d="M 760 555 L 880 555" stroke="#a855f7" stroke-width="2.5" fill="none" marker-end="url(#arrow-neon)" opacity="0.8" class="flow-arrow"/>

                        <!-- Flow Direction Legend (Bottom) -->
                        <g>
                            <rect x="350" y="620" width="500" height="50" rx="12" fill="rgba(255,255,255,0.05)" stroke="rgba(255,255,255,0.15)" stroke-width="1"/>
                            <text x="600" y="640" text-anchor="middle" fill="#94a3b8" font-size="11" font-weight="600">FLUX DE DONNÉES</text>
                            <path d="M 380 655 L 480 655" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-neon)"/>
                            <text x="430" y="650" text-anchor="middle" fill="#60a5fa" font-size="9">Inputs</text>
                            <path d="M 510 655 L 610 655" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-neon)"/>
                            <text x="560" y="650" text-anchor="middle" fill="#60a5fa" font-size="9">Core</text>
                            <path d="M 640 655 L 740 655" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-neon)"/>
                            <text x="690" y="650" text-anchor="middle" fill="#60a5fa" font-size="9">Workflows</text>
                            <path d="M 770 655 L 820 655" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-neon)"/>
                            <text x="795" y="650" text-anchor="middle" fill="#60a5fa" font-size="9">Modules</text>
                        </g>

                        <!-- Version badge -->
                        <g>
                            <rect x="1030" y="620" width="120" height="35" rx="17" fill="rgba(16,185,129,0.2)" stroke="#10b981" stroke-width="1"/>
                            <text x="1090" y="642" text-anchor="middle" fill="#34d399" font-size="11" font-weight="600">v3.0</text>
                        </g>
                    </svg>

                    <div class="legend" style="border-top-color: rgba(255,255,255,0.1);">
                        <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #fbbf24, #f59e0b);"></div><span style="color: #94a3b8;">Inputs (Excel, QGIS, DB)</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);"></div><span style="color: #94a3b8;">Core Orchestrateur</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #a78bfa, #7c3aed);"></div><span style="color: #94a3b8;">Workflows (6)</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #34d399, #10b981);"></div><span style="color: #94a3b8;">Modules Métier (6)</span></div>
                    </div>
                </div>
            </div>

            <!-- Data Flow Diagram - Style Pipeline Moderne -->
            <div id="diagram-dataflow" class="diagram-panel">
                <div class="diagram-container" style="background: linear-gradient(180deg, #f8fafc 0%, #e2e8f0 100%);">
                    <h3 class="diagram-title">Pipeline de traitement - Flux de données (Architecture Workflows)</h3>
                    <svg class="architecture-svg" viewBox="0 0 1100 600" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="pipe-grad" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:0.3" />
                                <stop offset="50%" style="stop-color:#8b5cf6;stop-opacity:0.3" />
                                <stop offset="100%" style="stop-color:#10b981;stop-opacity:0.3" />
                            </linearGradient>
                            <filter id="card-shadow" x="-10%" y="-10%" width="120%" height="130%">
                                <feDropShadow dx="0" dy="4" stdDeviation="8" flood-opacity="0.15"/>
                            </filter>
                            <marker id="pipe-arrow" markerWidth="15" markerHeight="10" refX="12" refY="5" orient="auto">
                                <path d="M 0 0 L 15 5 L 0 10 L 4 5 Z" fill="#3b82f6"/>
                            </marker>
                        </defs>

                        <!-- Pipeline principal (tube) -->
                        <rect x="80" y="280" width="940" height="60" rx="30" fill="url(#pipe-grad)" stroke="#94a3b8" stroke-width="2" stroke-dasharray="8 4"/>
                        
                        <!-- Workflow Layer (bande supérieure) -->
                        <rect x="80" y="200" width="940" height="50" rx="25" fill="rgba(59,130,246,0.15)" stroke="#3b82f6" stroke-width="2" stroke-dasharray="4 2"/>
                        <text x="550" y="230" text-anchor="middle" fill="#1e40af" font-size="12" font-weight="600">COUCHE WORKFLOWS (Orchestration Async)</text>
                        
                        <!-- Cercles de progression -->
                        <circle cx="180" cy="310" r="25" fill="white" stroke="#f59e0b" stroke-width="3"/>
                        <text x="180" y="315" text-anchor="middle" fill="#f59e0b" font-size="14" font-weight="700">1</text>
                        
                        <circle cx="350" cy="310" r="25" fill="white" stroke="#8b5cf6" stroke-width="3"/>
                        <text x="350" y="315" text-anchor="middle" fill="#8b5cf6" font-size="14" font-weight="700">2</text>
                        
                        <circle cx="550" cy="310" r="25" fill="white" stroke="#3b82f6" stroke-width="3"/>
                        <text x="550" y="315" text-anchor="middle" fill="#3b82f6" font-size="14" font-weight="700">3</text>
                        
                        <circle cx="750" cy="310" r="25" fill="white" stroke="#10b981" stroke-width="3"/>
                        <text x="750" y="315" text-anchor="middle" fill="#10b981" font-size="14" font-weight="700">4</text>
                        
                        <circle cx="920" cy="310" r="25" fill="white" stroke="#059669" stroke-width="3"/>
                        <text x="920" y="315" text-anchor="middle" fill="#059669" font-size="14" font-weight="700">5</text>

                        <!-- Workflow nodes (sur la bande) -->
                        <circle cx="350" cy="225" r="20" fill="#8b5cf6" opacity="0.8"/>
                        <text x="350" y="230" text-anchor="middle" fill="white" font-size="9" font-weight="600">WF</text>
                        
                        <circle cx="550" cy="225" r="20" fill="#3b82f6" opacity="0.8"/>
                        <text x="550" y="230" text-anchor="middle" fill="white" font-size="9" font-weight="600">WF</text>
                        
                        <circle cx="750" cy="225" r="20" fill="#10b981" opacity="0.8"/>
                        <text x="750" y="230" text-anchor="middle" fill="white" font-size="9" font-weight="600">WF</text>

                        <!-- Flèches entre étapes -->
                        <path d="M 205 310 L 320 310" stroke="#3b82f6" stroke-width="3" fill="none" marker-end="url(#pipe-arrow)" class="flow-arrow"/>
                        <path d="M 375 310 L 520 310" stroke="#3b82f6" stroke-width="3" fill="none" marker-end="url(#pipe-arrow)" class="flow-arrow"/>
                        <path d="M 575 310 L 720 310" stroke="#3b82f6" stroke-width="3" fill="none" marker-end="url(#pipe-arrow)" class="flow-arrow"/>
                        <path d="M 775 310 L 890 310" stroke="#3b82f6" stroke-width="3" fill="none" marker-end="url(#pipe-arrow)" class="flow-arrow"/>
                        
                        <!-- Connexions vers workflows -->
                        <path d="M 350 285 L 350 245" stroke="#8b5cf6" stroke-width="2" fill="none" opacity="0.6" stroke-dasharray="3 2"/>
                        <path d="M 550 285 L 550 245" stroke="#3b82f6" stroke-width="2" fill="none" opacity="0.6" stroke-dasharray="3 2"/>
                        <path d="M 750 285 L 750 245" stroke="#10b981" stroke-width="2" fill="none" opacity="0.6" stroke-dasharray="3 2"/>

                        <!-- ÉTAPE 1: Excel -->
                        <g class="node" filter="url(#card-shadow)">
                            <rect x="100" y="60" width="160" height="150" rx="16" fill="white" stroke="#f59e0b" stroke-width="2"/>
                            <rect x="100" y="60" width="160" height="40" rx="16" fill="linear-gradient(90deg, #fbbf24, #f59e0b)"/>
                            <rect x="100" y="85" width="160" height="15" fill="#fbbf24"/>
                            <text x="180" y="85" text-anchor="middle" fill="white" font-size="12" font-weight="700">SOURCE</text>
                            <svg x="140" y="115" width="80" height="50" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="1.5">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/>
                            </svg>
                            <text x="180" y="175" text-anchor="middle" fill="#92400e" font-size="11" font-weight="600">Excel FT/BT KO</text>
                            <text x="180" y="192" text-anchor="middle" fill="#a16207" font-size="9">.xlsx</text>
                        </g>

                        <!-- ÉTAPE 2: Lecture + Workflow -->
                        <g class="node" filter="url(#card-shadow)">
                            <rect x="270" y="60" width="160" height="150" rx="16" fill="white" stroke="#8b5cf6" stroke-width="2"/>
                            <rect x="270" y="60" width="160" height="40" rx="16" fill="linear-gradient(90deg, #a78bfa, #8b5cf6)"/>
                            <rect x="270" y="85" width="160" height="15" fill="#a78bfa"/>
                            <text x="350" y="85" text-anchor="middle" fill="white" font-size="12" font-weight="700">WORKFLOW</text>
                            <svg x="310" y="115" width="80" height="50" viewBox="0 0 24 24" fill="none" stroke="#8b5cf6" stroke-width="1.5">
                                <circle cx="12" cy="12" r="3"/>
                                <path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"/>
                            </svg>
                            <text x="350" y="175" text-anchor="middle" fill="#5b21b6" font-size="11" font-weight="600">MajWorkflow</text>
                            <text x="350" y="192" text-anchor="middle" fill="#7c3aed" font-size="9">Async Task</text>
                        </g>

                        <!-- ÉTAPE 3: Match -->
                        <g class="node" filter="url(#card-shadow)">
                            <rect x="470" y="60" width="160" height="150" rx="16" fill="white" stroke="#3b82f6" stroke-width="2"/>
                            <rect x="470" y="60" width="160" height="40" rx="16" fill="linear-gradient(90deg, #60a5fa, #3b82f6)"/>
                            <rect x="470" y="85" width="160" height="15" fill="#60a5fa"/>
                            <text x="550" y="85" text-anchor="middle" fill="white" font-size="12" font-weight="700">CORRESPONDANCE</text>
                            <svg x="510" y="115" width="80" height="50" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="1.5">
                                <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
                            </svg>
                            <text x="550" y="175" text-anchor="middle" fill="#1e40af" font-size="11" font-weight="600">N° appui + Études</text>
                            <text x="550" y="192" text-anchor="middle" fill="#2563eb" font-size="9">Clé composite</text>
                        </g>

                        <!-- ÉTAPE 4: Update -->
                        <g class="node" filter="url(#card-shadow)">
                            <rect x="670" y="60" width="160" height="150" rx="16" fill="white" stroke="#10b981" stroke-width="2"/>
                            <rect x="670" y="60" width="160" height="40" rx="16" fill="linear-gradient(90deg, #34d399, #10b981)"/>
                            <rect x="670" y="85" width="160" height="15" fill="#34d399"/>
                            <text x="750" y="85" text-anchor="middle" fill="white" font-size="12" font-weight="700">MODIFICATION</text>
                            <svg x="710" y="115" width="80" height="50" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="1.5">
                                <path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
                            </svg>
                            <text x="750" y="175" text-anchor="middle" fill="#065f46" font-size="11" font-weight="600">Maj_Ft_Bt.py</text>
                            <text x="750" y="192" text-anchor="middle" fill="#047857" font-size="9">6 attributs</text>
                        </g>

                        <!-- ÉTAPE 5: Résultat -->
                        <g class="node" filter="url(#card-shadow)">
                            <rect x="840" y="60" width="160" height="150" rx="16" fill="white" stroke="#059669" stroke-width="2"/>
                            <rect x="840" y="60" width="160" height="40" rx="16" fill="linear-gradient(90deg, #10b981, #059669)"/>
                            <rect x="840" y="85" width="160" height="15" fill="#10b981"/>
                            <text x="920" y="85" text-anchor="middle" fill="white" font-size="12" font-weight="700">RÉSULTAT</text>
                            <svg x="880" y="115" width="80" height="50" viewBox="0 0 24 24" fill="none" stroke="#059669" stroke-width="1.5">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                <polyline points="22 4 12 14.01 9 11.01"/>
                            </svg>
                            <text x="920" y="175" text-anchor="middle" fill="#064e3b" font-size="11" font-weight="600">infra_pt_pot</text>
                            <text x="920" y="192" text-anchor="middle" fill="#047857" font-size="9">Modifié</text>
                        </g>

                        <!-- Couche QGIS (bas) -->
                        <g class="node" filter="url(#card-shadow)">
                            <rect x="470" y="380" width="160" height="90" rx="12" fill="white" stroke="#10b981" stroke-width="2"/>
                            <circle cx="550" cy="410" r="20" fill="#d1fae5" stroke="#10b981" stroke-width="2"/>
                            <svg x="538" y="398" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
                                <polygon points="12 2 2 7 12 12 22 7 12 2"/>
                                <polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/>
                            </svg>
                            <text x="550" y="450" text-anchor="middle" fill="#065f46" font-size="11" font-weight="600">Couche QGIS</text>
                            <text x="550" y="465" text-anchor="middle" fill="#047857" font-size="9">infra_pt_pot source</text>
                        </g>
                        <path d="M 550 380 L 550 340" stroke="#10b981" stroke-width="2" fill="none" marker-end="url(#pipe-arrow)"/>

                        <!-- Études (haut droite) -->
                        <g class="node" filter="url(#card-shadow)">
                            <rect x="870" y="350" width="120" height="80" rx="12" fill="white" stroke="#ec4899" stroke-width="2"/>
                            <text x="930" y="380" text-anchor="middle" fill="#9d174d" font-size="11" font-weight="600">Filtrage spatial</text>
                            <text x="930" y="400" text-anchor="middle" fill="#be185d" font-size="9">etude_cap_ft</text>
                            <text x="930" y="415" text-anchor="middle" fill="#be185d" font-size="9">etude_comac</text>
                        </g>

                        <!-- Box champs modifiés -->
                        <g filter="url(#card-shadow)">
                            <rect x="60" y="350" width="280" height="140" rx="12" fill="white" stroke="#e2e8f0" stroke-width="1"/>
                            <rect x="60" y="350" width="280" height="30" rx="12" fill="#f1f5f9"/>
                            <rect x="60" y="365" width="280" height="15" fill="#f1f5f9"/>
                            <text x="200" y="372" text-anchor="middle" fill="#475569" font-size="11" font-weight="600">Champs modifiés (8)</text>
                            
                            <text x="80" y="400" fill="#64748b" font-size="9">inf_type</text>
                            <text x="160" y="400" fill="#10b981" font-size="9" font-weight="500">POT-AC</text>
                            
                            <text x="80" y="418" fill="#64748b" font-size="9">inf_propri</text>
                            <text x="160" y="418" fill="#10b981" font-size="9" font-weight="500">RAUV</text>
                            
                            <text x="80" y="436" fill="#64748b" font-size="9">noe_usage</text>
                            <text x="160" y="436" fill="#10b981" font-size="9" font-weight="500">DI</text>
                            
                            <text x="80" y="454" fill="#64748b" font-size="9">inf_mat</text>
                            <text x="160" y="454" fill="#10b981" font-size="9" font-weight="500">typ_po_mod</text>

                            <text x="220" y="400" fill="#64748b" font-size="9">etat</text>
                            <text x="280" y="400" fill="#10b981" font-size="9" font-weight="500">BT KO</text>
                            
                            <text x="220" y="418" fill="#64748b" font-size="9">dce</text>
                            <text x="280" y="418" fill="#10b981" font-size="9" font-weight="500">O</text>
                            
                            <text x="220" y="436" fill="#64748b" font-size="9">modifie_par</text>
                            <text x="280" y="436" fill="#94a3b8" font-size="9">user</text>
                            
                            <text x="220" y="454" fill="#64748b" font-size="9">date_modif</text>
                            <text x="280" y="454" fill="#94a3b8" font-size="9">timestamp</text>
                        </g>
                    </svg>

                    <div class="legend">
                        <div class="legend-item"><div class="legend-color" style="background: linear-gradient(90deg, #fbbf24, #f59e0b);"></div><span>Source Excel</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: linear-gradient(90deg, #a78bfa, #8b5cf6);"></div><span>Extraction</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: linear-gradient(90deg, #60a5fa, #3b82f6);"></div><span>Logique métier</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: linear-gradient(90deg, #34d399, #10b981);"></div><span>Résultat QGIS</span></div>
                    </div>
                </div>
            </div>

            <!-- Modules Detail Diagram - Style Constellation/Réseau -->
            <div id="diagram-modules" class="diagram-panel">
                <div class="diagram-container" style="background: radial-gradient(ellipse at center, #1e1b4b 0%, #0f172a 100%); border: none;">
                    <h3 class="diagram-title" style="color: white;">Constellation des modules</h3>
                    <svg class="architecture-svg" viewBox="0 0 1000 600" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <filter id="star-glow" x="-50%" y="-50%" width="200%" height="200%">
                                <feGaussianBlur stdDeviation="6" result="coloredBlur"/>
                                <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
                            </filter>
                            <radialGradient id="core-radial" cx="50%" cy="50%" r="50%">
                                <stop offset="0%" style="stop-color:#60a5fa;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#1e40af;stop-opacity:1" />
                            </radialGradient>
                            <linearGradient id="link-grad" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:0.8" />
                                <stop offset="100%" style="stop-color:#8b5cf6;stop-opacity:0.3" />
                            </linearGradient>
                        </defs>

                        <!-- Background stars -->
                        <circle cx="100" cy="80" r="1" fill="white" opacity="0.3"/>
                        <circle cx="200" cy="150" r="1.5" fill="white" opacity="0.4"/>
                        <circle cx="850" cy="100" r="1" fill="white" opacity="0.3"/>
                        <circle cx="920" cy="200" r="1.5" fill="white" opacity="0.5"/>
                        <circle cx="80" cy="450" r="1" fill="white" opacity="0.4"/>
                        <circle cx="950" cy="480" r="1.5" fill="white" opacity="0.3"/>
                        <circle cx="300" cy="50" r="1" fill="white" opacity="0.5"/>
                        <circle cx="700" cy="550" r="1" fill="white" opacity="0.4"/>

                        <!-- Orbit rings -->
                        <ellipse cx="500" cy="300" rx="130" ry="130" fill="none" stroke="rgba(59,130,246,0.2)" stroke-width="2"/>
                        <text x="500" y="165" text-anchor="middle" fill="#60a5fa" font-size="8" font-weight="600">WORKFLOWS</text>
                        <ellipse cx="500" cy="300" rx="240" ry="240" fill="none" stroke="rgba(99,102,241,0.15)" stroke-width="1"/>
                        <ellipse cx="500" cy="300" rx="320" ry="220" fill="none" stroke="rgba(99,102,241,0.1)" stroke-width="1" stroke-dasharray="8 4"/>

                        <!-- Connection lines: CORE → Workflows (inner orbit) -->
                        <path d="M 500 225 L 500 170" stroke="rgba(59,130,246,0.4)" stroke-width="1.5" opacity="0.6" stroke-dasharray="3 2"/>
                        <path d="M 560 260 L 605 230" stroke="rgba(59,130,246,0.4)" stroke-width="1.5" opacity="0.6" stroke-dasharray="3 2"/>
                        <path d="M 590 330 L 605 370" stroke="rgba(59,130,246,0.4)" stroke-width="1.5" opacity="0.6" stroke-dasharray="3 2"/>
                        <path d="M 500 375 L 500 430" stroke="rgba(59,130,246,0.4)" stroke-width="1.5" opacity="0.6" stroke-dasharray="3 2"/>
                        <path d="M 410 330 L 395 370" stroke="rgba(59,130,246,0.4)" stroke-width="1.5" opacity="0.6" stroke-dasharray="3 2"/>
                        <path d="M 440 260 L 395 230" stroke="rgba(59,130,246,0.4)" stroke-width="1.5" opacity="0.6" stroke-dasharray="3 2"/>
                        
                        <!-- Connection lines: Workflows → Modules (outer orbit) -->
                        <path d="M 500 170 L 180 150" stroke="url(#link-grad)" stroke-width="2" opacity="0.5" class="flow-arrow"/>
                        <path d="M 605 230 L 820 150" stroke="url(#link-grad)" stroke-width="2" opacity="0.5" class="flow-arrow"/>
                        <path d="M 605 370 L 820 450" stroke="url(#link-grad)" stroke-width="2" opacity="0.5" class="flow-arrow"/>
                        <path d="M 500 430 L 500 520" stroke="url(#link-grad)" stroke-width="2" opacity="0.5" class="flow-arrow"/>
                        <path d="M 395 370 L 180 450" stroke="url(#link-grad)" stroke-width="2" opacity="0.5" class="flow-arrow"/>
                        <path d="M 395 230 L 180 150" stroke="url(#link-grad)" stroke-width="1.5" opacity="0.4" class="flow-arrow" stroke-dasharray="4 2"/>
                        
                        <!-- Inter-module connections (dashed) -->
                        <path d="M 180 150 L 180 450" stroke="rgba(139,92,246,0.3)" stroke-width="1" stroke-dasharray="4 4"/>
                        <path d="M 820 150 L 820 450" stroke="rgba(139,92,246,0.3)" stroke-width="1" stroke-dasharray="4 4"/>
                        <path d="M 180 450 L 500 520" stroke="rgba(139,92,246,0.3)" stroke-width="1" stroke-dasharray="4 4"/>
                        <path d="M 820 450 L 500 520" stroke="rgba(139,92,246,0.3)" stroke-width="1" stroke-dasharray="4 4"/>

                        <!-- CORE - Central star -->
                        <g filter="url(#star-glow)">
                            <circle cx="500" cy="300" r="75" fill="url(#core-radial)" stroke="#60a5fa" stroke-width="3"/>
                            <circle cx="500" cy="300" r="55" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="1"/>
                            <text x="500" y="285" text-anchor="middle" font-weight="700" fill="white" font-size="16">CORE</text>
                            <text x="500" y="305" text-anchor="middle" fill="#bfdbfe" font-size="11">PoleAerien.py</text>
                            <text x="500" y="322" text-anchor="middle" fill="#93c5fd" font-size="9">Orchestrateur</text>
                        </g>

                        <!-- WORKFLOWS - Inner orbit satellites -->
                        <!-- Workflow 1: MajWorkflow (top) -->
                        <g class="node">
                            <circle cx="500" cy="170" r="28" fill="rgba(251,191,36,0.25)" stroke="#fbbf24" stroke-width="2"/>
                            <text x="500" y="173" text-anchor="middle" fill="#fbbf24" font-size="9" font-weight="600">Maj</text>
                            <text x="500" y="183" text-anchor="middle" fill="#fde68a" font-size="7">WF</text>
                        </g>

                        <!-- Workflow 2: CapFtWorkflow (top-right) -->
                        <g class="node">
                            <circle cx="605" cy="230" r="28" fill="rgba(52,211,153,0.25)" stroke="#34d399" stroke-width="2"/>
                            <text x="605" y="233" text-anchor="middle" fill="#34d399" font-size="9" font-weight="600">CapFt</text>
                            <text x="605" y="243" text-anchor="middle" fill="#a7f3d0" font-size="7">WF</text>
                        </g>

                        <!-- Workflow 3: ComacWorkflow (bottom-right) -->
                        <g class="node">
                            <circle cx="605" cy="370" r="28" fill="rgba(59,130,246,0.25)" stroke="#3b82f6" stroke-width="2"/>
                            <text x="605" y="373" text-anchor="middle" fill="#60a5fa" font-size="9" font-weight="600">Comac</text>
                            <text x="605" y="383" text-anchor="middle" fill="#bfdbfe" font-size="7">WF</text>
                        </g>

                        <!-- Workflow 4: C6BdWorkflow (bottom) -->
                        <g class="node">
                            <circle cx="500" cy="430" r="28" fill="rgba(236,72,153,0.25)" stroke="#ec4899" stroke-width="2"/>
                            <text x="500" y="433" text-anchor="middle" fill="#f472b6" font-size="9" font-weight="600">C6Bd</text>
                            <text x="500" y="443" text-anchor="middle" fill="#fbcfe8" font-size="7">WF</text>
                        </g>

                        <!-- Workflow 5: C6C3AWorkflow (bottom-left) -->
                        <g class="node">
                            <circle cx="395" cy="370" r="28" fill="rgba(139,92,246,0.25)" stroke="#8b5cf6" stroke-width="2"/>
                            <text x="395" y="373" text-anchor="middle" fill="#a78bfa" font-size="9" font-weight="600">C6C3A</text>
                            <text x="395" y="383" text-anchor="middle" fill="#ddd6fe" font-size="7">WF</text>
                        </g>

                        <!-- Workflow 6: PoliceWorkflow (top-left) -->
                        <g class="node">
                            <circle cx="395" cy="230" r="28" fill="rgba(168,85,247,0.25)" stroke="#a855f7" stroke-width="2"/>
                            <text x="395" y="233" text-anchor="middle" fill="#c084fc" font-size="9" font-weight="600">Police</text>
                            <text x="395" y="243" text-anchor="middle" fill="#e9d5ff" font-size="7">WF</text>
                        </g>

                        <!-- Module: MAJ FT/BT (Top Left) -->
                        <g class="node" filter="url(#star-glow)">
                            <circle cx="180" cy="150" r="55" fill="rgba(251,191,36,0.15)" stroke="#fbbf24" stroke-width="2"/>
                            <circle cx="180" cy="150" r="40" fill="rgba(251,191,36,0.3)" stroke="#f59e0b" stroke-width="1"/>
                            <text x="180" y="140" text-anchor="middle" font-weight="700" fill="#fbbf24" font-size="11">MAJ FT/BT</text>
                            <text x="180" y="158" text-anchor="middle" fill="#fcd34d" font-size="9">Maj_Ft_Bt.py</text>
                            <text x="180" y="173" text-anchor="middle" fill="#fde68a" font-size="8">800 lignes</text>
                        </g>
                        <!-- Badge module -->
                        <circle cx="220" cy="105" r="12" fill="#fbbf24"/>
                        <text x="220" y="109" text-anchor="middle" fill="#78350f" font-size="10" font-weight="700">0</text>

                        <!-- Module: CAP_FT (Top Right) -->
                        <g class="node" filter="url(#star-glow)">
                            <circle cx="820" cy="150" r="55" fill="rgba(52,211,153,0.15)" stroke="#34d399" stroke-width="2"/>
                            <circle cx="820" cy="150" r="40" fill="rgba(52,211,153,0.3)" stroke="#10b981" stroke-width="1"/>
                            <text x="820" y="140" text-anchor="middle" font-weight="700" fill="#34d399" font-size="11">CAP_FT</text>
                            <text x="820" y="158" text-anchor="middle" fill="#6ee7b7" font-size="9">CapFt.py</text>
                            <text x="820" y="173" text-anchor="middle" fill="#a7f3d0" font-size="8">154 lignes</text>
                        </g>
                        <circle cx="860" cy="105" r="12" fill="#34d399"/>
                        <text x="860" y="109" text-anchor="middle" fill="#064e3b" font-size="10" font-weight="700">2</text>

                        <!-- Module: COMAC (Bottom Left) -->
                        <g class="node" filter="url(#star-glow)">
                            <circle cx="180" cy="450" r="55" fill="rgba(59,130,246,0.15)" stroke="#3b82f6" stroke-width="2"/>
                            <circle cx="180" cy="450" r="40" fill="rgba(59,130,246,0.3)" stroke="#2563eb" stroke-width="1"/>
                            <text x="180" y="440" text-anchor="middle" font-weight="700" fill="#60a5fa" font-size="11">COMAC</text>
                            <text x="180" y="458" text-anchor="middle" fill="#93c5fd" font-size="9">Comac.py</text>
                            <text x="180" y="473" text-anchor="middle" fill="#bfdbfe" font-size="8">564 lignes</text>
                        </g>
                        <circle cx="220" cy="405" r="12" fill="#3b82f6"/>
                        <text x="220" y="409" text-anchor="middle" fill="white" font-size="10" font-weight="700">3</text>

                        <!-- Module: C6 vs BD (Bottom Right) -->
                        <g class="node" filter="url(#star-glow)">
                            <circle cx="820" cy="450" r="55" fill="rgba(236,72,153,0.15)" stroke="#ec4899" stroke-width="2"/>
                            <circle cx="820" cy="450" r="40" fill="rgba(236,72,153,0.3)" stroke="#db2777" stroke-width="1"/>
                            <text x="820" y="440" text-anchor="middle" font-weight="700" fill="#f472b6" font-size="11">C6 vs BD</text>
                            <text x="820" y="458" text-anchor="middle" fill="#f9a8d4" font-size="9">C6_vs_Bd.py</text>
                            <text x="820" y="473" text-anchor="middle" fill="#fbcfe8" font-size="8">382 lignes</text>
                        </g>
                        <circle cx="860" cy="405" r="12" fill="#ec4899"/>
                        <text x="860" y="409" text-anchor="middle" fill="white" font-size="10" font-weight="700">1</text>

                        <!-- Module: Police C6 (Bottom Center) -->
                        <g class="node" filter="url(#star-glow)">
                            <circle cx="500" cy="520" r="55" fill="rgba(139,92,246,0.15)" stroke="#8b5cf6" stroke-width="2"/>
                            <circle cx="500" cy="520" r="40" fill="rgba(139,92,246,0.3)" stroke="#7c3aed" stroke-width="1"/>
                            <text x="500" y="510" text-anchor="middle" font-weight="700" fill="#a78bfa" font-size="11">Police C6</text>
                            <text x="500" y="528" text-anchor="middle" fill="#c4b5fd" font-size="9">PoliceC6.py</text>
                            <text x="500" y="543" text-anchor="middle" fill="#ddd6fe" font-size="8">718 lignes</text>
                        </g>
                        <circle cx="540" cy="475" r="12" fill="#8b5cf6"/>
                        <text x="540" y="479" text-anchor="middle" fill="white" font-size="10" font-weight="700">4</text>

                        <!-- Support modules (petites étoiles) -->
                        <g class="node">
                            <circle cx="350" cy="120" r="25" fill="rgba(220,38,38,0.2)" stroke="#ef4444" stroke-width="1"/>
                            <text x="350" y="117" text-anchor="middle" fill="#fca5a5" font-size="8" font-weight="600">security</text>
                            <text x="350" y="128" text-anchor="middle" fill="#fecaca" font-size="7">_rules</text>
                        </g>
                        <path d="M 350 145 L 420 250" stroke="rgba(239,68,68,0.4)" stroke-width="1" stroke-dasharray="3 3"/>

                        <g class="node">
                            <circle cx="650" cy="120" r="25" fill="rgba(6,182,212,0.2)" stroke="#06b6d4" stroke-width="1"/>
                            <text x="650" y="117" text-anchor="middle" fill="#67e8f9" font-size="8" font-weight="600">comac</text>
                            <text x="650" y="128" text-anchor="middle" fill="#a5f3fc" font-size="7">_loader</text>
                        </g>
                        <path d="M 650 145 L 580 250" stroke="rgba(6,182,212,0.4)" stroke-width="1" stroke-dasharray="3 3"/>

                        <g class="node">
                            <circle cx="320" cy="480" r="25" fill="rgba(245,158,11,0.2)" stroke="#f59e0b" stroke-width="1"/>
                            <text x="320" y="477" text-anchor="middle" fill="#fcd34d" font-size="8" font-weight="600">pcm</text>
                            <text x="320" y="488" text-anchor="middle" fill="#fde68a" font-size="7">_parser</text>
                        </g>
                        <path d="M 320 455 L 425 350" stroke="rgba(245,158,11,0.4)" stroke-width="1" stroke-dasharray="3 3"/>

                        <g class="node">
                            <circle cx="680" cy="480" r="25" fill="rgba(16,185,129,0.2)" stroke="#10b981" stroke-width="1"/>
                            <text x="680" y="477" text-anchor="middle" fill="#6ee7b7" font-size="8" font-weight="600">comac</text>
                            <text x="680" y="488" text-anchor="middle" fill="#a7f3d0" font-size="7">_db_reader</text>
                        </g>
                        <path d="M 680 455 L 575 350" stroke="rgba(16,185,129,0.4)" stroke-width="1" stroke-dasharray="3 3"/>

                        <!-- db_connection.py (fddcpi2) -->
                        <g class="node">
                            <circle cx="850" cy="300" r="28" fill="rgba(168,85,247,0.2)" stroke="#a855f7" stroke-width="1.5"/>
                            <text x="850" y="295" text-anchor="middle" fill="#c084fc" font-size="8" font-weight="600">db_conn</text>
                            <text x="850" y="307" text-anchor="middle" fill="#e9d5ff" font-size="7">fddcpi2()</text>
                        </g>
                        <path d="M 828 285 L 545 510" stroke="rgba(168,85,247,0.4)" stroke-width="1" stroke-dasharray="3 3"/>

                        <!-- cable_analyzer.py -->
                        <g class="node">
                            <circle cx="150" cy="300" r="28" fill="rgba(236,72,153,0.2)" stroke="#ec4899" stroke-width="1.5"/>
                            <text x="150" y="295" text-anchor="middle" fill="#f472b6" font-size="8" font-weight="600">cable</text>
                            <text x="150" y="307" text-anchor="middle" fill="#fbcfe8" font-size="7">_analyzer</text>
                        </g>
                        <path d="M 172 315 L 460 510" stroke="rgba(236,72,153,0.4)" stroke-width="1" stroke-dasharray="3 3"/>

                        <!-- Stats panel -->
                        <g>
                            <rect x="40" y="30" width="150" height="90" rx="8" fill="rgba(255,255,255,0.05)" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
                            <text x="115" y="50" text-anchor="middle" fill="#94a3b8" font-size="9" font-weight="600">ARCHITECTURE v3.0</text>
                            <text x="60" y="70" fill="#64748b" font-size="8">Workflows:</text>
                            <text x="160" y="70" text-anchor="end" fill="#60a5fa" font-size="10" font-weight="600">6</text>
                            <text x="60" y="86" fill="#64748b" font-size="8">Fichiers Python:</text>
                            <text x="160" y="86" text-anchor="end" fill="#60a5fa" font-size="10" font-weight="600">24</text>
                            <text x="60" y="102" fill="#64748b" font-size="8">Lignes total:</text>
                            <text x="160" y="102" text-anchor="end" fill="#60a5fa" font-size="10" font-weight="600">9500</text>
                        </g>
                    </svg>

                    <div class="legend" style="border-top-color: rgba(255,255,255,0.1);">
                        <div class="legend-item"><div class="legend-color" style="background: rgba(251,191,36,0.4); border: 2px solid #fbbf24;"></div><span style="color: #94a3b8;">MAJ FT/BT</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: rgba(52,211,153,0.4); border: 2px solid #34d399;"></div><span style="color: #94a3b8;">CAP_FT</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: rgba(59,130,246,0.4); border: 2px solid #3b82f6;"></div><span style="color: #94a3b8;">COMAC</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: rgba(236,72,153,0.4); border: 2px solid #ec4899;"></div><span style="color: #94a3b8;">C6 vs BD</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: rgba(139,92,246,0.4); border: 2px solid #8b5cf6;"></div><span style="color: #94a3b8;">Police C6</span></div>
                    </div>
                </div>
            </div>

            <!-- Security Verification Diagram - Style Dashboard/Monitoring -->
            <div id="diagram-security" class="diagram-panel">
                <div class="diagram-container" style="background: linear-gradient(135deg, #450a0a 0%, #1c1917 50%, #0c0a09 100%); border: none;">
                    <h3 class="diagram-title" style="color: white;">Dashboard Sécurité - NFC 11201-A1</h3>
                    <svg class="architecture-svg" viewBox="0 0 1000 620" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="danger-grad" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#ef4444;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#dc2626;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="success-grad" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#22c55e;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#16a34a;stop-opacity:1" />
                            </linearGradient>
                            <filter id="red-glow" x="-50%" y="-50%" width="200%" height="200%">
                                <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
                                <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
                            </filter>
                            <marker id="arrow-danger" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#ef4444"/>
                            </marker>
                        </defs>

                        <!-- Background grid -->
                        <pattern id="sec-grid" width="30" height="30" patternUnits="userSpaceOnUse">
                            <path d="M 30 0 L 0 0 0 30" fill="none" stroke="rgba(239,68,68,0.05)" stroke-width="1"/>
                        </pattern>
                        <rect width="1000" height="620" fill="url(#sec-grid)"/>

                        <!-- Header panel -->
                        <g>
                            <rect x="30" y="20" width="940" height="60" rx="12" fill="rgba(239,68,68,0.1)" stroke="rgba(239,68,68,0.3)" stroke-width="1"/>
                            <svg x="50" y="35" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                            </svg>
                            <text x="95" y="52" fill="#ef4444" font-size="16" font-weight="700">VÉRIFICATION SÉCURITÉ</text>
                            <text x="95" y="68" fill="#fca5a5" font-size="10">Module: security_rules.py | Norme: NFC 11201-A1</text>
                            
                            <!-- Status indicators -->
                            <rect x="750" y="32" width="100" height="36" rx="8" fill="rgba(34,197,94,0.2)" stroke="#22c55e" stroke-width="1"/>
                            <circle cx="770" cy="50" r="6" fill="#22c55e"/>
                            <text x="785" y="55" fill="#22c55e" font-size="11" font-weight="600">ACTIF</text>
                            
                            <rect x="860" y="32" width="100" height="36" rx="8" fill="rgba(239,68,68,0.2)" stroke="#ef4444" stroke-width="1"/>
                            <text x="875" y="48" fill="#fca5a5" font-size="9">Alertes:</text>
                            <text x="930" y="55" text-anchor="end" fill="#ef4444" font-size="14" font-weight="700">0</text>
                        </g>

                        <!-- Pipeline flow -->
                        <g>
                            <!-- Step 1: Input -->
                            <rect x="50" y="110" width="160" height="140" rx="12" fill="rgba(251,191,36,0.1)" stroke="#fbbf24" stroke-width="2"/>
                            <rect x="50" y="110" width="160" height="35" rx="12" fill="rgba(251,191,36,0.3)"/>
                            <rect x="50" y="130" width="160" height="15" fill="rgba(251,191,36,0.2)"/>
                            <text x="130" y="132" text-anchor="middle" fill="#fbbf24" font-size="11" font-weight="700">ENTRÉE</text>
                            <svg x="100" y="155" width="60" height="40" viewBox="0 0 24 24" fill="none" stroke="#fbbf24" stroke-width="1.5">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                            </svg>
                            <text x="130" y="210" text-anchor="middle" fill="#fcd34d" font-size="10" font-weight="500">Excel COMAC</text>
                            <text x="130" y="225" text-anchor="middle" fill="#fde68a" font-size="8">Col A: N° poteau</text>
                            <text x="130" y="238" text-anchor="middle" fill="#fde68a" font-size="8">Col AO: Type câble FO</text>

                            <!-- Step 2: Extraction -->
                            <rect x="250" y="110" width="160" height="140" rx="12" fill="rgba(59,130,246,0.1)" stroke="#3b82f6" stroke-width="2"/>
                            <rect x="250" y="110" width="160" height="35" rx="12" fill="rgba(59,130,246,0.3)"/>
                            <rect x="250" y="130" width="160" height="15" fill="rgba(59,130,246,0.2)"/>
                            <text x="330" y="132" text-anchor="middle" fill="#60a5fa" font-size="11" font-weight="700">EXTRACTION</text>
                            <svg x="300" y="155" width="60" height="40" viewBox="0 0 24 24" fill="none" stroke="#60a5fa" stroke-width="1.5">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/>
                            </svg>
                            <text x="330" y="210" text-anchor="middle" fill="#93c5fd" font-size="10" font-weight="500">Comac.py</text>
                            <text x="330" y="225" text-anchor="middle" fill="#bfdbfe" font-size="8">Colonnes: 6, 40, 46</text>
                            <text x="330" y="238" text-anchor="middle" fill="#bfdbfe" font-size="8">portée, capacité_fo</text>

                            <!-- Step 3: Validation (CENTRAL) -->
                            <g filter="url(#red-glow)">
                                <rect x="450" y="100" width="180" height="160" rx="16" fill="rgba(239,68,68,0.15)" stroke="#ef4444" stroke-width="3"/>
                                <rect x="450" y="100" width="180" height="40" rx="16" fill="url(#danger-grad)"/>
                                <rect x="450" y="125" width="180" height="15" fill="rgba(239,68,68,0.8)"/>
                                <svg x="465" y="105" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                                </svg>
                                <text x="540" y="122" text-anchor="middle" fill="white" font-size="12" font-weight="700">VALIDATION</text>
                                <text x="540" y="165" text-anchor="middle" fill="#fca5a5" font-size="10" font-weight="600">security_rules.py</text>
                                <text x="540" y="185" text-anchor="middle" fill="#fecaca" font-size="9">PORTEES_MAX</text>
                                <text x="540" y="200" text-anchor="middle" fill="#fecaca" font-size="9">CODES_PRYSMIAN</text>
                                <text x="540" y="215" text-anchor="middle" fill="#fecaca" font-size="9">verifier_portee()</text>
                                <text x="540" y="245" text-anchor="middle" fill="#ef4444" font-size="8" font-weight="600">NFC 11201-A1</text>
                            </g>

                            <!-- Step 4: Results -->
                            <rect x="670" y="110" width="160" height="140" rx="12" fill="rgba(139,92,246,0.1)" stroke="#8b5cf6" stroke-width="2"/>
                            <rect x="670" y="110" width="160" height="35" rx="12" fill="rgba(139,92,246,0.3)"/>
                            <rect x="670" y="130" width="160" height="15" fill="rgba(139,92,246,0.2)"/>
                            <text x="750" y="132" text-anchor="middle" fill="#a78bfa" font-size="11" font-weight="700">RÉSULTATS</text>
                            <svg x="720" y="155" width="60" height="40" viewBox="0 0 24 24" fill="none" stroke="#a78bfa" stroke-width="1.5">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                <polyline points="22 4 12 14.01 9 11.01"/>
                            </svg>
                            <text x="750" y="210" text-anchor="middle" fill="#c4b5fd" font-size="10" font-weight="500">dico_verif_secu</text>
                            <text x="750" y="225" text-anchor="middle" fill="#ddd6fe" font-size="8">capacité_fo: 24FO</text>
                            <text x="750" y="238" text-anchor="middle" fill="#ddd6fe" font-size="8">valide: OK/KO</text>

                            <!-- Step 5: Export -->
                            <rect x="870" y="110" width="100" height="140" rx="12" fill="rgba(34,197,94,0.1)" stroke="#22c55e" stroke-width="2"/>
                            <rect x="870" y="110" width="100" height="35" rx="12" fill="rgba(34,197,94,0.3)"/>
                            <rect x="870" y="130" width="100" height="15" fill="rgba(34,197,94,0.2)"/>
                            <text x="920" y="132" text-anchor="middle" fill="#22c55e" font-size="11" font-weight="700">EXPORT</text>
                            <svg x="895" y="155" width="50" height="40" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="1.5">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                            <text x="920" y="210" text-anchor="middle" fill="#86efac" font-size="10" font-weight="500">Feuille</text>
                            <text x="920" y="225" text-anchor="middle" fill="#bbf7d0" font-size="9">VERIF_</text>
                            <text x="920" y="238" text-anchor="middle" fill="#bbf7d0" font-size="9">SECURITE</text>
                        </g>

                        <!-- Flow arrows -->
                        <path d="M 210 180 L 245 180" stroke="#fbbf24" stroke-width="2" fill="none" marker-end="url(#arrow-danger)" class="flow-arrow"/>
                        <path d="M 410 180 L 445 180" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrow-danger)" class="flow-arrow"/>
                        <path d="M 630 180 L 665 180" stroke="#ef4444" stroke-width="3" fill="none" marker-end="url(#arrow-danger)" class="flow-arrow"/>
                        <path d="M 830 180 L 865 180" stroke="#8b5cf6" stroke-width="2" fill="none" marker-end="url(#arrow-danger)" class="flow-arrow"/>

                        <!-- Zone climatique panel -->
                        <g>
                            <rect x="50" y="280" width="180" height="120" rx="12" fill="rgba(251,191,36,0.1)" stroke="#fbbf24" stroke-width="1"/>
                            <text x="140" y="305" text-anchor="middle" fill="#fbbf24" font-size="11" font-weight="700">ZONE CLIMATIQUE</text>
                            
                            <rect x="70" y="320" width="140" height="30" rx="6" fill="rgba(59,130,246,0.2)" stroke="#3b82f6" stroke-width="1"/>
                            <circle cx="90" cy="335" r="8" fill="#3b82f6"/>
                            <text x="115" y="340" fill="#93c5fd" font-size="10" font-weight="600">ZVN - Vent Normal</text>
                            
                            <rect x="70" y="358" width="140" height="30" rx="6" fill="rgba(239,68,68,0.2)" stroke="#ef4444" stroke-width="1"/>
                            <circle cx="90" cy="373" r="8" fill="#ef4444"/>
                            <text x="115" y="378" fill="#fca5a5" font-size="10" font-weight="600">ZVF - Vent Fort</text>
                        </g>

                        <!-- Portées max table -->
                        <g>
                            <rect x="260" y="280" width="480" height="180" rx="12" fill="rgba(255,255,255,0.03)" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
                            <rect x="260" y="280" width="480" height="35" rx="12" fill="rgba(239,68,68,0.15)"/>
                            <rect x="260" y="300" width="480" height="15" fill="rgba(239,68,68,0.1)"/>
                            <text x="500" y="302" text-anchor="middle" fill="#ef4444" font-size="11" font-weight="700">PORTÉES MAXIMALES NFC 11201-A1 (mètres)</text>

                            <!-- Table headers -->
                            <text x="290" y="340" fill="#94a3b8" font-size="10" font-weight="600">Zone</text>
                            <text x="360" y="340" fill="#94a3b8" font-size="10" font-weight="500">6 FO</text>
                            <text x="420" y="340" fill="#94a3b8" font-size="10" font-weight="500">12 FO</text>
                            <text x="480" y="340" fill="#94a3b8" font-size="10" font-weight="500">24 FO</text>
                            <text x="540" y="340" fill="#94a3b8" font-size="10" font-weight="500">36 FO</text>
                            <text x="600" y="340" fill="#94a3b8" font-size="10" font-weight="500">48 FO</text>
                            <text x="660" y="340" fill="#94a3b8" font-size="10" font-weight="500">72 FO</text>
                            <text x="710" y="340" fill="#94a3b8" font-size="10" font-weight="500">96 FO</text>

                            <line x1="275" y1="350" x2="725" y2="350" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>

                            <!-- ZVN row -->
                            <rect x="275" y="355" width="450" height="35" rx="4" fill="rgba(59,130,246,0.1)"/>
                            <text x="290" y="378" fill="#60a5fa" font-size="10" font-weight="600">ZVN</text>
                            <text x="360" y="378" fill="#bfdbfe" font-size="10">81</text>
                            <text x="420" y="378" fill="#bfdbfe" font-size="10">77</text>
                            <text x="480" y="378" fill="#bfdbfe" font-size="10">73</text>
                            <text x="540" y="378" fill="#bfdbfe" font-size="10">74</text>
                            <text x="600" y="378" fill="#bfdbfe" font-size="10">78</text>
                            <text x="660" y="378" fill="#bfdbfe" font-size="10">77</text>
                            <text x="710" y="378" fill="#bfdbfe" font-size="10">76</text>

                            <!-- ZVF row -->
                            <rect x="275" y="395" width="450" height="35" rx="4" fill="rgba(239,68,68,0.1)"/>
                            <text x="290" y="418" fill="#ef4444" font-size="10" font-weight="600">ZVF</text>
                            <text x="360" y="418" fill="#fecaca" font-size="10">79</text>
                            <text x="420" y="418" fill="#fecaca" font-size="10">74</text>
                            <text x="480" y="418" fill="#fecaca" font-size="10">73</text>
                            <text x="540" y="418" fill="#fecaca" font-size="10">74</text>
                            <text x="600" y="418" fill="#fecaca" font-size="10">78</text>
                            <text x="660" y="418" fill="#fecaca" font-size="10">77</text>
                            <text x="710" y="418" fill="#fecaca" font-size="10">76</text>

                            <!-- Note -->
                            <text x="500" y="450" text-anchor="middle" fill="#64748b" font-size="9">Source: Norme NFC 11201-A1 - Portées maximales câbles FO aériens</text>
                        </g>

                        <!-- Câbles référencés -->
                        <g>
                            <rect x="770" y="280" width="200" height="180" rx="12" fill="rgba(255,255,255,0.03)" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
                            <rect x="770" y="280" width="200" height="35" rx="12" fill="rgba(34,197,94,0.15)"/>
                            <rect x="770" y="300" width="200" height="15" fill="rgba(34,197,94,0.1)"/>
                            <text x="870" y="302" text-anchor="middle" fill="#22c55e" font-size="11" font-weight="700">CÂBLES RÉFÉRENCÉS</text>
                            
                            <text x="790" y="335" fill="#64748b" font-size="9">CODES_PRYSMIAN:</text>
                            <text x="800" y="355" fill="#86efac" font-size="9">PCO-06-E1-A</text>
                            <text x="900" y="355" fill="#64748b" font-size="9">6 FO</text>
                            <text x="800" y="372" fill="#86efac" font-size="9">PCO-12-E1-A</text>
                            <text x="900" y="372" fill="#64748b" font-size="9">12 FO</text>
                            <text x="800" y="389" fill="#86efac" font-size="9">PCO-24-E1-A</text>
                            <text x="900" y="389" fill="#64748b" font-size="9">24 FO</text>
                            <text x="800" y="406" fill="#86efac" font-size="9">PCO-48-E1-A</text>
                            <text x="900" y="406" fill="#64748b" font-size="9">48 FO</text>
                            <text x="800" y="423" fill="#86efac" font-size="9">PCO-72-E1-A</text>
                            <text x="900" y="423" fill="#64748b" font-size="9">72 FO</text>
                            
                            <text x="870" y="450" text-anchor="middle" fill="#64748b" font-size="8">591 câbles référencés (PG)</text>
                        </g>

                        <!-- Stats footer -->
                        <g>
                            <rect x="50" y="480" width="220" height="60" rx="10" fill="rgba(239,68,68,0.1)" stroke="rgba(239,68,68,0.2)" stroke-width="1"/>
                            <text x="70" y="505" fill="#64748b" font-size="9">Fichier règles:</text>
                            <text x="230" y="505" text-anchor="end" fill="#ef4444" font-size="10" font-weight="600">security_rules.py</text>
                            <text x="70" y="525" fill="#64748b" font-size="9">Lignes de code:</text>
                            <text x="230" y="525" text-anchor="end" fill="#ef4444" font-size="10" font-weight="600">434</text>
                        </g>

                        <g>
                            <rect x="290" y="480" width="220" height="60" rx="10" fill="rgba(6,182,212,0.1)" stroke="rgba(6,182,212,0.2)" stroke-width="1"/>
                            <text x="310" y="505" fill="#64748b" font-size="9">Lecteur BD:</text>
                            <text x="470" y="505" text-anchor="end" fill="#06b6d4" font-size="10" font-weight="600">comac_db_reader.py</text>
                            <text x="310" y="525" fill="#64748b" font-size="9">Source:</text>
                            <text x="470" y="525" text-anchor="end" fill="#06b6d4" font-size="10" font-weight="600">PostgreSQL</text>
                        </g>

                        <g>
                            <rect x="530" y="480" width="220" height="60" rx="10" fill="rgba(245,158,11,0.1)" stroke="rgba(245,158,11,0.2)" stroke-width="1"/>
                            <text x="550" y="505" fill="#64748b" font-size="9">Parser PCM:</text>
                            <text x="710" y="505" text-anchor="end" fill="#f59e0b" font-size="10" font-weight="600">pcm_parser.py</text>
                            <text x="550" y="525" fill="#64748b" font-size="9">Format:</text>
                            <text x="710" y="525" text-anchor="end" fill="#f59e0b" font-size="10" font-weight="600">XML (.pcm)</text>
                        </g>

                        <g>
                            <rect x="770" y="480" width="200" height="60" rx="10" fill="rgba(34,197,94,0.1)" stroke="rgba(34,197,94,0.2)" stroke-width="1"/>
                            <text x="790" y="505" fill="#64748b" font-size="9">Export feuille:</text>
                            <text x="930" y="505" text-anchor="end" fill="#22c55e" font-size="10" font-weight="600">VERIF_SECURITE</text>
                            <text x="790" y="525" fill="#64748b" font-size="9">Format:</text>
                            <text x="930" y="525" text-anchor="end" fill="#22c55e" font-size="10" font-weight="600">.xlsx</text>
                        </g>
                    </svg>

                    <div class="legend" style="border-top-color: rgba(255,255,255,0.1);">
                        <div class="legend-item"><div class="legend-color" style="background: rgba(251,191,36,0.4); border: 2px solid #fbbf24;"></div><span style="color: #94a3b8;">Entrée / Zone</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: rgba(239,68,68,0.4); border: 2px solid #ef4444;"></div><span style="color: #94a3b8;">Validation sécurité</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: rgba(139,92,246,0.4); border: 2px solid #8b5cf6;"></div><span style="color: #94a3b8;">Résultats</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: rgba(34,197,94,0.4); border: 2px solid #22c55e;"></div><span style="color: #94a3b8;">Export</span></div>
                    </div>
                </div>
            </div>

            <!-- DAG Imports Diagram -->
            <div id="diagram-dag" class="diagram-panel">
                <div class="diagram-container dag-container">
                    <h3 class="diagram-title">Graphe de Dependances (DAG) - Imports Python</h3>
                    <svg viewBox="0 0 1100 700" xmlns="http://www.w3.org/2000/svg" style="width: 100%; max-height: 720px;">
                        <defs>
                            <marker id="arrow-dag" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
                                <polygon points="0 0, 8 3, 0 6" fill="#10b981"/>
                            </marker>
                            <filter id="dag-glow" x="-20%" y="-20%" width="140%" height="140%">
                                <feGaussianBlur stdDeviation="2" result="blur"/>
                                <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
                            </filter>
                        </defs>
                        
                        <rect width="1100" height="700" fill="#f8fafc"/>
                        
                        <!-- Level 0: Entry Point -->
                        <g class="dag-node" filter="url(#dag-glow)">
                            <rect x="480" y="20" width="140" height="50" rx="8" fill="#3b82f6" stroke="#1d4ed8" stroke-width="2"/>
                            <text x="550" y="45" text-anchor="middle" fill="white" font-size="11" font-weight="700">__init__.py</text>
                            <text x="550" y="60" text-anchor="middle" fill="#bfdbfe" font-size="9">classFactory()</text>
                        </g>
                        
                        <!-- Arrow to PoleAerien -->
                        <path d="M 550 70 L 550 100" stroke="#10b981" stroke-width="2" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        
                        <!-- Level 1: Controller -->
                        <g class="dag-node" filter="url(#dag-glow)">
                            <rect x="450" y="100" width="200" height="60" rx="10" fill="#8b5cf6" stroke="#7c3aed" stroke-width="2"/>
                            <text x="550" y="125" text-anchor="middle" fill="white" font-size="12" font-weight="700">PoleAerien.py</text>
                            <text x="550" y="145" text-anchor="middle" fill="#ddd6fe" font-size="9">Point d'entree - 128 lignes</text>
                        </g>
                        
                        <!-- Arrows from PoleAerien to UI/Support -->
                        <path d="M 450 130 L 180 200" stroke="#10b981" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 480 160 L 350 200" stroke="#10b981" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 620 160 L 750 200" stroke="#10b981" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 650 130 L 920 200" stroke="#10b981" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        
                        <!-- Arrows from PoleAerien to Workflows -->
                        <path d="M 500 160 L 115 290" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 520 160 L 265 290" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 540 160 L 415 290" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 560 160 L 565 290" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 580 160 L 715 290" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 600 160 L 865 290" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        
                        <!-- Level 2A: UI & Infrastructure -->
                        <g class="dag-node">
                            <rect x="80" y="200" width="160" height="50" rx="8" fill="#a78bfa" stroke="#8b5cf6" stroke-width="1.5"/>
                            <text x="160" y="225" text-anchor="middle" fill="white" font-size="10" font-weight="600">dialog_v2.py</text>
                            <text x="160" y="240" text-anchor="middle" fill="#e9d5ff" font-size="8">PoleAerienDialogV2</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="280" y="200" width="160" height="50" rx="8" fill="#a78bfa" stroke="#8b5cf6" stroke-width="1.5"/>
                            <text x="360" y="225" text-anchor="middle" fill="white" font-size="10" font-weight="600">batch_orchestrator.py</text>
                            <text x="360" y="240" text-anchor="middle" fill="#e9d5ff" font-size="8">Dialog - Workflows</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="690" y="200" width="140" height="50" rx="8" fill="#60a5fa" stroke="#3b82f6" stroke-width="1.5"/>
                            <text x="760" y="225" text-anchor="middle" fill="white" font-size="10" font-weight="600">batch_runner.py</text>
                            <text x="760" y="240" text-anchor="middle" fill="#bfdbfe" font-size="8">Execution sequentielle</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="860" y="200" width="150" height="50" rx="8" fill="#60a5fa" stroke="#3b82f6" stroke-width="1.5"/>
                            <text x="935" y="225" text-anchor="middle" fill="white" font-size="10" font-weight="600">project_detector.py</text>
                            <text x="935" y="240" text-anchor="middle" fill="#bfdbfe" font-size="8">Auto-detection</text>
                        </g>
                        
                        <!-- Level 2B: WORKFLOWS (nouvelle couche) -->
                        <text x="550" y="280" text-anchor="middle" fill="#1e40af" font-size="11" font-weight="700">WORKFLOWS/</text>
                        
                        <g class="dag-node">
                            <rect x="50" y="290" width="120" height="45" rx="8" fill="#3b82f6" stroke="#1d4ed8" stroke-width="2"/>
                            <text x="110" y="310" text-anchor="middle" fill="white" font-size="9" font-weight="600">maj_workflow.py</text>
                            <text x="110" y="325" text-anchor="middle" fill="#bfdbfe" font-size="7">MajWorkflow</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="190" y="290" width="140" height="45" rx="8" fill="#3b82f6" stroke="#1d4ed8" stroke-width="2"/>
                            <text x="260" y="310" text-anchor="middle" fill="white" font-size="9" font-weight="600">capft_workflow.py</text>
                            <text x="260" y="325" text-anchor="middle" fill="#bfdbfe" font-size="7">CapFtWorkflow</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="350" y="290" width="150" height="45" rx="8" fill="#3b82f6" stroke="#1d4ed8" stroke-width="2"/>
                            <text x="425" y="310" text-anchor="middle" fill="white" font-size="9" font-weight="600">comac_workflow.py</text>
                            <text x="425" y="325" text-anchor="middle" fill="#bfdbfe" font-size="7">ComacWorkflow</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="520" y="290" width="140" height="45" rx="8" fill="#3b82f6" stroke="#1d4ed8" stroke-width="2"/>
                            <text x="590" y="310" text-anchor="middle" fill="white" font-size="9" font-weight="600">c6bd_workflow.py</text>
                            <text x="590" y="325" text-anchor="middle" fill="#bfdbfe" font-size="7">C6BdWorkflow</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="680" y="290" width="150" height="45" rx="8" fill="#3b82f6" stroke="#1d4ed8" stroke-width="2"/>
                            <text x="755" y="310" text-anchor="middle" fill="white" font-size="9" font-weight="600">c6c3a_workflow.py</text>
                            <text x="755" y="325" text-anchor="middle" fill="#bfdbfe" font-size="7">C6C3AWorkflow</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="850" y="290" width="150" height="45" rx="8" fill="#3b82f6" stroke="#1d4ed8" stroke-width="2"/>
                            <text x="925" y="310" text-anchor="middle" fill="white" font-size="9" font-weight="600">police_workflow.py</text>
                            <text x="925" y="325" text-anchor="middle" fill="#bfdbfe" font-size="7">PoliceWorkflow</text>
                        </g>
                        
                        <!-- Arrows from Workflows to Business Modules -->
                        <path d="M 110 335 L 115 400" stroke="#10b981" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 260 335 L 255 400" stroke="#10b981" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 425 335 L 710 400" stroke="#10b981" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 590 335 L 390 400" stroke="#10b981" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 755 335 L 550 400" stroke="#10b981" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 925 335 L 820 400" stroke="#10b981" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        
                        <!-- Arrow View to excel_helpers -->
                        <path d="M 160 250 L 160 360" stroke="#10b981" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        
                        <g class="dag-node">
                            <rect x="80" y="360" width="160" height="40" rx="6" fill="#c4b5fd" stroke="#a78bfa" stroke-width="1"/>
                            <text x="160" y="385" text-anchor="middle" fill="#581c87" font-size="10" font-weight="500">excel_helpers.py</text>
                        </g>
                        
                        <!-- Level 3: Modules Metier -->
                        <text x="550" y="385" text-anchor="middle" fill="#475569" font-size="12" font-weight="700">MODULES METIER</text>
                        <line x1="100" y1="395" x2="1000" y2="395" stroke="#e2e8f0" stroke-width="2"/>
                        
                        <g class="dag-node">
                            <rect x="50" y="415" width="130" height="55" rx="8" fill="#fbbf24" stroke="#f59e0b" stroke-width="1.5"/>
                            <text x="115" y="440" text-anchor="middle" fill="#78350f" font-size="10" font-weight="600">Maj_Ft_Bt.py</text>
                            <text x="115" y="455" text-anchor="middle" fill="#92400e" font-size="8">Module MAJ</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="200" y="415" width="110" height="55" rx="8" fill="#34d399" stroke="#10b981" stroke-width="1.5"/>
                            <text x="255" y="440" text-anchor="middle" fill="#064e3b" font-size="10" font-weight="600">CapFt.py</text>
                            <text x="255" y="455" text-anchor="middle" fill="#065f46" font-size="8">Module CAP FT</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="330" y="415" width="120" height="55" rx="8" fill="#f472b6" stroke="#ec4899" stroke-width="1.5"/>
                            <text x="390" y="440" text-anchor="middle" fill="#831843" font-size="10" font-weight="600">C6_vs_Bd.py</text>
                            <text x="390" y="455" text-anchor="middle" fill="#9d174d" font-size="8">Module C6 BD</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="470" y="415" width="160" height="55" rx="8" fill="#f472b6" stroke="#ec4899" stroke-width="1.5"/>
                            <text x="550" y="440" text-anchor="middle" fill="#831843" font-size="10" font-weight="600">C6_vs_C3A_vs_Bd.py</text>
                            <text x="550" y="455" text-anchor="middle" fill="#9d174d" font-size="8">Module C6-C3A</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="650" y="415" width="120" height="55" rx="8" fill="#38bdf8" stroke="#0ea5e9" stroke-width="1.5"/>
                            <text x="710" y="440" text-anchor="middle" fill="#0c4a6e" font-size="10" font-weight="600">Comac.py</text>
                            <text x="710" y="455" text-anchor="middle" fill="#075985" font-size="8">Module COMAC</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="790" y="400" width="120" height="55" rx="8" fill="#a78bfa" stroke="#8b5cf6" stroke-width="1.5"/>
                            <text x="850" y="425" text-anchor="middle" fill="#3730a3" font-size="10" font-weight="600">PoliceC6.py</text>
                            <text x="850" y="440" text-anchor="middle" fill="#4338ca" font-size="8">Module Police</text>
                        </g>
                        
                        <!-- Arrows to qgis_utils.py + core_utils.py (shared) -->
                        <path d="M 115 470 L 270 510" stroke="#94a3b8" stroke-width="1" fill="none" marker-end="url(#arrow-dag)" stroke-dasharray="4 2"/>
                        <path d="M 255 470 L 280 510" stroke="#94a3b8" stroke-width="1" fill="none" marker-end="url(#arrow-dag)" stroke-dasharray="4 2"/>
                        <path d="M 390 470 L 310 510" stroke="#94a3b8" stroke-width="1" fill="none" marker-end="url(#arrow-dag)" stroke-dasharray="4 2"/>
                        <path d="M 550 470 L 340 510" stroke="#94a3b8" stroke-width="1" fill="none" marker-end="url(#arrow-dag)" stroke-dasharray="4 2"/>
                        <path d="M 710 470 L 360 510" stroke="#94a3b8" stroke-width="1" fill="none" marker-end="url(#arrow-dag)" stroke-dasharray="4 2"/>
                        <path d="M 850 470 L 380 510" stroke="#94a3b8" stroke-width="1" fill="none" marker-end="url(#arrow-dag)" stroke-dasharray="4 2"/>
                        
                        <!-- Level 4: Support -->
                        <g class="dag-node">
                            <rect x="170" y="510" width="130" height="45" rx="8" fill="#94a3b8" stroke="#64748b" stroke-width="1.5"/>
                            <text x="235" y="535" text-anchor="middle" fill="white" font-size="10" font-weight="600">qgis_utils.py</text>
                            <text x="235" y="548" text-anchor="middle" fill="#e2e8f0" font-size="8">QGIS API (390 L)</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="310" y="510" width="130" height="45" rx="8" fill="#94a3b8" stroke="#64748b" stroke-width="1.5"/>
                            <text x="375" y="535" text-anchor="middle" fill="white" font-size="10" font-weight="600">core_utils.py</text>
                            <text x="375" y="548" text-anchor="middle" fill="#e2e8f0" font-size="8">Python pur (220 L)</text>
                        </g>
                        
                        <!-- Arrows Comac to security modules -->
                        <path d="M 710 470 L 600 510" stroke="#ef4444" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 710 470 L 750 510" stroke="#ef4444" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 710 470 L 900 510" stroke="#ef4444" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        
                        <!-- Arrow PoliceC6 to comac_db_reader -->
                        <path d="M 850 470 L 765 510" stroke="#ef4444" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <!-- Arrow PoliceWorkflow to db_connection -->
                        <path d="M 925 335 L 100 510" stroke="#a855f7" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <!-- Arrow PoliceWorkflow to cable_analyzer -->
                        <path d="M 925 335 L 95 560" stroke="#ec4899" stroke-width="1" fill="none" marker-end="url(#arrow-dag)" stroke-dasharray="4 2"/>
                        
                        <!-- Level 4: db_connection + cable_analyzer (Police C6 infra) -->
                        <g class="dag-node">
                            <rect x="30" y="510" width="130" height="45" rx="8" fill="#a855f7" stroke="#8b5cf6" stroke-width="1.5"/>
                            <text x="95" y="530" text-anchor="middle" fill="white" font-size="9" font-weight="600">db_connection.py</text>
                            <text x="95" y="545" text-anchor="middle" fill="#e9d5ff" font-size="8">fddcpi2() PG</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="30" y="560" width="130" height="45" rx="8" fill="#ec4899" stroke="#db2777" stroke-width="1.5"/>
                            <text x="95" y="580" text-anchor="middle" fill="white" font-size="9" font-weight="600">cable_analyzer.py</text>
                            <text x="95" y="595" text-anchor="middle" fill="#fbcfe8" font-size="8">CDI+posemode</text>
                        </g>
                        
                        <!-- Level 4: Security Rules -->
                        <g class="dag-node">
                            <rect x="520" y="510" width="150" height="50" rx="8" fill="#ef4444" stroke="#dc2626" stroke-width="1.5"/>
                            <text x="595" y="530" text-anchor="middle" fill="white" font-size="10" font-weight="600">security_rules.py</text>
                            <text x="595" y="548" text-anchor="middle" fill="#fecaca" font-size="8">NFC 11201-A1</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="690" y="510" width="150" height="50" rx="8" fill="#f97316" stroke="#ea580c" stroke-width="1.5"/>
                            <text x="765" y="530" text-anchor="middle" fill="white" font-size="10" font-weight="600">comac_db_reader.py</text>
                            <text x="765" y="548" text-anchor="middle" fill="#fed7aa" font-size="8">BD officielle</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="860" y="510" width="130" height="50" rx="8" fill="#f97316" stroke="#ea580c" stroke-width="1.5"/>
                            <text x="925" y="530" text-anchor="middle" fill="white" font-size="10" font-weight="600">pcm_parser.py</text>
                            <text x="925" y="548" text-anchor="middle" fill="#fed7aa" font-size="8">XML .pcm</text>
                        </g>
                        
                        <!-- Arrows security_rules -> comac_db_reader -->
                        <path d="M 595 560 L 700 600" stroke="#f97316" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 925 560 L 595 600" stroke="#f97316" stroke-width="1" fill="none" marker-end="url(#arrow-dag)" stroke-dasharray="4 2"/>
                        
                        <!-- Level 5: comac_loader -->
                        <g class="dag-node">
                            <rect x="620" y="590" width="150" height="50" rx="8" fill="#06b6d4" stroke="#0891b2" stroke-width="1.5"/>
                            <text x="695" y="610" text-anchor="middle" fill="white" font-size="10" font-weight="600">comac_loader.py</text>
                            <text x="695" y="628" text-anchor="middle" fill="#a5f3fc" font-size="8">Fusion PCM+Excel</text>
                        </g>
                        
                        <!-- Level 5: Data -->
                        <g class="dag-node">
                            <rect x="860" y="590" width="130" height="50" rx="8" fill="#64748b" stroke="#475569" stroke-width="1.5"/>
                            <text x="925" y="610" text-anchor="middle" fill="white" font-size="10" font-weight="600">PostgreSQL</text>
                            <text x="925" y="628" text-anchor="middle" fill="#e2e8f0" font-size="8">schema comac</text>
                        </g>
                        
                        <path d="M 765 560 L 860 590" stroke="#64748b" stroke-width="1" fill="none" marker-end="url(#arrow-dag)" stroke-dasharray="4 2"/>
                        
                        <!-- Legend -->
                        <rect x="30" y="590" width="200" height="110" rx="8" fill="white" stroke="#e2e8f0" stroke-width="1"/>
                        <text x="130" y="610" text-anchor="middle" fill="#334155" font-size="10" font-weight="600">LEGENDE</text>
                        <circle cx="50" cy="628" r="6" fill="#8b5cf6"/>
                        <text x="65" y="632" fill="#64748b" font-size="9">UI / Controller</text>
                        <circle cx="50" cy="648" r="6" fill="#3b82f6"/>
                        <text x="65" y="652" fill="#64748b" font-size="9">Workflows (6)</text>
                        <circle cx="50" cy="668" r="6" fill="#10b981"/>
                        <text x="65" y="672" fill="#64748b" font-size="9">Modules metier</text>
                        <circle cx="50" cy="688" r="6" fill="#ef4444"/>
                        <text x="65" y="692" fill="#64748b" font-size="9">Regles securite</text>
                    </svg>
                    
                    <div class="legend" style="margin-top: 1rem;">
                        <div class="legend-item"><div class="legend-color" style="background: #8b5cf6;"></div><span>UI / Controller</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: #3b82f6;"></div><span>Workflows (Orchestration)</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: #10b981;"></div><span>Modules metier</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: #ef4444;"></div><span>Regles securite</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: #f97316;"></div><span>Lecteurs donnees</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: #64748b;"></div><span>Donnees (PostgreSQL)</span></div>
                    </div>
                </div>
            </div>

            <!-- Tooltip -->
            <div id="diagram-tooltip" class="info-tooltip"></div>
        </section>

        <!-- Modules Anchor -->
        <div id="modules-section" style="scroll-margin-top: 80px;"></div>

        <!-- Police C6 Deep Dive - v2.3.0 Major Changes -->
        <section id="police-c6" style="margin-top: 5rem;">
            <div class="section-header">
                <h2>
                    <span style="display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; background: linear-gradient(135deg, #a855f7, #7c3aed); border-radius: 10px; margin-right: 12px; color: white; font-weight: 700; font-size: 18px;">4</span>
                    Police C6 - Refactoring v2.3.0
                </h2>
                <p>Architecture fddcpi2 : SRO → PostgreSQL → cables decoupes → intersection appuis → comparaison C6 Excel</p>
            </div>

            <!-- Performance Dashboard -->
            <div class="stats-grid" style="margin-bottom: 3rem;">
                <div class="stat-card" style="border-top: 3px solid #a855f7;">
                    <div class="stat-value" style="color: #a855f7;">718</div>
                    <div class="stat-label">Lignes PoliceC6.py</div>
                </div>
                <div class="stat-card" style="border-top: 3px solid #3b82f6;">
                    <div class="stat-value" style="color: #3b82f6;">752</div>
                    <div class="stat-label">Lignes police_workflow.py</div>
                </div>
                <div class="stat-card" style="border-top: 3px solid #10b981;">
                    <div class="stat-value" style="color: #10b981;">-78%</div>
                    <div class="stat-label">Temps extraction (10k poteaux)</div>
                </div>
                <div class="stat-card" style="border-top: 3px solid #ef4444;">
                    <div class="stat-value" style="color: #ef4444;">-62%</div>
                    <div class="stat-label">Consommation memoire</div>
                </div>
            </div>

            <!-- Police C6 Filters Pipeline Diagram -->
            <div class="diagram-container" style="background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 50%, #ede9fe 100%);">
                <h3 class="diagram-title" style="color: #5b21b6;">Pipeline de filtrage Police C6 v2.3.0</h3>
                <svg class="architecture-svg" viewBox="0 0 1000 600" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <marker id="arrow-plc" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
                            <polygon points="0 0, 8 3, 0 6" fill="#7c3aed"/>
                        </marker>
                        <marker id="arrow-plc-red" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
                            <polygon points="0 0, 8 3, 0 6" fill="#ef4444"/>
                        </marker>
                        <marker id="arrow-plc-green" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
                            <polygon points="0 0, 8 3, 0 6" fill="#10b981"/>
                        </marker>
                        <linearGradient id="grad-plc" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#a855f7;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#7c3aed;stop-opacity:1" />
                        </linearGradient>
                        <filter id="shadow-plc" x="-10%" y="-10%" width="120%" height="120%">
                            <feDropShadow dx="0" dy="3" stdDeviation="4" flood-opacity="0.15"/>
                        </filter>
                    </defs>

                    <rect width="1000" height="600" fill="transparent"/>

                    <!-- Title bar -->
                    <g filter="url(#shadow-plc)">
                        <rect x="30" y="15" width="940" height="50" rx="12" fill="url(#grad-plc)"/>
                        <text x="500" y="45" text-anchor="middle" fill="white" font-size="14" font-weight="700">PIPELINE DE FILTRAGE - PoliceC6.py + cable_analyzer.py + async_tasks.py</text>
                    </g>

                    <!-- STAGE 1: Spatial Filter (bbox) -->
                    <g filter="url(#shadow-plc)">
                        <rect x="30" y="85" width="220" height="160" rx="12" fill="white" stroke="#3b82f6" stroke-width="2"/>
                        <rect x="30" y="85" width="220" height="32" rx="12" fill="#3b82f6"/>
                        <text x="140" y="106" text-anchor="middle" fill="white" font-size="11" font-weight="700">1. FILTRE SPATIAL (bbox)</text>
                        <text x="45" y="135" fill="#1e40af" font-size="9" font-weight="600">QgsRectangle + buffer 10%</text>
                        <text x="45" y="152" fill="#3b82f6" font-size="8">Zone etude → bbox etendu</text>
                        <text x="45" y="168" fill="#3b82f6" font-size="8">QgsFeatureRequest.setFilterRect()</text>
                        <text x="45" y="184" fill="#3b82f6" font-size="8">build_spatial_index() cache</text>
                        <rect x="45" y="200" width="190" height="30" rx="6" fill="#dbeafe"/>
                        <text x="140" y="220" text-anchor="middle" fill="#1e40af" font-size="10" font-weight="700">-80% temps extraction</text>
                    </g>

                    <!-- Arrow 1→2 -->
                    <path d="M 250 165 L 275 165" stroke="#7c3aed" stroke-width="2" fill="none" marker-end="url(#arrow-plc)"/>

                    <!-- STAGE 2: Cable Type Filter -->
                    <g filter="url(#shadow-plc)">
                        <rect x="280" y="85" width="200" height="160" rx="12" fill="white" stroke="#f59e0b" stroke-width="2"/>
                        <rect x="280" y="85" width="200" height="32" rx="12" fill="#f59e0b"/>
                        <text x="380" y="106" text-anchor="middle" fill="white" font-size="11" font-weight="700">2. FILTRE CABLE</text>
                        <text x="295" y="135" fill="#92400e" font-size="9" font-weight="600">cab_type = 'CDI' uniquement</text>
                        <text x="295" y="152" fill="#a16207" font-size="8">Avant: cab_type != 'RAC'</text>
                        <text x="295" y="168" fill="#a16207" font-size="8">Types: CDI, RAC, TRA...</text>
                        <text x="295" y="184" fill="#a16207" font-size="8">Seul CDI = distribution</text>
                        <rect x="295" y="200" width="170" height="30" rx="6" fill="#fef3c7"/>
                        <text x="380" y="220" text-anchor="middle" fill="#92400e" font-size="10" font-weight="700">cable_analyzer.py L364</text>
                    </g>

                    <!-- Arrow 2→3 -->
                    <path d="M 480 165 L 505 165" stroke="#7c3aed" stroke-width="2" fill="none" marker-end="url(#arrow-plc)"/>

                    <!-- STAGE 3: Posemode Filter -->
                    <g filter="url(#shadow-plc)">
                        <rect x="510" y="85" width="210" height="160" rx="12" fill="white" stroke="#10b981" stroke-width="2"/>
                        <rect x="510" y="85" width="210" height="32" rx="12" fill="#10b981"/>
                        <text x="615" y="106" text-anchor="middle" fill="white" font-size="11" font-weight="700">3. FILTRE POSEMODE</text>
                        <text x="525" y="135" fill="#065f46" font-size="9" font-weight="600">posemode in (1, 2)</text>
                        <rect x="525" y="145" width="60" height="18" rx="4" fill="#d1fae5"/>
                        <text x="555" y="158" text-anchor="middle" fill="#065f46" font-size="8" font-weight="600">1 = aerien</text>
                        <rect x="595" y="145" width="60" height="18" rx="4" fill="#d1fae5"/>
                        <text x="625" y="158" text-anchor="middle" fill="#065f46" font-size="8" font-weight="600">2 = facade</text>
                        <rect x="665" y="145" width="42" height="18" rx="4" fill="#fee2e2"/>
                        <text x="686" y="158" text-anchor="middle" fill="#991b1b" font-size="7" font-weight="600">0 exclu</text>
                        <text x="525" y="184" fill="#047857" font-size="8">0=souterrain, 4=indefini → EXCLU</text>
                        <rect x="525" y="200" width="180" height="30" rx="6" fill="#d1fae5"/>
                        <text x="615" y="220" text-anchor="middle" fill="#065f46" font-size="10" font-weight="700">async_tasks.py L619</text>
                    </g>

                    <!-- Arrow 3→4 -->
                    <path d="M 720 165 L 745 165" stroke="#7c3aed" stroke-width="2" fill="none" marker-end="url(#arrow-plc)"/>

                    <!-- STAGE 4: EDF Exclusion -->
                    <g filter="url(#shadow-plc)">
                        <rect x="750" y="85" width="220" height="160" rx="12" fill="white" stroke="#ef4444" stroke-width="2"/>
                        <rect x="750" y="85" width="220" height="32" rx="12" fill="#ef4444"/>
                        <text x="860" y="106" text-anchor="middle" fill="white" font-size="11" font-weight="700">4. EXCLUSION EDF</text>
                        <text x="765" y="135" fill="#991b1b" font-size="9" font-weight="600">Colonne AB (Effort disponible)</text>
                        <rect x="765" y="145" width="85" height="22" rx="4" fill="#d1fae5"/>
                        <text x="807" y="160" text-anchor="middle" fill="#065f46" font-size="8" font-weight="600">Renseigne=FT</text>
                        <rect x="860" y="145" width="95" height="22" rx="4" fill="#fee2e2"/>
                        <text x="907" y="160" text-anchor="middle" fill="#991b1b" font-size="8" font-weight="600">Vide=EDF exclu</text>
                        <text x="765" y="184" fill="#dc2626" font-size="8">lire_annexe_c6() L390-427</text>
                        <rect x="765" y="200" width="190" height="30" rx="6" fill="#fee2e2"/>
                        <text x="860" y="220" text-anchor="middle" fill="#991b1b" font-size="10" font-weight="700">Appuis EDF elimines</text>
                    </g>

                    <!-- Performance comparison: Before vs After -->
                    <g filter="url(#shadow-plc)">
                        <rect x="30" y="270" width="455" height="150" rx="14" fill="white" stroke="#ef4444" stroke-width="2"/>
                        <rect x="30" y="270" width="455" height="32" rx="14" fill="rgba(239,68,68,0.15)"/>
                        <text x="257" y="292" text-anchor="middle" fill="#991b1b" font-size="12" font-weight="700">AVANT v2.3.0</text>

                        <text x="55" y="325" fill="#64748b" font-size="10">Temps (10k poteaux):</text>
                        <text x="250" y="325" fill="#ef4444" font-size="14" font-weight="700">~45s</text>
                        <text x="55" y="350" fill="#64748b" font-size="10">Memoire (50k poteaux):</text>
                        <text x="250" y="350" fill="#ef4444" font-size="14" font-weight="700">~800 MB</text>
                        <text x="55" y="375" fill="#64748b" font-size="10">Filtre cable:</text>
                        <text x="250" y="375" fill="#ef4444" font-size="11" font-weight="600">cab_type != 'RAC' (trop large)</text>
                        <text x="55" y="400" fill="#64748b" font-size="10">Cleanup memoire:</text>
                        <text x="250" y="400" fill="#ef4444" font-size="11" font-weight="600">AUCUN (fuite ~500 MB)</text>
                    </g>

                    <!-- Arrow Before→After -->
                    <path d="M 485 345 L 515 345" stroke="#10b981" stroke-width="4" fill="none" marker-end="url(#arrow-plc-green)"/>

                    <g filter="url(#shadow-plc)">
                        <rect x="520" y="270" width="450" height="150" rx="14" fill="white" stroke="#10b981" stroke-width="2"/>
                        <rect x="520" y="270" width="450" height="32" rx="14" fill="rgba(16,185,129,0.15)"/>
                        <text x="745" y="292" text-anchor="middle" fill="#065f46" font-size="12" font-weight="700">APRES v2.3.0</text>

                        <text x="545" y="325" fill="#64748b" font-size="10">Temps (10k poteaux):</text>
                        <text x="740" y="325" fill="#10b981" font-size="14" font-weight="700">&lt;10s (-78%)</text>
                        <text x="545" y="350" fill="#64748b" font-size="10">Memoire (50k poteaux):</text>
                        <text x="740" y="350" fill="#10b981" font-size="14" font-weight="700">&lt;300 MB (-62%)</text>
                        <text x="545" y="375" fill="#64748b" font-size="10">Filtre cable:</text>
                        <text x="740" y="375" fill="#10b981" font-size="11" font-weight="600">CDI + posemode(1,2) (precis)</text>
                        <text x="545" y="400" fill="#64748b" font-size="10">Cleanup memoire:</text>
                        <text x="740" y="400" fill="#10b981" font-size="11" font-weight="600">pot_cache.clear() etc. (explicite)</text>
                    </g>

                    <!-- Bug fixes section -->
                    <g filter="url(#shadow-plc)">
                        <rect x="30" y="440" width="940" height="140" rx="14" fill="white" stroke="#8b5cf6" stroke-width="2"/>
                        <rect x="30" y="440" width="940" height="32" rx="14" fill="url(#grad-plc)"/>
                        <text x="500" y="462" text-anchor="middle" fill="white" font-size="12" font-weight="700">CORRECTIONS CRITIQUES IMPLEMENTEES</text>

                        <!-- CRIT-001 -->
                        <rect x="50" y="485" width="200" height="80" rx="8" fill="#f0fdf4" stroke="#10b981" stroke-width="1"/>
                        <text x="150" y="505" text-anchor="middle" fill="#065f46" font-size="9" font-weight="700">CRIT-001: Filtres spatiaux</text>
                        <text x="60" y="522" fill="#047857" font-size="8">QgsRectangle bbox + buffer</text>
                        <text x="60" y="537" fill="#047857" font-size="8">-80% temps, -70% memoire</text>
                        <text x="60" y="552" fill="#10b981" font-size="7" font-weight="600">PoliceC6.py L611-627</text>

                        <!-- CRIT-003 -->
                        <rect x="270" y="485" width="200" height="80" rx="8" fill="#f0fdf4" stroke="#10b981" stroke-width="1"/>
                        <text x="370" y="505" text-anchor="middle" fill="#065f46" font-size="9" font-weight="700">CRIT-003: Cleanup memoire</text>
                        <text x="280" y="522" fill="#047857" font-size="8">pot_cache, bpe_cache .clear()</text>
                        <text x="280" y="537" fill="#047857" font-size="8">Evite fuite 500 MB</text>
                        <text x="280" y="552" fill="#10b981" font-size="7" font-weight="600">PoliceC6.py L932-942</text>

                        <!-- CRIT-004 -->
                        <rect x="490" y="485" width="200" height="80" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
                        <text x="590" y="505" text-anchor="middle" fill="#92400e" font-size="9" font-weight="700">CRIT-004: Division zero</text>
                        <text x="500" y="522" fill="#a16207" font-size="8">Guards portee/capacite_fo</text>
                        <text x="500" y="537" fill="#a16207" font-size="8">Validation None, &lt;0</text>
                        <text x="500" y="552" fill="#f59e0b" font-size="7" font-weight="600">security_rules.py L234-346</text>

                        <!-- CRIT-006 -->
                        <rect x="710" y="485" width="240" height="80" rx="8" fill="#fee2e2" stroke="#ef4444" stroke-width="1"/>
                        <text x="830" y="505" text-anchor="middle" fill="#991b1b" font-size="9" font-weight="700">CRIT-006: Fix injection SQL</text>
                        <text x="720" y="522" fill="#dc2626" font-size="8">Avant: f&quot;{champs} LIKE '{val}'&quot;</text>
                        <text x="720" y="537" fill="#dc2626" font-size="8">Apres: double quotes colonnes</text>
                        <text x="720" y="552" fill="#ef4444" font-size="7" font-weight="600">PoliceC6.py L1068</text>
                    </g>
                </svg>

                <div class="legend" style="margin-top: 1.5rem;">
                    <div class="legend-item"><div class="legend-color" style="background: #3b82f6;"></div><span>Filtre spatial</span></div>
                    <div class="legend-item"><div class="legend-color" style="background: #f59e0b;"></div><span>Filtre cable CDI</span></div>
                    <div class="legend-item"><div class="legend-color" style="background: #10b981;"></div><span>Filtre posemode</span></div>
                    <div class="legend-item"><div class="legend-color" style="background: #ef4444;"></div><span>Exclusion EDF</span></div>
                </div>
            </div>

            <!-- FDDCPI2 - Premium Design -->
            <div style="margin-top: 3rem; border-radius: 24px; overflow: hidden; background: linear-gradient(160deg, #0c0a1a 0%, #1a1033 35%, #0f172a 65%, #071a12 100%); border: 1px solid rgba(139,92,246,0.2); box-shadow: 0 25px 60px rgba(0,0,0,0.4), 0 0 80px rgba(139,92,246,0.06);">
                <!-- Header Bar -->
                <div style="padding: 1.6rem 2rem; border-bottom: 1px solid rgba(139,92,246,0.12); background: linear-gradient(90deg, rgba(139,92,246,0.06), rgba(251,191,36,0.06), rgba(16,185,129,0.06));">
                    <div style="display: flex; align-items: center; gap: 14px; flex-wrap: wrap;">
                        <div style="width: 44px; height: 44px; border-radius: 12px; background: linear-gradient(135deg, #a855f7, #7c3aed); display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 20px rgba(168,85,247,0.3); flex-shrink: 0;">
                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.2" stroke-linecap="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
                        </div>
                        <div style="flex: 1; min-width: 200px;">
                            <h3 style="margin: 0; color: #f1f5f9; font-size: 1.3rem; font-weight: 700; letter-spacing: -0.02em;">FDDCPI2(SRO)</h3>
                            <p style="margin: 2px 0 0; color: #94a3b8; font-size: 0.82rem;">Fonction Dynamique de Découpage des Câbles par Point d'Infrastructure</p>
                        </div>
                        <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                            <span style="padding: 3px 10px; border-radius: 16px; background: rgba(168,85,247,0.12); color: #c084fc; font-size: 0.72rem; font-weight: 600; border: 1px solid rgba(168,85,247,0.25);">PostgreSQL</span>
                            <span style="padding: 3px 10px; border-radius: 16px; background: rgba(251,191,36,0.12); color: #fbbf24; font-size: 0.72rem; font-weight: 600; border: 1px solid rgba(251,191,36,0.25);">PostGIS</span>
                            <span style="padding: 3px 10px; border-radius: 16px; background: rgba(16,185,129,0.12); color: #6ee7b7; font-size: 0.72rem; font-weight: 600; border: 1px solid rgba(16,185,129,0.25);">EPSG:2154</span>
                        </div>
                    </div>
                </div>

                <!-- SVG Diagram -->
                <div style="padding: 1.5rem;">
                <svg viewBox="0 0 1100 700" xmlns="http://www.w3.org/2000/svg" style="width:100%; height:auto; max-height:720px;">
                    <defs>
                        <marker id="fa2" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0,8 3,0 6" fill="#fbbf24"/></marker>
                        <filter id="fg"><feGaussianBlur stdDeviation="3" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                        <linearGradient id="gzl" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#1e1b4b" stop-opacity="0.35"/><stop offset="100%" stop-color="#0f172a" stop-opacity="0.15"/></linearGradient>
                        <linearGradient id="gzr" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#052e16" stop-opacity="0.25"/><stop offset="100%" stop-color="#0f172a" stop-opacity="0.15"/></linearGradient>
                        <linearGradient id="gc1" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#818cf8"/><stop offset="100%" stop-color="#6366f1"/></linearGradient>
                        <linearGradient id="gc2" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#22d3ee"/><stop offset="100%" stop-color="#06b6d4"/></linearGradient>
                        <linearGradient id="gfl" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#a855f7"/><stop offset="50%" stop-color="#fbbf24"/><stop offset="100%" stop-color="#10b981"/></linearGradient>
                    </defs>

                    <!-- ===== LEFT: AVANT ===== -->
                    <rect x="15" y="10" width="350" height="380" rx="18" fill="url(#gzl)" stroke="rgba(129,140,248,0.2)" stroke-width="1.5"/>
                    <rect x="25" y="20" width="80" height="24" rx="12" fill="rgba(129,140,248,0.15)"/>
                    <text x="65" y="36" text-anchor="middle" fill="#a5b4fc" font-size="10" font-weight="700">AVANT</text>
                    <text x="115" y="36" fill="#64748b" font-size="8.5">2 câbles continus + 7 points infra</text>

                    <!-- Legend -->
                    <g transform="translate(237,46)">
                        <rect x="-6" y="-4" width="118" height="66" rx="6" fill="rgba(0,0,0,0.25)" stroke="rgba(255,255,255,0.06)" stroke-width="0.5"/>
                        <line x1="2" y1="8" x2="18" y2="8" stroke="url(#gc1)" stroke-width="2.5" stroke-linecap="round"/>
                        <text x="22" y="12" fill="#94a3b8" font-size="7">Câble</text>
                        <circle cx="10" cy="22" r="4" fill="#fbbf24" stroke="#f59e0b" stroke-width="1"/>
                        <text x="22" y="26" fill="#94a3b8" font-size="7">Poteau (pot_)</text>
                        <rect x="6" y="34" width="8" height="8" rx="2" fill="#ef4444" stroke="#dc2626" stroke-width="0.8"/>
                        <text x="22" y="41" fill="#94a3b8" font-size="7">Chambre (chb_)</text>
                        <polygon points="10,50 14,58 6,58" fill="#10b981" stroke="#059669" stroke-width="0.8"/>
                        <text x="22" y="56" fill="#94a3b8" font-size="7">Attache (atr_)</text>
                    </g>

                    <!-- Cable 1 -->
                    <path d="M 55 140 Q 100 162, 145 158 T 238 130 Q 278 148, 310 185 L 335 235" stroke="url(#gc1)" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round" opacity="0.85"/>
                    <text x="175" y="118" text-anchor="middle" fill="#818cf8" font-size="9" font-weight="600">Câble 1 (gid=1)</text>
                    <!-- Cable 2 -->
                    <path d="M 65 265 Q 115 288, 170 283 T 275 272 L 335 315" stroke="url(#gc2)" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round" opacity="0.85"/>
                    <text x="175" y="330" text-anchor="middle" fill="#22d3ee" font-size="9" font-weight="600">Câble 2 (gid=2)</text>

                    <!-- Infrastructure Points -->
                    <circle cx="55" cy="140" r="10" fill="rgba(251,191,36,0.1)"/><circle cx="55" cy="140" r="6" fill="#fbbf24" stroke="#fde68a" stroke-width="1.2" filter="url(#fg)"/>
                    <text x="55" y="130" text-anchor="middle" fill="#fde68a" font-size="6.5" font-weight="600">pot_001</text>
                    <circle cx="145" cy="158" r="10" fill="rgba(251,191,36,0.1)"/><circle cx="145" cy="158" r="6" fill="#fbbf24" stroke="#fde68a" stroke-width="1.2" filter="url(#fg)"/>
                    <text x="145" y="148" text-anchor="middle" fill="#fde68a" font-size="6.5" font-weight="600">pot_002</text>
                    <rect x="232" y="124" width="12" height="12" rx="2.5" fill="#ef4444" stroke="#fca5a5" stroke-width="1.2"/>
                    <text x="238" y="119" text-anchor="middle" fill="#fca5a5" font-size="6.5" font-weight="600">chb_001</text>
                    <circle cx="310" cy="185" r="10" fill="rgba(251,191,36,0.1)"/><circle cx="310" cy="185" r="6" fill="#fbbf24" stroke="#fde68a" stroke-width="1.2" filter="url(#fg)"/>
                    <text x="310" y="175" text-anchor="middle" fill="#fde68a" font-size="6.5" font-weight="600">pot_003</text>
                    <circle cx="65" cy="265" r="10" fill="rgba(251,191,36,0.1)"/><circle cx="65" cy="265" r="6" fill="#fbbf24" stroke="#fde68a" stroke-width="1.2" filter="url(#fg)"/>
                    <text x="65" y="255" text-anchor="middle" fill="#fde68a" font-size="6.5" font-weight="600">pot_004</text>
                    <polygon points="170,277 176,289 164,289" fill="#10b981" stroke="#6ee7b7" stroke-width="1.2"/>
                    <text x="170" y="271" text-anchor="middle" fill="#6ee7b7" font-size="6.5" font-weight="600">atr_FAC</text>
                    <rect x="269" y="266" width="12" height="12" rx="2.5" fill="#ef4444" stroke="#fca5a5" stroke-width="1.2"/>
                    <text x="275" y="261" text-anchor="middle" fill="#fca5a5" font-size="6.5" font-weight="600">chb_002</text>

                    <!-- Mini input table -->
                    <rect x="35" y="350" width="130" height="32" rx="8" fill="rgba(129,140,248,0.06)" stroke="rgba(129,140,248,0.15)" stroke-width="1"/>
                    <text x="50" y="370" fill="#94a3b8" font-size="7.5">gid: <tspan fill="#818cf8" font-weight="600">1, 2</tspan>  |  geom: <tspan fill="#818cf8">LINESTRING</tspan></text>

                    <!-- ===== CENTER: FUNCTION ===== -->
                    <!-- Flow arrow IN -->
                    <path d="M 370 200 L 405 200" stroke="url(#gfl)" stroke-width="2.5" fill="none" marker-end="url(#fa2)" opacity="0.7">
                        <animate attributeName="stroke-dashoffset" from="20" to="0" dur="1.5s" repeatCount="indefinite"/>
                    </path>

                    <!-- Function container -->
                    <rect x="410" y="8" width="280" height="384" rx="18" fill="rgba(12,8,30,0.75)" stroke="rgba(251,191,36,0.25)" stroke-width="1.5"/>
                    <rect x="410" y="8" width="280" height="4" rx="18" fill="url(#gfl)"/>

                    <text x="550" y="38" text-anchor="middle" fill="#fbbf24" font-size="14" font-weight="800" letter-spacing="-0.5">fddcpi2(zasro)</text>
                    <text x="550" y="52" text-anchor="middle" fill="#64748b" font-size="7.5">rip_avg_nge | plpgsql | Serveur AUVERGNE</text>

                    <!-- Step 1 -->
                    <rect x="425" y="64" width="250" height="42" rx="10" fill="rgba(239,68,68,0.06)" stroke="rgba(239,68,68,0.2)" stroke-width="1"/>
                    <circle cx="442" cy="85" r="9" fill="rgba(239,68,68,0.12)" stroke="#ef4444" stroke-width="1.2"/>
                    <text x="442" y="89" text-anchor="middle" fill="#ef4444" font-size="8.5" font-weight="700">1</text>
                    <text x="460" y="80" fill="#fca5a5" font-size="9.5" font-weight="700">infra(SRO)</text>
                    <text x="460" y="94" fill="#ef4444" font-size="7" opacity="0.8">Collect points : pot_ + chb_ + atr_</text>

                    <line x1="550" y1="106" x2="550" y2="114" stroke="#334155" stroke-width="1.2" stroke-dasharray="2 2"/>

                    <!-- Step 2 -->
                    <rect x="425" y="114" width="250" height="42" rx="10" fill="rgba(168,85,247,0.06)" stroke="rgba(168,85,247,0.2)" stroke-width="1"/>
                    <circle cx="442" cy="135" r="9" fill="rgba(168,85,247,0.12)" stroke="#a855f7" stroke-width="1.2"/>
                    <text x="442" y="139" text-anchor="middle" fill="#a855f7" font-size="8.5" font-weight="700">2</text>
                    <text x="460" y="130" fill="#c084fc" font-size="9.5" font-weight="700">fdrca(SRO)</text>
                    <text x="460" y="144" fill="#a855f7" font-size="7" opacity="0.8">Recalage : alignement câbles sur infra</text>

                    <line x1="550" y1="156" x2="550" y2="164" stroke="#334155" stroke-width="1.2" stroke-dasharray="2 2"/>

                    <!-- Step 3 -->
                    <rect x="425" y="164" width="250" height="42" rx="10" fill="rgba(59,130,246,0.06)" stroke="rgba(59,130,246,0.2)" stroke-width="1"/>
                    <circle cx="442" cy="185" r="9" fill="rgba(59,130,246,0.12)" stroke="#3b82f6" stroke-width="1.2"/>
                    <text x="442" y="189" text-anchor="middle" fill="#3b82f6" font-size="8.5" font-weight="700">3</text>
                    <text x="460" y="180" fill="#93c5fd" font-size="9.5" font-weight="700">ST_Snap(cable, infra, 0.2m)</text>
                    <text x="460" y="194" fill="#3b82f6" font-size="7" opacity="0.8">Accrochage câbles aux points (20cm)</text>

                    <line x1="550" y1="206" x2="550" y2="214" stroke="#334155" stroke-width="1.2" stroke-dasharray="2 2"/>

                    <!-- Step 4 - Highlight -->
                    <rect x="425" y="214" width="250" height="52" rx="10" fill="rgba(16,185,129,0.07)" stroke="rgba(16,185,129,0.3)" stroke-width="1.5"/>
                    <circle cx="442" cy="240" r="9" fill="rgba(16,185,129,0.15)" stroke="#10b981" stroke-width="1.2"/>
                    <text x="442" y="244" text-anchor="middle" fill="#10b981" font-size="8.5" font-weight="700">4</text>
                    <text x="460" y="234" fill="#6ee7b7" font-size="9.5" font-weight="700">ST_Split + ST_Dump</text>
                    <text x="460" y="248" fill="#10b981" font-size="7" opacity="0.8">Découpage géométrique aux points infra</text>
                    <text x="460" y="260" fill="#059669" font-size="6.5" opacity="0.6">Filtre longueur &gt; 0.2m | doublons éliminés</text>

                    <line x1="550" y1="266" x2="550" y2="274" stroke="#334155" stroke-width="1.2" stroke-dasharray="2 2"/>

                    <!-- Step 5 -->
                    <rect x="425" y="274" width="250" height="64" rx="10" fill="rgba(251,191,36,0.05)" stroke="rgba(251,191,36,0.2)" stroke-width="1"/>
                    <circle cx="442" cy="296" r="9" fill="rgba(251,191,36,0.12)" stroke="#fbbf24" stroke-width="1.2"/>
                    <text x="442" y="300" text-anchor="middle" fill="#fbbf24" font-size="8.5" font-weight="700">5</text>
                    <text x="460" y="291" fill="#fde68a" font-size="9.5" font-weight="700">Posemode</text>
                    <text x="460" y="305" fill="#fbbf24" font-size="7" opacity="0.8">Analyse endpoints → type de pose</text>
                    <!-- Posemode chips -->
                    <rect x="430" y="316" width="50" height="15" rx="7" fill="rgba(59,130,246,0.12)" stroke="rgba(59,130,246,0.25)" stroke-width="0.5"/>
                    <text x="455" y="327" text-anchor="middle" fill="#60a5fa" font-size="6.5" font-weight="600">0 sout.</text>
                    <rect x="484" y="316" width="50" height="15" rx="7" fill="rgba(245,158,11,0.12)" stroke="rgba(245,158,11,0.25)" stroke-width="0.5"/>
                    <text x="509" y="327" text-anchor="middle" fill="#f59e0b" font-size="6.5" font-weight="600">1 aérien</text>
                    <rect x="538" y="316" width="50" height="15" rx="7" fill="rgba(16,185,129,0.12)" stroke="rgba(16,185,129,0.25)" stroke-width="0.5"/>
                    <text x="563" y="327" text-anchor="middle" fill="#10b981" font-size="6.5" font-weight="600">2 façade</text>
                    <rect x="592" y="316" width="50" height="15" rx="7" fill="rgba(100,116,139,0.12)" stroke="rgba(100,116,139,0.25)" stroke-width="0.5"/>
                    <text x="617" y="327" text-anchor="middle" fill="#94a3b8" font-size="6.5" font-weight="600">4 indéf.</text>

                    <!-- Flow arrow OUT -->
                    <path d="M 695 200 L 730 200" stroke="url(#gfl)" stroke-width="2.5" fill="none" marker-end="url(#fa2)" opacity="0.7">
                        <animate attributeName="stroke-dashoffset" from="20" to="0" dur="1.5s" repeatCount="indefinite"/>
                    </path>

                    <!-- ===== RIGHT: APRÈS ===== -->
                    <rect x="735" y="10" width="355" height="380" rx="18" fill="url(#gzr)" stroke="rgba(16,185,129,0.2)" stroke-width="1.5"/>
                    <rect x="745" y="20" width="80" height="24" rx="12" fill="rgba(16,185,129,0.15)"/>
                    <text x="785" y="36" text-anchor="middle" fill="#6ee7b7" font-size="10" font-weight="700">APRÈS</text>
                    <text x="835" y="36" fill="#64748b" font-size="8.5">7 segments + posemode assigné</text>

                    <!-- Posemode legend -->
                    <g transform="translate(930,48)">
                        <rect x="-5" y="-4" width="150" height="75" rx="6" fill="rgba(0,0,0,0.3)" stroke="rgba(255,255,255,0.06)" stroke-width="0.5"/>
                        <line x1="2" y1="10" x2="18" y2="10" stroke="#f59e0b" stroke-width="3" stroke-linecap="round"/>
                        <text x="24" y="14" fill="#fbbf24" font-size="7" font-weight="600">aérien</text>
                        <text x="65" y="14" fill="#475569" font-size="6.5">pot↔pot</text>
                        <line x1="2" y1="26" x2="18" y2="26" stroke="#3b82f6" stroke-width="3" stroke-linecap="round"/>
                        <text x="24" y="30" fill="#60a5fa" font-size="7" font-weight="600">souterrain</text>
                        <text x="82" y="30" fill="#475569" font-size="6.5">chb↔*</text>
                        <line x1="2" y1="42" x2="18" y2="42" stroke="#10b981" stroke-width="3" stroke-linecap="round"/>
                        <text x="24" y="46" fill="#6ee7b7" font-size="7" font-weight="600">façade</text>
                        <text x="65" y="46" fill="#475569" font-size="6.5">*↔atr_FAC</text>
                        <line x1="2" y1="58" x2="18" y2="58" stroke="#64748b" stroke-width="3" stroke-linecap="round" stroke-dasharray="4 2"/>
                        <text x="24" y="62" fill="#94a3b8" font-size="7" font-weight="600">indéfini</text>
                        <text x="72" y="62" fill="#475569" font-size="6.5">DQE/???</text>
                    </g>

                    <!-- Segment 1.1: pot→pot = aérien -->
                    <path d="M 765 140 L 845 168" stroke="#f59e0b" stroke-width="3.5" fill="none" stroke-linecap="round"/>
                    <circle cx="765" cy="140" r="5.5" fill="#fbbf24" stroke="#fde68a" stroke-width="1" filter="url(#fg)"/>
                    <circle cx="845" cy="168" r="5.5" fill="#fbbf24" stroke="#fde68a" stroke-width="1" filter="url(#fg)"/>
                    <rect x="790" y="144" width="28" height="14" rx="7" fill="rgba(245,158,11,0.2)"/>
                    <text x="804" y="154" text-anchor="middle" fill="#fbbf24" font-size="7" font-weight="700">1.1</text>

                    <!-- Segment 1.2: pot→chb = souterrain -->
                    <path d="M 845 168 L 935 132" stroke="#3b82f6" stroke-width="3.5" fill="none" stroke-linecap="round"/>
                    <rect x="929" y="126" width="11" height="11" rx="2" fill="#ef4444" stroke="#fca5a5" stroke-width="1"/>
                    <rect x="876" y="140" width="28" height="14" rx="7" fill="rgba(59,130,246,0.2)"/>
                    <text x="890" y="150" text-anchor="middle" fill="#60a5fa" font-size="7" font-weight="700">1.2</text>

                    <!-- Segment 1.3: chb→pot = souterrain -->
                    <path d="M 935 132 L 1010 190" stroke="#3b82f6" stroke-width="3.5" fill="none" stroke-linecap="round"/>
                    <circle cx="1010" cy="190" r="5.5" fill="#fbbf24" stroke="#fde68a" stroke-width="1" filter="url(#fg)"/>
                    <rect x="960" y="152" width="28" height="14" rx="7" fill="rgba(59,130,246,0.2)"/>
                    <text x="974" y="162" text-anchor="middle" fill="#60a5fa" font-size="7" font-weight="700">1.3</text>

                    <!-- Segment 1.4: pot→??? = indéfini -->
                    <path d="M 1010 190 L 1050 245" stroke="#64748b" stroke-width="3" fill="none" stroke-linecap="round" stroke-dasharray="5 3"/>
                    <rect x="1022" y="208" width="28" height="14" rx="7" fill="rgba(100,116,139,0.15)"/>
                    <text x="1036" y="218" text-anchor="middle" fill="#94a3b8" font-size="7" font-weight="700">1.4</text>
                    <text x="1055" y="256" fill="#64748b" font-size="6">?</text>

                    <!-- Segment 2.1: pot→atr_FAC = façade -->
                    <path d="M 775 270 L 865 298" stroke="#10b981" stroke-width="3.5" fill="none" stroke-linecap="round"/>
                    <circle cx="775" cy="270" r="5.5" fill="#fbbf24" stroke="#fde68a" stroke-width="1" filter="url(#fg)"/>
                    <polygon points="865,292 871,304 859,304" fill="#10b981" stroke="#6ee7b7" stroke-width="1"/>
                    <rect x="806" y="275" width="28" height="14" rx="7" fill="rgba(16,185,129,0.2)"/>
                    <text x="820" y="285" text-anchor="middle" fill="#6ee7b7" font-size="7" font-weight="700">2.1</text>

                    <!-- Segment 2.2: atr_FAC→chb = souterrain -->
                    <path d="M 865 298 L 970 280" stroke="#3b82f6" stroke-width="3.5" fill="none" stroke-linecap="round"/>
                    <rect x="964" y="274" width="11" height="11" rx="2" fill="#ef4444" stroke="#fca5a5" stroke-width="1"/>
                    <rect x="905" y="281" width="28" height="14" rx="7" fill="rgba(59,130,246,0.2)"/>
                    <text x="919" y="291" text-anchor="middle" fill="#60a5fa" font-size="7" font-weight="700">2.2</text>

                    <!-- Segment 2.3: chb→??? = souterrain -->
                    <path d="M 970 280 L 1040 330" stroke="#3b82f6" stroke-width="3.5" fill="none" stroke-linecap="round"/>
                    <rect x="992" y="298" width="28" height="14" rx="7" fill="rgba(59,130,246,0.2)"/>
                    <text x="1006" y="308" text-anchor="middle" fill="#60a5fa" font-size="7" font-weight="700">2.3</text>

                    <!-- Mini output table -->
                    <rect x="755" y="350" width="140" height="32" rx="8" fill="rgba(16,185,129,0.06)" stroke="rgba(16,185,129,0.15)" stroke-width="1"/>
                    <text x="770" y="370" fill="#94a3b8" font-size="7.5">7 segments | <tspan fill="#6ee7b7" font-weight="600">posemode</tspan> assigné</text>

                    <!-- ===== BOTTOM: Result Table ===== -->
                    <rect x="15" y="405" width="1075" height="145" rx="14" fill="rgba(16,185,129,0.04)" stroke="rgba(16,185,129,0.15)" stroke-width="1"/>
                    <text x="550" y="425" text-anchor="middle" fill="#6ee7b7" font-size="10" font-weight="700">Table résultat fddcpi2()</text>
                    <line x1="30" y1="432" x2="1075" y2="432" stroke="rgba(51,65,85,0.5)" stroke-width="0.8"/>

                    <!-- Header row -->
                    <text x="50" y="446" fill="#64748b" font-size="7.5" font-weight="700">gid_dc2</text>
                    <text x="130" y="446" fill="#64748b" font-size="7.5" font-weight="700">gid</text>
                    <text x="195" y="446" fill="#64748b" font-size="7.5" font-weight="700">cab_type</text>
                    <text x="280" y="446" fill="#64748b" font-size="7.5" font-weight="700">posemode</text>
                    <text x="380" y="446" fill="#64748b" font-size="7.5" font-weight="700">endpoints</text>
                    <text x="500" y="446" fill="#64748b" font-size="7.5" font-weight="700">gid_dc2</text>
                    <text x="565" y="446" fill="#64748b" font-size="7.5" font-weight="700">gid</text>
                    <text x="625" y="446" fill="#64748b" font-size="7.5" font-weight="700">cab_type</text>
                    <text x="710" y="446" fill="#64748b" font-size="7.5" font-weight="700">posemode</text>
                    <text x="810" y="446" fill="#64748b" font-size="7.5" font-weight="700">endpoints</text>
                    <line x1="30" y1="452" x2="1075" y2="452" stroke="rgba(51,65,85,0.3)" stroke-width="0.5"/>

                    <!-- Col 1: Cable 1 segments -->
                    <text x="50" y="466" fill="#f59e0b" font-size="7.5">1</text>
                    <text x="130" y="466" fill="#818cf8" font-size="7.5">1</text>
                    <text x="195" y="466" fill="#e2e8f0" font-size="7.5">CDI</text>
                    <rect x="275" y="458" width="36" height="12" rx="6" fill="rgba(245,158,11,0.15)"/>
                    <text x="293" y="468" text-anchor="middle" fill="#f59e0b" font-size="7" font-weight="600">1</text>
                    <text x="380" y="466" fill="#94a3b8" font-size="7">pot→pot</text>

                    <text x="50" y="482" fill="#3b82f6" font-size="7.5">2</text>
                    <text x="130" y="482" fill="#818cf8" font-size="7.5">1</text>
                    <text x="195" y="482" fill="#e2e8f0" font-size="7.5">CDI</text>
                    <rect x="275" y="474" width="36" height="12" rx="6" fill="rgba(59,130,246,0.15)"/>
                    <text x="293" y="484" text-anchor="middle" fill="#3b82f6" font-size="7" font-weight="600">0</text>
                    <text x="380" y="482" fill="#94a3b8" font-size="7">pot→chb</text>

                    <text x="50" y="498" fill="#3b82f6" font-size="7.5">3</text>
                    <text x="130" y="498" fill="#818cf8" font-size="7.5">1</text>
                    <text x="195" y="498" fill="#e2e8f0" font-size="7.5">CDI</text>
                    <rect x="275" y="490" width="36" height="12" rx="6" fill="rgba(59,130,246,0.15)"/>
                    <text x="293" y="500" text-anchor="middle" fill="#3b82f6" font-size="7" font-weight="600">0</text>
                    <text x="380" y="498" fill="#94a3b8" font-size="7">chb→pot</text>

                    <text x="50" y="514" fill="#64748b" font-size="7.5">4</text>
                    <text x="130" y="514" fill="#818cf8" font-size="7.5">1</text>
                    <text x="195" y="514" fill="#e2e8f0" font-size="7.5">CDI</text>
                    <rect x="275" y="506" width="36" height="12" rx="6" fill="rgba(100,116,139,0.12)"/>
                    <text x="293" y="516" text-anchor="middle" fill="#64748b" font-size="7" font-weight="600">4</text>
                    <text x="380" y="514" fill="#94a3b8" font-size="7">pot→???</text>

                    <!-- Vertical divider -->
                    <line x1="470" y1="435" x2="470" y2="540" stroke="rgba(51,65,85,0.3)" stroke-width="0.5" stroke-dasharray="3 2"/>

                    <!-- Col 2: Cable 2 segments -->
                    <text x="500" y="466" fill="#10b981" font-size="7.5">5</text>
                    <text x="565" y="466" fill="#22d3ee" font-size="7.5">2</text>
                    <text x="625" y="466" fill="#e2e8f0" font-size="7.5">CDI</text>
                    <rect x="705" y="458" width="36" height="12" rx="6" fill="rgba(16,185,129,0.15)"/>
                    <text x="723" y="468" text-anchor="middle" fill="#10b981" font-size="7" font-weight="600">2</text>
                    <text x="810" y="466" fill="#94a3b8" font-size="7">pot→FAC</text>

                    <text x="500" y="482" fill="#3b82f6" font-size="7.5">6</text>
                    <text x="565" y="482" fill="#22d3ee" font-size="7.5">2</text>
                    <text x="625" y="482" fill="#e2e8f0" font-size="7.5">CDI</text>
                    <rect x="705" y="474" width="36" height="12" rx="6" fill="rgba(59,130,246,0.15)"/>
                    <text x="723" y="484" text-anchor="middle" fill="#3b82f6" font-size="7" font-weight="600">0</text>
                    <text x="810" y="482" fill="#94a3b8" font-size="7">FAC→chb</text>

                    <text x="500" y="498" fill="#3b82f6" font-size="7.5">7</text>
                    <text x="565" y="498" fill="#22d3ee" font-size="7.5">2</text>
                    <text x="625" y="498" fill="#e2e8f0" font-size="7.5">CDI</text>
                    <rect x="705" y="490" width="36" height="12" rx="6" fill="rgba(59,130,246,0.15)"/>
                    <text x="723" y="500" text-anchor="middle" fill="#3b82f6" font-size="7" font-weight="600">0</text>
                    <text x="810" y="498" fill="#94a3b8" font-size="7">chb→???</text>

                    <!-- ===== BOTTOM: Posemode Rules ===== -->
                    <rect x="15" y="560" width="530" height="130" rx="14" fill="rgba(251,191,36,0.04)" stroke="rgba(251,191,36,0.15)" stroke-width="1"/>
                    <text x="280" y="580" text-anchor="middle" fill="#fde68a" font-size="10" font-weight="700">Règles de détermination du posemode</text>

                    <rect x="30" y="590" width="245" height="22" rx="6" fill="rgba(59,130,246,0.08)" stroke="rgba(59,130,246,0.15)" stroke-width="0.5"/>
                    <text x="40" y="605" fill="#3b82f6" font-size="8" font-weight="700">0 SOUTERRAIN</text>
                    <text x="160" y="605" fill="#94a3b8" font-size="7">chb↔chb, pot↔chb, atr_ADR</text>

                    <rect x="30" y="616" width="245" height="22" rx="6" fill="rgba(245,158,11,0.08)" stroke="rgba(245,158,11,0.15)" stroke-width="0.5"/>
                    <text x="40" y="631" fill="#f59e0b" font-size="8" font-weight="700">1 AÉRIEN</text>
                    <text x="160" y="631" fill="#94a3b8" font-size="7">pot↔pot, pot↔atr_IMM</text>

                    <rect x="285" y="590" width="245" height="22" rx="6" fill="rgba(16,185,129,0.08)" stroke="rgba(16,185,129,0.15)" stroke-width="0.5"/>
                    <text x="295" y="605" fill="#10b981" font-size="8" font-weight="700">2 FAÇADE</text>
                    <text x="415" y="605" fill="#94a3b8" font-size="7">*↔atr_FAC (prioritaire)</text>

                    <rect x="285" y="616" width="245" height="22" rx="6" fill="rgba(100,116,139,0.08)" stroke="rgba(100,116,139,0.15)" stroke-width="0.5"/>
                    <text x="295" y="631" fill="#64748b" font-size="8" font-weight="700">4 INDÉFINI</text>
                    <text x="415" y="631" fill="#94a3b8" font-size="7">DQE / endpoints inconnus</text>

                    <text x="30" y="680" fill="#475569" font-size="7">Tolérance: 20cm | Filtre: longueur &gt; 0.2m | Résultat dynamique (pas de table physique)</text>

                    <!-- ===== BOTTOM-RIGHT: Description ===== -->
                    <rect x="555" y="560" width="535" height="130" rx="14" fill="rgba(168,85,247,0.04)" stroke="rgba(168,85,247,0.12)" stroke-width="1"/>
                    <text x="822" y="580" text-anchor="middle" fill="#c084fc" font-size="10" font-weight="700">Pipeline SQL interne</text>

                    <text x="570" y="598" fill="#94a3b8" font-size="8">1. <tspan fill="#fca5a5" font-weight="600">infra(SRO)</tspan> → collecte poteaux, chambres, attaches de la zone</text>
                    <text x="570" y="614" fill="#94a3b8" font-size="8">2. <tspan fill="#c084fc" font-weight="600">fdrca(SRO)</tspan> → recalage et alignement des câbles sur l'infrastructure</text>
                    <text x="570" y="630" fill="#94a3b8" font-size="8">3. <tspan fill="#93c5fd" font-weight="600">ST_Snap</tspan>(cable, infra, 0.2m) → accrochage géométrique</text>
                    <text x="570" y="646" fill="#94a3b8" font-size="8">4. <tspan fill="#6ee7b7" font-weight="600">ST_Split + ST_Dump</tspan> → découpage et extraction des segments</text>
                    <text x="570" y="662" fill="#94a3b8" font-size="8">5. <tspan fill="#fde68a" font-weight="600">Endpoints</tspan> → détermination du posemode (0/1/2/4)</text>
                    <text x="570" y="680" fill="#475569" font-size="7">Source: rip_avg_nge.fddcpi2(text) | Serveur: AUVERGNE (10.241.228.107) | Dépendances: infra(), fdrca()</text>
                </svg>
                </div>

                <!-- Bottom HTML legend strip -->
                <div style="padding: 0.8rem 2rem 1.2rem; border-top: 1px solid rgba(139,92,246,0.1); display: flex; gap: 24px; flex-wrap: wrap; justify-content: center;">
                    <div style="display: flex; align-items: center; gap: 6px;"><div style="width: 10px; height: 10px; border-radius: 50%; background: #fbbf24; box-shadow: 0 0 6px rgba(251,191,36,0.4);"></div><span style="color: #94a3b8; font-size: 0.75rem;">Poteau (pot_)</span></div>
                    <div style="display: flex; align-items: center; gap: 6px;"><div style="width: 10px; height: 10px; border-radius: 2px; background: #ef4444; box-shadow: 0 0 6px rgba(239,68,68,0.4);"></div><span style="color: #94a3b8; font-size: 0.75rem;">Chambre (chb_)</span></div>
                    <div style="display: flex; align-items: center; gap: 6px;"><div style="width: 0; height: 0; border-left: 5px solid transparent; border-right: 5px solid transparent; border-bottom: 10px solid #10b981;"></div><span style="color: #94a3b8; font-size: 0.75rem;">Attache (atr_)</span></div>
                    <div style="display: flex; align-items: center; gap: 6px;"><div style="width: 16px; height: 3px; border-radius: 2px; background: #f59e0b;"></div><span style="color: #94a3b8; font-size: 0.75rem;">Aérien (1)</span></div>
                    <div style="display: flex; align-items: center; gap: 6px;"><div style="width: 16px; height: 3px; border-radius: 2px; background: #3b82f6;"></div><span style="color: #94a3b8; font-size: 0.75rem;">Souterrain (0)</span></div>
                    <div style="display: flex; align-items: center; gap: 6px;"><div style="width: 16px; height: 3px; border-radius: 2px; background: #10b981;"></div><span style="color: #94a3b8; font-size: 0.75rem;">Façade (2)</span></div>
                </div>
            </div>

            <!-- Feature Cards -->
            <div class="cards-grid" style="margin-top: 3rem;">
                <article class="card">
                    <div class="card-icon purple">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg>
                    </div>
                    <h3>cable_analyzer.py</h3>
                    <p>Nouveau module (402 lignes) : <code>compter_cables_par_appui()</code>, <code>analyser_charge_appuis()</code>. Filtre combine CDI + posemode pour comptage precis.</p>
                </article>
                <article class="card">
                    <div class="card-icon blue">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                    </div>
                    <h3>Workflow async PoliceWorkflow</h3>
                    <p>768 lignes. Architecture fddcpi2 : SRO depuis QGIS → <code>db_connection.py</code> appelle fddcpi2() PostgreSQL → CableSegment → <code>cable_analyzer.py</code> intersecte appuis.</p>
                </article>
                <article class="card">
                    <div class="card-icon red">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                    </div>
                    <h3>db_connection.py + PostgreSQL</h3>
                    <p>Connexion psycopg2 auto (credentials QGIS). Fonction SQL <code>fddcpi2()</code> retourne cables decoupes. Schema comac : 591 cables, hypotheses. Serveur AUVERGNE 10.241.228.107.</p>
                </article>
            </div>
        </section>

        <!-- Module C6 vs BD - Architecture detaillee -->
        <section id="mod-c6bd" style="margin-top: 5rem;">
            <div class="section-header">
                <h2>
                    <span style="display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; background: linear-gradient(135deg, #ec4899, #db2777); border-radius: 10px; margin-right: 12px; color: white; font-weight: 700; font-size: 18px;">1</span>
                    Module C6 vs BD - Architecture complete
                </h2>
                <p>Comparaison intelligente des fichiers Excel C6 avec la base de données QGIS</p>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid" style="margin-bottom: 3rem;">
                <div class="stat-card">
                    <div class="stat-value" style="color: #ec4899;">382</div>
                    <div class="stat-label">Lignes C6_vs_Bd.py</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: #3b82f6;">218</div>
                    <div class="stat-label">Lignes c6bd_workflow.py</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: #10b981;">7s</div>
                    <div class="stat-label">Temps analyse (19 études)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: #f59e0b;">-84%</div>
                    <div class="stat-label">Gain performance</div>
                </div>
            </div>

            <!-- Architecture Diagram C6 vs BD -->
            <div class="diagram-container" style="background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%);">
                <h3 class="diagram-title" style="color: #831843;">Architecture asynchrone non-bloquante</h3>
                <svg class="architecture-svg" viewBox="0 0 900 520" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <marker id="arrow-c6" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
                            <polygon points="0 0, 8 3, 0 6" fill="#ec4899"/>
                        </marker>
                        <marker id="arrow-c6-green" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
                            <polygon points="0 0, 8 3, 0 6" fill="#10b981"/>
                        </marker>
                        <linearGradient id="grad-c6-1" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#ec4899;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#db2777;stop-opacity:1" />
                        </linearGradient>
                        <filter id="shadow-c6" x="-10%" y="-10%" width="120%" height="120%">
                            <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.15"/>
                        </filter>
                    </defs>
                    
                    <!-- Background -->
                    <rect width="900" height="520" fill="transparent"/>
                    
                    <!-- Main Thread Zone -->
                    <rect x="20" y="50" width="540" height="200" rx="16" fill="rgba(255,255,255,0.6)" stroke="#3b82f6" stroke-width="2" stroke-dasharray="6 3"/>
                    <text x="40" y="75" fill="#1e40af" font-size="11" font-weight="700">MAIN THREAD</text>
                    
                    <!-- Step 0: START -->
                    <g filter="url(#shadow-c6)">
                        <rect x="40" y="95" width="120" height="70" rx="10" fill="white" stroke="#ec4899" stroke-width="2"/>
                        <rect x="40" y="95" width="120" height="24" rx="10" fill="url(#grad-c6-1)"/>
                        <text x="100" y="112" text-anchor="middle" fill="white" font-size="10" font-weight="700">START</text>
                        <text x="100" y="135" text-anchor="middle" fill="#831843" font-size="9" font-weight="600">start_analysis()</text>
                        <text x="100" y="150" text-anchor="middle" fill="#9d174d" font-size="8">Auto-detect champ</text>
                    </g>
                    <text x="100" y="178" text-anchor="middle" fill="#10b981" font-size="8" font-weight="600">5%</text>
                    
                    <!-- Arrow 0→1 -->
                    <line x1="160" y1="130" x2="175" y2="130" stroke="#ec4899" stroke-width="2" marker-end="url(#arrow-c6)"/>
                    
                    <!-- Step 1: Extract IN -->
                    <g filter="url(#shadow-c6)">
                        <rect x="180" y="95" width="120" height="70" rx="10" fill="white" stroke="#3b82f6" stroke-width="2"/>
                        <rect x="180" y="95" width="120" height="24" rx="10" fill="#3b82f6"/>
                        <text x="240" y="112" text-anchor="middle" fill="white" font-size="10" font-weight="700">STEP 1</text>
                        <text x="240" y="135" text-anchor="middle" fill="#1e40af" font-size="9" font-weight="600">extract_in()</text>
                        <text x="240" y="150" text-anchor="middle" fill="#2563eb" font-size="8">QgsSpatialIndex</text>
                    </g>
                    <text x="240" y="178" text-anchor="middle" fill="#10b981" font-size="8" font-weight="600">25%</text>
                    
                    <!-- Arrow 1→2 -->
                    <line x1="300" y1="130" x2="315" y2="130" stroke="#ec4899" stroke-width="2" marker-end="url(#arrow-c6)"/>
                    
                    <!-- Step 2: Extract OUT -->
                    <g filter="url(#shadow-c6)">
                        <rect x="320" y="95" width="120" height="70" rx="10" fill="white" stroke="#f59e0b" stroke-width="2"/>
                        <rect x="320" y="95" width="120" height="24" rx="10" fill="#f59e0b"/>
                        <text x="380" y="112" text-anchor="middle" fill="white" font-size="10" font-weight="700">STEP 2</text>
                        <text x="380" y="135" text-anchor="middle" fill="#92400e" font-size="9" font-weight="600">extract_out()</text>
                        <text x="380" y="150" text-anchor="middle" fill="#a16207" font-size="8">Hors périmètre</text>
                    </g>
                    <text x="380" y="178" text-anchor="middle" fill="#10b981" font-size="8" font-weight="600">40%</text>
                    
                    <!-- Arrow 2→3 -->
                    <line x1="440" y1="130" x2="455" y2="130" stroke="#ec4899" stroke-width="2" marker-end="url(#arrow-c6)"/>
                    
                    <!-- Step 3: Verify études -->
                    <g filter="url(#shadow-c6)">
                        <rect x="460" y="95" width="120" height="70" rx="10" fill="white" stroke="#8b5cf6" stroke-width="2"/>
                        <rect x="460" y="95" width="120" height="24" rx="10" fill="#8b5cf6"/>
                        <text x="520" y="112" text-anchor="middle" fill="white" font-size="10" font-weight="700">STEP 3</text>
                        <text x="520" y="135" text-anchor="middle" fill="#3730a3" font-size="9" font-weight="600">verify_etudes()</text>
                        <text x="520" y="150" text-anchor="middle" fill="#5b21b6" font-size="8">CAP FT vs C6</text>
                    </g>
                    <text x="520" y="178" text-anchor="middle" fill="#10b981" font-size="8" font-weight="600">50%</text>
                    
                    <!-- QTimer label -->
                    <rect x="200" y="188" width="200" height="20" rx="4" fill="#f0fdf4" stroke="#10b981" stroke-width="1"/>
                    <text x="300" y="202" text-anchor="middle" fill="#065f46" font-size="9" font-weight="600">QTimer 0ms entre chaque étape</text>
                    
                    <!-- Arrow Main→Worker -->
                    <path d="M 520 165 L 520 210 L 600 210 L 600 275" stroke="#10b981" stroke-width="3" fill="none" marker-end="url(#arrow-c6-green)"/>
                    <text x="570" y="245" text-anchor="middle" fill="#065f46" font-size="9" font-weight="700">QgsTask</text>
                    
                    <!-- Worker Thread Zone -->
                    <rect x="580" y="50" width="300" height="200" rx="16" fill="rgba(209,250,229,0.5)" stroke="#10b981" stroke-width="2"/>
                    <text x="600" y="75" fill="#065f46" font-size="11" font-weight="700">WORKER THREAD</text>
                    
                    <!-- Step 4: Async Task -->
                    <g filter="url(#shadow-c6)">
                        <rect x="600" y="95" width="260" height="130" rx="12" fill="white" stroke="#10b981" stroke-width="2"/>
                        <rect x="600" y="95" width="260" height="28" rx="12" fill="#10b981"/>
                        <text x="730" y="114" text-anchor="middle" fill="white" font-size="11" font-weight="700">STEP 4 - C6BdTask</text>
                        <text x="730" y="140" text-anchor="middle" fill="#065f46" font-size="10" font-weight="600">Worker Thread Non-bloquant</text>
                        <text x="620" y="160" fill="#047857" font-size="9">Lecture fichiers Excel C6</text>
                        <text x="620" y="175" fill="#047857" font-size="9">Filtrage intelligent auto</text>
                        <text x="620" y="190" fill="#047857" font-size="9">Fusion données QGIS</text>
                        <text x="620" y="205" fill="#047857" font-size="9">Export Excel 3 feuilles</text>
                    </g>
                    <text x="730" y="238" text-anchor="middle" fill="#10b981" font-size="9" font-weight="600">50% → 100%</text>
                    
                    <!-- Sources box -->
                    <g filter="url(#shadow-c6)">
                        <rect x="20" y="280" width="200" height="110" rx="10" fill="white" stroke="#64748b" stroke-width="2"/>
                        <rect x="20" y="280" width="200" height="24" rx="10" fill="#64748b"/>
                        <text x="120" y="296" text-anchor="middle" fill="white" font-size="10" font-weight="700">SOURCES</text>
                        <text x="35" y="320" fill="#475569" font-size="9" font-weight="600">Répertoire C6</text>
                        <text x="45" y="335" fill="#64748b" font-size="8">Filtrage: FicheAppui, C7, GESPOT</text>
                        <text x="45" y="350" fill="#64748b" font-size="8">Détection feuille/colonne auto</text>
                        <text x="35" y="370" fill="#475569" font-size="9" font-weight="600">Couche QGIS: infra_pt_pot</text>
                    </g>
                    
                    <!-- Arrow Sources→Results -->
                    <line x1="220" y1="335" x2="235" y2="335" stroke="#64748b" stroke-width="2" marker-end="url(#arrow-c6)"/>
                    
                    <!-- Results box -->
                    <g filter="url(#shadow-c6)">
                        <rect x="240" y="280" width="320" height="140" rx="10" fill="white" stroke="#ec4899" stroke-width="2"/>
                        <rect x="240" y="280" width="320" height="28" rx="10" fill="url(#grad-c6-1)"/>
                        <text x="400" y="299" text-anchor="middle" fill="white" font-size="11" font-weight="700">RÉSULTATS - Excel Multi-feuilles</text>
                        <rect x="255" y="320" width="140" height="28" rx="6" fill="#fef3c7"/>
                        <text x="325" y="339" text-anchor="middle" fill="#92400e" font-size="9" font-weight="600">ANALYSE C6 BD</text>
                        <text x="255" y="360" fill="#9d174d" font-size="8">Comparaison poteau par poteau</text>
                        <rect x="405" y="320" width="140" height="28" rx="6" fill="#fee2e2"/>
                        <text x="475" y="339" text-anchor="middle" fill="#991b1b" font-size="9" font-weight="600">HORS PERIMETRE</text>
                        <text x="405" y="360" fill="#9d174d" font-size="8">Poteaux FT non couverts</text>
                        <rect x="255" y="375" width="140" height="28" rx="6" fill="#fed7aa"/>
                        <text x="325" y="394" text-anchor="middle" fill="#9a3412" font-size="9" font-weight="600">VERIF ETUDES</text>
                        <text x="255" y="412" fill="#9d174d" font-size="8">Études sans C6 / C6 sans étude</text>
                    </g>
                    
                    <!-- Performance box -->
                    <g filter="url(#shadow-c6)">
                        <rect x="580" y="280" width="300" height="140" rx="10" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
                        <rect x="580" y="280" width="300" height="28" rx="10" fill="#f59e0b"/>
                        <text x="730" y="299" text-anchor="middle" fill="white" font-size="11" font-weight="700">PERFORMANCE</text>
                        <text x="730" y="340" text-anchor="middle" fill="#78350f" font-size="28" font-weight="700">7s</text>
                        <text x="730" y="360" text-anchor="middle" fill="#a16207" font-size="10">pour 19 études</text>
                        <line x1="620" y1="375" x2="840" y2="375" stroke="#f59e0b" stroke-width="1"/>
                        <text x="680" y="395" text-anchor="middle" fill="#92400e" font-size="10">Avant: ~45s</text>
                        <text x="780" y="395" text-anchor="middle" fill="#10b981" font-size="12" font-weight="700">-84%</text>
                    </g>
                    
                    <!-- Progress bar -->
                    <rect x="20" y="450" width="860" height="30" rx="8" fill="white" stroke="#e5e7eb" stroke-width="1"/>
                    <rect x="22" y="452" width="42" height="26" rx="6" fill="#ec4899"/>
                    <rect x="64" y="452" width="170" height="26" rx="0" fill="#3b82f6"/>
                    <rect x="234" y="452" width="130" height="26" rx="0" fill="#f59e0b"/>
                    <rect x="364" y="452" width="86" height="26" rx="0" fill="#8b5cf6"/>
                    <rect x="450" y="452" width="428" height="26" rx="6" fill="#10b981"/>
                    <text x="43" y="470" text-anchor="middle" fill="white" font-size="8" font-weight="600">5%</text>
                    <text x="149" y="470" text-anchor="middle" fill="white" font-size="8" font-weight="600">25%</text>
                    <text x="299" y="470" text-anchor="middle" fill="white" font-size="8" font-weight="600">40%</text>
                    <text x="407" y="470" text-anchor="middle" fill="white" font-size="8" font-weight="600">50%</text>
                    <text x="664" y="470" text-anchor="middle" fill="white" font-size="8" font-weight="600">100%</text>
                    <text x="450" y="500" text-anchor="middle" fill="#64748b" font-size="10">UI reste 100% réactive - Annulation possible à tout moment</text>
                </svg>
                
                <div class="legend" style="margin-top: 1.5rem;">
                    <div class="legend-item"><div class="legend-color" style="background: #ec4899;"></div><span>Orchestration</span></div>
                    <div class="legend-item"><div class="legend-color" style="background: #3b82f6;"></div><span>Extraction QGIS</span></div>
                    <div class="legend-item"><div class="legend-color" style="background: #10b981;"></div><span>Worker Thread</span></div>
                    <div class="legend-item"><div class="legend-color" style="background: #f59e0b;"></div><span>Performance</span></div>
                </div>
            </div>

            <!-- Features Cards -->
            <div class="cards-grid" style="margin-top: 3rem;">
                <article class="card">
                    <div class="card-icon blue">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                    </div>
                    <h3>Auto-détection champ étude</h3>
                    <p>Reconnaissance automatique via patterns regex: <code>nom_etudes</code>, <code>etudes</code>, <code>decoupage</code>, <code>zone</code>. Plus besoin de sélection manuelle.</p>
                </article>
                <article class="card">
                    <div class="card-icon green">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                    </div>
                    <h3>Filtrage intelligent</h3>
                    <p>Ignore automatiquement les fichiers non-C6: <code>FicheAppui_*.xlsx</code>, <code>*_C7*.xlsx</code>, <code>GESPOT_*.xlsx</code>. Zéro erreur de parsing.</p>
                </article>
                <article class="card">
                    <div class="card-icon orange">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
                    </div>
                    <h3>Index spatial O(n log m)</h3>
                    <p>Utilise <code>QgsSpatialIndex</code> pour intersections géométriques ultra-rapides. Cache géométries polygones CAP FT.</p>
                </article>
            </div>
        </section>

        <!-- Module CAP FT - Architecture detaillee -->
        <section id="mod-capft" style="margin-top: 5rem;">
            <div class="section-header">
                <h2>
                    <span style="display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; background: linear-gradient(135deg, #34d399, #10b981); border-radius: 10px; margin-right: 12px; color: white; font-weight: 700; font-size: 18px;">2</span>
                    Module CAP FT - Architecture complete
                </h2>
                <p>Vérification correspondance poteaux FT vs fiches appuis individuelles</p>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid" style="margin-bottom: 3rem;">
                <div class="stat-card">
                    <div class="stat-value" style="color: #34d399;">154</div>
                    <div class="stat-label">Lignes CapFt.py</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: #3b82f6;">110</div>
                    <div class="stat-label">Lignes capft_workflow.py</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: #10b981;">O(n+m)</div>
                    <div class="stat-label">Complexité index rapide</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: #f59e0b;">~95%</div>
                    <div class="stat-label">Gain temps traitement</div>
                </div>
            </div>

            <!-- Architecture Diagram CAP FT -->
            <div class="diagram-container" style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);">
                <h3 class="diagram-title" style="color: #065f46;">Architecture Main Thread + Worker Thread</h3>
                <svg class="architecture-svg" viewBox="0 0 900 540" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <marker id="arrow-cap" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
                            <polygon points="0 0, 8 3, 0 6" fill="#10b981"/>
                        </marker>
                        <marker id="arrow-cap-blue" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
                            <polygon points="0 0, 8 3, 0 6" fill="#3b82f6"/>
                        </marker>
                        <linearGradient id="grad-cap-1" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#34d399;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#10b981;stop-opacity:1" />
                        </linearGradient>
                        <filter id="shadow-cap" x="-10%" y="-10%" width="120%" height="120%">
                            <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.15"/>
                        </filter>
                    </defs>
                    
                    <!-- Background -->
                    <rect width="900" height="540" fill="transparent"/>
                    
                    <!-- Main Thread Zone -->
                    <rect x="20" y="50" width="380" height="220" rx="16" fill="rgba(255,255,255,0.6)" stroke="#3b82f6" stroke-width="2" stroke-dasharray="6 3"/>
                    <text x="40" y="75" fill="#1e40af" font-size="11" font-weight="700">MAIN THREAD</text>
                    
                    <!-- Step 1: Verification -->
                    <g filter="url(#shadow-cap)">
                        <rect x="40" y="95" width="160" height="70" rx="10" fill="white" stroke="#3b82f6" stroke-width="2"/>
                        <rect x="40" y="95" width="160" height="24" rx="10" fill="#3b82f6"/>
                        <text x="120" y="112" text-anchor="middle" fill="white" font-size="10" font-weight="700">1. Vérifications</text>
                        <text x="120" y="135" text-anchor="middle" fill="#1e40af" font-size="8" font-weight="600">verificationsDonneesCapft()</text>
                        <text x="120" y="150" text-anchor="middle" fill="#2563eb" font-size="8">Doublons / Poteaux hors zone</text>
                    </g>
                    
                    <!-- Arrow 1→2 -->
                    <line x1="200" y1="130" x2="215" y2="130" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrow-cap-blue)"/>
                    
                    <!-- Step 2: Extraction -->
                    <g filter="url(#shadow-cap)">
                        <rect x="220" y="95" width="160" height="70" rx="10" fill="white" stroke="#3b82f6" stroke-width="2"/>
                        <rect x="220" y="95" width="160" height="24" rx="10" fill="#3b82f6"/>
                        <text x="300" y="112" text-anchor="middle" fill="white" font-size="10" font-weight="700">2. Extraction</text>
                        <text x="300" y="135" text-anchor="middle" fill="#1e40af" font-size="8" font-weight="600">liste_poteau_cap_ft()</text>
                        <text x="300" y="150" text-anchor="middle" fill="#2563eb" font-size="8">Intersection spatiale</text>
                    </g>
                    
                    <!-- Arrow 2→3 -->
                    <path d="M 300 165 L 300 185 L 200 185 L 200 205" stroke="#8b5cf6" stroke-width="2" fill="none" marker-end="url(#arrow-cap)"/>
                    
                    <!-- Step 3: Launch -->
                    <g filter="url(#shadow-cap)">
                        <rect x="80" y="210" width="240" height="50" rx="10" fill="white" stroke="#8b5cf6" stroke-width="2"/>
                        <rect x="80" y="210" width="240" height="22" rx="10" fill="#8b5cf6"/>
                        <text x="200" y="226" text-anchor="middle" fill="white" font-size="10" font-weight="700">3. CapFtWorkflow.start_analysis()</text>
                        <text x="200" y="248" text-anchor="middle" fill="#3730a3" font-size="9">Lancement CapFtTask (QgsTask)</text>
                    </g>
                    
                    <!-- Arrow Main→Worker -->
                    <path d="M 320 235 L 380 235 L 420 120" stroke="#10b981" stroke-width="3" fill="none" marker-end="url(#arrow-cap)"/>
                    <text x="390" y="180" fill="#065f46" font-size="9" font-weight="700">QgsTask</text>
                    
                    <!-- Worker Thread Zone -->
                    <rect x="420" y="50" width="460" height="220" rx="16" fill="rgba(209,250,229,0.5)" stroke="#10b981" stroke-width="2"/>
                    <text x="440" y="75" fill="#065f46" font-size="11" font-weight="700">WORKER THREAD</text>
                    
                    <!-- Step 4: Lecture -->
                    <g filter="url(#shadow-cap)">
                        <rect x="440" y="95" width="130" height="80" rx="10" fill="white" stroke="#10b981" stroke-width="2"/>
                        <rect x="440" y="95" width="130" height="24" rx="10" fill="url(#grad-cap-1)"/>
                        <text x="505" y="112" text-anchor="middle" fill="white" font-size="10" font-weight="700">4. Lecture</text>
                        <text x="505" y="132" text-anchor="middle" fill="#065f46" font-size="8" font-weight="600">LectureFichiers</text>
                        <text x="505" y="145" text-anchor="middle" fill="#047857" font-size="7">FicheAppui_*.xlsx</text>
                        <text x="505" y="158" text-anchor="middle" fill="#047857" font-size="7">Par dossiers études</text>
                    </g>
                    
                    <!-- Arrow 4→5 -->
                    <line x1="570" y1="135" x2="585" y2="135" stroke="#10b981" stroke-width="2" marker-end="url(#arrow-cap)"/>
                    
                    <!-- Step 5: Comparaison -->
                    <g filter="url(#shadow-cap)">
                        <rect x="590" y="95" width="130" height="80" rx="10" fill="white" stroke="#f59e0b" stroke-width="2"/>
                        <rect x="590" y="95" width="130" height="24" rx="10" fill="#f59e0b"/>
                        <text x="655" y="112" text-anchor="middle" fill="white" font-size="10" font-weight="700">5. Comparaison</text>
                        <text x="655" y="132" text-anchor="middle" fill="#92400e" font-size="8" font-weight="600">traitementResultats</text>
                        <text x="655" y="145" text-anchor="middle" fill="#a16207" font-size="7">Index O(n+m)</text>
                        <text x="655" y="158" text-anchor="middle" fill="#a16207" font-size="7">Lookup O(1)</text>
                    </g>
                    
                    <!-- Arrow 5→6 -->
                    <line x1="720" y1="135" x2="735" y2="135" stroke="#10b981" stroke-width="2" marker-end="url(#arrow-cap)"/>
                    
                    <!-- Step 6: Export -->
                    <g filter="url(#shadow-cap)">
                        <rect x="740" y="95" width="120" height="80" rx="10" fill="white" stroke="#8b5cf6" stroke-width="2"/>
                        <rect x="740" y="95" width="120" height="24" rx="10" fill="#8b5cf6"/>
                        <text x="800" y="112" text-anchor="middle" fill="white" font-size="10" font-weight="700">6. Export</text>
                        <text x="800" y="132" text-anchor="middle" fill="#3730a3" font-size="8" font-weight="600">ecrireResultats</text>
                        <text x="800" y="145" text-anchor="middle" fill="#4338ca" font-size="7">ANALYSE CAP_FT</text>
                        <text x="800" y="158" text-anchor="middle" fill="#4338ca" font-size="7">Excel coloré</text>
                    </g>
                    
                    <!-- Normalisation box -->
                    <g filter="url(#shadow-cap)">
                        <rect x="440" y="190" width="200" height="70" rx="10" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
                        <rect x="440" y="190" width="200" height="22" rx="10" fill="#f59e0b"/>
                        <text x="540" y="206" text-anchor="middle" fill="white" font-size="9" font-weight="700">NORMALISATION</text>
                        <text x="455" y="225" fill="#78350f" font-size="8" font-weight="600">normalize_appui_num_bt()</text>
                        <text x="455" y="240" fill="#a16207" font-size="7">E000123, FicheAppui_E123.xlsx → 123</text>
                        <text x="455" y="252" fill="#065f46" font-size="7" font-weight="600">strip_e_prefix=True</text>
                    </g>
                    
                    <!-- Results box -->
                    <g filter="url(#shadow-cap)">
                        <rect x="660" y="190" width="200" height="70" rx="10" fill="white" stroke="#ec4899" stroke-width="2"/>
                        <rect x="660" y="190" width="200" height="22" rx="10" fill="#ec4899"/>
                        <text x="760" y="206" text-anchor="middle" fill="white" font-size="9" font-weight="700">RÉSULTATS</text>
                        <rect x="675" y="218" width="75" height="16" rx="4" fill="#fee2e2"/>
                        <text x="712" y="230" text-anchor="middle" fill="#991b1b" font-size="7" font-weight="600">ROUGE</text>
                        <rect x="760" y="218" width="85" height="16" rx="4" fill="#fed7aa"/>
                        <text x="802" y="230" text-anchor="middle" fill="#9a3412" font-size="7" font-weight="600">ORANGE</text>
                        <rect x="675" y="238" width="75" height="16" rx="4" fill="#d1fae5"/>
                        <text x="712" y="250" text-anchor="middle" fill="#065f46" font-size="7" font-weight="600">BLANC OK</text>
                        <text x="802" y="250" fill="#10b981" font-size="8" font-weight="700">Bidirectionnel</text>
                    </g>
                    
                    <!-- Signals Section -->
                    <g filter="url(#shadow-cap)">
                        <rect x="20" y="300" width="860" height="100" rx="12" fill="rgba(255,255,255,0.9)" stroke="#6366f1" stroke-width="2"/>
                        <text x="450" y="322" text-anchor="middle" fill="#3730a3" font-size="11" font-weight="700">SIGNAUX WORKFLOW → UI</text>
                        
                        <rect x="40" y="340" width="150" height="40" rx="6" fill="#dbeafe" stroke="#3b82f6" stroke-width="1"/>
                        <text x="115" y="358" text-anchor="middle" fill="#1e40af" font-size="9" font-weight="600">progress_changed</text>
                        <text x="115" y="372" text-anchor="middle" fill="#2563eb" font-size="7">0% → 100%</text>
                        
                        <rect x="210" y="340" width="150" height="40" rx="6" fill="#d1fae5" stroke="#10b981" stroke-width="1"/>
                        <text x="285" y="358" text-anchor="middle" fill="#065f46" font-size="9" font-weight="600">message_received</text>
                        <text x="285" y="372" text-anchor="middle" fill="#047857" font-size="7">Message + couleur</text>
                        
                        <rect x="380" y="340" width="150" height="40" rx="6" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
                        <text x="455" y="358" text-anchor="middle" fill="#92400e" font-size="9" font-weight="600">analysis_finished</text>
                        <text x="455" y="372" text-anchor="middle" fill="#a16207" font-size="7">Résultats analyse</text>
                        
                        <rect x="550" y="340" width="150" height="40" rx="6" fill="#e0e7ff" stroke="#6366f1" stroke-width="1"/>
                        <text x="625" y="358" text-anchor="middle" fill="#3730a3" font-size="9" font-weight="600">export_finished</text>
                        <text x="625" y="372" text-anchor="middle" fill="#4338ca" font-size="7">Confirmation</text>
                        
                        <rect x="720" y="340" width="150" height="40" rx="6" fill="#fee2e2" stroke="#ef4444" stroke-width="1"/>
                        <text x="795" y="358" text-anchor="middle" fill="#991b1b" font-size="9" font-weight="600">error_occurred</text>
                        <text x="795" y="372" text-anchor="middle" fill="#dc2626" font-size="7">Erreur critique</text>
                    </g>
                    
                    <!-- Performance box -->
                    <g filter="url(#shadow-cap)">
                        <rect x="20" y="420" width="420" height="100" rx="12" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
                        <rect x="20" y="420" width="420" height="28" rx="12" fill="#f59e0b"/>
                        <text x="230" y="440" text-anchor="middle" fill="white" font-size="11" font-weight="700">PERFORMANCE</text>
                        <text x="120" y="475" text-anchor="middle" fill="#78350f" font-size="24" font-weight="700">O(n+m)</text>
                        <text x="120" y="495" text-anchor="middle" fill="#a16207" font-size="10">Index rapide</text>
                        <line x1="220" y1="455" x2="220" y2="510" stroke="#f59e0b" stroke-width="1"/>
                        <text x="320" y="475" text-anchor="middle" fill="#78350f" font-size="24" font-weight="700">~95%</text>
                        <text x="320" y="495" text-anchor="middle" fill="#10b981" font-size="10" font-weight="600">Gain temps</text>
                    </g>
                    
                    <!-- UI Status -->
                    <g filter="url(#shadow-cap)">
                        <rect x="460" y="420" width="420" height="100" rx="12" fill="white" stroke="#10b981" stroke-width="2"/>
                        <rect x="460" y="420" width="420" height="28" rx="12" fill="#10b981"/>
                        <text x="670" y="440" text-anchor="middle" fill="white" font-size="11" font-weight="700">EXPÉRIENCE UTILISATEUR</text>
                        <text x="670" y="475" text-anchor="middle" fill="#065f46" font-size="12" font-weight="600">UI 100% réactive pendant traitement</text>
                        <text x="670" y="495" text-anchor="middle" fill="#047857" font-size="10">Annulation possible à tout moment via task.cancel()</text>
                        <text x="670" y="512" text-anchor="middle" fill="#10b981" font-size="10" font-weight="600">Deep copy données pour isolation thread-safe</text>
                    </g>
                </svg>
                
                <div class="legend" style="margin-top: 1.5rem;">
                    <div class="legend-item"><div class="legend-color" style="background: #3b82f6;"></div><span>Main Thread (QGIS API)</span></div>
                    <div class="legend-item"><div class="legend-color" style="background: #10b981;"></div><span>Worker Thread (Python pur)</span></div>
                    <div class="legend-item"><div class="legend-color" style="background: #f59e0b;"></div><span>Traitement intensif</span></div>
                    <div class="legend-item"><div class="legend-color" style="background: #6366f1;"></div><span>Communication async</span></div>
                </div>
            </div>

            <!-- Features Cards -->
            <div class="cards-grid" style="margin-top: 3rem;">
                <article class="card">
                    <div class="card-icon green">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                    </div>
                    <h3>Pattern FicheAppui_*.xlsx</h3>
                    <p>Structure: 1 fichier par poteau. Organisation par dossiers études. Extraction nom fichier → Numéro appui automatique.</p>
                </article>
                <article class="card">
                    <div class="card-icon orange">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
                    </div>
                    <h3>Normalisation robuste</h3>
                    <p>Gestion formats variables: <code>E000123</code>, <code>FicheAppui_E123.xlsx</code>, <code>E123/63041</code>. Fonction <code>normalize_appui_num_bt(strip_e_prefix=True)</code>.</p>
                </article>
                <article class="card">
                    <div class="card-icon blue">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
                    </div>
                    <h3>Détection terrains privés</h3>
                    <p>Extraction simultanée poteaux normaux et privés via champ spécifique. Retour: <code>(dict_poteaux, dict_poteaux_prives)</code>.</p>
                </article>
            </div>
        </section>

        <!-- MAJ BD Consolidation Section -->
        <section id="maj-consolidation" style="margin-top: 5rem;">
            <div class="section-header">
                <h2>
                    <span style="display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; background: linear-gradient(135deg, #fbbf24, #f59e0b); border-radius: 10px; margin-right: 12px; color: white; font-weight: 700; font-size: 18px;">0</span>
                    MAJ BD - Consolidation v2.3.0
                </h2>
                <p>3 chemins d'execution dupliques → 1 chemin unique SQL background</p>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid" style="margin-bottom: 3rem;">
                <div class="stat-card" style="border-top: 3px solid #fbbf24;">
                    <div class="stat-value" style="color: #fbbf24;">800</div>
                    <div class="stat-label">Lignes Maj_Ft_Bt.py</div>
                </div>
                <div class="stat-card" style="border-top: 3px solid #3b82f6;">
                    <div class="stat-value" style="color: #3b82f6;">328</div>
                    <div class="stat-label">Lignes maj_workflow.py</div>
                </div>
                <div class="stat-card" style="border-top: 3px solid #ef4444;">
                    <div class="stat-value" style="color: #ef4444;">-716</div>
                    <div class="stat-label">Lignes supprimees Maj_Ft_Bt</div>
                </div>
                <div class="stat-card" style="border-top: 3px solid #10b981;">
                    <div class="stat-value" style="color: #10b981;">6</div>
                    <div class="stat-label">Bugs corriges</div>
                </div>
            </div>

            <!-- Consolidation Diagram -->
            <div class="diagram-container" style="background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 50%, #fde68a 100%);">
                <h3 class="diagram-title" style="color: #78350f;">Consolidation MAJ BD : 3 chemins → 1 chemin unique</h3>
                <svg class="architecture-svg" viewBox="0 0 1000 520" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <marker id="arrow-maj" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
                            <polygon points="0 0, 8 3, 0 6" fill="#f59e0b"/>
                        </marker>
                        <marker id="arrow-maj-green" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
                            <polygon points="0 0, 8 3, 0 6" fill="#10b981"/>
                        </marker>
                        <filter id="shadow-maj" x="-10%" y="-10%" width="120%" height="120%">
                            <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.15"/>
                        </filter>
                    </defs>

                    <rect width="1000" height="520" fill="transparent"/>

                    <!-- BEFORE: 3 paths (left side) -->
                    <g filter="url(#shadow-maj)">
                        <rect x="30" y="20" width="440" height="240" rx="16" fill="white" stroke="#ef4444" stroke-width="2"/>
                        <rect x="30" y="20" width="440" height="36" rx="16" fill="rgba(239,68,68,0.15)"/>
                        <text x="250" y="44" text-anchor="middle" fill="#991b1b" font-size="13" font-weight="700">AVANT v2.3.0 — 3 chemins dupliques</text>

                        <!-- Path 1: Synchrone -->
                        <rect x="50" y="70" width="400" height="50" rx="8" fill="#fee2e2" stroke="#ef4444" stroke-width="1"/>
                        <text x="70" y="92" fill="#991b1b" font-size="10" font-weight="700">1. SYNCHRONE</text>
                        <text x="70" y="108" fill="#dc2626" font-size="8">miseAjourFinalDesDonneesFT/BT() — Bloque UI</text>
                        <rect x="380" y="78" width="55" height="20" rx="4" fill="#ef4444"/>
                        <text x="407" y="92" text-anchor="middle" fill="white" font-size="8" font-weight="700">SUPPRIME</text>

                        <!-- Path 2: QTimer -->
                        <rect x="50" y="130" width="400" height="50" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
                        <text x="70" y="152" fill="#92400e" font-size="10" font-weight="700">2. INCREMENTAL (QTimer)</text>
                        <text x="70" y="168" fill="#a16207" font-size="8">_prepare/_apply/_finalize_update_ft/bt — Semi-async</text>
                        <rect x="380" y="138" width="55" height="20" rx="4" fill="#ef4444"/>
                        <text x="407" y="152" text-anchor="middle" fill="white" font-size="8" font-weight="700">SUPPRIME</text>

                        <!-- Path 3: SQL Background -->
                        <rect x="50" y="190" width="400" height="50" rx="8" fill="#d1fae5" stroke="#10b981" stroke-width="2"/>
                        <text x="70" y="212" fill="#065f46" font-size="10" font-weight="700">3. SQL BACKGROUND</text>
                        <text x="70" y="228" fill="#047857" font-size="8">MajSqlBackgroundTask — SQL direct PostgreSQL, thread background</text>
                        <rect x="380" y="198" width="55" height="20" rx="4" fill="#10b981"/>
                        <text x="407" y="212" text-anchor="middle" fill="white" font-size="8" font-weight="700">GARDE</text>
                    </g>

                    <!-- Arrow Before→After -->
                    <path d="M 470 140 L 530 140" stroke="#10b981" stroke-width="4" fill="none" marker-end="url(#arrow-maj-green)"/>
                    <text x="500" y="130" text-anchor="middle" fill="#065f46" font-size="10" font-weight="700">v2.3.0</text>

                    <!-- AFTER: Single path (right side) -->
                    <g filter="url(#shadow-maj)">
                        <rect x="535" y="20" width="435" height="240" rx="16" fill="white" stroke="#10b981" stroke-width="2"/>
                        <rect x="535" y="20" width="435" height="36" rx="16" fill="rgba(16,185,129,0.15)"/>
                        <text x="752" y="44" text-anchor="middle" fill="#065f46" font-size="13" font-weight="700">APRES v2.3.0 — Chemin unique</text>

                        <!-- Single flow -->
                        <g filter="url(#shadow-maj)">
                            <rect x="555" y="70" width="130" height="55" rx="10" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
                            <text x="620" y="92" text-anchor="middle" fill="#1e40af" font-size="10" font-weight="700">CONFIRMER</text>
                            <text x="620" y="108" text-anchor="middle" fill="#2563eb" font-size="8">PoleAerien.py</text>
                        </g>

                        <path d="M 685 97 L 705 97" stroke="#f59e0b" stroke-width="2" fill="none" marker-end="url(#arrow-maj)"/>

                        <g filter="url(#shadow-maj)">
                            <rect x="710" y="70" width="130" height="55" rx="10" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
                            <text x="775" y="88" text-anchor="middle" fill="#92400e" font-size="9" font-weight="700">MajWorkflow</text>
                            <text x="775" y="103" text-anchor="middle" fill="#a16207" font-size="7">start_updates_</text>
                            <text x="775" y="115" text-anchor="middle" fill="#a16207" font-size="7">sql_background()</text>
                        </g>

                        <path d="M 840 97 L 860 97" stroke="#f59e0b" stroke-width="2" fill="none" marker-end="url(#arrow-maj)"/>

                        <g filter="url(#shadow-maj)">
                            <rect x="865" y="70" width="90" height="55" rx="10" fill="#d1fae5" stroke="#10b981" stroke-width="2"/>
                            <text x="910" y="90" text-anchor="middle" fill="#065f46" font-size="9" font-weight="700">SQL Task</text>
                            <text x="910" y="105" text-anchor="middle" fill="#047857" font-size="7">Background</text>
                            <text x="910" y="117" text-anchor="middle" fill="#047857" font-size="7">Thread</text>
                        </g>

                        <!-- Benefits -->
                        <text x="555" y="155" fill="#065f46" font-size="10" font-weight="700">Avantages :</text>
                        <text x="570" y="172" fill="#047857" font-size="9">SQL direct PostgreSQL (pas de QGIS API)</text>
                        <text x="570" y="188" fill="#047857" font-size="9">Thread background (UI non bloquee)</text>
                        <text x="570" y="204" fill="#047857" font-size="9">Rollback atomique si erreur</text>
                        <text x="570" y="220" fill="#047857" font-size="9">Triggers PostgreSQL auto (inf_num, nommage)</text>
                        <text x="570" y="236" fill="#047857" font-size="9">pending_comment centralise (pas d'ecrasement)</text>
                    </g>

                    <!-- Bug Fixes Section -->
                    <g filter="url(#shadow-maj)">
                        <rect x="30" y="280" width="940" height="220" rx="14" fill="white" stroke="#f59e0b" stroke-width="2"/>
                        <rect x="30" y="280" width="940" height="32" rx="14" fill="#f59e0b"/>
                        <text x="500" y="302" text-anchor="middle" fill="white" font-size="12" font-weight="700">6 BUGS CORRIGES DANS LA CONSOLIDATION</text>

                        <!-- Bug 1 -->
                        <rect x="50" y="325" width="280" height="60" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
                        <text x="60" y="345" fill="#92400e" font-size="9" font-weight="700">BUG-1: Commentaire FT IMPLANTATION</text>
                        <text x="60" y="360" fill="#a16207" font-size="8">Manquant dans SQL background → Ajoute</text>
                        <text x="60" y="375" fill="#a16207" font-size="8">BUG-2: inf_num=NULL → trigger nommage</text>

                        <!-- Bug 3 -->
                        <rect x="350" y="325" width="290" height="60" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
                        <text x="360" y="345" fill="#92400e" font-size="9" font-weight="700">BUG-3: gids_pot_ac_bt perdu en BT</text>
                        <text x="360" y="360" fill="#a16207" font-size="8">Trigger ne se declenchait jamais → Corrige</text>
                        <text x="360" y="375" fill="#a16207" font-size="8">BUG-4: Conflit IMPLANTATION + zone_privee</text>

                        <!-- Bug 5-6 -->
                        <rect x="660" y="325" width="290" height="60" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
                        <text x="670" y="345" fill="#92400e" font-size="9" font-weight="700">BUG-5: inf_mat hardcode 'BS8'</text>
                        <text x="670" y="360" fill="#a16207" font-size="8">Fallback FT implantation → Corrige</text>
                        <text x="670" y="375" fill="#a16207" font-size="8">BUG-6: Slash en tete quand commentaire NULL</text>

                        <!-- Code removed -->
                        <rect x="50" y="400" width="450" height="85" rx="10" fill="#fee2e2" stroke="#ef4444" stroke-width="1"/>
                        <text x="275" y="420" text-anchor="middle" fill="#991b1b" font-size="11" font-weight="700">CODE SUPPRIME (Maj_Ft_Bt.py: 1591 → 800 lignes)</text>
                        <text x="65" y="438" fill="#dc2626" font-size="8">MajUpdateTask, miseAjourFinalDesDonnees, miseAjourFinalDesDonneesFT/BT</text>
                        <text x="65" y="452" fill="#dc2626" font-size="8">_prepare/_apply/_finalize_update_ft/bt, _execSqlTriggerBatch</text>
                        <text x="65" y="466" fill="#dc2626" font-size="8">Imports: QApplication, QgsFeature, QgsGeometry, QgsPointXY, QSqlDatabase, QSqlQuery</text>
                        <text x="65" y="480" fill="#ef4444" font-size="9" font-weight="700">-791 lignes totales (Maj_Ft_Bt + maj_workflow + PoleAerien)</text>

                        <!-- Kept -->
                        <rect x="520" y="400" width="430" height="85" rx="10" fill="#d1fae5" stroke="#10b981" stroke-width="1"/>
                        <text x="735" y="420" text-anchor="middle" fill="#065f46" font-size="11" font-weight="700">CHEMIN UNIQUE CONSERVE</text>
                        <text x="535" y="438" fill="#047857" font-size="9">maj_workflow.py → start_updates_sql_background()</text>
                        <text x="535" y="455" fill="#047857" font-size="9">maj_sql_background.py → MajSqlBackgroundTask (388 lignes)</text>
                        <text x="535" y="472" fill="#047857" font-size="9">SQL direct: UPDATE infra_pt_pot SET ... WHERE ...</text>
                        <text x="535" y="486" fill="#10b981" font-size="9" font-weight="700">Rollback atomique + CRIT-005 transactions</text>
                    </g>
                </svg>

                <div class="legend" style="margin-top: 1.5rem;">
                    <div class="legend-item"><div class="legend-color" style="background: #fee2e2; border: 2px solid #ef4444;"></div><span>Chemin supprime</span></div>
                    <div class="legend-item"><div class="legend-color" style="background: #d1fae5; border: 2px solid #10b981;"></div><span>Chemin conserve (SQL background)</span></div>
                    <div class="legend-item"><div class="legend-color" style="background: #fef3c7; border: 2px solid #f59e0b;"></div><span>Bugs corriges</span></div>
                </div>
            </div>
        </section>

        <!-- Workflow Section -->
        <section id="workflow">
            <div class="section-header">
                <h2>Workflow d'utilisation</h2>
                <p>Processus étape par étape pour une utilisation optimale</p>
            </div>

            <div class="workflow">
                <div class="workflow-step">
                    <div class="step-number"><img src="../images/icon-layers.svg" alt="Layers" width="20" height="20"></div>
                    <div class="step-content">
                        <h4>Charger les couches QGIS + connexion PostgreSQL</h4>
                        <p>Importez les couches dans votre projet QGIS et vérifiez la connexion PostgreSQL (serveur AUVERGNE, 10.241.228.107).</p>
                        <div class="code-block">
                            <code>
<span class="code-comment"># Couches QGIS requises</span>
infra_pt_pot    <span class="code-comment"># Table poteaux (Point, PostgreSQL)</span>
etude_cap_ft    <span class="code-comment"># Périmètres CAP_FT (Polygon)</span>
cables_dc       <span class="code-comment"># Câbles découpés (via fddcpi2)</span>
<span class="code-comment"># PostgreSQL: schema comac (591 câbles, hypotheses)</span>
                            </code>
                        </div>
                    </div>
                </div>

                <div class="workflow-step">
                    <div class="step-number"><img src="../images/icon-settings.svg" alt="Settings" width="20" height="20"></div>
                    <div class="step-content">
                        <h4>Selectionner le dossier projet</h4>
                        <p>Ouvrez le plugin via <strong>Extensions > Pole Aerien</strong>. Selectionnez le dossier projet : le <code>project_detector</code> identifie automatiquement les fichiers et active les modules disponibles. Cochez les modules souhaites.</p>
                    </div>
                </div>

                <div class="workflow-step">
                    <div class="step-number"><img src="../images/icon-play.svg" alt="Play" width="20" height="20"></div>
                    <div class="step-content">
                        <h4>Demarrer l'analyse par lot</h4>
                        <p>Cliquez sur <strong>Demarrer</strong>. Le <code>BatchRunner</code> execute les modules coches sequentiellement via QgsTask en arriere-plan. La barre de progression et le journal montrent l'avancement en temps reel. QGIS reste utilisable.</p>
                    </div>
                </div>

                <div class="workflow-step">
                    <div class="step-number"><img src="../images/icon-export.svg" alt="Export" width="20" height="20"></div>
                    <div class="step-content">
                        <h4>Consulter les resultats</h4>
                        <p>Les rapports Excel sont generes automatiquement (openpyxl, coloration conditionnelle). Pour MAJ BD, le SQL s'execute en background avec rollback atomique. Les resultats sont affiches dans le journal du dialog.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Modules Section -->
        <section id="modules">
            <div class="section-header">
                <h2>Détail des modules</h2>
                <p>Spécifications techniques de chaque composant</p>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Module</th>
                            <th>Fonction</th>
                            <th>Entrées</th>
                            <th>Sorties</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge badge-blue">MAJ FT/BT</span></td>
                            <td>MAJ attributs poteaux via SQL background (chemin unique v2.3.0)</td>
                            <td>Excel .xlsx, couches QGIS, PostgreSQL</td>
                            <td>Table modifiée, rollback atomique</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-green">CAP_FT</span></td>
                            <td>Vérification fichiers capacitaires FT (154 L + 110 L workflow)</td>
                            <td>Répertoire FicheAppui_*.xlsx, couches</td>
                            <td>Rapport .xlsx coloré</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-blue">COMAC</span></td>
                            <td>Contrôle données COMAC via PostgreSQL natif (564 L)</td>
                            <td>Répertoire COMAC, PostgreSQL (schema comac)</td>
                            <td>Rapport .xlsx + VERIF_SECURITE</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-orange">C6 vs BD</span></td>
                            <td>Comparaison C6 / BD async (382 L + 218 L workflow)</td>
                            <td>Fichiers C6, couches, QgsSpatialIndex</td>
                            <td>Excel 3 feuilles, -84% temps</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-orange">C6/C3A/C7</span></td>
                            <td>Analyse croisée multi-fichiers (406 L + 217 L workflow)</td>
                            <td>C6, C3A, C7, couches</td>
                            <td>Rapport consolidé</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-green">Police C6</span></td>
                            <td>fddcpi2 : SRO→PG→cables→appuis→C6 (718 L + 768 L wf)</td>
                            <td>C6 Excel, infra_pt_pot, fddcpi2() PG, cable_analyzer</td>
                            <td>Rapport conformité, -78% temps</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-orange">VERIF_SECURITE</span></td>
                            <td>Portées câbles NFC 11201-A1 (434 L security_rules.py)</td>
                            <td>Excel COMAC, zone climatique ZVN/ZVF</td>
                            <td>Feuille VERIF_SECURITE (OK/PORTEE MOLLE)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Zones Climatiques Section -->
        <section id="zones">
            <div class="zone-section">
                <div class="zone-header">
                    <span class="zone-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                        Norme NFC 11201-A1
                    </span>
                    <h2>Zones Climatiques</h2>
                    <p>Comprendre l'impact du vent sur les portées maximales des câbles aériens</p>
                </div>

                <div class="zone-content" style="display:grid;grid-template-columns:1fr 320px;gap:24px;align-items:start;">
                    
                    <!-- Left column: Map + Search -->
                    <div style="display:flex;flex-direction:column;gap:16px;">
                        <!-- Interactive Wind Map -->
                        <div style="background:var(--card-bg);border-radius:12px;padding:16px;border:1px solid var(--border);">
                            <iframe id="windy-map"
                                src="https://embed.windy.com/embed2.html?lat=46.5&lon=2.5&zoom=5&level=surface&overlay=wind&menu=&message=true&marker=&calendar=&pressure=&type=map&location=coordinates&detail=&detailLat=46.5&detailLon=2.5&metricWind=km%2Fh&metricTemp=%C2%B0C&radarRange=-1"
                                style="width:100%;height:350px;border:none;border-radius:8px;"
                                allowfullscreen>
                            </iframe>
                            <p style="text-align:center;margin:10px 0 0 0;font-size:11px;color:var(--text-light);">
                                Carte interactive des vents en temps réel - Source: Windy.com
                            </p>
                        </div>
                        
                        <!-- Search commune panel -->
                        <div style="background:var(--card-bg);border-radius:12px;padding:16px;border:1px solid var(--border);">
                            <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
                                <h4 style="margin:0;color:var(--primary);display:flex;align-items:center;gap:8px;font-size:14px;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                                    Rechercher une commune
                                </h4>
                                <div style="flex:1;min-width:200px;position:relative;">
                                    <input type="text" id="commune-search" 
                                        placeholder="Ex: Clermont-Ferrand, Cantal, Pont-du-Château..."
                                        style="width:100%;padding:10px 40px 10px 12px;border:1px solid var(--border);border-radius:8px;background:var(--bg);color:var(--text);font-size:13px;box-sizing:border-box;"
                                        autocomplete="off"/>
                                    <button onclick="searchCommune()" style="position:absolute;right:4px;top:50%;transform:translateY(-50%);background:var(--primary);border:none;border-radius:6px;padding:6px 10px;cursor:pointer;">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                                    </button>
                                </div>
                                <div id="commune-info" style="padding:8px 12px;background:rgba(59,130,246,0.15);border-radius:6px;display:none;">
                                    <span style="font-weight:600;color:var(--primary);font-size:13px;" id="commune-name"></span>
                                    <span style="font-size:11px;color:var(--text-light);margin-left:8px;" id="commune-coords"></span>
                                </div>
                            </div>
                            <div id="search-results" style="margin-top:10px;display:flex;flex-wrap:wrap;gap:8px;"></div>
                        </div>
                        
                        <!-- Legend -->
                        <div style="display:flex;justify-content:center;gap:30px;">
                            <div class="map-legend-item" style="display:flex;align-items:center;gap:8px;">
                                <span class="map-legend-dot zvn"></span>
                                <span>ZVN - Vent Normal</span>
                            </div>
                            <div class="map-legend-item" style="display:flex;align-items:center;gap:8px;">
                                <span class="map-legend-dot zvf"></span>
                                <span>ZVF - Vent Fort</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right column: Portees Comparator -->
                    <div class="portees-comparator" style="height:fit-content;">
                        <div class="comparator-title">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>
                            Portées maximales autorisées (mètres)
                        </div>

                        <!-- 6 FO -->
                        <div class="portee-row">
                            <span class="portee-label">6 FO</span>
                            <div class="portee-bar-container">
                                <div class="portee-bar zvn" style="width: 100%;">81m</div>
                            </div>
                            <div class="portee-bar-container">
                                <div class="portee-bar zvf" style="width: 97.5%;">79m</div>
                            </div>
                        </div>

                        <!-- 12 FO -->
                        <div class="portee-row">
                            <span class="portee-label">12 FO</span>
                            <div class="portee-bar-container">
                                <div class="portee-bar zvn" style="width: 95%;">77m</div>
                            </div>
                            <div class="portee-bar-container">
                                <div class="portee-bar zvf" style="width: 91.3%;">74m</div>
                            </div>
                        </div>

                        <!-- 24 FO -->
                        <div class="portee-row">
                            <span class="portee-label">24 FO</span>
                            <div class="portee-bar-container">
                                <div class="portee-bar zvn" style="width: 90%;">73m</div>
                            </div>
                            <div class="portee-bar-container">
                                <div class="portee-bar zvf" style="width: 90%;">73m</div>
                            </div>
                        </div>

                        <!-- 48 FO -->
                        <div class="portee-row">
                            <span class="portee-label">48 FO</span>
                            <div class="portee-bar-container">
                                <div class="portee-bar zvn" style="width: 96.3%;">78m</div>
                            </div>
                            <div class="portee-bar-container">
                                <div class="portee-bar zvf" style="width: 96.3%;">78m</div>
                            </div>
                        </div>

                        <!-- 72 FO -->
                        <div class="portee-row">
                            <span class="portee-label">72 FO</span>
                            <div class="portee-bar-container">
                                <div class="portee-bar zvn" style="width: 95%;">77m</div>
                            </div>
                            <div class="portee-bar-container">
                                <div class="portee-bar zvf" style="width: 95%;">77m</div>
                            </div>
                        </div>

                        <div class="comparator-footer">
                            <div class="zone-info-card zvn">
                                <h4>ZVN</h4>
                                <p>Régions intérieures protégées</p>
                            </div>
                            <div class="zone-info-card zvf">
                                <h4>ZVF</h4>
                                <p>Littoral, montagnes, couloirs venteux</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <script>
        // Search commune and zoom
        async function searchCommune() {
            const input = document.getElementById('commune-search').value.trim();
            if (!input) return;
            try {
                const resp = await fetch(`https://api-adresse.data.gouv.fr/search/?q=${encodeURIComponent(input)}&type=municipality&limit=5`);
                const data = await resp.json();
                const resultsDiv = document.getElementById('search-results');
                resultsDiv.innerHTML = '';
                if (data.features && data.features.length > 0) {
                    data.features.forEach(f => {
                        const btn = document.createElement('button');
                        btn.style.cssText = 'text-align:left;padding:8px 12px;background:var(--bg);border:1px solid var(--border);border-radius:6px;cursor:pointer;color:var(--text);font-size:12px;';
                        btn.innerHTML = `<strong>${f.properties.city || f.properties.name}</strong> <span style="color:var(--text-light);">${f.properties.postcode}</span>`;
                        btn.onclick = () => zoomToCommune(f);
                        resultsDiv.appendChild(btn);
                    });
                } else {
                    resultsDiv.innerHTML = '<p style="color:var(--text-light);font-size:12px;">Aucune commune trouvée</p>';
                }
            } catch(e) { console.error('Erreur recherche:', e); }
        }
        function zoomToCommune(feature) {
            const [lon, lat] = feature.geometry.coordinates;
            const name = feature.properties.city || feature.properties.name;
            document.getElementById('windy-map').src = `https://embed.windy.com/embed2.html?lat=${lat}&lon=${lon}&zoom=10&level=surface&overlay=wind&menu=&message=true&marker=true&calendar=&pressure=&type=map&location=coordinates&detail=&detailLat=${lat}&detailLon=${lon}&metricWind=km%2Fh&metricTemp=%C2%B0C&radarRange=-1`;
            document.getElementById('commune-info').style.display = 'flex';
            document.getElementById('commune-name').textContent = name;
            document.getElementById('commune-coords').textContent = `${lat.toFixed(4)}, ${lon.toFixed(4)}`;
            document.getElementById('search-results').innerHTML = '';
        }
        document.getElementById('commune-search')?.addEventListener('keypress', e => { if (e.key === 'Enter') searchCommune(); });
        </script>

        <!-- FAQ Section -->
        <section id="faq">
            <div class="section-header">
                <h2>Foire aux questions</h2>
                <p>Tout ce qu'il faut savoir pour exploiter pleinement le plugin</p>
            </div>

            <div class="accordion">
                <!-- Catégorie: Général -->
                <div style="margin-bottom: 0.5rem; padding: 0.5rem 1rem; background: linear-gradient(135deg, #3b82f6, #1d4ed8); border-radius: 8px;">
                    <span style="color: white; font-weight: 600; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px;">Général</span>
                </div>

                <div class="accordion-item active">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>Quelle version de QGIS est requise ?</h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>Le plugin <strong>Pole Aerien v3.0</strong> est compatible avec <strong>QGIS 3.28</strong> et les versions ulterieures (jusqu'a 3.99). Nous recommandons la version <strong>3.28 LTS</strong> pour la stabilite en production. Le plugin utilise <strong>PostgreSQL</strong> comme base de donnees principale (schema comac, AUVERGNE).</p>
                        <p style="margin-top: 0.75rem; padding: 0.75rem; background: #fef3c7; border-radius: 6px; border-left: 3px solid #f59e0b;">
                            <strong>Remarque :</strong> Les versions antérieures à 3.28 ne sont plus officiellement prises en charge. Si vous rencontrez des difficultés, vérifiez d'abord votre version de QGIS.
                        </p>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>Quelles sont les couches QGIS indispensables ?</h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>Selon les modules utilisés, les couches suivantes doivent être chargées dans votre projet :</p>
                        <ul style="margin: 0.75rem 0; padding-left: 1.5rem; line-height: 1.8;">
                            <li><strong>infra_pt_pot</strong> : Poteaux (points) avec les champs <code>inf_num</code>, <code>inf_type</code>, <code>etat</code></li>
                            <li><strong>etude_cap_ft</strong> : Zones d'études FT (polygones) avec le champ <code>nom_etudes</code></li>
                            <li><strong>etude_comac</strong> : Zones d'études BT (polygones) avec le champ <code>etudes</code></li>
                            <li><strong>bpe</strong> : Boîtes de protection équipement (points)</li>
                            <li><strong>attaches</strong> : Points d'attache (points)</li>
                            <li><strong>infra_pt_chb</strong> : Chambres (points) — requis pour Police C6</li>
                        </ul>
                        <p style="color: var(--text-light); font-size: 0.9rem;">Les noms des couches doivent correspondre exactement à ceux attendus par le plugin.</p>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>Est-il possible d'annuler une modification ?</h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>Oui, de plusieurs manières :</p>
                        <ul style="margin: 0.75rem 0; padding-left: 1.5rem; line-height: 1.8;">
                            <li><strong>Annulation immédiate :</strong> Utilisez <kbd>Ctrl</kbd>+<kbd>Z</kbd> dans QGIS juste après l'opération.</li>
                            <li><strong>Restauration :</strong> Rechargez la couche depuis la base de données si les modifications n'ont pas été enregistrées.</li>
                            <li><strong>Sauvegarde préalable :</strong> Nous conseillons vivement d'effectuer une sauvegarde de votre base de données avant toute mise à jour en lot.</li>
                        </ul>
                    </div>
                </div>

                <!-- Catégorie: Modules métier -->
                <div style="margin: 1.5rem 0 0.5rem 0; padding: 0.5rem 1rem; background: linear-gradient(135deg, #10b981, #059669); border-radius: 8px;">
                    <span style="color: white; font-weight: 600; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px;">Modules métier</span>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>Quels champs sont mis à jour par le module MAJ FT/BT ?</h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>Le module de mise à jour des poteaux FT/BT modifie les champs suivants :</p>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0.5rem; margin: 0.75rem 0;">
                            <span style="padding: 0.4rem 0.8rem; background: #e0f2fe; border-radius: 4px; font-family: monospace; font-size: 0.85rem;">inf_type</span>
                            <span style="padding: 0.4rem 0.8rem; background: #e0f2fe; border-radius: 4px; font-family: monospace; font-size: 0.85rem;">inf_propri</span>
                            <span style="padding: 0.4rem 0.8rem; background: #e0f2fe; border-radius: 4px; font-family: monospace; font-size: 0.85rem;">noe_usage</span>
                            <span style="padding: 0.4rem 0.8rem; background: #e0f2fe; border-radius: 4px; font-family: monospace; font-size: 0.85rem;">inf_mat</span>
                            <span style="padding: 0.4rem 0.8rem; background: #e0f2fe; border-radius: 4px; font-family: monospace; font-size: 0.85rem;">etat</span>
                            <span style="padding: 0.4rem 0.8rem; background: #e0f2fe; border-radius: 4px; font-family: monospace; font-size: 0.85rem;">dce</span>
                        </div>
                        <p style="margin-top: 0.75rem;">Les champs d'audit <code>modifie_par</code> et <code>date_modif</code> sont également renseignés automatiquement pour assurer la traçabilité.</p>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>Comment fonctionne le module C6 vs BD ?</h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>Ce module compare les fichiers Excel Annexe C6 avec les données présentes dans QGIS afin d'identifier les écarts :</p>
                        <ul style="margin: 0.75rem 0; padding-left: 1.5rem; line-height: 1.8;">
                            <li><strong>Extraction IN :</strong> Poteaux FT situés à l'intérieur des périmètres d'études CAP FT</li>
                            <li><strong>Extraction OUT :</strong> Poteaux FT hors périmètre (alerte potentielle)</li>
                            <li><strong>Vérification croisée :</strong> Études sans fichier C6 correspondant, et inversement</li>
                        </ul>
                        <p>Le résultat est exporté dans un fichier Excel comportant trois feuilles : <em>Analyse C6 BD</em>, <em>Poteaux hors périmètre</em> et <em>Vérification études</em>.</p>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>Qu'est-ce que la vérification des portées molles ?</h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>Le module <strong>VERIF CAP_COMAC</strong> analyse les portées de câbles fibre optique selon la norme <strong>NFC 11201-A1</strong>.</p>
                        <p style="margin: 0.75rem 0;">Le processus s'effectue comme suit :</p>
                        <ol style="padding-left: 1.5rem; line-height: 1.8;">
                            <li>Lecture des colonnes <strong>AO</strong> (type de ligne FO) et <strong>AU</strong> (portée en mètres) des fichiers COMAC</li>
                            <li>Détection de la capacité FO via les codes Prysmian (ex. : <code>L1092-xx-P</code>)</li>
                            <li>Comparaison avec les valeurs maximales autorisées selon la zone climatique (<strong>ZVN</strong> ou <strong>ZVF</strong>)</li>
                        </ol>
                        <p style="margin-top: 0.75rem; padding: 0.75rem; background: #fee2e2; border-radius: 6px; border-left: 3px solid #ef4444;">
                            Les dépassements sont signalés comme <strong>« PORTÉE MOLLE »</strong> et nécessitent une vérification terrain.
                        </p>
                    </div>
                </div>

                <!-- Catégorie: Police C6 & Données -->
                <div style="margin: 1.5rem 0 0.5rem 0; padding: 0.5rem 1rem; background: linear-gradient(135deg, #8b5cf6, #7c3aed); border-radius: 8px;">
                    <span style="color: white; font-weight: 600; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px;">Police C6 & Données</span>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>Quelles sont les sources de données pour Police C6 ?</h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>Le module <strong>Police C6</strong> utilise plusieurs sources de données :</p>
                        <ul style="margin: 0.75rem 0; padding-left: 1.5rem; line-height: 1.8;">
                            <li><strong>Couches QGIS :</strong> <code>infra_pt_pot</code>, <code>cables_dc</code> et couches réseau chargées dans le projet</li>
                            <li><strong>Fichier C6 Excel :</strong> Auto-détecté par <code>nom_etudes</code> dans le répertoire de travail</li>
                            <li><strong>Données COMAC :</strong> Via <strong>PostgreSQL</strong> exclusivement (schéma comac, serveur AUVERGNE)</li>
                            <li><strong>cable_analyzer.py :</strong> Comptage câbles CDI + posemode(1,2) par appui</li>
                        </ul>
                        <p style="margin-top: 0.75rem; padding: 0.75rem; background: #f3e8ff; border-radius: 6px; border-left: 3px solid #a855f7;">
                            <strong>v2.3.0 :</strong> Filtres spatiaux bbox, exclusion appuis EDF, cleanup mémoire. Données COMAC via PostgreSQL uniquement (plus de GeoPackage/CSV/SQLite).
                        </p>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>Qu'est-ce que l'auto-détection du fichier C6 ?</h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>Lorsque le dossier projet est selectionne, le <strong>project_detector</strong> identifie automatiquement les fichiers C6 dans le dossier CAP FT. Les annexes C6 sont les Excel d'etude (FTTH-NGE-ETUDE-*.xlsx) situes dans les sous-dossiers CMD du dossier CAP FT.</p>
                        <p style="margin: 0.75rem 0;"><strong>Motifs de recherche utilises :</strong></p>
                        <div style="display: flex; flex-direction: column; gap: 0.4rem; margin: 0.75rem 0;">
                            <code style="padding: 0.4rem 0.8rem; background: #f1f5f9; border-radius: 4px; font-size: 0.85rem;">*nom_etudes*.xlsx</code>
                            <code style="padding: 0.4rem 0.8rem; background: #f1f5f9; border-radius: 4px; font-size: 0.85rem;">*Annexe*C6*nom_etudes*.xlsx</code>
                            <code style="padding: 0.4rem 0.8rem; background: #f1f5f9; border-radius: 4px; font-size: 0.85rem;">*C6*nom_etudes*.xlsx</code>
                        </div>
                        <p style="color: var(--text-light); font-size: 0.9rem;">La detection est automatique lors de la selection du dossier projet.</p>
                    </div>
                </div>

                <!-- Catégorie: Résolution de problèmes -->
                <div style="margin: 1.5rem 0 0.5rem 0; padding: 0.5rem 1rem; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 8px;">
                    <span style="color: white; font-weight: 600; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px;">Résolution de problèmes</span>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>Pourquoi certains numéros d'appui ne correspondent-ils pas ?</h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>La correspondance des numéros d'appui repose sur le couple <strong>N° appui + Nom d'études</strong>. Vérifiez les points suivants :</p>
                        <ul style="margin: 0.75rem 0; padding-left: 1.5rem; line-height: 1.8;">
                            <li><strong>Format :</strong> Le numéro doit être identique (ex. : <code>1016436/63041</code> est normalisé en <code>1016436</code>)</li>
                            <li><strong>Nom d'études :</strong> Les noms doivent correspondre exactement (attention aux variantes QSB/DTR)</li>
                            <li><strong>Espaces parasites :</strong> Des espaces en début ou fin de cellule peuvent fausser la correspondance</li>
                        </ul>
                        <p style="margin-top: 0.75rem; padding: 0.75rem; background: #e0f2fe; border-radius: 6px; border-left: 3px solid #3b82f6;">
                            <strong>Astuce :</strong> Utilisez la fonction SUPPRESPACE() dans Excel pour nettoyer vos données avant l'import.
                        </p>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>Que faire si le bouton "Demarrer" ne fonctionne pas ?</h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>Le bouton "Demarrer l'analyse" necessite que les conditions suivantes soient remplies :</p>
                        <ul style="margin: 0.75rem 0; padding-left: 1.5rem; line-height: 1.8;">
                            <li><strong>Dossier projet :</strong> Un dossier projet valide doit etre selectionne</li>
                            <li><strong>Modules coches :</strong> Au moins un module doit etre selectionne (coche)</li>
                            <li><strong>Couches QGIS :</strong> Les couches requises (infra_pt_pot, etude_cap_ft, etude_comac) doivent etre chargees dans le projet QGIS</li>
                            <li><strong>Connexion PostgreSQL :</strong> La connexion au serveur AUVERGNE doit etre active pour les modules Police C6 et COMAC</li>
                        </ul>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>Comment signaler une anomalie ou suggérer une amélioration ?</h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>Pour tout signalement, contactez <strong>Youcef ADDA</strong> en fournissant les informations suivantes :</p>
                        <ul style="margin: 0.75rem 0; padding-left: 1.5rem; line-height: 1.8;">
                            <li>Version de QGIS et du plugin Pôle Aérien</li>
                            <li>Message d'erreur complet (copie du panneau « Journal des messages »)</li>
                            <li>Étapes précises permettant de reproduire le problème</li>
                            <li>Captures d'écran si pertinent</li>
                        </ul>
                        <div style="display: flex; gap: 1rem; margin-top: 1rem; flex-wrap: wrap;">
                            <a href="mailto:yadda@nge-es.fr" style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.6rem 1.2rem; background: #3b82f6; color: white; border-radius: 6px; text-decoration: none; font-weight: 500;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                                yadda@nge-es.fr
                            </a>
                            <a href="https://www.linkedin.com/in/youcef-adda/" target="_blank" style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.6rem 1.2rem; background: #0077b5; color: white; border-radius: 6px; text-decoration: none; font-weight: 500;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                                LinkedIn
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Nouveautés v2.3.0 Section -->
        <section id="nouveautes" style="background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%); padding: 3rem 2rem; border-radius: var(--radius); margin-top: 3rem;">
            <div class="section-header">
                <h2><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 8px;"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg> Nouveautés v2.3.0</h2>
                <p>Refactoring majeur : architecture workflows, PostgreSQL natif, Police C6 haute performance</p>
            </div>

            <div class="cards-grid" style="max-width: 1000px; margin: 0 auto;">
                <article class="card" style="border: 2px solid #a855f7;">
                    <div class="card-icon purple">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>
                    </div>
                    <h3>Architecture Workflows</h3>
                    <p><strong>God Object decouple :</strong> PoleAerien.py passe de ~2400 à 1740 lignes. 6 workflows dédiés orchestrent chaque module métier avec signaux standardisés.</p>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(168, 85, 247, 0.1); border-radius: 8px; border-left: 4px solid #a855f7;">
                        <p style="margin: 0; font-size: 0.9rem; color: #5b21b6;"><strong>Signaux Qt :</strong> progress_changed, message_received, analysis_finished, error_occurred</p>
                    </div>
                </article>

                <article class="card" style="border: 2px solid #10b981;">
                    <div class="card-icon green">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                    </div>
                    <h3>Police C6 Haute Performance</h3>
                    <p><strong>Architecture fddcpi2 (-78% temps, -62% mémoire).</strong> SRO → PostgreSQL fddcpi2() → CableSegment → cable_analyzer → intersection appuis → comparaison C6 Excel.</p>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border-left: 4px solid #10b981;">
                        <p style="margin: 0; font-size: 0.9rem; color: #065f46;"><strong>Nouveau :</strong> db_connection.py (fddcpi2), cable_analyzer.py (402 L), fix injection SQL, guards division zéro</p>
                    </div>
                </article>

                <article class="card" style="border: 2px solid #f59e0b;">
                    <div class="card-icon orange">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
                    </div>
                    <h3>MAJ BD + PostgreSQL</h3>
                    <p><strong>3 chemins → 1 unique :</strong> SQL background direct via MajSqlBackgroundTask. Migration COMAC vers PostgreSQL (schéma comac). 6 bugs corrigés.</p>
                    <ul style="margin-top: 1rem; padding-left: 1.5rem; color: var(--text-secondary); font-size: 0.9rem;">
                        <li><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="3" style="display: inline-block; vertical-align: middle; margin-right: 6px;"><polyline points="20 6 9 17 4 12"/></svg> -791 lignes dead code supprimées</li>
                        <li><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="3" style="display: inline-block; vertical-align: middle; margin-right: 6px;"><polyline points="20 6 9 17 4 12"/></svg> Rollback atomique + triggers auto</li>
                        <li><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="3" style="display: inline-block; vertical-align: middle; margin-right: 6px;"><polyline points="20 6 9 17 4 12"/></svg> core_utils.py centralise (safe_float, build_export_path...)</li>
                    </ul>
                </article>
            </div>

            <!-- Schéma détaillé du workflow Police C6 v2.3.0 -->
            <div class="diagram-container" style="margin-top: 3rem;">
                <h3 class="diagram-title">Workflow Police C6 - v2.3.0 avec auto-détection + filtres optimisés</h3>
                <svg class="architecture-svg" viewBox="0 0 1000 400" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <marker id="arrow-workflow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6"/>
                        </marker>
                        <filter id="glow">
                            <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                            <feMerge>
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                    </defs>
                    <rect width="1000" height="400" fill="#f8fafc"/>

                    <!-- Étape 1: Sélection étude -->
                    <g class="node">
                        <rect x="50" y="150" width="160" height="100" rx="12" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
                        <text x="130" y="180" text-anchor="middle" font-weight="600" fill="#1e40af" font-size="14">1. Sélection étude</text>
                        <text x="130" y="200" text-anchor="middle" fill="#1d4ed8" font-size="11">Filtre Valeur:</text>
                        <text x="130" y="215" text-anchor="middle" fill="#1d4ed8" font-size="10" font-weight="600">NGE-63A2D-73463-PA-21</text>
                        <circle cx="130" cy="235" r="8" fill="#10b981" opacity="0.8"/>
                        <polyline points="125,235 128,238 135,231" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" transform="translate(0, 0)"/>
                    </g>

                    <!-- Flèche 1 -->
                    <path d="M 210 200 L 270 200" stroke="#3b82f6" stroke-width="3" fill="none" marker-end="url(#arrow-workflow)" class="flow-arrow"/>
                    <text x="240" y="190" text-anchor="middle" fill="#10b981" font-size="11" font-weight="600">AUTO</text>

                    <!-- Étape 2: Auto-détection -->
                    <g class="node pulse">
                        <rect x="270" y="150" width="160" height="100" rx="12" fill="#d1fae5" stroke="#10b981" stroke-width="2" filter="url(#glow)"/>
                        <text x="350" y="180" text-anchor="middle" font-weight="600" fill="#065f46" font-size="14">2. Auto-détection</text>
                        <text x="350" y="200" text-anchor="middle" fill="#047857" font-size="10">Recherche patterns:</text>
                        <text x="350" y="215" text-anchor="middle" fill="#047857" font-size="9" font-family="monospace">*nom_etudes*.xlsx</text>
                        <text x="350" y="228" text-anchor="middle" fill="#047857" font-size="9" font-family="monospace">*C6*nom_etudes*.xlsx</text>
                        <circle cx="350" cy="240" r="6" fill="#10b981"/>
                        <animate attributeName="opacity" values="1;0.5;1" dur="2s" repeatCount="indefinite"/>
                    </g>

                    <!-- Flèche 2 -->
                    <path d="M 430 200 L 490 200" stroke="#3b82f6" stroke-width="3" fill="none" marker-end="url(#arrow-workflow)" class="flow-arrow"/>

                    <!-- Étape 3: Couches réseau -->
                    <g class="node">
                        <rect x="490" y="150" width="160" height="100" rx="12" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
                        <text x="570" y="180" text-anchor="middle" font-weight="600" fill="#92400e" font-size="14">3. fddcpi2()</text>
                        <text x="570" y="200" text-anchor="middle" fill="#a16207" font-size="10">SRO → PostgreSQL:</text>
                        <text x="570" y="215" text-anchor="middle" fill="#a16207" font-size="9" font-family="monospace">db_connection.py</text>
                        <text x="570" y="228" text-anchor="middle" fill="#a16207" font-size="9" font-family="monospace">cables decoupes retournes</text>
                        <rect x="545" y="233" width="50" height="12" rx="3" fill="#f59e0b" opacity="0.2"/>
                        <text x="570" y="242" text-anchor="middle" fill="#92400e" font-size="9" font-weight="600">AUTO</text>
                    </g>

                    <!-- Flèche 3 -->
                    <path d="M 650 200 L 710 200" stroke="#3b82f6" stroke-width="3" fill="none" marker-end="url(#arrow-workflow)" class="flow-arrow"/>

                    <!-- Étape 4: Analyse -->
                    <g class="node">
                        <rect x="710" y="150" width="160" height="100" rx="12" fill="#e0e7ff" stroke="#6366f1" stroke-width="2"/>
                        <text x="790" y="180" text-anchor="middle" font-weight="600" fill="#3730a3" font-size="14">4. Analyse</text>
                        <text x="790" y="200" text-anchor="middle" fill="#4338ca" font-size="10">cable_analyzer.py:</text>
                        <text x="790" y="215" text-anchor="middle" fill="#4338ca" font-size="10">• CDI + posemode(1,2)</text>
                        <text x="790" y="228" text-anchor="middle" fill="#4338ca" font-size="10">• Intersection appuis</text>
                        <text x="790" y="241" text-anchor="middle" fill="#4338ca" font-size="10">• Comparaison C6</text>
                    </g>

                    <!-- Annotations -->
                    <g opacity="0.7">
                        <rect x="50" y="280" width="200" height="80" rx="8" fill="white" stroke="#e2e8f0" stroke-width="1"/>
                        <text x="150" y="300" text-anchor="middle" font-weight="600" fill="#334155" font-size="11">Avant v2.2.4</text>
                        <text x="60" y="320" fill="#64748b" font-size="9">• Recherche manuelle fichier C6</text>
                        <text x="60" y="335" fill="#64748b" font-size="9">• Sélection manuelle fichier C6</text>
                        <text x="60" y="350" fill="#dc2626" font-size="9" font-weight="600">= 2 étapes supplémentaires</text>
                    </g>

                    <g opacity="0.7">
                        <rect x="280" y="280" width="200" height="80" rx="8" fill="#d1fae5" stroke="#10b981" stroke-width="1"/>
                        <text x="380" y="300" text-anchor="middle" font-weight="600" fill="#065f46" font-size="11">Depuis v2.2.4</text>
                        <text x="290" y="320" fill="#047857" font-size="9">• Auto-détection fichier C6</text>
                        <text x="290" y="335" fill="#047857" font-size="9">• PostgreSQL COMAC natif</text>
                        <text x="290" y="350" fill="#10b981" font-size="9" font-weight="600">= Workflow simplifié !</text>
                    </g>

                    <!-- Légende temps gagné -->
                    <g>
                        <rect x="520" y="290" width="140" height="60" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
                        <text x="590" y="310" text-anchor="middle" font-weight="700" fill="#92400e" font-size="13">Temps gagné</text>
                        <text x="590" y="330" text-anchor="middle" font-weight="700" fill="#ea580c" font-size="20">~30 sec</text>
                        <text x="590" y="345" text-anchor="middle" fill="#a16207" font-size="9">par analyse</text>
                    </g>
                </svg>

                <div class="legend" style="margin-top: 1.5rem;">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #dbeafe; border: 2px solid #3b82f6;"></div>
                        <span>Interaction utilisateur</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #d1fae5; border: 2px solid #10b981;"></div>
                        <span>Automatique (nouveau)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #fef3c7; border: 2px solid #f59e0b;"></div>
                        <span>Données internes</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #e0e7ff; border: 2px solid #6366f1;"></div>
                        <span>Traitement</span>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 2rem;">
                <div style="display: inline-block; padding: 1rem 2rem; background: white; border-radius: var(--radius); box-shadow: var(--shadow);">
                    <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 6px;"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg> <strong>Architecture v2.3.0</strong> : 34 fichiers Python • ~11 900 lignes • 6 workflows • PostgreSQL natif • -791 lignes dead code</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-logo" style="display: flex; align-items: center; gap: 12px;">
                <img src="../images/icon-pole.svg" alt="Pole" width="32" height="32" style="filter: brightness(0) invert(1);">
                <span>Pole Aerien - Plugin QGIS</span>
            </div>
            <ul class="footer-links">
                <li><a href="mailto:yadda@nge-es.fr">Contact</a></li>
                <li><a href="https://www.linkedin.com/in/youcef-adda/" target="_blank">LinkedIn</a></li>
                <li><a href="#">Documentation</a></li>
                <li><a href="#">Licence GPL v2</a></li>
            </ul>
            <div style="display: flex; align-items: center; gap: 16px; margin-top: 1rem;">
                <img src="../images/logo_NGE.svg" alt="NGE" width="80" height="28">
                <p style="margin: 0;">&copy; 2022-2026 NGE Energie Solutions. Tous droits reserves.</p>
            </div>
        </div>
    </footer>

    <script>
        // Accordion functionality
        function toggleAccordion(header) {
            const item = header.parentElement;
            const isActive = item.classList.contains('active');
            
            // Close all
            document.querySelectorAll('.accordion-item').forEach(i => {
                i.classList.remove('active');
            });
            
            // Open clicked if was closed
            if (!isActive) {
                item.classList.add('active');
            }
        }

        // Diagram tabs functionality
        function showDiagram(diagramId) {
            // Hide all panels
            document.querySelectorAll('.diagram-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            // Deactivate all tabs
            document.querySelectorAll('.diagram-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected panel
            document.getElementById('diagram-' + diagramId).classList.add('active');
            
            // Activate clicked tab
            event.target.classList.add('active');
        }

        // Tooltip functionality for SVG nodes
        document.addEventListener('DOMContentLoaded', function() {
            const tooltip = document.getElementById('diagram-tooltip');
            
            document.querySelectorAll('.architecture-svg .node').forEach(node => {
                node.addEventListener('mouseenter', function(e) {
                    const info = this.getAttribute('data-info');
                    if (info) {
                        tooltip.textContent = info;
                        tooltip.classList.add('visible');
                    }
                });
                
                node.addEventListener('mousemove', function(e) {
                    tooltip.style.left = (e.pageX + 15) + 'px';
                    tooltip.style.top = (e.pageY - 10) + 'px';
                });
                
                node.addEventListener('mouseleave', function() {
                    tooltip.classList.remove('visible');
                });
            });
        });

        // Smooth scroll for nav links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Active nav link on scroll
        window.addEventListener('scroll', function() {
            const sections = document.querySelectorAll('section[id], header[id]');
            const navLinks = document.querySelectorAll('.nav-links a');
            
            let current = 'demarrage';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (scrollY >= sectionTop) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        });

        // Animated Counter
        function animateCounters() {
            const counters = document.querySelectorAll('.counter-number');
            const speed = 200;

            counters.forEach(counter => {
                const target = +counter.getAttribute('data-target');
                const increment = target / speed;

                const updateCount = () => {
                    const count = +counter.innerText;
                    if (count < target) {
                        counter.innerText = Math.ceil(count + increment);
                        setTimeout(updateCount, 10);
                    } else {
                        counter.innerText = target.toLocaleString();
                    }
                };
                updateCount();
            });
        }

        // Intersection Observer for counters
        const counterSection = document.querySelector('.counter-section');
        if (counterSection) {
            const counterObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        animateCounters();
                        counterObserver.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.5 });
            counterObserver.observe(counterSection);
        }

        // Navbar: transparent over hero, solid on scroll
        const navbar = document.querySelector('.navbar');
        const hero = document.querySelector('.hero');
        if (navbar && hero) {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    navbar.classList.toggle('navbar-scrolled', !entry.isIntersecting);
                });
            }, { threshold: 0.05 });
            observer.observe(hero);
        }
    </script>
</body>
</html>
