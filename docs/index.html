<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Documentation complète du plugin QGIS Pôle Aérien - Contrôle qualité et analyse des poteaux aériens ENEDIS pour projets FTTH">
    <meta name="keywords" content="QGIS, Pôle Aérien, FTTH, ENEDIS, C6, CAP FT, COMAC, Police C6">
    <title>Pôle Aérien - Documentation Technique Complète</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- No external chart library - Pure SVG diagrams -->
    
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #dbeafe;
            --secondary: #64748b;
            --accent: #f59e0b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
            --border: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --radius: 12px;
            --radius-sm: 8px;
            --transition: all 0.2s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 16px;
        }

        /* Navigation */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            z-index: 1000;
            padding: 0 2rem;
        }

        .navbar-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 64px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 600;
            font-size: 1.25rem;
            color: var(--text-primary);
            text-decoration: none;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
            transition: var(--transition);
            padding: 0.5rem 0;
            border-bottom: 2px solid transparent;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        /* Hero Section */
        .hero {
            padding: 8rem 2rem 4rem;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--primary-light) 100%);
            text-align: center;
        }

        .hero-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--primary-light);
            color: var(--primary);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 1.5rem;
        }

        .hero h1 {
            font-size: clamp(2.5rem, 5vw, 3.5rem);
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, var(--text-primary), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 1.25rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto 2rem;
        }

        .hero-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.875rem 1.75rem;
            border-radius: var(--radius-sm);
            font-weight: 500;
            font-size: 0.95rem;
            text-decoration: none;
            transition: var(--transition);
            cursor: pointer;
            border: none;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--bg-primary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-tertiary);
            border-color: var(--primary);
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 4rem 2rem;
        }

        /* Section */
        section {
            margin-bottom: 5rem;
        }

        .section-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .section-header h2 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
        }

        .section-header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .card {
            background: var(--bg-primary);
            border-radius: var(--radius);
            padding: 1.75rem;
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-4px);
            border-color: var(--primary);
        }

        .card-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .card-icon.blue { background: #dbeafe; color: #2563eb; }
        .card-icon.green { background: #d1fae5; color: #059669; }
        .card-icon.orange { background: #ffedd5; color: #ea580c; }
        .card-icon.purple { background: #ede9fe; color: #7c3aed; }
        .card-icon.red { background: #fee2e2; color: #dc2626; }

        .card h3 {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .card p {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        /* Stats Section */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: var(--bg-primary);
            border-radius: var(--radius);
            padding: 1.5rem;
            text-align: center;
            border: 1px solid var(--border);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Animated Counter */
        .counter-section {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            border-radius: var(--radius);
            padding: 3rem 2rem;
            margin: 3rem 0;
        }

        .counter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 2rem;
            max-width: 1000px;
            margin: 0 auto;
        }

        .counter-item {
            text-align: center;
            padding: 1.5rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius);
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
        }

        .counter-item:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.1);
            border-color: var(--primary);
        }

        .counter-number {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }

        .counter-label {
            color: #94a3b8;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .counter-sublabel {
            color: #64748b;
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }

        /* Timeline Section */
        .timeline-section {
            position: relative;
            padding: 2rem 0;
        }

        .timeline-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(180deg, var(--primary) 0%, #a78bfa 50%, #10b981 100%);
            transform: translateX(-50%);
            border-radius: 2px;
        }

        .timeline-item {
            display: flex;
            justify-content: flex-end;
            padding-right: calc(50% + 30px);
            position: relative;
            margin-bottom: 3rem;
        }

        .timeline-item:nth-child(even) {
            justify-content: flex-start;
            padding-right: 0;
            padding-left: calc(50% + 30px);
        }

        .timeline-dot {
            position: absolute;
            left: 50%;
            top: 20px;
            width: 20px;
            height: 20px;
            background: var(--primary);
            border-radius: 50%;
            transform: translateX(-50%);
            border: 4px solid var(--bg-secondary);
            z-index: 10;
            box-shadow: 0 0 20px rgba(37, 99, 235, 0.4);
        }

        .timeline-item:nth-child(2) .timeline-dot { background: #8b5cf6; }
        .timeline-item:nth-child(3) .timeline-dot { background: #10b981; }
        .timeline-item:nth-child(4) .timeline-dot { background: #f59e0b; }

        .timeline-content {
            background: var(--bg-primary);
            border-radius: var(--radius);
            padding: 1.5rem;
            max-width: 400px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .timeline-content:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-3px);
        }

        .timeline-date {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: var(--primary-light);
            color: var(--primary);
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .timeline-content h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .timeline-content p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin: 0;
        }

        .timeline-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.2rem 0.5rem;
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-top: 0.5rem;
        }

        @media (max-width: 768px) {
            .timeline-line { left: 20px; }
            .timeline-item,
            .timeline-item:nth-child(even) {
                padding-left: 50px;
                padding-right: 0;
                justify-content: flex-start;
            }
            .timeline-dot { left: 20px; }
        }

        /* Lifecycle Diagram */
        .lifecycle-container {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #1e1b4b 100%);
            border-radius: var(--radius);
            padding: 2rem;
            margin: 2rem 0;
        }

        /* Audit Report Section */
        .audit-section {
            background: var(--bg-primary);
            border-radius: var(--radius);
            padding: 2rem;
            border: 1px solid var(--border);
            margin: 2rem 0;
        }

        .audit-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .audit-card {
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
            overflow: hidden;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .audit-card:hover {
            box-shadow: var(--shadow-lg);
            transform: scale(1.02);
        }

        .audit-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-bottom: 1px solid var(--border);
        }

        .audit-card-content {
            padding: 1rem;
        }

        .audit-card h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .audit-card p {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin: 0;
        }

        /* DAG Diagram */
        .dag-container {
            background: linear-gradient(180deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: var(--radius);
            padding: 2rem;
            margin: 2rem 0;
            overflow-x: auto;
        }

        .dag-node {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dag-node:hover {
            filter: brightness(1.1) drop-shadow(0 4px 12px rgba(0,0,0,0.15));
        }

        .dag-edge {
            stroke-dasharray: 8 4;
            animation: dagFlow 1s linear infinite;
        }

        @keyframes dagFlow {
            0% { stroke-dashoffset: 12; }
            100% { stroke-dashoffset: 0; }
        }

        /* Charts Section */
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
        }

        .chart-card {
            background: var(--bg-primary);
            border-radius: var(--radius);
            padding: 1.5rem;
            border: 1px solid var(--border);
        }

        .chart-card h3 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .chart-wrapper {
            position: relative;
            height: 280px;
        }

        /* Workflow Section */
        .workflow {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .workflow-step {
            display: flex;
            gap: 1.5rem;
            align-items: flex-start;
        }

        .step-number {
            width: 48px;
            height: 48px;
            min-width: 48px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.25rem;
        }

        .step-content {
            flex: 1;
            background: var(--bg-primary);
            border-radius: var(--radius);
            padding: 1.5rem;
            border: 1px solid var(--border);
        }

        .step-content h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .step-content p {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        /* Code Block */
        .code-block {
            background: #1e293b;
            border-radius: var(--radius-sm);
            padding: 1.25rem;
            margin-top: 1rem;
            overflow-x: auto;
        }

        .code-block code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            color: #e2e8f0;
            line-height: 1.7;
        }

        .code-comment { color: #64748b; }
        .code-keyword { color: #f472b6; }
        .code-string { color: #a5f3fc; }
        .code-function { color: #fbbf24; }

        /* Table */
        .table-container {
            background: var(--bg-primary);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 1rem 1.25rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--bg-tertiary);
            font-weight: 600;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
        }

        td {
            font-size: 0.95rem;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover td {
            background: var(--bg-secondary);
        }

        .badge {
            display: inline-flex;
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-blue { background: #dbeafe; color: #1d4ed8; }
        .badge-green { background: #d1fae5; color: #047857; }
        .badge-orange { background: #ffedd5; color: #c2410c; }

        /* Accordion */
        .accordion {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .accordion-item {
            background: var(--bg-primary);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .accordion-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.25rem 1.5rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .accordion-header:hover {
            background: var(--bg-secondary);
        }

        .accordion-header h4 {
            font-weight: 600;
            font-size: 1rem;
        }

        .accordion-icon {
            font-size: 1.25rem;
            color: var(--text-muted);
            transition: var(--transition);
        }

        .accordion-item.active .accordion-icon {
            transform: rotate(45deg);
        }

        .accordion-content {
            padding: 0 1.5rem;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), padding 0.3s ease;
            opacity: 0;
            transform: translateY(-8px);
        }

        .accordion-item.active .accordion-content {
            padding: 0 1.5rem 1.5rem;
            max-height: 1000px;
            opacity: 1;
            transform: translateY(0);
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), 
                        padding 0.3s ease,
                        opacity 0.3s ease 0.1s,
                        transform 0.3s ease 0.1s;
        }

        .accordion-content p {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        /* Footer */
        .footer {
            background: var(--text-primary);
            color: var(--text-muted);
            padding: 3rem 2rem;
            margin-top: 4rem;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1.5rem;
        }

        .footer-logo {
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .footer-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .footer-links a {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .footer-links a:hover {
            color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .navbar-content {
                padding: 0 1rem;
            }

            .nav-links {
                display: none;
            }

            .hero {
                padding: 6rem 1.5rem 3rem;
            }

            .main-content {
                padding: 2rem 1rem;
            }

            .charts-container {
                grid-template-columns: 1fr;
            }

            .chart-wrapper {
                height: 220px;
            }

            .workflow-step {
                flex-direction: column;
                gap: 1rem;
            }

            .footer-content {
                flex-direction: column;
                text-align: center;
            }
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-in {
            animation: fadeInUp 0.6s ease forwards;
        }

        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }

        /* Architecture Diagrams */
        .diagram-container {
            background: var(--bg-primary);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .diagram-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .diagram-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: var(--primary);
            border-radius: 2px;
        }

        .architecture-svg {
            width: 100%;
            height: auto;
            max-height: 500px;
            font-family: 'Inter', sans-serif;
            font-size: 12px;
        }

        .architecture-svg .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .architecture-svg .node:hover {
            filter: brightness(1.1);
        }

        .architecture-svg .node:hover rect,
        .architecture-svg .node:hover circle {
            stroke-width: 3;
        }

        .architecture-svg .flow-arrow {
            stroke-dasharray: 8 4;
            animation: flowAnimation 1.5s linear infinite;
        }

        @keyframes flowAnimation {
            0% { stroke-dashoffset: 12; }
            100% { stroke-dashoffset: 0; }
        }

        .architecture-svg .pulse {
            animation: pulseAnimation 2s ease-in-out infinite;
        }

        @keyframes pulseAnimation {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .diagram-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
            padding-bottom: 0.5rem;
        }

        .diagram-tab {
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            background: transparent;
            border: none;
            color: var(--text-secondary);
        }

        .diagram-tab:hover {
            background: var(--bg-tertiary);
        }

        .diagram-tab.active {
            background: var(--primary);
            color: white;
        }

        .diagram-panel {
            display: none;
        }

        .diagram-panel.active {
            display: block;
        }

        .info-tooltip {
            position: absolute;
            background: var(--text-primary);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: var(--radius-sm);
            font-size: 0.85rem;
            max-width: 250px;
            z-index: 100;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease;
            box-shadow: var(--shadow-lg);
        }

        .info-tooltip.visible {
            opacity: 1;
        }

        /* Zone Climatique Section */
        .zone-section {
            background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 50%, #0f172a 100%);
            border-radius: var(--radius);
            padding: 3rem;
            margin-bottom: 3rem;
            position: relative;
            overflow: hidden;
        }

        .zone-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            pointer-events: none;
        }

        .zone-header {
            text-align: center;
            margin-bottom: 2.5rem;
            position: relative;
            z-index: 1;
        }

        .zone-header h2 {
            color: white;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .zone-header p {
            color: #94a3b8;
            font-size: 1.1rem;
        }

        .zone-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(37, 99, 235, 0.2);
            border: 1px solid rgba(37, 99, 235, 0.3);
            color: #60a5fa;
            padding: 0.4rem 1rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 1rem;
        }

        .zone-content {
            display: grid;
            grid-template-columns: 1fr 1.2fr;
            gap: 3rem;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        @media (max-width: 900px) {
            .zone-content {
                grid-template-columns: 1fr;
            }
        }

        /* France Map */
        .france-map-container {
            position: relative;
        }

        .france-map {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            display: block;
        }

        .france-map .zone-zvn {
            fill: #3b82f6;
            fill-opacity: 0.6;
            stroke: #60a5fa;
            stroke-width: 2;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .france-map .zone-zvf {
            fill: #ef4444;
            fill-opacity: 0.6;
            stroke: #f87171;
            stroke-width: 2;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .france-map .zone-zvn:hover {
            fill-opacity: 0.9;
            filter: drop-shadow(0 0 20px rgba(59, 130, 246, 0.5));
        }

        .france-map .zone-zvf:hover {
            fill-opacity: 0.9;
            filter: drop-shadow(0 0 20px rgba(239, 68, 68, 0.5));
        }

        .map-legend {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1.5rem;
        }

        .map-legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: white;
            font-size: 0.9rem;
        }

        .map-legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .map-legend-dot.zvn { background: #3b82f6; box-shadow: 0 0 10px rgba(59, 130, 246, 0.5); }
        .map-legend-dot.zvf { background: #ef4444; box-shadow: 0 0 10px rgba(239, 68, 68, 0.5); }

        /* Portees Comparator */
        .portees-comparator {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            padding: 2rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .comparator-title {
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .comparator-title svg {
            color: #fbbf24;
        }

        .portee-row {
            display: grid;
            grid-template-columns: 60px 1fr 1fr;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-sm);
            transition: all 0.3s ease;
        }

        .portee-row:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(5px);
        }

        .portee-label {
            color: #e2e8f0;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .portee-bar-container {
            position: relative;
            height: 28px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 14px;
            overflow: hidden;
        }

        .portee-bar {
            height: 100%;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .portee-bar.zvn {
            background: linear-gradient(90deg, #2563eb, #3b82f6);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.4);
        }

        .portee-bar.zvf {
            background: linear-gradient(90deg, #dc2626, #ef4444);
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.4);
        }

        .comparator-footer {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .zone-info-card {
            flex: 1;
            min-width: 200px;
            padding: 1rem;
            border-radius: var(--radius-sm);
            text-align: center;
        }

        .zone-info-card.zvn {
            background: rgba(59, 130, 246, 0.15);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .zone-info-card.zvf {
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .zone-info-card h4 {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .zone-info-card.zvn h4 { color: #60a5fa; }
        .zone-info-card.zvf h4 { color: #f87171; }

        .zone-info-card p {
            color: #94a3b8;
            font-size: 0.85rem;
        }

        /* Pulse animation for active zone */
        @keyframes zonePulse {
            0%, 100% { stroke-opacity: 1; }
            50% { stroke-opacity: 0.5; }
        }

        .zone-active {
            animation: zonePulse 2s ease-in-out infinite;
        }

        /* Wind animation */
        @keyframes windFlow {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }

        .wind-line {
            animation: windFlow 3s ease-in-out infinite;
        }

        .wind-line:nth-child(2) { animation-delay: 0.5s; }
        .wind-line:nth-child(3) { animation-delay: 1s; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar" role="navigation" aria-label="Navigation principale">
        <div class="navbar-content">
            <a href="#" class="logo">
                <span class="logo-icon">PA</span>
                Pôle Aérien
            </a>
            <ul class="nav-links">
                <li><a href="#features" class="active">Fonctionnalites</a></li>
                <li><a href="#onglet-c6bd" style="color: #ec4899; font-weight: 600;">O-1: C6 vs BD</a></li>
                <li><a href="#onglet-capft" style="color: #34d399; font-weight: 600;">O-2: CAP FT</a></li>
                <li><a href="#timeline">Timeline</a></li>
                <li><a href="#lifecycle">Cycle de vie</a></li>
                <li><a href="#analytics">Architecture</a></li>
                <li><a href="#workflow">Workflow</a></li>
                <li><a href="#zones">Zones NFC</a></li>
                <li><a href="#nouveautes" style="color: #10b981; font-weight: 600;"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 4px;"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>v2.2.4</a></li>
                <li><a href="#faq">FAQ</a></li>
            </ul>
        </div>
    </nav>

    <!-- Hero -->
    <header class="hero">
        <div class="hero-content">
            <div style="margin-bottom: 1.5rem;">
                <img src="../images/noun-electric-pole-4591270.svg" alt="Poteaux electriques" width="80" height="80" style="opacity: 0.9;">
            </div>
            <span class="hero-badge">
                <img src="../images/icon-layers.svg" alt="Layers" width="16" height="16" style="filter: brightness(0) invert(1); vertical-align: middle; margin-right: 6px;">
                Plugin QGIS v2.2.4 - GraceTHD integre + Auto-detection C6
            </span>
            <h1>Controle et analyse des donnees Pole Aerien</h1>
            <p>Solution complète pour la gestion, le contrôle et l'analyse des données COMAC relatives aux poteaux ENEDIS (POT-BT) dans QGIS.</p>
            <div class="hero-buttons">
                <a href="#workflow" class="btn btn-primary">
                    Démarrer
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                </a>
                <a href="#modules" class="btn btn-secondary">Voir les modules</a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Features Section -->
        <section id="features">
            <div class="section-header">
                <h2>Fonctionnalités principales</h2>
                <p>Un ensemble d'outils puissants pour gérer vos données terrain</p>
            </div>
            
            <div class="cards-grid">
                <article class="card animate-in">
                    <div class="card-icon blue">
                        <img src="../images/icon-sync.svg" alt="Sync" width="28" height="28" style="filter: brightness(0) invert(1);">
                    </div>
                    <h3>Mise à jour FT/BT</h3>
                    <p>Import et synchronisation des données depuis fichiers Excel vers la table infra_pt_pot avec traçabilité complète.</p>
                </article>

                <article class="card animate-in delay-1">
                    <div class="card-icon green">
                        <img src="../images/icon-success.svg" alt="Validation" width="28" height="28" style="filter: brightness(0) invert(1);">
                    </div>
                    <h3>Vérification CAP_FT</h3>
                    <p>Analyse automatisée des fichiers CAP_FT avec détection des anomalies et génération de rapports.</p>
                </article>

                <article class="card animate-in delay-2">
                    <div class="card-icon orange">
                        <img src="../images/icon-database.svg" alt="Database" width="28" height="28" style="filter: brightness(0) invert(1);">
                    </div>
                    <h3>Contrôle COMAC</h3>
                    <p>Validation croisée des données COMAC avec les références de la base de données ENEDIS.</p>
                </article>

                <article class="card animate-in delay-3">
                    <div class="card-icon purple">
                        <img src="../images/icon-chart.svg" alt="Chart" width="28" height="28" style="filter: brightness(0) invert(1);">
                    </div>
                    <h3>Comparaison C6 vs BD</h3>
                    <p>Croisement des données C6 avec la base de données pour identifier les écarts.</p>
                </article>

                <article class="card animate-in">
                    <div class="card-icon red">
                        <img src="../images/icon-search.svg" alt="Search" width="28" height="28" style="filter: brightness(0) invert(1);">
                    </div>
                    <h3>Police C6 <span class="badge badge-orange" style="font-size: 0.7rem; margin-left: 0.5rem;">v2.2.4</span></h3>
                    <p>Vérification de conformité avec import GraceTHD (shp/SQLite) + auto-détection du fichier C6 basée sur nom_etudes.</p>
                </article>

                <article class="card animate-in delay-1">
                    <div class="card-icon blue">
                        <img src="../images/icon-clock.svg" alt="Clock" width="28" height="28" style="filter: brightness(0) invert(1);">
                    </div>
                    <h3>Traçabilité</h3>
                    <p>Historique complet des modifications avec horodatage et identification utilisateur.</p>
                </article>

                <article class="card animate-in delay-2">
                    <div class="card-icon red">
                        <img src="../images/icon-warning.svg" alt="Security" width="28" height="28" style="filter: brightness(0) invert(1);">
                    </div>
                    <h3>Vérification Sécurité</h3>
                    <p>Contrôle automatique des portées câbles selon norme NFC 11201-A1 et zones climatiques ZVN/ZVF.</p>
                </article>
            </div>
        </section>

        <!-- Animated Counters Section -->
        <div class="counter-section">
            <div class="counter-grid">
                <div class="counter-item">
                    <div class="counter-number" data-target="9700">0</div>
                    <div class="counter-label">Lignes de code</div>
                    <div class="counter-sublabel">Python pur</div>
                </div>
                <div class="counter-item">
                    <div class="counter-number" data-target="19">0</div>
                    <div class="counter-label">Fichiers Python</div>
                    <div class="counter-sublabel">Architecture modulaire</div>
                </div>
                <div class="counter-item">
                    <div class="counter-number" data-target="6">0</div>
                    <div class="counter-label">Modules metier</div>
                    <div class="counter-sublabel">Onglets fonctionnels</div>
                </div>
                <div class="counter-item">
                    <div class="counter-number" data-target="463">0</div>
                    <div class="counter-label">Cables references</div>
                    <div class="counter-sublabel">Base COMAC officielle</div>
                </div>
                <div class="counter-item">
                    <div class="counter-number" data-target="12">0</div>
                    <div class="counter-label">Fichiers CSV</div>
                    <div class="counter-sublabel">Donnees metier</div>
                </div>
            </div>
        </div>

        <!-- Timeline Section -->
        <section id="timeline" style="margin-top: 4rem;">
            <div class="section-header">
                <h2>Evolution du plugin</h2>
                <p>Historique des versions majeures et fonctionnalites ajoutees</p>
            </div>

            <div class="timeline-section">
                <div class="timeline-line"></div>
                
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <span class="timeline-date">Janvier 2026</span>
                        <h4>v2.2.4 - Auto-detection</h4>
                        <p>GraceTHD integre en interne, auto-detection fichier C6, workflow optimise Police C6.</p>
                        <span class="timeline-badge">ACTUELLE</span>
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <span class="timeline-date">Decembre 2025</span>
                        <h4>v2.2.0 - Securite NFC</h4>
                        <p>Module verification securite NFC 11201-A1, detection zones climatiques ZVN/ZVF, feuille VERIF_SECURITE.</p>
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <span class="timeline-date">Octobre 2025</span>
                        <h4>v2.1.0 - Police C6</h4>
                        <p>Integration GraceTHD SQLite, analyse croisee C6/C3A/C7, couches erreur temporaires.</p>
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content">
                        <span class="timeline-date">2024</span>
                        <h4>v2.0.0 - Refonte complete</h4>
                        <p>Architecture MVC, execution asynchrone QgsTask, UI feedback animations, 6 onglets fonctionnels.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Lifecycle Diagram Section -->
        <section id="lifecycle" style="margin-top: 4rem;">
            <div class="section-header">
                <h2>Cycle de vie QGIS</h2>
                <p>Comprendre le fonctionnement interne du plugin dans QGIS</p>
            </div>

            <!-- Main Lifecycle Diagram -->
            <div class="lifecycle-container">
                <svg viewBox="0 0 1200 500" xmlns="http://www.w3.org/2000/svg" style="width: 100%; max-height: 520px;">
                    <defs>
                        <marker id="arrow-life" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#60a5fa"/>
                        </marker>
                        <filter id="glow-life" x="-50%" y="-50%" width="200%" height="200%">
                            <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                            <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
                        </filter>
                    </defs>
                    
                    <!-- Background grid -->
                    <pattern id="grid-life" width="30" height="30" patternUnits="userSpaceOnUse">
                        <path d="M 30 0 L 0 0 0 30" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/>
                    </pattern>
                    <rect width="1200" height="500" fill="url(#grid-life)"/>

                    <!-- Step 1: QGIS Start -->
                    <g filter="url(#glow-life)">
                        <rect x="40" y="200" width="150" height="100" rx="12" fill="rgba(59,130,246,0.3)" stroke="#3b82f6" stroke-width="2"/>
                        <text x="115" y="230" text-anchor="middle" fill="white" font-size="13" font-weight="700">1. QGIS Start</text>
                        <text x="115" y="250" text-anchor="middle" fill="#93c5fd" font-size="10">classFactory(iface)</text>
                        <text x="115" y="270" text-anchor="middle" fill="#60a5fa" font-size="9">__init__.py:64</text>
                        <text x="115" y="285" text-anchor="middle" fill="#bfdbfe" font-size="8">Retourne PoleAerien</text>
                    </g>

                    <!-- Arrow 1 -->
                    <path d="M 190 250 L 230 250" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-life)" class="flow-arrow"/>

                    <!-- Step 2: __init__ -->
                    <g filter="url(#glow-life)">
                        <rect x="230" y="170" width="180" height="160" rx="12" fill="rgba(139,92,246,0.3)" stroke="#8b5cf6" stroke-width="2"/>
                        <text x="320" y="195" text-anchor="middle" fill="white" font-size="13" font-weight="700">2. __init__(iface)</text>
                        <text x="320" y="215" text-anchor="middle" fill="#c4b5fd" font-size="9">• Dialog + UIStateController</text>
                        <text x="320" y="232" text-anchor="middle" fill="#c4b5fd" font-size="9">• LogManager</text>
                        <text x="320" y="249" text-anchor="middle" fill="#c4b5fd" font-size="9">• 6 Workflows (signaux)</text>
                        <text x="320" y="266" text-anchor="middle" fill="#c4b5fd" font-size="9">• Toolbar création</text>
                        <text x="320" y="283" text-anchor="middle" fill="#c4b5fd" font-size="9">• Connexion boutons</text>
                        <text x="320" y="305" text-anchor="middle" fill="#a78bfa" font-size="8">PoleAerien.py:83-290</text>
                        <text x="320" y="320" text-anchor="middle" fill="#ddd6fe" font-size="7">Workflows: Maj, CapFt, Comac, C6Bd, C6C3A, Police</text>
                    </g>

                    <!-- Arrow 2 -->
                    <path d="M 410 250 L 460 250" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-life)" class="flow-arrow"/>

                    <!-- Step 3: initGui -->
                    <g filter="url(#glow-life)">
                        <rect x="460" y="200" width="160" height="100" rx="12" fill="rgba(16,185,129,0.3)" stroke="#10b981" stroke-width="2"/>
                        <text x="540" y="230" text-anchor="middle" fill="white" font-size="13" font-weight="700">3. initGui()</text>
                        <text x="540" y="250" text-anchor="middle" fill="#6ee7b7" font-size="9">• Menu QGIS</text>
                        <text x="540" y="267" text-anchor="middle" fill="#6ee7b7" font-size="9">• Toolbar icon</text>
                        <text x="540" y="284" text-anchor="middle" fill="#34d399" font-size="8">Ligne 374-383</text>
                    </g>

                    <!-- Arrow 3 -->
                    <path d="M 620 250 L 670 250" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-life)" class="flow-arrow"/>

                    <!-- Step 4: run -->
                    <g filter="url(#glow-life)">
                        <rect x="670" y="160" width="180" height="180" rx="12" fill="rgba(251,191,36,0.3)" stroke="#fbbf24" stroke-width="2"/>
                        <text x="760" y="185" text-anchor="middle" fill="white" font-size="13" font-weight="700">4. run()</text>
                        <text x="760" y="205" text-anchor="middle" fill="#fcd34d" font-size="9">• Init ComboBox couches</text>
                        <text x="760" y="222" text-anchor="middle" fill="#fcd34d" font-size="9">• dlg.show()</text>
                        <text x="760" y="239" text-anchor="middle" fill="#fcd34d" font-size="9">• QTimer 150ms</text>
                        <text x="760" y="256" text-anchor="middle" fill="#fcd34d" font-size="9">• _init_default_layers()</text>
                        <text x="760" y="273" text-anchor="middle" fill="#fcd34d" font-size="9">• Validation UI</text>
                        <text x="760" y="290" text-anchor="middle" fill="#fcd34d" font-size="9">• dlg.exec_() boucle Qt</text>
                        <text x="760" y="315" text-anchor="middle" fill="#f59e0b" font-size="8">Ligne 432-464</text>
                        <text x="760" y="330" text-anchor="middle" fill="#fef3c7" font-size="7">Attente interaction utilisateur</text>
                    </g>

                    <!-- Arrow 4 -->
                    <path d="M 850 250 L 900 250" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-life)" class="flow-arrow"/>

                    <!-- Step 5: unload -->
                    <g filter="url(#glow-life)">
                        <rect x="900" y="190" width="160" height="120" rx="12" fill="rgba(239,68,68,0.3)" stroke="#ef4444" stroke-width="2"/>
                        <text x="980" y="220" text-anchor="middle" fill="white" font-size="13" font-weight="700">5. unload()</text>
                        <text x="980" y="240" text-anchor="middle" fill="#fca5a5" font-size="9">• Cleanup tasks</text>
                        <text x="980" y="257" text-anchor="middle" fill="#fca5a5" font-size="9">• dlg.cleanup()</text>
                        <text x="980" y="274" text-anchor="middle" fill="#fca5a5" font-size="9">• Remove menu</text>
                        <text x="980" y="291" text-anchor="middle" fill="#f87171" font-size="9">• del toolbar</text>
                    </g>

                    <!-- Loop arrow back -->
                    <path d="M 760 340 Q 760 430 400 430 Q 115 430 115 300" stroke="rgba(96,165,250,0.4)" stroke-width="2" fill="none" stroke-dasharray="8 4" marker-end="url(#arrow-life)"/>
                    <text x="450" y="460" text-anchor="middle" fill="#94a3b8" font-size="11" font-style="italic">↻ Utilisateur relance le plugin</text>

                    <!-- Title & Metadata -->
                    <text x="50" y="40" fill="#e2e8f0" font-size="14" font-weight="700">CYCLE DE VIE PLUGIN QGIS</text>
                    <rect x="50" y="50" width="280" height="90" rx="8" fill="rgba(255,255,255,0.08)" stroke="rgba(255,255,255,0.15)" stroke-width="1"/>
                    
                    <!-- File Icon -->
                    <g transform="translate(65, 65)">
                        <rect width="10" height="13" rx="1" fill="none" stroke="#94a3b8" stroke-width="1.2"/>
                        <line x1="2" y1="4" x2="8" y2="4" stroke="#94a3b8" stroke-width="1"/>
                        <line x1="2" y1="7" x2="8" y2="7" stroke="#94a3b8" stroke-width="1"/>
                        <line x1="2" y1="10" x2="6" y2="10" stroke="#94a3b8" stroke-width="1"/>
                    </g>
                    <text x="82" y="75" fill="#94a3b8" font-size="10" font-weight="600">Fichier principal:</text>
                    <text x="210" y="75" fill="#60a5fa" font-size="10" font-weight="700">PoleAerien.py</text>
                    
                    <!-- Code Icon -->
                    <g transform="translate(65, 85)">
                        <polyline points="0,6.5 3,3.5 0,0.5" fill="none" stroke="#94a3b8" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                        <polyline points="10,0.5 7,3.5 10,6.5" fill="none" stroke="#94a3b8" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
                        <line x1="4.5" y1="0" x2="5.5" y2="7" stroke="#94a3b8" stroke-width="1.2" stroke-linecap="round"/>
                    </g>
                    <text x="82" y="95" fill="#94a3b8" font-size="10" font-weight="600">Lignes de code:</text>
                    <text x="210" y="95" fill="#60a5fa" font-size="10" font-weight="700">~2125 lignes</text>
                    
                    <!-- Version Icon -->
                    <g transform="translate(65, 105)">
                        <circle cx="5" cy="5" r="4.5" fill="none" stroke="#94a3b8" stroke-width="1.2"/>
                        <text x="5" y="8" text-anchor="middle" fill="#94a3b8" font-size="6" font-weight="700">v</text>
                    </g>
                    <text x="82" y="115" fill="#94a3b8" font-size="10" font-weight="600">Version:</text>
                    <text x="210" y="115" fill="#60a5fa" font-size="10" font-weight="700">2.3.0</text>
                    <text x="65" y="130" fill="#94a3b8" font-size="9">QGIS 3.28+ compatible</text>
                </svg>
            </div>

            <!-- Detailed Explanation Cards -->
            <div class="cards-grid" style="margin-top: 3rem;">
                <div class="card">
                    <div class="card-icon blue">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                            <path d="M2 17l10 5 10-5M2 12l10 5 10-5"/>
                        </svg>
                    </div>
                    <h3>1. Démarrage QGIS</h3>
                    <p><strong>classFactory(iface)</strong> dans <code>__init__.py</code> est appelée par QGIS au démarrage. Cette fonction instancie et retourne l'objet <code>PoleAerien</code>.</p>
                </div>

                <div class="card">
                    <div class="card-icon purple">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"/>
                        </svg>
                    </div>
                    <h3>2. Initialisation</h3>
                    <p><strong>__init__(iface)</strong> configure le plugin : création du dialog, initialisation de 6 workflows (Maj, CapFt, Comac, C6Bd, C6C3A, Police), connexion des signaux Qt, et création de la toolbar.</p>
                </div>

                <div class="card">
                    <div class="card-icon green">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <line x1="9" y1="9" x2="15" y2="15"/>
                            <line x1="15" y1="9" x2="9" y2="15"/>
                        </svg>
                    </div>
                    <h3>3. Interface GUI</h3>
                    <p><strong>initGui()</strong> ajoute l'icône du plugin au menu QGIS et à la toolbar. L'action est connectée à la méthode <code>run()</code>.</p>
                </div>

                <div class="card">
                    <div class="card-icon orange">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="5 3 19 12 5 21 5 3"/>
                        </svg>
                    </div>
                    <h3>4. Exécution</h3>
                    <p><strong>run()</strong> affiche le dialog, peuple les QgsMapLayerComboBox, initialise les couches par défaut avec un délai de 150ms (QTimer), et lance la boucle événementielle Qt avec <code>exec_()</code>.</p>
                </div>

                <div class="card">
                    <div class="card-icon red">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="3 6 5 6 21 6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                            <line x1="10" y1="11" x2="10" y2="17"/>
                            <line x1="14" y1="11" x2="14" y2="17"/>
                        </svg>
                    </div>
                    <h3>5. Nettoyage</h3>
                    <p><strong>unload()</strong> nettoie les ressources : arrêt des QgsTask, fermeture du dialog, suppression du LogManager, retrait du menu et de la toolbar.</p>
                </div>

                <div class="card">
                    <div class="card-icon blue">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="23 4 23 10 17 10"/>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                        </svg>
                    </div>
                    <h3>Workflows asynchrones</h3>
                    <p>6 workflows héritent de <code>QgsTask</code> pour exécuter les analyses en arrière-plan sans bloquer l'interface. Chaque workflow émet des signaux (progress, message, finished, error).</p>
                </div>
            </div>

            <!-- Technical Details Accordion -->
            <div class="accordion" style="margin-top: 3rem;">
                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                                <rect x="2" y="7" width="20" height="14" rx="2" ry="2"/>
                                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>
                            </svg>
                            Détails techniques : Initialisation des composants
                        </h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p><strong>Dans __init__() (lignes 83-290) :</strong></p>
                        <ul style="color: var(--text-secondary); font-size: 0.95rem; line-height: 1.8; margin-left: 1.5rem;">
                            <li><code>self.dlg = PoleAerienDialog()</code> - Création du dialog Qt</li>
                            <li><code>self.ui_state = UIStateController(self.dlg)</code> - Gestion état UI</li>
                            <li><code>self._log = get_log_manager()</code> - Système de logs</li>
                            <li><code>self.maj_workflow = MajWorkflow()</code> - Workflow MAJ FT/BT</li>
                            <li>Connexion de ~50 signaux Qt (clicked, textChanged, layerChanged)</li>
                            <li>Création toolbar : <code>self.toolbar = self.iface.addToolBar()</code></li>
                        </ul>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                            Détails techniques : QTimer et couches par défaut
                        </h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p><strong>Problème résolu :</strong> Les QgsMapLayerComboBox des onglets cachés (1, 2, 3) restaient vides au démarrage car leur modèle n'était pas initialisé.</p>
                        <p><strong>Solution :</strong> <code>QTimer.singleShot(150, self._init_default_layers)</code> attend 150ms après <code>dlg.show()</code> pour forcer le refresh des ComboBox et sélectionner les couches <code>infra_pt_pot</code>, <code>cap_ft</code>, <code>comac</code>.</p>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                <polyline points="22 4 12 14.01 9 11.01"/>
                            </svg>
                            Détails techniques : Validation UI et UIStateController
                        </h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p><strong>UIStateController</strong> gère l'activation/désactivation automatique des boutons lanceurs selon la validité des champs requis (couches, fichiers, chemins).</p>
                        <p><code>connect_validation_signals()</code> connecte les signaux de changement pour mettre à jour l'état des boutons en temps réel.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Audit Report Section -->
        <section id="audit" style="margin-top: 4rem;">
            <div class="section-header">
                <h2>Rapport d'Audit Visuel</h2>
                <p>Captures d'ecran des interfaces et resultats d'analyse</p>
            </div>

            <div class="audit-section">
                <div class="audit-gallery">
                    <div class="audit-card">
                        <img src="image/rapport_audit/1769672442884.png" alt="Interface principale" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27400%27 height=%27200%27%3E%3Crect fill=%27%23e2e8f0%27 width=%27400%27 height=%27200%27/%3E%3Ctext x=%27200%27 y=%27100%27 text-anchor=%27middle%27 fill=%27%2364748b%27 font-size=%2714%27%3EImage non disponible%3C/text%3E%3C/svg%3E'"/>
                        <div class="audit-card-content">
                            <h4>Interface principale</h4>
                            <p>Vue d'ensemble du dialog principal avec les 6 onglets fonctionnels et la barre de progression.</p>
                        </div>
                    </div>
                    <div class="audit-card">
                        <img src="image/rapport_audit/1769672797672.png" alt="Analyse COMAC" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27400%27 height=%27200%27%3E%3Crect fill=%27%23e2e8f0%27 width=%27400%27 height=%27200%27/%3E%3Ctext x=%27200%27 y=%27100%27 text-anchor=%27middle%27 fill=%27%2364748b%27 font-size=%2714%27%3EImage non disponible%3C/text%3E%3C/svg%3E'"/>
                        <div class="audit-card-content">
                            <h4>Analyse COMAC</h4>
                            <p>Resultat d'analyse avec verification securite et detection des portees molles.</p>
                        </div>
                    </div>
                    <div class="audit-card">
                        <img src="image/rapport_audit/1769673860198.png" alt="Export Excel" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27400%27 height=%27200%27%3E%3Crect fill=%27%23e2e8f0%27 width=%27400%27 height=%27200%27/%3E%3Ctext x=%27200%27 y=%27100%27 text-anchor=%27middle%27 fill=%27%2364748b%27 font-size=%2714%27%3EImage non disponible%3C/text%3E%3C/svg%3E'"/>
                        <div class="audit-card-content">
                            <h4>Export Excel</h4>
                            <p>Feuille VERIF_SECURITE avec coloration conditionnelle OK/PORTEE MOLLE.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Architecture Section -->
        <section id="analytics">
            <div class="section-header">
                <h2>Architecture du plugin</h2>
                <p>Schémas explicatifs du fonctionnement des composants</p>
            </div>

            <!-- Diagram Tabs -->
            <div class="diagram-tabs">
                <button class="diagram-tab active" onclick="showDiagram('global')">Vue globale</button>
                <button class="diagram-tab" onclick="showDiagram('layers')">Architecture en couches</button>
                <button class="diagram-tab" onclick="showDiagram('dataflow')">Flux de données</button>
                <button class="diagram-tab" onclick="showDiagram('modules')">Modules détaillés</button>
                <button class="diagram-tab" onclick="showDiagram('security')">Vérif Sécurité</button>
                <button class="diagram-tab" onclick="showDiagram('dag')" style="background: rgba(16,185,129,0.1); border: 1px solid #10b981;">DAG Imports</button>
            </div>

            <!-- Architecture en couches -->
            <div id="diagram-layers" class="diagram-panel">
                <div class="diagram-container">
                    <h3 class="diagram-title">Architecture applicative en couches</h3>
                    <svg class="architecture-svg" viewBox="0 0 1100 800" xmlns="http://www.w3.org/2000/svg" style="max-height: 820px;">
                        <defs>
                            <marker id="arrow-dep" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
                            </marker>
                            <linearGradient id="grad-ui" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#7c3aed;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="grad-ctrl" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#2563eb;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="grad-metier" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="grad-rules" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#f59e0b;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#d97706;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="grad-data" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#ef4444;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#dc2626;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <rect width="1100" height="800" fill="#f8fafc"/>

                        <!-- COUCHE 1: UI -->
                        <g class="node">
                            <rect x="50" y="30" width="1000" height="100" rx="12" fill="url(#grad-ui)" stroke="#7c3aed" stroke-width="2" opacity="0.95"/>
                            <text x="80" y="60" font-weight="700" fill="white" font-size="16">COUCHE UI (Qt)</text>
                            
                            <rect x="80" y="75" width="180" height="40" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="170" y="92" text-anchor="middle" fill="white" font-size="11" font-weight="600">PoleAerien.py</text>
                            <text x="170" y="105" text-anchor="middle" fill="#ddd6fe" font-size="9">Contrôleur</text>

                            <rect x="280" y="75" width="180" height="40" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="370" y="92" text-anchor="middle" fill="white" font-size="11" font-weight="600">Pole_Aerien_dialog.py</text>
                            <text x="370" y="105" text-anchor="middle" fill="#ddd6fe" font-size="9">Vue (QDialog)</text>

                            <rect x="480" y="75" width="150" height="40" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="555" y="92" text-anchor="middle" fill="white" font-size="11" font-weight="600">ui_feedback.py</text>
                            <text x="555" y="105" text-anchor="middle" fill="#ddd6fe" font-size="9">Animations</text>
                        </g>

                        <!-- Flèche UI → Orchestration -->
                        <path d="M 550 130 L 550 155" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrow-dep)" stroke-dasharray="5,3"/>

                        <!-- COUCHE 2: WORKFLOWS (NOUVELLE ARCHITECTURE) -->
                        <g class="node">
                            <rect x="50" y="155" width="1000" height="140" rx="12" fill="url(#grad-ctrl)" stroke="#2563eb" stroke-width="2" opacity="0.95"/>
                            <text x="80" y="180" font-weight="700" fill="white" font-size="16">COUCHE WORKFLOWS (Orchestration)</text>
                            
                            <!-- Ligne 1: 3 workflows -->
                            <rect x="80" y="195" width="140" height="40" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="150" y="210" text-anchor="middle" fill="white" font-size="10" font-weight="600">MajWorkflow</text>
                            <text x="150" y="223" text-anchor="middle" fill="#bfdbfe" font-size="8">MAJ FT/BT</text>

                            <rect x="235" y="195" width="140" height="40" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="305" y="210" text-anchor="middle" fill="white" font-size="10" font-weight="600">CapFtWorkflow</text>
                            <text x="305" y="223" text-anchor="middle" fill="#bfdbfe" font-size="8">Vérif FT</text>

                            <rect x="390" y="195" width="140" height="40" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="460" y="210" text-anchor="middle" fill="white" font-size="10" font-weight="600">ComacWorkflow</text>
                            <text x="460" y="223" text-anchor="middle" fill="#bfdbfe" font-size="8">Vérif BT</text>

                            <!-- Ligne 2: 3 workflows -->
                            <rect x="80" y="245" width="140" height="40" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="150" y="260" text-anchor="middle" fill="white" font-size="10" font-weight="600">C6BdWorkflow</text>
                            <text x="150" y="273" text-anchor="middle" fill="#bfdbfe" font-size="8">C6 vs BD</text>

                            <rect x="235" y="245" width="140" height="40" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="305" y="260" text-anchor="middle" fill="white" font-size="10" font-weight="600">C6C3AWorkflow</text>
                            <text x="305" y="273" text-anchor="middle" fill="#bfdbfe" font-size="8">C6/C3A/C7</text>

                            <rect x="390" y="245" width="140" height="40" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="460" y="260" text-anchor="middle" fill="white" font-size="10" font-weight="600">PoliceWorkflow</text>
                            <text x="460" y="273" text-anchor="middle" fill="#bfdbfe" font-size="8">Police C6</text>

                            <!-- Infrastructure async -->
                            <rect x="550" y="195" width="220" height="90" rx="8" fill="rgba(255,255,255,0.15)" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                            <text x="660" y="215" text-anchor="middle" fill="white" font-size="10" font-weight="600">Infrastructure Async</text>
                            <text x="660" y="235" text-anchor="middle" fill="#bfdbfe" font-size="8">async_tasks.py</text>
                            <text x="660" y="250" text-anchor="middle" fill="#bfdbfe" font-size="8">QgsTask + signaux</text>
                            <text x="660" y="265" text-anchor="middle" fill="#bfdbfe" font-size="8">ui_state.py</text>
                            <text x="660" y="280" text-anchor="middle" fill="#bfdbfe" font-size="8">ui_feedback.py</text>
                        </g>

                        <!-- Flèche Workflows → Métier -->
                        <path d="M 550 295 L 550 320" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrow-dep)" stroke-dasharray="5,3"/>

                        <!-- COUCHE 3: MÉTIER -->
                        <g class="node">
                            <rect x="50" y="320" width="1000" height="120" rx="12" fill="url(#grad-metier)" stroke="#059669" stroke-width="2" opacity="0.95"/>
                            <text x="80" y="345" font-weight="700" fill="white" font-size="16">COUCHE MÉTIER (Logique Business)</text>
                            
                            <rect x="80" y="360" width="140" height="30" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="150" y="378" text-anchor="middle" fill="white" font-size="10" font-weight="600">Maj_Ft_Bt.py</text>

                            <rect x="235" y="360" width="110" height="30" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="290" y="378" text-anchor="middle" fill="white" font-size="10" font-weight="600">CapFt.py</text>

                            <rect x="360" y="360" width="110" height="30" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="415" y="378" text-anchor="middle" fill="white" font-size="10" font-weight="600">Comac.py</text>

                            <rect x="485" y="360" width="130" height="30" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="550" y="378" text-anchor="middle" fill="white" font-size="10" font-weight="600">C6_vs_Bd.py</text>

                            <rect x="630" y="360" width="180" height="30" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="720" y="378" text-anchor="middle" fill="white" font-size="10" font-weight="600">C6_vs_C3A_vs_Bd.py</text>

                            <rect x="825" y="360" width="130" height="30" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="890" y="378" text-anchor="middle" fill="white" font-size="10" font-weight="600">PoliceC6.py</text>

                            <rect x="340" y="395" width="140" height="40" rx="8" fill="rgba(255,255,255,0.3)" stroke="white" stroke-width="1"/>
                            <text x="410" y="414" text-anchor="middle" fill="white" font-size="11" font-weight="600">qgis_utils.py</text>
                            <text x="410" y="429" text-anchor="middle" fill="#d1fae5" font-size="9">+ core_utils.py</text>
                        </g>

                        <!-- Flèche Métier → Règles -->
                        <path d="M 550 440 L 550 465" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrow-dep)" stroke-dasharray="5,3"/>

                        <!-- COUCHE 4: RÈGLES & VALIDATION -->
                        <g class="node">
                            <rect x="50" y="465" width="1000" height="120" rx="12" fill="url(#grad-rules)" stroke="#d97706" stroke-width="2" opacity="0.95"/>
                            <text x="80" y="490" font-weight="700" fill="white" font-size="16">COUCHE RÈGLES &amp; VALIDATION</text>
                            
                            <rect x="80" y="505" width="160" height="75" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="160" y="522" text-anchor="middle" fill="white" font-size="11" font-weight="600">security_rules.py</text>
                            <text x="160" y="535" text-anchor="middle" fill="#fef3c7" font-size="8">PORTEES_MAX</text>
                            <text x="160" y="545" text-anchor="middle" fill="#fef3c7" font-size="8">verifier_portee()</text>
                            <text x="160" y="555" text-anchor="middle" fill="#fef3c7" font-size="8">NFC 11201-A1</text>
                            <text x="160" y="570" text-anchor="middle" fill="#fde68a" font-size="7">Guards division/0</text>

                            <rect x="260" y="505" width="160" height="75" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="340" y="522" text-anchor="middle" fill="white" font-size="11" font-weight="600">pcm_parser.py</text>
                            <text x="340" y="535" text-anchor="middle" fill="#fef3c7" font-size="8">parse_pcm_file()</text>
                            <text x="340" y="545" text-anchor="middle" fill="#fef3c7" font-size="8">EtudePCM</text>
                            <text x="340" y="555" text-anchor="middle" fill="#fef3c7" font-size="8">XML → dataclass</text>
                            <text x="340" y="570" text-anchor="middle" fill="#fde68a" font-size="7">ISO-8859-1</text>

                            <rect x="440" y="505" width="160" height="75" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="520" y="522" text-anchor="middle" fill="white" font-size="11" font-weight="600">comac_loader.py</text>
                            <text x="520" y="535" text-anchor="middle" fill="#fef3c7" font-size="8">load_etude_comac()</text>
                            <text x="520" y="545" text-anchor="middle" fill="#fef3c7" font-size="8">Fusion PCM+Excel</text>
                            <text x="520" y="555" text-anchor="middle" fill="#fef3c7" font-size="8">Détection ZVF/ZVN</text>
                            <text x="520" y="570" text-anchor="middle" fill="#fde68a" font-size="7">Auto-detect zones</text>
                        </g>

                        <!-- Flèche Règles → Données -->
                        <path d="M 550 585 L 550 610" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#arrow-dep)" stroke-dasharray="5,3"/>

                        <!-- COUCHE 5: DONNÉES -->
                        <g class="node">
                            <rect x="50" y="610" width="1000" height="110" rx="12" fill="url(#grad-data)" stroke="#dc2626" stroke-width="2" opacity="0.95"/>
                            <text x="80" y="635" font-weight="700" fill="white" font-size="16">COUCHE DONNÉES</text>
                            
                            <rect x="80" y="650" width="200" height="65" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="180" y="667" text-anchor="middle" fill="white" font-size="11" font-weight="600">comac_db_reader.py</text>
                            <text x="180" y="680" text-anchor="middle" fill="#fee2e2" font-size="8">get_cable_capacite()</text>
                            <text x="180" y="690" text-anchor="middle" fill="#fee2e2" font-size="8">get_zone_vent_*()</text>
                            <text x="180" y="700" text-anchor="middle" fill="#fee2e2" font-size="8">Cache thread-safe</text>

                            <rect x="300" y="650" width="120" height="65" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="360" y="667" text-anchor="middle" fill="white" font-size="10" font-weight="600">comac.gpkg</text>
                            <text x="360" y="680" text-anchor="middle" fill="#fee2e2" font-size="8">cables (463)</text>
                            <text x="360" y="690" text-anchor="middle" fill="#fee2e2" font-size="8">hypotheses</text>
                            <text x="360" y="700" text-anchor="middle" fill="#fee2e2" font-size="8">communes</text>

                            <rect x="440" y="650" width="120" height="65" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="500" y="667" text-anchor="middle" fill="white" font-size="10" font-weight="600">GraceTHD/</text>
                            <text x="500" y="680" text-anchor="middle" fill="#fee2e2" font-size="8">t_cheminement</text>
                            <text x="500" y="690" text-anchor="middle" fill="#fee2e2" font-size="8">t_cable</text>
                            <text x="500" y="700" text-anchor="middle" fill="#fee2e2" font-size="8">SQLite/Shp</text>

                            <rect x="580" y="650" width="140" height="65" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="650" y="667" text-anchor="middle" fill="white" font-size="10" font-weight="600">Couches QGIS</text>
                            <text x="650" y="680" text-anchor="middle" fill="#fee2e2" font-size="8">infra_pt_pot</text>
                            <text x="650" y="690" text-anchor="middle" fill="#fee2e2" font-size="8">etude_cap_ft</text>
                            <text x="650" y="700" text-anchor="middle" fill="#fee2e2" font-size="8">EPSG:2154</text>

                            <rect x="740" y="650" width="120" height="65" rx="6" fill="rgba(255,255,255,0.2)" stroke="white" stroke-width="1"/>
                            <text x="800" y="667" text-anchor="middle" fill="white" font-size="10" font-weight="600">Fichiers Excel</text>
                            <text x="800" y="680" text-anchor="middle" fill="#fee2e2" font-size="8">FT/BT KO</text>
                            <text x="800" y="690" text-anchor="middle" fill="#fee2e2" font-size="8">C6, C3A, C7</text>
                            <text x="800" y="700" text-anchor="middle" fill="#fee2e2" font-size="8">CAP_FT, COMAC</text>
                        </g>

                        <!-- Annotations statistiques -->
                        <g opacity="0.9">
                            <rect x="50" y="735" width="1000" height="50" rx="8" fill="white" stroke="#e2e8f0" stroke-width="1"/>
                            <!-- Chart icon SVG -->
                            <g transform="translate(80, 745)">
                                <rect x="0" y="8" width="3" height="8" fill="#3b82f6" rx="1"/>
                                <rect x="5" y="4" width="3" height="12" fill="#3b82f6" rx="1"/>
                                <rect x="10" y="0" width="3" height="16" fill="#3b82f6" rx="1"/>
                            </g>
                            <text x="100" y="757" font-weight="600" fill="#334155" font-size="11">Statistiques v2.3.0</text>
                            <text x="250" y="757" fill="#64748b" font-size="10">~35 fichiers Python</text>
                            <text x="400" y="757" fill="#64748b" font-size="10">~8500 lignes</text>
                            <text x="520" y="757" fill="#64748b" font-size="10">6 workflows</text>
                            <text x="640" y="757" fill="#64748b" font-size="10">6 modules métier</text>
                            <text x="790" y="757" fill="#64748b" font-size="10">Thread-safe async</text>
                            <g transform="translate(940, 747)">
                                <circle cx="5" cy="5" r="8" fill="#10b981"/>
                                <polyline points="2,5 4.5,7.5 8,3" fill="none" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </g>
                            <text x="960" y="757" fill="#10b981" font-size="10" font-weight="600">QGIS 3.28+</text>
                            
                            <text x="80" y="775" fill="#94a3b8" font-size="9">Architecture en 5 couches : UI → Workflows → Métier → Règles → Données</text>
                        </g>
                    </svg>

                    <div class="legend" style="margin-top: 1.5rem;">
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);"></div>
                            <span>Couche UI (Interface utilisateur)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></div>
                            <span>Couche Orchestration (Async, signaux)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #10b981, #059669);"></div>
                            <span>Couche Métier (Logique business)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></div>
                            <span>Couche Règles (Validation, sécurité)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(135deg, #ef4444, #dc2626);"></div>
                            <span>Couche Données (CSV, QGIS, Excel)</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Global Architecture Diagram - Clean Hierarchical Flow -->
            <div id="diagram-global" class="diagram-panel active">
                <div class="diagram-container" style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%); border: none;">
                    <h3 class="diagram-title" style="color: white;">Vue d'ensemble - Architecture en flux (v2.3.0)</h3>
                    <svg class="architecture-svg" viewBox="0 0 1200 700" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <!-- Gradients modernes -->
                            <linearGradient id="grad-core" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#1d4ed8;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="grad-gold" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#fbbf24;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#f59e0b;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="grad-emerald" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#34d399;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#10b981;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="grad-violet" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#a78bfa;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#7c3aed;stop-opacity:1" />
                            </linearGradient>
                            <filter id="glow-blue" x="-50%" y="-50%" width="200%" height="200%">
                                <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
                                <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
                            </filter>
                            <filter id="glow-gold" x="-50%" y="-50%" width="200%" height="200%">
                                <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                                <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
                            </filter>
                            <marker id="arrow-neon" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto">
                                <polygon points="0 0, 12 4, 0 8" fill="#60a5fa"/>
                            </marker>
                        </defs>
                        
                        <!-- Background pattern -->
                        <pattern id="grid-dark" width="40" height="40" patternUnits="userSpaceOnUse">
                            <path d="M 40 0 L 0 0 0 40" fill="none" stroke="rgba(255,255,255,0.03)" stroke-width="1"/>
                        </pattern>
                        <rect width="1200" height="700" fill="url(#grid-dark)"/>

                        <!-- Visual Zones (Background grouping) -->
                        <rect x="30" y="150" width="180" height="400" rx="16" fill="rgba(251,191,36,0.08)" stroke="rgba(251,191,36,0.2)" stroke-width="1"/>
                        <text x="120" y="180" text-anchor="middle" fill="#fbbf24" font-size="10" font-weight="600">INPUTS</text>
                        
                        <rect x="250" y="100" width="200" height="500" rx="16" fill="rgba(59,130,246,0.08)" stroke="rgba(59,130,246,0.2)" stroke-width="1"/>
                        <text x="350" y="130" text-anchor="middle" fill="#60a5fa" font-size="10" font-weight="600">CORE</text>
                        
                        <rect x="490" y="50" width="320" height="600" rx="16" fill="rgba(139,92,246,0.08)" stroke="rgba(139,92,246,0.2)" stroke-width="1"/>
                        <text x="650" y="80" text-anchor="middle" fill="#a78bfa" font-size="10" font-weight="600">WORKFLOWS</text>
                        
                        <rect x="850" y="100" width="320" height="500" rx="16" fill="rgba(16,185,129,0.08)" stroke="rgba(16,185,129,0.2)" stroke-width="1"/>
                        <text x="1010" y="130" text-anchor="middle" fill="#34d399" font-size="10" font-weight="600">MODULES</text>

                        <!-- COLONNE 2: CORE -->
                        <g class="node" filter="url(#glow-blue)">
                            <rect x="270" y="280" width="160" height="140" rx="16" fill="url(#grad-core)" stroke="#60a5fa" stroke-width="3"/>
                            <text x="350" y="310" text-anchor="middle" font-weight="700" fill="white" font-size="18">CORE</text>
                            <text x="350" y="335" text-anchor="middle" fill="#bfdbfe" font-size="12">PoleAerien.py</text>
                            <text x="350" y="355" text-anchor="middle" fill="#93c5fd" font-size="10">Orchestrateur</text>
                            <text x="350" y="375" text-anchor="middle" fill="#60a5fa" font-size="9">~2125 lignes</text>
                        </g>

                        <!-- COLONNE 3: WORKFLOWS (Centre) -->
                        <g class="node">
                            <rect x="520" y="150" width="240" height="60" rx="10" fill="rgba(251,191,36,0.2)" stroke="#fbbf24" stroke-width="2"/>
                            <text x="550" y="175" text-anchor="start" font-weight="600" fill="#fbbf24" font-size="11">MajWorkflow</text>
                            <text x="550" y="193" text-anchor="start" fill="#fde68a" font-size="8">maj_workflow.py</text>
                            <circle cx="730" cy="180" r="18" fill="#fbbf24"/>
                            <text x="730" y="186" text-anchor="middle" fill="#78350f" font-size="11" font-weight="700">0</text>
                        </g>

                        <g class="node">
                            <rect x="520" y="225" width="240" height="60" rx="10" fill="rgba(52,211,153,0.2)" stroke="#34d399" stroke-width="2"/>
                            <text x="550" y="250" text-anchor="start" font-weight="600" fill="#34d399" font-size="11">CapFtWorkflow</text>
                            <text x="550" y="268" text-anchor="start" fill="#a7f3d0" font-size="8">capft_workflow.py</text>
                            <circle cx="730" cy="255" r="18" fill="#34d399"/>
                            <text x="730" y="261" text-anchor="middle" fill="#064e3b" font-size="11" font-weight="700">2</text>
                        </g>

                        <g class="node">
                            <rect x="520" y="300" width="240" height="60" rx="10" fill="rgba(59,130,246,0.2)" stroke="#3b82f6" stroke-width="2"/>
                            <text x="550" y="325" text-anchor="start" font-weight="600" fill="#60a5fa" font-size="11">ComacWorkflow</text>
                            <text x="550" y="343" text-anchor="start" fill="#bfdbfe" font-size="8">comac_workflow.py</text>
                            <circle cx="730" cy="330" r="18" fill="#3b82f6"/>
                            <text x="730" y="336" text-anchor="middle" fill="white" font-size="11" font-weight="700">3</text>
                        </g>

                        <g class="node">
                            <rect x="520" y="375" width="240" height="60" rx="10" fill="rgba(236,72,153,0.2)" stroke="#ec4899" stroke-width="2"/>
                            <text x="550" y="400" text-anchor="start" font-weight="600" fill="#f472b6" font-size="11">C6BdWorkflow</text>
                            <text x="550" y="418" text-anchor="start" fill="#fbcfe8" font-size="8">c6bd_workflow.py</text>
                            <circle cx="730" cy="405" r="18" fill="#ec4899"/>
                            <text x="730" y="411" text-anchor="middle" fill="white" font-size="11" font-weight="700">1</text>
                        </g>

                        <g class="node">
                            <rect x="520" y="450" width="240" height="60" rx="10" fill="rgba(139,92,246,0.2)" stroke="#8b5cf6" stroke-width="2"/>
                            <text x="550" y="475" text-anchor="start" font-weight="600" fill="#a78bfa" font-size="11">C6C3AWorkflow</text>
                            <text x="550" y="493" text-anchor="start" fill="#ddd6fe" font-size="8">c6c3a_workflow.py</text>
                            <circle cx="730" cy="480" r="18" fill="#8b5cf6"/>
                            <text x="730" y="486" text-anchor="middle" fill="white" font-size="11" font-weight="700">5</text>
                        </g>

                        <g class="node">
                            <rect x="520" y="525" width="240" height="60" rx="10" fill="rgba(168,85,247,0.2)" stroke="#a855f7" stroke-width="2"/>
                            <text x="550" y="550" text-anchor="start" font-weight="600" fill="#c084fc" font-size="11">PoliceWorkflow</text>
                            <text x="550" y="568" text-anchor="start" fill="#e9d5ff" font-size="8">police_workflow.py</text>
                            <circle cx="730" cy="555" r="18" fill="#a855f7"/>
                            <text x="730" y="561" text-anchor="middle" fill="white" font-size="11" font-weight="700">4</text>
                        </g>

                        <!-- COLONNE 4: MODULES (Droite) -->
                        <g class="node">
                            <rect x="880" y="150" width="270" height="60" rx="10" fill="rgba(251,191,36,0.15)" stroke="#fbbf24" stroke-width="2"/>
                            <text x="1015" y="175" text-anchor="middle" fill="#fbbf24" font-size="12" font-weight="600">MAJ FT/BT</text>
                            <text x="1015" y="193" text-anchor="middle" fill="#fcd34d" font-size="9">Maj_Ft_Bt.py (462 lignes)</text>
                        </g>

                        <g class="node">
                            <rect x="880" y="225" width="270" height="60" rx="10" fill="rgba(52,211,153,0.15)" stroke="#34d399" stroke-width="2"/>
                            <text x="1015" y="250" text-anchor="middle" fill="#34d399" font-size="12" font-weight="600">CAP_FT</text>
                            <text x="1015" y="268" text-anchor="middle" fill="#6ee7b7" font-size="9">CapFt.py (237 lignes)</text>
                        </g>

                        <g class="node">
                            <rect x="880" y="300" width="270" height="60" rx="10" fill="rgba(59,130,246,0.15)" stroke="#3b82f6" stroke-width="2"/>
                            <text x="1015" y="325" text-anchor="middle" fill="#60a5fa" font-size="12" font-weight="600">COMAC</text>
                            <text x="1015" y="343" text-anchor="middle" fill="#93c5fd" font-size="9">Comac.py (595 lignes)</text>
                        </g>

                        <g class="node">
                            <rect x="880" y="375" width="270" height="60" rx="10" fill="rgba(236,72,153,0.15)" stroke="#ec4899" stroke-width="2"/>
                            <text x="1015" y="400" text-anchor="middle" fill="#f472b6" font-size="12" font-weight="600">C6 vs BD</text>
                            <text x="1015" y="418" text-anchor="middle" fill="#f9a8d4" font-size="9">C6_vs_Bd.py (164 lignes)</text>
                        </g>

                        <g class="node">
                            <rect x="880" y="450" width="270" height="60" rx="10" fill="rgba(139,92,246,0.15)" stroke="#8b5cf6" stroke-width="2"/>
                            <text x="1015" y="475" text-anchor="middle" fill="#a78bfa" font-size="12" font-weight="600">C6/C3A/C7/BD</text>
                            <text x="1015" y="493" text-anchor="middle" fill="#c4b5fd" font-size="9">C6_vs_C3A_vs_Bd.py (386 lignes)</text>
                        </g>

                        <g class="node">
                            <rect x="880" y="525" width="270" height="60" rx="10" fill="rgba(168,85,247,0.15)" stroke="#a855f7" stroke-width="2"/>
                            <text x="1015" y="550" text-anchor="middle" fill="#c084fc" font-size="12" font-weight="600">Police C6</text>
                            <text x="1015" y="568" text-anchor="middle" fill="#e9d5ff" font-size="9">PoliceC6.py (790 lignes)</text>
                        </g>

                        <!-- COLONNE 1: INPUTS (Gauche) -->
                        <g class="node" filter="url(#glow-gold)">
                            <rect x="50" y="200" width="140" height="70" rx="12" fill="url(#grad-gold)" stroke="#fbbf24" stroke-width="2"/>
                            <text x="120" y="225" text-anchor="middle" font-weight="600" fill="#78350f" font-size="12">EXCEL</text>
                            <text x="120" y="245" text-anchor="middle" fill="#92400e" font-size="9">FT/BT, C6</text>
                            <text x="120" y="258" text-anchor="middle" fill="#a16207" font-size="9">C3A, C7</text>
                        </g>

                        <g class="node">
                            <rect x="50" y="290" width="140" height="70" rx="12" fill="url(#grad-emerald)" stroke="#34d399" stroke-width="2"/>
                            <text x="120" y="315" text-anchor="middle" font-weight="600" fill="#064e3b" font-size="12">QGIS</text>
                            <text x="120" y="335" text-anchor="middle" fill="#065f46" font-size="9">infra_pt_pot</text>
                            <text x="120" y="348" text-anchor="middle" fill="#047857" font-size="9">études</text>
                        </g>

                        <g class="node">
                            <rect x="50" y="380" width="140" height="70" rx="12" fill="rgba(99,102,241,0.8)" stroke="#818cf8" stroke-width="2"/>
                            <text x="120" y="405" text-anchor="middle" font-weight="600" fill="white" font-size="12">COMAC_DB</text>
                            <text x="120" y="425" text-anchor="middle" fill="#c7d2fe" font-size="9">comac.gpkg</text>
                            <text x="120" y="438" text-anchor="middle" fill="#a5b4fc" font-size="9">463 câbles</text>
                        </g>


                        <!-- UI Dialog (Haut) -->
                        <g class="node">
                            <rect x="270" y="150" width="160" height="80" rx="16" fill="url(#grad-violet)" stroke="#a78bfa" stroke-width="2"/>
                            <text x="350" y="180" text-anchor="middle" font-weight="600" fill="white" font-size="13">INTERFACE UI</text>
                            <text x="350" y="198" text-anchor="middle" fill="#ddd6fe" font-size="10">PoleAerienDialog</text>
                            <text x="350" y="215" text-anchor="middle" fill="#c4b5fd" font-size="9">6 onglets</text>
                        </g>
                        <path d="M 350 230 L 350 280" stroke="#a78bfa" stroke-width="2" fill="none" marker-end="url(#arrow-neon)" opacity="0.7"/>

                        <!-- CONNEXIONS: Inputs → CORE (simples flèches) -->
                        <path d="M 190 235 L 270 320" stroke="#fbbf24" stroke-width="2" fill="none" opacity="0.4" stroke-dasharray="4 2"/>
                        <path d="M 190 325 L 270 340" stroke="#34d399" stroke-width="2" fill="none" opacity="0.4" stroke-dasharray="4 2"/>
                        <path d="M 190 415 L 270 380" stroke="#818cf8" stroke-width="2" fill="none" opacity="0.4" stroke-dasharray="4 2"/>

                        <!-- CONNEXIONS: CORE → Workflows (flèches horizontales) -->
                        <path d="M 430 310 L 520 180" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-neon)" opacity="0.6" class="flow-arrow"/>
                        <path d="M 430 330 L 520 255" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-neon)" opacity="0.6" class="flow-arrow"/>
                        <path d="M 430 350 L 520 330" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-neon)" opacity="0.6" class="flow-arrow"/>
                        <path d="M 430 370 L 520 405" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-neon)" opacity="0.6" class="flow-arrow"/>
                        <path d="M 430 390 L 520 480" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-neon)" opacity="0.6" class="flow-arrow"/>
                        <path d="M 430 410 L 520 555" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-neon)" opacity="0.6" class="flow-arrow"/>

                        <!-- CONNEXIONS: Workflows → Modules (flèches horizontales directes) -->
                        <path d="M 760 180 L 880 180" stroke="#fbbf24" stroke-width="2.5" fill="none" marker-end="url(#arrow-neon)" opacity="0.8" class="flow-arrow"/>
                        <path d="M 760 255 L 880 255" stroke="#34d399" stroke-width="2.5" fill="none" marker-end="url(#arrow-neon)" opacity="0.8" class="flow-arrow"/>
                        <path d="M 760 330 L 880 330" stroke="#3b82f6" stroke-width="2.5" fill="none" marker-end="url(#arrow-neon)" opacity="0.8" class="flow-arrow"/>
                        <path d="M 760 405 L 880 405" stroke="#ec4899" stroke-width="2.5" fill="none" marker-end="url(#arrow-neon)" opacity="0.8" class="flow-arrow"/>
                        <path d="M 760 480 L 880 480" stroke="#8b5cf6" stroke-width="2.5" fill="none" marker-end="url(#arrow-neon)" opacity="0.8" class="flow-arrow"/>
                        <path d="M 760 555 L 880 555" stroke="#a855f7" stroke-width="2.5" fill="none" marker-end="url(#arrow-neon)" opacity="0.8" class="flow-arrow"/>

                        <!-- Flow Direction Legend (Bottom) -->
                        <g>
                            <rect x="350" y="620" width="500" height="50" rx="12" fill="rgba(255,255,255,0.05)" stroke="rgba(255,255,255,0.15)" stroke-width="1"/>
                            <text x="600" y="640" text-anchor="middle" fill="#94a3b8" font-size="11" font-weight="600">FLUX DE DONNÉES</text>
                            <path d="M 380 655 L 480 655" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-neon)"/>
                            <text x="430" y="650" text-anchor="middle" fill="#60a5fa" font-size="9">Inputs</text>
                            <path d="M 510 655 L 610 655" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-neon)"/>
                            <text x="560" y="650" text-anchor="middle" fill="#60a5fa" font-size="9">Core</text>
                            <path d="M 640 655 L 740 655" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-neon)"/>
                            <text x="690" y="650" text-anchor="middle" fill="#60a5fa" font-size="9">Workflows</text>
                            <path d="M 770 655 L 820 655" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrow-neon)"/>
                            <text x="795" y="650" text-anchor="middle" fill="#60a5fa" font-size="9">Modules</text>
                        </g>

                        <!-- Version badge -->
                        <g>
                            <rect x="1030" y="620" width="120" height="35" rx="17" fill="rgba(16,185,129,0.2)" stroke="#10b981" stroke-width="1"/>
                            <text x="1090" y="642" text-anchor="middle" fill="#34d399" font-size="11" font-weight="600">v2.3.0</text>
                        </g>
                    </svg>

                    <div class="legend" style="border-top-color: rgba(255,255,255,0.1);">
                        <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #fbbf24, #f59e0b);"></div><span style="color: #94a3b8;">Inputs (Excel, QGIS, DB)</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);"></div><span style="color: #94a3b8;">Core Orchestrateur</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #a78bfa, #7c3aed);"></div><span style="color: #94a3b8;">Workflows (6)</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #34d399, #10b981);"></div><span style="color: #94a3b8;">Modules Métier (6)</span></div>
                    </div>
                </div>
            </div>

            <!-- Data Flow Diagram - Style Pipeline Moderne -->
            <div id="diagram-dataflow" class="diagram-panel">
                <div class="diagram-container" style="background: linear-gradient(180deg, #f8fafc 0%, #e2e8f0 100%);">
                    <h3 class="diagram-title">Pipeline de traitement - Flux de données (Architecture Workflows)</h3>
                    <svg class="architecture-svg" viewBox="0 0 1100 600" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="pipe-grad" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:0.3" />
                                <stop offset="50%" style="stop-color:#8b5cf6;stop-opacity:0.3" />
                                <stop offset="100%" style="stop-color:#10b981;stop-opacity:0.3" />
                            </linearGradient>
                            <filter id="card-shadow" x="-10%" y="-10%" width="120%" height="130%">
                                <feDropShadow dx="0" dy="4" stdDeviation="8" flood-opacity="0.15"/>
                            </filter>
                            <marker id="pipe-arrow" markerWidth="15" markerHeight="10" refX="12" refY="5" orient="auto">
                                <path d="M 0 0 L 15 5 L 0 10 L 4 5 Z" fill="#3b82f6"/>
                            </marker>
                        </defs>

                        <!-- Pipeline principal (tube) -->
                        <rect x="80" y="280" width="940" height="60" rx="30" fill="url(#pipe-grad)" stroke="#94a3b8" stroke-width="2" stroke-dasharray="8 4"/>
                        
                        <!-- Workflow Layer (bande supérieure) -->
                        <rect x="80" y="200" width="940" height="50" rx="25" fill="rgba(59,130,246,0.15)" stroke="#3b82f6" stroke-width="2" stroke-dasharray="4 2"/>
                        <text x="550" y="230" text-anchor="middle" fill="#1e40af" font-size="12" font-weight="600">COUCHE WORKFLOWS (Orchestration Async)</text>
                        
                        <!-- Cercles de progression -->
                        <circle cx="180" cy="310" r="25" fill="white" stroke="#f59e0b" stroke-width="3"/>
                        <text x="180" y="315" text-anchor="middle" fill="#f59e0b" font-size="14" font-weight="700">1</text>
                        
                        <circle cx="350" cy="310" r="25" fill="white" stroke="#8b5cf6" stroke-width="3"/>
                        <text x="350" y="315" text-anchor="middle" fill="#8b5cf6" font-size="14" font-weight="700">2</text>
                        
                        <circle cx="550" cy="310" r="25" fill="white" stroke="#3b82f6" stroke-width="3"/>
                        <text x="550" y="315" text-anchor="middle" fill="#3b82f6" font-size="14" font-weight="700">3</text>
                        
                        <circle cx="750" cy="310" r="25" fill="white" stroke="#10b981" stroke-width="3"/>
                        <text x="750" y="315" text-anchor="middle" fill="#10b981" font-size="14" font-weight="700">4</text>
                        
                        <circle cx="920" cy="310" r="25" fill="white" stroke="#059669" stroke-width="3"/>
                        <text x="920" y="315" text-anchor="middle" fill="#059669" font-size="14" font-weight="700">5</text>

                        <!-- Workflow nodes (sur la bande) -->
                        <circle cx="350" cy="225" r="20" fill="#8b5cf6" opacity="0.8"/>
                        <text x="350" y="230" text-anchor="middle" fill="white" font-size="9" font-weight="600">WF</text>
                        
                        <circle cx="550" cy="225" r="20" fill="#3b82f6" opacity="0.8"/>
                        <text x="550" y="230" text-anchor="middle" fill="white" font-size="9" font-weight="600">WF</text>
                        
                        <circle cx="750" cy="225" r="20" fill="#10b981" opacity="0.8"/>
                        <text x="750" y="230" text-anchor="middle" fill="white" font-size="9" font-weight="600">WF</text>

                        <!-- Flèches entre étapes -->
                        <path d="M 205 310 L 320 310" stroke="#3b82f6" stroke-width="3" fill="none" marker-end="url(#pipe-arrow)" class="flow-arrow"/>
                        <path d="M 375 310 L 520 310" stroke="#3b82f6" stroke-width="3" fill="none" marker-end="url(#pipe-arrow)" class="flow-arrow"/>
                        <path d="M 575 310 L 720 310" stroke="#3b82f6" stroke-width="3" fill="none" marker-end="url(#pipe-arrow)" class="flow-arrow"/>
                        <path d="M 775 310 L 890 310" stroke="#3b82f6" stroke-width="3" fill="none" marker-end="url(#pipe-arrow)" class="flow-arrow"/>
                        
                        <!-- Connexions vers workflows -->
                        <path d="M 350 285 L 350 245" stroke="#8b5cf6" stroke-width="2" fill="none" opacity="0.6" stroke-dasharray="3 2"/>
                        <path d="M 550 285 L 550 245" stroke="#3b82f6" stroke-width="2" fill="none" opacity="0.6" stroke-dasharray="3 2"/>
                        <path d="M 750 285 L 750 245" stroke="#10b981" stroke-width="2" fill="none" opacity="0.6" stroke-dasharray="3 2"/>

                        <!-- ÉTAPE 1: Excel -->
                        <g class="node" filter="url(#card-shadow)">
                            <rect x="100" y="60" width="160" height="150" rx="16" fill="white" stroke="#f59e0b" stroke-width="2"/>
                            <rect x="100" y="60" width="160" height="40" rx="16" fill="linear-gradient(90deg, #fbbf24, #f59e0b)"/>
                            <rect x="100" y="85" width="160" height="15" fill="#fbbf24"/>
                            <text x="180" y="85" text-anchor="middle" fill="white" font-size="12" font-weight="700">SOURCE</text>
                            <svg x="140" y="115" width="80" height="50" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="1.5">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/>
                            </svg>
                            <text x="180" y="175" text-anchor="middle" fill="#92400e" font-size="11" font-weight="600">Excel FT/BT KO</text>
                            <text x="180" y="192" text-anchor="middle" fill="#a16207" font-size="9">.xlsx</text>
                        </g>

                        <!-- ÉTAPE 2: Lecture + Workflow -->
                        <g class="node" filter="url(#card-shadow)">
                            <rect x="270" y="60" width="160" height="150" rx="16" fill="white" stroke="#8b5cf6" stroke-width="2"/>
                            <rect x="270" y="60" width="160" height="40" rx="16" fill="linear-gradient(90deg, #a78bfa, #8b5cf6)"/>
                            <rect x="270" y="85" width="160" height="15" fill="#a78bfa"/>
                            <text x="350" y="85" text-anchor="middle" fill="white" font-size="12" font-weight="700">WORKFLOW</text>
                            <svg x="310" y="115" width="80" height="50" viewBox="0 0 24 24" fill="none" stroke="#8b5cf6" stroke-width="1.5">
                                <circle cx="12" cy="12" r="3"/>
                                <path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"/>
                            </svg>
                            <text x="350" y="175" text-anchor="middle" fill="#5b21b6" font-size="11" font-weight="600">MajWorkflow</text>
                            <text x="350" y="192" text-anchor="middle" fill="#7c3aed" font-size="9">Async Task</text>
                        </g>

                        <!-- ÉTAPE 3: Match -->
                        <g class="node" filter="url(#card-shadow)">
                            <rect x="470" y="60" width="160" height="150" rx="16" fill="white" stroke="#3b82f6" stroke-width="2"/>
                            <rect x="470" y="60" width="160" height="40" rx="16" fill="linear-gradient(90deg, #60a5fa, #3b82f6)"/>
                            <rect x="470" y="85" width="160" height="15" fill="#60a5fa"/>
                            <text x="550" y="85" text-anchor="middle" fill="white" font-size="12" font-weight="700">CORRESPONDANCE</text>
                            <svg x="510" y="115" width="80" height="50" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="1.5">
                                <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
                            </svg>
                            <text x="550" y="175" text-anchor="middle" fill="#1e40af" font-size="11" font-weight="600">N° appui + Études</text>
                            <text x="550" y="192" text-anchor="middle" fill="#2563eb" font-size="9">Clé composite</text>
                        </g>

                        <!-- ÉTAPE 4: Update -->
                        <g class="node" filter="url(#card-shadow)">
                            <rect x="670" y="60" width="160" height="150" rx="16" fill="white" stroke="#10b981" stroke-width="2"/>
                            <rect x="670" y="60" width="160" height="40" rx="16" fill="linear-gradient(90deg, #34d399, #10b981)"/>
                            <rect x="670" y="85" width="160" height="15" fill="#34d399"/>
                            <text x="750" y="85" text-anchor="middle" fill="white" font-size="12" font-weight="700">MODIFICATION</text>
                            <svg x="710" y="115" width="80" height="50" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="1.5">
                                <path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
                            </svg>
                            <text x="750" y="175" text-anchor="middle" fill="#065f46" font-size="11" font-weight="600">Maj_Ft_Bt.py</text>
                            <text x="750" y="192" text-anchor="middle" fill="#047857" font-size="9">6 attributs</text>
                        </g>

                        <!-- ÉTAPE 5: Résultat -->
                        <g class="node" filter="url(#card-shadow)">
                            <rect x="840" y="60" width="160" height="150" rx="16" fill="white" stroke="#059669" stroke-width="2"/>
                            <rect x="840" y="60" width="160" height="40" rx="16" fill="linear-gradient(90deg, #10b981, #059669)"/>
                            <rect x="840" y="85" width="160" height="15" fill="#10b981"/>
                            <text x="920" y="85" text-anchor="middle" fill="white" font-size="12" font-weight="700">RÉSULTAT</text>
                            <svg x="880" y="115" width="80" height="50" viewBox="0 0 24 24" fill="none" stroke="#059669" stroke-width="1.5">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                <polyline points="22 4 12 14.01 9 11.01"/>
                            </svg>
                            <text x="920" y="175" text-anchor="middle" fill="#064e3b" font-size="11" font-weight="600">infra_pt_pot</text>
                            <text x="920" y="192" text-anchor="middle" fill="#047857" font-size="9">Modifié</text>
                        </g>

                        <!-- Couche QGIS (bas) -->
                        <g class="node" filter="url(#card-shadow)">
                            <rect x="470" y="380" width="160" height="90" rx="12" fill="white" stroke="#10b981" stroke-width="2"/>
                            <circle cx="550" cy="410" r="20" fill="#d1fae5" stroke="#10b981" stroke-width="2"/>
                            <svg x="538" y="398" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
                                <polygon points="12 2 2 7 12 12 22 7 12 2"/>
                                <polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/>
                            </svg>
                            <text x="550" y="450" text-anchor="middle" fill="#065f46" font-size="11" font-weight="600">Couche QGIS</text>
                            <text x="550" y="465" text-anchor="middle" fill="#047857" font-size="9">infra_pt_pot source</text>
                        </g>
                        <path d="M 550 380 L 550 340" stroke="#10b981" stroke-width="2" fill="none" marker-end="url(#pipe-arrow)"/>

                        <!-- Études (haut droite) -->
                        <g class="node" filter="url(#card-shadow)">
                            <rect x="870" y="350" width="120" height="80" rx="12" fill="white" stroke="#ec4899" stroke-width="2"/>
                            <text x="930" y="380" text-anchor="middle" fill="#9d174d" font-size="11" font-weight="600">Filtrage spatial</text>
                            <text x="930" y="400" text-anchor="middle" fill="#be185d" font-size="9">etude_cap_ft</text>
                            <text x="930" y="415" text-anchor="middle" fill="#be185d" font-size="9">etude_comac</text>
                        </g>

                        <!-- Box champs modifiés -->
                        <g filter="url(#card-shadow)">
                            <rect x="60" y="350" width="280" height="140" rx="12" fill="white" stroke="#e2e8f0" stroke-width="1"/>
                            <rect x="60" y="350" width="280" height="30" rx="12" fill="#f1f5f9"/>
                            <rect x="60" y="365" width="280" height="15" fill="#f1f5f9"/>
                            <text x="200" y="372" text-anchor="middle" fill="#475569" font-size="11" font-weight="600">Champs modifiés (8)</text>
                            
                            <text x="80" y="400" fill="#64748b" font-size="9">inf_type</text>
                            <text x="160" y="400" fill="#10b981" font-size="9" font-weight="500">POT-AC</text>
                            
                            <text x="80" y="418" fill="#64748b" font-size="9">inf_propri</text>
                            <text x="160" y="418" fill="#10b981" font-size="9" font-weight="500">RAUV</text>
                            
                            <text x="80" y="436" fill="#64748b" font-size="9">noe_usage</text>
                            <text x="160" y="436" fill="#10b981" font-size="9" font-weight="500">DI</text>
                            
                            <text x="80" y="454" fill="#64748b" font-size="9">inf_mat</text>
                            <text x="160" y="454" fill="#10b981" font-size="9" font-weight="500">typ_po_mod</text>

                            <text x="220" y="400" fill="#64748b" font-size="9">etat</text>
                            <text x="280" y="400" fill="#10b981" font-size="9" font-weight="500">BT KO</text>
                            
                            <text x="220" y="418" fill="#64748b" font-size="9">dce</text>
                            <text x="280" y="418" fill="#10b981" font-size="9" font-weight="500">O</text>
                            
                            <text x="220" y="436" fill="#64748b" font-size="9">modifie_par</text>
                            <text x="280" y="436" fill="#94a3b8" font-size="9">user</text>
                            
                            <text x="220" y="454" fill="#64748b" font-size="9">date_modif</text>
                            <text x="280" y="454" fill="#94a3b8" font-size="9">timestamp</text>
                        </g>
                    </svg>

                    <div class="legend">
                        <div class="legend-item"><div class="legend-color" style="background: linear-gradient(90deg, #fbbf24, #f59e0b);"></div><span>Source Excel</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: linear-gradient(90deg, #a78bfa, #8b5cf6);"></div><span>Extraction</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: linear-gradient(90deg, #60a5fa, #3b82f6);"></div><span>Logique métier</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: linear-gradient(90deg, #34d399, #10b981);"></div><span>Résultat QGIS</span></div>
                    </div>
                </div>
            </div>

            <!-- Modules Detail Diagram - Style Constellation/Réseau -->
            <div id="diagram-modules" class="diagram-panel">
                <div class="diagram-container" style="background: radial-gradient(ellipse at center, #1e1b4b 0%, #0f172a 100%); border: none;">
                    <h3 class="diagram-title" style="color: white;">Constellation des modules</h3>
                    <svg class="architecture-svg" viewBox="0 0 1000 600" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <filter id="star-glow" x="-50%" y="-50%" width="200%" height="200%">
                                <feGaussianBlur stdDeviation="6" result="coloredBlur"/>
                                <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
                            </filter>
                            <radialGradient id="core-radial" cx="50%" cy="50%" r="50%">
                                <stop offset="0%" style="stop-color:#60a5fa;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#1e40af;stop-opacity:1" />
                            </radialGradient>
                            <linearGradient id="link-grad" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:0.8" />
                                <stop offset="100%" style="stop-color:#8b5cf6;stop-opacity:0.3" />
                            </linearGradient>
                        </defs>

                        <!-- Background stars -->
                        <circle cx="100" cy="80" r="1" fill="white" opacity="0.3"/>
                        <circle cx="200" cy="150" r="1.5" fill="white" opacity="0.4"/>
                        <circle cx="850" cy="100" r="1" fill="white" opacity="0.3"/>
                        <circle cx="920" cy="200" r="1.5" fill="white" opacity="0.5"/>
                        <circle cx="80" cy="450" r="1" fill="white" opacity="0.4"/>
                        <circle cx="950" cy="480" r="1.5" fill="white" opacity="0.3"/>
                        <circle cx="300" cy="50" r="1" fill="white" opacity="0.5"/>
                        <circle cx="700" cy="550" r="1" fill="white" opacity="0.4"/>

                        <!-- Orbit rings -->
                        <ellipse cx="500" cy="300" rx="130" ry="130" fill="none" stroke="rgba(59,130,246,0.2)" stroke-width="2"/>
                        <text x="500" y="165" text-anchor="middle" fill="#60a5fa" font-size="8" font-weight="600">WORKFLOWS</text>
                        <ellipse cx="500" cy="300" rx="240" ry="240" fill="none" stroke="rgba(99,102,241,0.15)" stroke-width="1"/>
                        <ellipse cx="500" cy="300" rx="320" ry="220" fill="none" stroke="rgba(99,102,241,0.1)" stroke-width="1" stroke-dasharray="8 4"/>

                        <!-- Connection lines: CORE → Workflows (inner orbit) -->
                        <path d="M 500 225 L 500 170" stroke="rgba(59,130,246,0.4)" stroke-width="1.5" opacity="0.6" stroke-dasharray="3 2"/>
                        <path d="M 560 260 L 605 230" stroke="rgba(59,130,246,0.4)" stroke-width="1.5" opacity="0.6" stroke-dasharray="3 2"/>
                        <path d="M 590 330 L 605 370" stroke="rgba(59,130,246,0.4)" stroke-width="1.5" opacity="0.6" stroke-dasharray="3 2"/>
                        <path d="M 500 375 L 500 430" stroke="rgba(59,130,246,0.4)" stroke-width="1.5" opacity="0.6" stroke-dasharray="3 2"/>
                        <path d="M 410 330 L 395 370" stroke="rgba(59,130,246,0.4)" stroke-width="1.5" opacity="0.6" stroke-dasharray="3 2"/>
                        <path d="M 440 260 L 395 230" stroke="rgba(59,130,246,0.4)" stroke-width="1.5" opacity="0.6" stroke-dasharray="3 2"/>
                        
                        <!-- Connection lines: Workflows → Modules (outer orbit) -->
                        <path d="M 500 170 L 180 150" stroke="url(#link-grad)" stroke-width="2" opacity="0.5" class="flow-arrow"/>
                        <path d="M 605 230 L 820 150" stroke="url(#link-grad)" stroke-width="2" opacity="0.5" class="flow-arrow"/>
                        <path d="M 605 370 L 820 450" stroke="url(#link-grad)" stroke-width="2" opacity="0.5" class="flow-arrow"/>
                        <path d="M 500 430 L 500 520" stroke="url(#link-grad)" stroke-width="2" opacity="0.5" class="flow-arrow"/>
                        <path d="M 395 370 L 180 450" stroke="url(#link-grad)" stroke-width="2" opacity="0.5" class="flow-arrow"/>
                        <path d="M 395 230 L 180 150" stroke="url(#link-grad)" stroke-width="1.5" opacity="0.4" class="flow-arrow" stroke-dasharray="4 2"/>
                        
                        <!-- Inter-module connections (dashed) -->
                        <path d="M 180 150 L 180 450" stroke="rgba(139,92,246,0.3)" stroke-width="1" stroke-dasharray="4 4"/>
                        <path d="M 820 150 L 820 450" stroke="rgba(139,92,246,0.3)" stroke-width="1" stroke-dasharray="4 4"/>
                        <path d="M 180 450 L 500 520" stroke="rgba(139,92,246,0.3)" stroke-width="1" stroke-dasharray="4 4"/>
                        <path d="M 820 450 L 500 520" stroke="rgba(139,92,246,0.3)" stroke-width="1" stroke-dasharray="4 4"/>

                        <!-- CORE - Central star -->
                        <g filter="url(#star-glow)">
                            <circle cx="500" cy="300" r="75" fill="url(#core-radial)" stroke="#60a5fa" stroke-width="3"/>
                            <circle cx="500" cy="300" r="55" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="1"/>
                            <text x="500" y="285" text-anchor="middle" font-weight="700" fill="white" font-size="16">CORE</text>
                            <text x="500" y="305" text-anchor="middle" fill="#bfdbfe" font-size="11">PoleAerien.py</text>
                            <text x="500" y="322" text-anchor="middle" fill="#93c5fd" font-size="9">Orchestrateur</text>
                        </g>

                        <!-- WORKFLOWS - Inner orbit satellites -->
                        <!-- Workflow 1: MajWorkflow (top) -->
                        <g class="node">
                            <circle cx="500" cy="170" r="28" fill="rgba(251,191,36,0.25)" stroke="#fbbf24" stroke-width="2"/>
                            <text x="500" y="173" text-anchor="middle" fill="#fbbf24" font-size="9" font-weight="600">Maj</text>
                            <text x="500" y="183" text-anchor="middle" fill="#fde68a" font-size="7">WF</text>
                        </g>

                        <!-- Workflow 2: CapFtWorkflow (top-right) -->
                        <g class="node">
                            <circle cx="605" cy="230" r="28" fill="rgba(52,211,153,0.25)" stroke="#34d399" stroke-width="2"/>
                            <text x="605" y="233" text-anchor="middle" fill="#34d399" font-size="9" font-weight="600">CapFt</text>
                            <text x="605" y="243" text-anchor="middle" fill="#a7f3d0" font-size="7">WF</text>
                        </g>

                        <!-- Workflow 3: ComacWorkflow (bottom-right) -->
                        <g class="node">
                            <circle cx="605" cy="370" r="28" fill="rgba(59,130,246,0.25)" stroke="#3b82f6" stroke-width="2"/>
                            <text x="605" y="373" text-anchor="middle" fill="#60a5fa" font-size="9" font-weight="600">Comac</text>
                            <text x="605" y="383" text-anchor="middle" fill="#bfdbfe" font-size="7">WF</text>
                        </g>

                        <!-- Workflow 4: C6BdWorkflow (bottom) -->
                        <g class="node">
                            <circle cx="500" cy="430" r="28" fill="rgba(236,72,153,0.25)" stroke="#ec4899" stroke-width="2"/>
                            <text x="500" y="433" text-anchor="middle" fill="#f472b6" font-size="9" font-weight="600">C6Bd</text>
                            <text x="500" y="443" text-anchor="middle" fill="#fbcfe8" font-size="7">WF</text>
                        </g>

                        <!-- Workflow 5: C6C3AWorkflow (bottom-left) -->
                        <g class="node">
                            <circle cx="395" cy="370" r="28" fill="rgba(139,92,246,0.25)" stroke="#8b5cf6" stroke-width="2"/>
                            <text x="395" y="373" text-anchor="middle" fill="#a78bfa" font-size="9" font-weight="600">C6C3A</text>
                            <text x="395" y="383" text-anchor="middle" fill="#ddd6fe" font-size="7">WF</text>
                        </g>

                        <!-- Workflow 6: PoliceWorkflow (top-left) -->
                        <g class="node">
                            <circle cx="395" cy="230" r="28" fill="rgba(168,85,247,0.25)" stroke="#a855f7" stroke-width="2"/>
                            <text x="395" y="233" text-anchor="middle" fill="#c084fc" font-size="9" font-weight="600">Police</text>
                            <text x="395" y="243" text-anchor="middle" fill="#e9d5ff" font-size="7">WF</text>
                        </g>

                        <!-- Module: MAJ FT/BT (Top Left) -->
                        <g class="node" filter="url(#star-glow)">
                            <circle cx="180" cy="150" r="55" fill="rgba(251,191,36,0.15)" stroke="#fbbf24" stroke-width="2"/>
                            <circle cx="180" cy="150" r="40" fill="rgba(251,191,36,0.3)" stroke="#f59e0b" stroke-width="1"/>
                            <text x="180" y="140" text-anchor="middle" font-weight="700" fill="#fbbf24" font-size="11">MAJ FT/BT</text>
                            <text x="180" y="158" text-anchor="middle" fill="#fcd34d" font-size="9">Maj_Ft_Bt.py</text>
                            <text x="180" y="173" text-anchor="middle" fill="#fde68a" font-size="8">462 lignes</text>
                        </g>
                        <!-- Badge onglet -->
                        <circle cx="220" cy="105" r="12" fill="#fbbf24"/>
                        <text x="220" y="109" text-anchor="middle" fill="#78350f" font-size="10" font-weight="700">0</text>

                        <!-- Module: CAP_FT (Top Right) -->
                        <g class="node" filter="url(#star-glow)">
                            <circle cx="820" cy="150" r="55" fill="rgba(52,211,153,0.15)" stroke="#34d399" stroke-width="2"/>
                            <circle cx="820" cy="150" r="40" fill="rgba(52,211,153,0.3)" stroke="#10b981" stroke-width="1"/>
                            <text x="820" y="140" text-anchor="middle" font-weight="700" fill="#34d399" font-size="11">CAP_FT</text>
                            <text x="820" y="158" text-anchor="middle" fill="#6ee7b7" font-size="9">CapFt.py</text>
                            <text x="820" y="173" text-anchor="middle" fill="#a7f3d0" font-size="8">237 lignes</text>
                        </g>
                        <circle cx="860" cy="105" r="12" fill="#34d399"/>
                        <text x="860" y="109" text-anchor="middle" fill="#064e3b" font-size="10" font-weight="700">2</text>

                        <!-- Module: COMAC (Bottom Left) -->
                        <g class="node" filter="url(#star-glow)">
                            <circle cx="180" cy="450" r="55" fill="rgba(59,130,246,0.15)" stroke="#3b82f6" stroke-width="2"/>
                            <circle cx="180" cy="450" r="40" fill="rgba(59,130,246,0.3)" stroke="#2563eb" stroke-width="1"/>
                            <text x="180" y="440" text-anchor="middle" font-weight="700" fill="#60a5fa" font-size="11">COMAC</text>
                            <text x="180" y="458" text-anchor="middle" fill="#93c5fd" font-size="9">Comac.py</text>
                            <text x="180" y="473" text-anchor="middle" fill="#bfdbfe" font-size="8">595 lignes</text>
                        </g>
                        <circle cx="220" cy="405" r="12" fill="#3b82f6"/>
                        <text x="220" y="409" text-anchor="middle" fill="white" font-size="10" font-weight="700">3</text>

                        <!-- Module: C6 vs BD (Bottom Right) -->
                        <g class="node" filter="url(#star-glow)">
                            <circle cx="820" cy="450" r="55" fill="rgba(236,72,153,0.15)" stroke="#ec4899" stroke-width="2"/>
                            <circle cx="820" cy="450" r="40" fill="rgba(236,72,153,0.3)" stroke="#db2777" stroke-width="1"/>
                            <text x="820" y="440" text-anchor="middle" font-weight="700" fill="#f472b6" font-size="11">C6 vs BD</text>
                            <text x="820" y="458" text-anchor="middle" fill="#f9a8d4" font-size="9">C6_vs_Bd.py</text>
                            <text x="820" y="473" text-anchor="middle" fill="#fbcfe8" font-size="8">164 lignes</text>
                        </g>
                        <circle cx="860" cy="405" r="12" fill="#ec4899"/>
                        <text x="860" y="409" text-anchor="middle" fill="white" font-size="10" font-weight="700">1</text>

                        <!-- Module: Police C6 (Bottom Center) -->
                        <g class="node" filter="url(#star-glow)">
                            <circle cx="500" cy="520" r="55" fill="rgba(139,92,246,0.15)" stroke="#8b5cf6" stroke-width="2"/>
                            <circle cx="500" cy="520" r="40" fill="rgba(139,92,246,0.3)" stroke="#7c3aed" stroke-width="1"/>
                            <text x="500" y="510" text-anchor="middle" font-weight="700" fill="#a78bfa" font-size="11">Police C6</text>
                            <text x="500" y="528" text-anchor="middle" fill="#c4b5fd" font-size="9">PoliceC6.py</text>
                            <text x="500" y="543" text-anchor="middle" fill="#ddd6fe" font-size="8">790 lignes</text>
                        </g>
                        <circle cx="540" cy="475" r="12" fill="#8b5cf6"/>
                        <text x="540" y="479" text-anchor="middle" fill="white" font-size="10" font-weight="700">4</text>

                        <!-- Support modules (petites étoiles) -->
                        <g class="node">
                            <circle cx="350" cy="120" r="25" fill="rgba(220,38,38,0.2)" stroke="#ef4444" stroke-width="1"/>
                            <text x="350" y="117" text-anchor="middle" fill="#fca5a5" font-size="8" font-weight="600">security</text>
                            <text x="350" y="128" text-anchor="middle" fill="#fecaca" font-size="7">_rules</text>
                        </g>
                        <path d="M 350 145 L 420 250" stroke="rgba(239,68,68,0.4)" stroke-width="1" stroke-dasharray="3 3"/>

                        <g class="node">
                            <circle cx="650" cy="120" r="25" fill="rgba(6,182,212,0.2)" stroke="#06b6d4" stroke-width="1"/>
                            <text x="650" y="117" text-anchor="middle" fill="#67e8f9" font-size="8" font-weight="600">comac</text>
                            <text x="650" y="128" text-anchor="middle" fill="#a5f3fc" font-size="7">_loader</text>
                        </g>
                        <path d="M 650 145 L 580 250" stroke="rgba(6,182,212,0.4)" stroke-width="1" stroke-dasharray="3 3"/>

                        <g class="node">
                            <circle cx="320" cy="480" r="25" fill="rgba(245,158,11,0.2)" stroke="#f59e0b" stroke-width="1"/>
                            <text x="320" y="477" text-anchor="middle" fill="#fcd34d" font-size="8" font-weight="600">pcm</text>
                            <text x="320" y="488" text-anchor="middle" fill="#fde68a" font-size="7">_parser</text>
                        </g>
                        <path d="M 320 455 L 425 350" stroke="rgba(245,158,11,0.4)" stroke-width="1" stroke-dasharray="3 3"/>

                        <g class="node">
                            <circle cx="680" cy="480" r="25" fill="rgba(16,185,129,0.2)" stroke="#10b981" stroke-width="1"/>
                            <text x="680" y="477" text-anchor="middle" fill="#6ee7b7" font-size="8" font-weight="600">comac</text>
                            <text x="680" y="488" text-anchor="middle" fill="#a7f3d0" font-size="7">_db_reader</text>
                        </g>
                        <path d="M 680 455 L 575 350" stroke="rgba(16,185,129,0.4)" stroke-width="1" stroke-dasharray="3 3"/>

                        <!-- Stats panel -->
                        <g>
                            <rect x="40" y="30" width="150" height="90" rx="8" fill="rgba(255,255,255,0.05)" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
                            <text x="115" y="50" text-anchor="middle" fill="#94a3b8" font-size="9" font-weight="600">ARCHITECTURE v2.3.0</text>
                            <text x="60" y="70" fill="#64748b" font-size="8">Workflows:</text>
                            <text x="160" y="70" text-anchor="end" fill="#60a5fa" font-size="10" font-weight="600">6</text>
                            <text x="60" y="86" fill="#64748b" font-size="8">Modules:</text>
                            <text x="160" y="86" text-anchor="end" fill="#60a5fa" font-size="10" font-weight="600">6</text>
                            <text x="60" y="102" fill="#64748b" font-size="8">Lignes métier:</text>
                            <text x="160" y="102" text-anchor="end" fill="#60a5fa" font-size="10" font-weight="600">2634</text>
                        </g>
                    </svg>

                    <div class="legend" style="border-top-color: rgba(255,255,255,0.1);">
                        <div class="legend-item"><div class="legend-color" style="background: rgba(251,191,36,0.4); border: 2px solid #fbbf24;"></div><span style="color: #94a3b8;">MAJ FT/BT</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: rgba(52,211,153,0.4); border: 2px solid #34d399;"></div><span style="color: #94a3b8;">CAP_FT</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: rgba(59,130,246,0.4); border: 2px solid #3b82f6;"></div><span style="color: #94a3b8;">COMAC</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: rgba(236,72,153,0.4); border: 2px solid #ec4899;"></div><span style="color: #94a3b8;">C6 vs BD</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: rgba(139,92,246,0.4); border: 2px solid #8b5cf6;"></div><span style="color: #94a3b8;">Police C6</span></div>
                    </div>
                </div>
            </div>

            <!-- Security Verification Diagram - Style Dashboard/Monitoring -->
            <div id="diagram-security" class="diagram-panel">
                <div class="diagram-container" style="background: linear-gradient(135deg, #450a0a 0%, #1c1917 50%, #0c0a09 100%); border: none;">
                    <h3 class="diagram-title" style="color: white;">Dashboard Sécurité - NFC 11201-A1</h3>
                    <svg class="architecture-svg" viewBox="0 0 1000 620" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="danger-grad" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#ef4444;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#dc2626;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="success-grad" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#22c55e;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#16a34a;stop-opacity:1" />
                            </linearGradient>
                            <filter id="red-glow" x="-50%" y="-50%" width="200%" height="200%">
                                <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
                                <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
                            </filter>
                            <marker id="arrow-danger" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#ef4444"/>
                            </marker>
                        </defs>

                        <!-- Background grid -->
                        <pattern id="sec-grid" width="30" height="30" patternUnits="userSpaceOnUse">
                            <path d="M 30 0 L 0 0 0 30" fill="none" stroke="rgba(239,68,68,0.05)" stroke-width="1"/>
                        </pattern>
                        <rect width="1000" height="620" fill="url(#sec-grid)"/>

                        <!-- Header panel -->
                        <g>
                            <rect x="30" y="20" width="940" height="60" rx="12" fill="rgba(239,68,68,0.1)" stroke="rgba(239,68,68,0.3)" stroke-width="1"/>
                            <svg x="50" y="35" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                            </svg>
                            <text x="95" y="52" fill="#ef4444" font-size="16" font-weight="700">VÉRIFICATION SÉCURITÉ</text>
                            <text x="95" y="68" fill="#fca5a5" font-size="10">Module: security_rules.py | Norme: NFC 11201-A1</text>
                            
                            <!-- Status indicators -->
                            <rect x="750" y="32" width="100" height="36" rx="8" fill="rgba(34,197,94,0.2)" stroke="#22c55e" stroke-width="1"/>
                            <circle cx="770" cy="50" r="6" fill="#22c55e"/>
                            <text x="785" y="55" fill="#22c55e" font-size="11" font-weight="600">ACTIF</text>
                            
                            <rect x="860" y="32" width="100" height="36" rx="8" fill="rgba(239,68,68,0.2)" stroke="#ef4444" stroke-width="1"/>
                            <text x="875" y="48" fill="#fca5a5" font-size="9">Alertes:</text>
                            <text x="930" y="55" text-anchor="end" fill="#ef4444" font-size="14" font-weight="700">0</text>
                        </g>

                        <!-- Pipeline flow -->
                        <g>
                            <!-- Step 1: Input -->
                            <rect x="50" y="110" width="160" height="140" rx="12" fill="rgba(251,191,36,0.1)" stroke="#fbbf24" stroke-width="2"/>
                            <rect x="50" y="110" width="160" height="35" rx="12" fill="rgba(251,191,36,0.3)"/>
                            <rect x="50" y="130" width="160" height="15" fill="rgba(251,191,36,0.2)"/>
                            <text x="130" y="132" text-anchor="middle" fill="#fbbf24" font-size="11" font-weight="700">ENTRÉE</text>
                            <svg x="100" y="155" width="60" height="40" viewBox="0 0 24 24" fill="none" stroke="#fbbf24" stroke-width="1.5">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                            </svg>
                            <text x="130" y="210" text-anchor="middle" fill="#fcd34d" font-size="10" font-weight="500">Excel COMAC</text>
                            <text x="130" y="225" text-anchor="middle" fill="#fde68a" font-size="8">Col A: N° poteau</text>
                            <text x="130" y="238" text-anchor="middle" fill="#fde68a" font-size="8">Col AO: Type câble FO</text>

                            <!-- Step 2: Extraction -->
                            <rect x="250" y="110" width="160" height="140" rx="12" fill="rgba(59,130,246,0.1)" stroke="#3b82f6" stroke-width="2"/>
                            <rect x="250" y="110" width="160" height="35" rx="12" fill="rgba(59,130,246,0.3)"/>
                            <rect x="250" y="130" width="160" height="15" fill="rgba(59,130,246,0.2)"/>
                            <text x="330" y="132" text-anchor="middle" fill="#60a5fa" font-size="11" font-weight="700">EXTRACTION</text>
                            <svg x="300" y="155" width="60" height="40" viewBox="0 0 24 24" fill="none" stroke="#60a5fa" stroke-width="1.5">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/>
                            </svg>
                            <text x="330" y="210" text-anchor="middle" fill="#93c5fd" font-size="10" font-weight="500">Comac.py</text>
                            <text x="330" y="225" text-anchor="middle" fill="#bfdbfe" font-size="8">Colonnes: 6, 40, 46</text>
                            <text x="330" y="238" text-anchor="middle" fill="#bfdbfe" font-size="8">portée, capacité_fo</text>

                            <!-- Step 3: Validation (CENTRAL) -->
                            <g filter="url(#red-glow)">
                                <rect x="450" y="100" width="180" height="160" rx="16" fill="rgba(239,68,68,0.15)" stroke="#ef4444" stroke-width="3"/>
                                <rect x="450" y="100" width="180" height="40" rx="16" fill="url(#danger-grad)"/>
                                <rect x="450" y="125" width="180" height="15" fill="rgba(239,68,68,0.8)"/>
                                <svg x="465" y="105" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                                </svg>
                                <text x="540" y="122" text-anchor="middle" fill="white" font-size="12" font-weight="700">VALIDATION</text>
                                <text x="540" y="165" text-anchor="middle" fill="#fca5a5" font-size="10" font-weight="600">security_rules.py</text>
                                <text x="540" y="185" text-anchor="middle" fill="#fecaca" font-size="9">PORTEES_MAX</text>
                                <text x="540" y="200" text-anchor="middle" fill="#fecaca" font-size="9">CODES_PRYSMIAN</text>
                                <text x="540" y="215" text-anchor="middle" fill="#fecaca" font-size="9">verifier_portee()</text>
                                <text x="540" y="245" text-anchor="middle" fill="#ef4444" font-size="8" font-weight="600">NFC 11201-A1</text>
                            </g>

                            <!-- Step 4: Results -->
                            <rect x="670" y="110" width="160" height="140" rx="12" fill="rgba(139,92,246,0.1)" stroke="#8b5cf6" stroke-width="2"/>
                            <rect x="670" y="110" width="160" height="35" rx="12" fill="rgba(139,92,246,0.3)"/>
                            <rect x="670" y="130" width="160" height="15" fill="rgba(139,92,246,0.2)"/>
                            <text x="750" y="132" text-anchor="middle" fill="#a78bfa" font-size="11" font-weight="700">RÉSULTATS</text>
                            <svg x="720" y="155" width="60" height="40" viewBox="0 0 24 24" fill="none" stroke="#a78bfa" stroke-width="1.5">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                <polyline points="22 4 12 14.01 9 11.01"/>
                            </svg>
                            <text x="750" y="210" text-anchor="middle" fill="#c4b5fd" font-size="10" font-weight="500">dico_verif_secu</text>
                            <text x="750" y="225" text-anchor="middle" fill="#ddd6fe" font-size="8">capacité_fo: 24FO</text>
                            <text x="750" y="238" text-anchor="middle" fill="#ddd6fe" font-size="8">valide: OK/KO</text>

                            <!-- Step 5: Export -->
                            <rect x="870" y="110" width="100" height="140" rx="12" fill="rgba(34,197,94,0.1)" stroke="#22c55e" stroke-width="2"/>
                            <rect x="870" y="110" width="100" height="35" rx="12" fill="rgba(34,197,94,0.3)"/>
                            <rect x="870" y="130" width="100" height="15" fill="rgba(34,197,94,0.2)"/>
                            <text x="920" y="132" text-anchor="middle" fill="#22c55e" font-size="11" font-weight="700">EXPORT</text>
                            <svg x="895" y="155" width="50" height="40" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="1.5">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                            <text x="920" y="210" text-anchor="middle" fill="#86efac" font-size="10" font-weight="500">Feuille</text>
                            <text x="920" y="225" text-anchor="middle" fill="#bbf7d0" font-size="9">VERIF_</text>
                            <text x="920" y="238" text-anchor="middle" fill="#bbf7d0" font-size="9">SECURITE</text>
                        </g>

                        <!-- Flow arrows -->
                        <path d="M 210 180 L 245 180" stroke="#fbbf24" stroke-width="2" fill="none" marker-end="url(#arrow-danger)" class="flow-arrow"/>
                        <path d="M 410 180 L 445 180" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrow-danger)" class="flow-arrow"/>
                        <path d="M 630 180 L 665 180" stroke="#ef4444" stroke-width="3" fill="none" marker-end="url(#arrow-danger)" class="flow-arrow"/>
                        <path d="M 830 180 L 865 180" stroke="#8b5cf6" stroke-width="2" fill="none" marker-end="url(#arrow-danger)" class="flow-arrow"/>

                        <!-- Zone climatique panel -->
                        <g>
                            <rect x="50" y="280" width="180" height="120" rx="12" fill="rgba(251,191,36,0.1)" stroke="#fbbf24" stroke-width="1"/>
                            <text x="140" y="305" text-anchor="middle" fill="#fbbf24" font-size="11" font-weight="700">ZONE CLIMATIQUE</text>
                            
                            <rect x="70" y="320" width="140" height="30" rx="6" fill="rgba(59,130,246,0.2)" stroke="#3b82f6" stroke-width="1"/>
                            <circle cx="90" cy="335" r="8" fill="#3b82f6"/>
                            <text x="115" y="340" fill="#93c5fd" font-size="10" font-weight="600">ZVN - Vent Normal</text>
                            
                            <rect x="70" y="358" width="140" height="30" rx="6" fill="rgba(239,68,68,0.2)" stroke="#ef4444" stroke-width="1"/>
                            <circle cx="90" cy="373" r="8" fill="#ef4444"/>
                            <text x="115" y="378" fill="#fca5a5" font-size="10" font-weight="600">ZVF - Vent Fort</text>
                        </g>

                        <!-- Portées max table -->
                        <g>
                            <rect x="260" y="280" width="480" height="180" rx="12" fill="rgba(255,255,255,0.03)" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
                            <rect x="260" y="280" width="480" height="35" rx="12" fill="rgba(239,68,68,0.15)"/>
                            <rect x="260" y="300" width="480" height="15" fill="rgba(239,68,68,0.1)"/>
                            <text x="500" y="302" text-anchor="middle" fill="#ef4444" font-size="11" font-weight="700">PORTÉES MAXIMALES NFC 11201-A1 (mètres)</text>

                            <!-- Table headers -->
                            <text x="290" y="340" fill="#94a3b8" font-size="10" font-weight="600">Zone</text>
                            <text x="360" y="340" fill="#94a3b8" font-size="10" font-weight="500">6 FO</text>
                            <text x="420" y="340" fill="#94a3b8" font-size="10" font-weight="500">12 FO</text>
                            <text x="480" y="340" fill="#94a3b8" font-size="10" font-weight="500">24 FO</text>
                            <text x="540" y="340" fill="#94a3b8" font-size="10" font-weight="500">36 FO</text>
                            <text x="600" y="340" fill="#94a3b8" font-size="10" font-weight="500">48 FO</text>
                            <text x="660" y="340" fill="#94a3b8" font-size="10" font-weight="500">72 FO</text>
                            <text x="710" y="340" fill="#94a3b8" font-size="10" font-weight="500">96 FO</text>

                            <line x1="275" y1="350" x2="725" y2="350" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>

                            <!-- ZVN row -->
                            <rect x="275" y="355" width="450" height="35" rx="4" fill="rgba(59,130,246,0.1)"/>
                            <text x="290" y="378" fill="#60a5fa" font-size="10" font-weight="600">ZVN</text>
                            <text x="360" y="378" fill="#bfdbfe" font-size="10">81</text>
                            <text x="420" y="378" fill="#bfdbfe" font-size="10">77</text>
                            <text x="480" y="378" fill="#bfdbfe" font-size="10">73</text>
                            <text x="540" y="378" fill="#bfdbfe" font-size="10">74</text>
                            <text x="600" y="378" fill="#bfdbfe" font-size="10">78</text>
                            <text x="660" y="378" fill="#bfdbfe" font-size="10">77</text>
                            <text x="710" y="378" fill="#bfdbfe" font-size="10">76</text>

                            <!-- ZVF row -->
                            <rect x="275" y="395" width="450" height="35" rx="4" fill="rgba(239,68,68,0.1)"/>
                            <text x="290" y="418" fill="#ef4444" font-size="10" font-weight="600">ZVF</text>
                            <text x="360" y="418" fill="#fecaca" font-size="10">79</text>
                            <text x="420" y="418" fill="#fecaca" font-size="10">74</text>
                            <text x="480" y="418" fill="#fecaca" font-size="10">73</text>
                            <text x="540" y="418" fill="#fecaca" font-size="10">74</text>
                            <text x="600" y="418" fill="#fecaca" font-size="10">78</text>
                            <text x="660" y="418" fill="#fecaca" font-size="10">77</text>
                            <text x="710" y="418" fill="#fecaca" font-size="10">76</text>

                            <!-- Note -->
                            <text x="500" y="450" text-anchor="middle" fill="#64748b" font-size="9">Source: Norme NFC 11201-A1 - Portées maximales câbles FO aériens</text>
                        </g>

                        <!-- Câbles référencés -->
                        <g>
                            <rect x="770" y="280" width="200" height="180" rx="12" fill="rgba(255,255,255,0.03)" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
                            <rect x="770" y="280" width="200" height="35" rx="12" fill="rgba(34,197,94,0.15)"/>
                            <rect x="770" y="300" width="200" height="15" fill="rgba(34,197,94,0.1)"/>
                            <text x="870" y="302" text-anchor="middle" fill="#22c55e" font-size="11" font-weight="700">CÂBLES RÉFÉRENCÉS</text>
                            
                            <text x="790" y="335" fill="#64748b" font-size="9">CODES_PRYSMIAN:</text>
                            <text x="800" y="355" fill="#86efac" font-size="9">PCO-06-E1-A</text>
                            <text x="900" y="355" fill="#64748b" font-size="9">6 FO</text>
                            <text x="800" y="372" fill="#86efac" font-size="9">PCO-12-E1-A</text>
                            <text x="900" y="372" fill="#64748b" font-size="9">12 FO</text>
                            <text x="800" y="389" fill="#86efac" font-size="9">PCO-24-E1-A</text>
                            <text x="900" y="389" fill="#64748b" font-size="9">24 FO</text>
                            <text x="800" y="406" fill="#86efac" font-size="9">PCO-48-E1-A</text>
                            <text x="900" y="406" fill="#64748b" font-size="9">48 FO</text>
                            <text x="800" y="423" fill="#86efac" font-size="9">PCO-72-E1-A</text>
                            <text x="900" y="423" fill="#64748b" font-size="9">72 FO</text>
                            
                            <text x="870" y="450" text-anchor="middle" fill="#64748b" font-size="8">463 câbles référencés</text>
                        </g>

                        <!-- Stats footer -->
                        <g>
                            <rect x="50" y="480" width="220" height="60" rx="10" fill="rgba(239,68,68,0.1)" stroke="rgba(239,68,68,0.2)" stroke-width="1"/>
                            <text x="70" y="505" fill="#64748b" font-size="9">Fichier règles:</text>
                            <text x="230" y="505" text-anchor="end" fill="#ef4444" font-size="10" font-weight="600">security_rules.py</text>
                            <text x="70" y="525" fill="#64748b" font-size="9">Lignes de code:</text>
                            <text x="230" y="525" text-anchor="end" fill="#ef4444" font-size="10" font-weight="600">348</text>
                        </g>

                        <g>
                            <rect x="290" y="480" width="220" height="60" rx="10" fill="rgba(6,182,212,0.1)" stroke="rgba(6,182,212,0.2)" stroke-width="1"/>
                            <text x="310" y="505" fill="#64748b" font-size="9">Lecteur BD:</text>
                            <text x="470" y="505" text-anchor="end" fill="#06b6d4" font-size="10" font-weight="600">comac_db_reader.py</text>
                            <text x="310" y="525" fill="#64748b" font-size="9">Fichiers CSV:</text>
                            <text x="470" y="525" text-anchor="end" fill="#06b6d4" font-size="10" font-weight="600">12</text>
                        </g>

                        <g>
                            <rect x="530" y="480" width="220" height="60" rx="10" fill="rgba(245,158,11,0.1)" stroke="rgba(245,158,11,0.2)" stroke-width="1"/>
                            <text x="550" y="505" fill="#64748b" font-size="9">Parser PCM:</text>
                            <text x="710" y="505" text-anchor="end" fill="#f59e0b" font-size="10" font-weight="600">pcm_parser.py</text>
                            <text x="550" y="525" fill="#64748b" font-size="9">Format:</text>
                            <text x="710" y="525" text-anchor="end" fill="#f59e0b" font-size="10" font-weight="600">XML (.pcm)</text>
                        </g>

                        <g>
                            <rect x="770" y="480" width="200" height="60" rx="10" fill="rgba(34,197,94,0.1)" stroke="rgba(34,197,94,0.2)" stroke-width="1"/>
                            <text x="790" y="505" fill="#64748b" font-size="9">Export feuille:</text>
                            <text x="930" y="505" text-anchor="end" fill="#22c55e" font-size="10" font-weight="600">VERIF_SECURITE</text>
                            <text x="790" y="525" fill="#64748b" font-size="9">Format:</text>
                            <text x="930" y="525" text-anchor="end" fill="#22c55e" font-size="10" font-weight="600">.xlsx</text>
                        </g>
                    </svg>

                    <div class="legend" style="border-top-color: rgba(255,255,255,0.1);">
                        <div class="legend-item"><div class="legend-color" style="background: rgba(251,191,36,0.4); border: 2px solid #fbbf24;"></div><span style="color: #94a3b8;">Entrée / Zone</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: rgba(239,68,68,0.4); border: 2px solid #ef4444;"></div><span style="color: #94a3b8;">Validation sécurité</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: rgba(139,92,246,0.4); border: 2px solid #8b5cf6;"></div><span style="color: #94a3b8;">Résultats</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: rgba(34,197,94,0.4); border: 2px solid #22c55e;"></div><span style="color: #94a3b8;">Export</span></div>
                    </div>
                </div>
            </div>

            <!-- DAG Imports Diagram -->
            <div id="diagram-dag" class="diagram-panel">
                <div class="diagram-container dag-container">
                    <h3 class="diagram-title">Graphe de Dependances (DAG) - Imports Python</h3>
                    <svg viewBox="0 0 1100 700" xmlns="http://www.w3.org/2000/svg" style="width: 100%; max-height: 720px;">
                        <defs>
                            <marker id="arrow-dag" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
                                <polygon points="0 0, 8 3, 0 6" fill="#10b981"/>
                            </marker>
                            <filter id="dag-glow" x="-20%" y="-20%" width="140%" height="140%">
                                <feGaussianBlur stdDeviation="2" result="blur"/>
                                <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
                            </filter>
                        </defs>
                        
                        <rect width="1100" height="700" fill="#f8fafc"/>
                        
                        <!-- Level 0: Entry Point -->
                        <g class="dag-node" filter="url(#dag-glow)">
                            <rect x="480" y="20" width="140" height="50" rx="8" fill="#3b82f6" stroke="#1d4ed8" stroke-width="2"/>
                            <text x="550" y="45" text-anchor="middle" fill="white" font-size="11" font-weight="700">__init__.py</text>
                            <text x="550" y="60" text-anchor="middle" fill="#bfdbfe" font-size="9">classFactory()</text>
                        </g>
                        
                        <!-- Arrow to PoleAerien -->
                        <path d="M 550 70 L 550 100" stroke="#10b981" stroke-width="2" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        
                        <!-- Level 1: Controller -->
                        <g class="dag-node" filter="url(#dag-glow)">
                            <rect x="450" y="100" width="200" height="60" rx="10" fill="#8b5cf6" stroke="#7c3aed" stroke-width="2"/>
                            <text x="550" y="125" text-anchor="middle" fill="white" font-size="12" font-weight="700">PoleAerien.py</text>
                            <text x="550" y="145" text-anchor="middle" fill="#ddd6fe" font-size="9">Controller - 2442 lignes</text>
                        </g>
                        
                        <!-- Arrows from PoleAerien to UI/Support -->
                        <path d="M 450 130 L 180 200" stroke="#10b981" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 480 160 L 350 200" stroke="#10b981" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 620 160 L 750 200" stroke="#10b981" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 650 130 L 920 200" stroke="#10b981" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        
                        <!-- Arrows from PoleAerien to Workflows -->
                        <path d="M 500 160 L 115 290" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 520 160 L 265 290" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 540 160 L 415 290" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 560 160 L 565 290" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 580 160 L 715 290" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 600 160 L 865 290" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        
                        <!-- Level 2A: Views & Support -->
                        <g class="dag-node">
                            <rect x="80" y="200" width="160" height="50" rx="8" fill="#a78bfa" stroke="#8b5cf6" stroke-width="1.5"/>
                            <text x="160" y="225" text-anchor="middle" fill="white" font-size="10" font-weight="600">Pole_Aerien_dialog.py</text>
                            <text x="160" y="240" text-anchor="middle" fill="#e9d5ff" font-size="8">Vue principale</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="280" y="200" width="130" height="50" rx="8" fill="#a78bfa" stroke="#8b5cf6" stroke-width="1.5"/>
                            <text x="345" y="225" text-anchor="middle" fill="white" font-size="10" font-weight="600">ui_state.py</text>
                            <text x="345" y="240" text-anchor="middle" fill="#e9d5ff" font-size="8">Etat UI</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="690" y="200" width="130" height="50" rx="8" fill="#60a5fa" stroke="#3b82f6" stroke-width="1.5"/>
                            <text x="755" y="225" text-anchor="middle" fill="white" font-size="10" font-weight="600">log_manager.py</text>
                            <text x="755" y="240" text-anchor="middle" fill="#bfdbfe" font-size="8">Logging</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="860" y="200" width="130" height="50" rx="8" fill="#60a5fa" stroke="#3b82f6" stroke-width="1.5"/>
                            <text x="925" y="225" text-anchor="middle" fill="white" font-size="10" font-weight="600">SecondFile.py</text>
                            <text x="925" y="240" text-anchor="middle" fill="#bfdbfe" font-size="8">Couches erreur</text>
                        </g>
                        
                        <!-- Level 2B: WORKFLOWS (nouvelle couche) -->
                        <text x="550" y="280" text-anchor="middle" fill="#1e40af" font-size="11" font-weight="700">WORKFLOWS/</text>
                        
                        <g class="dag-node">
                            <rect x="50" y="290" width="120" height="45" rx="8" fill="#3b82f6" stroke="#1d4ed8" stroke-width="2"/>
                            <text x="110" y="310" text-anchor="middle" fill="white" font-size="9" font-weight="600">maj_workflow.py</text>
                            <text x="110" y="325" text-anchor="middle" fill="#bfdbfe" font-size="7">MajWorkflow</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="190" y="290" width="140" height="45" rx="8" fill="#3b82f6" stroke="#1d4ed8" stroke-width="2"/>
                            <text x="260" y="310" text-anchor="middle" fill="white" font-size="9" font-weight="600">capft_workflow.py</text>
                            <text x="260" y="325" text-anchor="middle" fill="#bfdbfe" font-size="7">CapFtWorkflow</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="350" y="290" width="150" height="45" rx="8" fill="#3b82f6" stroke="#1d4ed8" stroke-width="2"/>
                            <text x="425" y="310" text-anchor="middle" fill="white" font-size="9" font-weight="600">comac_workflow.py</text>
                            <text x="425" y="325" text-anchor="middle" fill="#bfdbfe" font-size="7">ComacWorkflow</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="520" y="290" width="140" height="45" rx="8" fill="#3b82f6" stroke="#1d4ed8" stroke-width="2"/>
                            <text x="590" y="310" text-anchor="middle" fill="white" font-size="9" font-weight="600">c6bd_workflow.py</text>
                            <text x="590" y="325" text-anchor="middle" fill="#bfdbfe" font-size="7">C6BdWorkflow</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="680" y="290" width="150" height="45" rx="8" fill="#3b82f6" stroke="#1d4ed8" stroke-width="2"/>
                            <text x="755" y="310" text-anchor="middle" fill="white" font-size="9" font-weight="600">c6c3a_workflow.py</text>
                            <text x="755" y="325" text-anchor="middle" fill="#bfdbfe" font-size="7">C6C3AWorkflow</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="850" y="290" width="150" height="45" rx="8" fill="#3b82f6" stroke="#1d4ed8" stroke-width="2"/>
                            <text x="925" y="310" text-anchor="middle" fill="white" font-size="9" font-weight="600">police_workflow.py</text>
                            <text x="925" y="325" text-anchor="middle" fill="#bfdbfe" font-size="7">PoliceWorkflow</text>
                        </g>
                        
                        <!-- Arrows from Workflows to Business Modules -->
                        <path d="M 110 335 L 115 400" stroke="#10b981" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 260 335 L 255 400" stroke="#10b981" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 425 335 L 710 400" stroke="#10b981" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 590 335 L 390 400" stroke="#10b981" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 755 335 L 550 400" stroke="#10b981" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 925 335 L 820 400" stroke="#10b981" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        
                        <!-- Arrow View to ui_feedback -->
                        <path d="M 160 250 L 160 360" stroke="#10b981" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        
                        <g class="dag-node">
                            <rect x="80" y="360" width="160" height="40" rx="6" fill="#c4b5fd" stroke="#a78bfa" stroke-width="1"/>
                            <text x="160" y="385" text-anchor="middle" fill="#581c87" font-size="10" font-weight="500">ui_feedback.py</text>
                        </g>
                        
                        <!-- Level 3: Modules Metier -->
                        <text x="550" y="385" text-anchor="middle" fill="#475569" font-size="12" font-weight="700">MODULES METIER</text>
                        <line x1="100" y1="395" x2="1000" y2="395" stroke="#e2e8f0" stroke-width="2"/>
                        
                        <g class="dag-node">
                            <rect x="50" y="415" width="130" height="55" rx="8" fill="#fbbf24" stroke="#f59e0b" stroke-width="1.5"/>
                            <text x="115" y="440" text-anchor="middle" fill="#78350f" font-size="10" font-weight="600">Maj_Ft_Bt.py</text>
                            <text x="115" y="455" text-anchor="middle" fill="#92400e" font-size="8">Onglet 0</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="200" y="415" width="110" height="55" rx="8" fill="#34d399" stroke="#10b981" stroke-width="1.5"/>
                            <text x="255" y="440" text-anchor="middle" fill="#064e3b" font-size="10" font-weight="600">CapFt.py</text>
                            <text x="255" y="455" text-anchor="middle" fill="#065f46" font-size="8">Onglet 2</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="330" y="415" width="120" height="55" rx="8" fill="#f472b6" stroke="#ec4899" stroke-width="1.5"/>
                            <text x="390" y="440" text-anchor="middle" fill="#831843" font-size="10" font-weight="600">C6_vs_Bd.py</text>
                            <text x="390" y="455" text-anchor="middle" fill="#9d174d" font-size="8">Onglet 1</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="470" y="415" width="160" height="55" rx="8" fill="#f472b6" stroke="#ec4899" stroke-width="1.5"/>
                            <text x="550" y="440" text-anchor="middle" fill="#831843" font-size="10" font-weight="600">C6_vs_C3A_vs_Bd.py</text>
                            <text x="550" y="455" text-anchor="middle" fill="#9d174d" font-size="8">Onglet 5</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="650" y="415" width="120" height="55" rx="8" fill="#38bdf8" stroke="#0ea5e9" stroke-width="1.5"/>
                            <text x="710" y="440" text-anchor="middle" fill="#0c4a6e" font-size="10" font-weight="600">Comac.py</text>
                            <text x="710" y="455" text-anchor="middle" fill="#075985" font-size="8">Onglet 3</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="790" y="400" width="120" height="55" rx="8" fill="#a78bfa" stroke="#8b5cf6" stroke-width="1.5"/>
                            <text x="850" y="425" text-anchor="middle" fill="#3730a3" font-size="10" font-weight="600">PoliceC6.py</text>
                            <text x="850" y="440" text-anchor="middle" fill="#4338ca" font-size="8">Onglet 4</text>
                        </g>
                        
                        <!-- Arrows to utils.py (shared) -->
                        <path d="M 115 470 L 270 510" stroke="#94a3b8" stroke-width="1" fill="none" marker-end="url(#arrow-dag)" stroke-dasharray="4 2"/>
                        <path d="M 255 470 L 280 510" stroke="#94a3b8" stroke-width="1" fill="none" marker-end="url(#arrow-dag)" stroke-dasharray="4 2"/>
                        <path d="M 390 470 L 310 510" stroke="#94a3b8" stroke-width="1" fill="none" marker-end="url(#arrow-dag)" stroke-dasharray="4 2"/>
                        <path d="M 550 470 L 340 510" stroke="#94a3b8" stroke-width="1" fill="none" marker-end="url(#arrow-dag)" stroke-dasharray="4 2"/>
                        <path d="M 710 470 L 360 510" stroke="#94a3b8" stroke-width="1" fill="none" marker-end="url(#arrow-dag)" stroke-dasharray="4 2"/>
                        <path d="M 850 470 L 380 510" stroke="#94a3b8" stroke-width="1" fill="none" marker-end="url(#arrow-dag)" stroke-dasharray="4 2"/>
                        
                        <!-- Level 4: Support -->
                        <g class="dag-node">
                            <rect x="220" y="510" width="160" height="45" rx="8" fill="#94a3b8" stroke="#64748b" stroke-width="1.5"/>
                            <text x="300" y="535" text-anchor="middle" fill="white" font-size="11" font-weight="600">utils.py</text>
                            <text x="300" y="548" text-anchor="middle" fill="#e2e8f0" font-size="8">Module feuille</text>
                        </g>
                        
                        <!-- Arrows Comac to security modules -->
                        <path d="M 710 470 L 600 510" stroke="#ef4444" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 710 470 L 750 510" stroke="#ef4444" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 710 470 L 900 510" stroke="#ef4444" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        
                        <!-- Arrow PoliceC6 to comac_db_reader -->
                        <path d="M 850 470 L 765 510" stroke="#ef4444" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        
                        <!-- Level 4: Security Rules -->
                        <g class="dag-node">
                            <rect x="520" y="510" width="150" height="50" rx="8" fill="#ef4444" stroke="#dc2626" stroke-width="1.5"/>
                            <text x="595" y="530" text-anchor="middle" fill="white" font-size="10" font-weight="600">security_rules.py</text>
                            <text x="595" y="548" text-anchor="middle" fill="#fecaca" font-size="8">NFC 11201-A1</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="690" y="510" width="150" height="50" rx="8" fill="#f97316" stroke="#ea580c" stroke-width="1.5"/>
                            <text x="765" y="530" text-anchor="middle" fill="white" font-size="10" font-weight="600">comac_db_reader.py</text>
                            <text x="765" y="548" text-anchor="middle" fill="#fed7aa" font-size="8">BD officielle</text>
                        </g>
                        
                        <g class="dag-node">
                            <rect x="860" y="510" width="130" height="50" rx="8" fill="#f97316" stroke="#ea580c" stroke-width="1.5"/>
                            <text x="925" y="530" text-anchor="middle" fill="white" font-size="10" font-weight="600">pcm_parser.py</text>
                            <text x="925" y="548" text-anchor="middle" fill="#fed7aa" font-size="8">XML .pcm</text>
                        </g>
                        
                        <!-- Arrows security_rules -> comac_db_reader -->
                        <path d="M 595 560 L 700 600" stroke="#f97316" stroke-width="1.5" fill="none" marker-end="url(#arrow-dag)" class="dag-edge"/>
                        <path d="M 925 560 L 595 600" stroke="#f97316" stroke-width="1" fill="none" marker-end="url(#arrow-dag)" stroke-dasharray="4 2"/>
                        
                        <!-- Level 5: comac_loader -->
                        <g class="dag-node">
                            <rect x="620" y="590" width="150" height="50" rx="8" fill="#06b6d4" stroke="#0891b2" stroke-width="1.5"/>
                            <text x="695" y="610" text-anchor="middle" fill="white" font-size="10" font-weight="600">comac_loader.py</text>
                            <text x="695" y="628" text-anchor="middle" fill="#a5f3fc" font-size="8">Fusion PCM+Excel</text>
                        </g>
                        
                        <!-- Level 5: Data -->
                        <g class="dag-node">
                            <rect x="860" y="590" width="130" height="50" rx="8" fill="#64748b" stroke="#475569" stroke-width="1.5"/>
                            <text x="925" y="610" text-anchor="middle" fill="white" font-size="10" font-weight="600">comac_db/</text>
                            <text x="925" y="628" text-anchor="middle" fill="#e2e8f0" font-size="8">12 fichiers CSV</text>
                        </g>
                        
                        <path d="M 765 560 L 860 590" stroke="#64748b" stroke-width="1" fill="none" marker-end="url(#arrow-dag)" stroke-dasharray="4 2"/>
                        
                        <!-- Legend -->
                        <rect x="30" y="590" width="200" height="110" rx="8" fill="white" stroke="#e2e8f0" stroke-width="1"/>
                        <text x="130" y="610" text-anchor="middle" fill="#334155" font-size="10" font-weight="600">LEGENDE</text>
                        <circle cx="50" cy="628" r="6" fill="#8b5cf6"/>
                        <text x="65" y="632" fill="#64748b" font-size="9">UI / Controller</text>
                        <circle cx="50" cy="648" r="6" fill="#3b82f6"/>
                        <text x="65" y="652" fill="#64748b" font-size="9">Workflows (6)</text>
                        <circle cx="50" cy="668" r="6" fill="#10b981"/>
                        <text x="65" y="672" fill="#64748b" font-size="9">Modules metier</text>
                        <circle cx="50" cy="688" r="6" fill="#ef4444"/>
                        <text x="65" y="692" fill="#64748b" font-size="9">Regles securite</text>
                    </svg>
                    
                    <div class="legend" style="margin-top: 1rem;">
                        <div class="legend-item"><div class="legend-color" style="background: #8b5cf6;"></div><span>UI / Controller</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: #3b82f6;"></div><span>Workflows (Orchestration)</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: #10b981;"></div><span>Modules metier</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: #ef4444;"></div><span>Regles securite</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: #f97316;"></div><span>Lecteurs donnees</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: #64748b;"></div><span>Donnees (CSV)</span></div>
                    </div>
                </div>
            </div>

            <!-- Tooltip -->
            <div id="diagram-tooltip" class="info-tooltip"></div>
        </section>

        <!-- Onglet 1: C6 vs BD - Architecture détaillée -->
        <section id="onglet-c6bd" style="margin-top: 5rem;">
            <div class="section-header">
                <h2>
                    <span style="display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; background: linear-gradient(135deg, #ec4899, #db2777); border-radius: 10px; margin-right: 12px; color: white; font-weight: 700; font-size: 18px;">1</span>
                    Onglet 1 : C6 vs BD - Architecture complète
                </h2>
                <p>Comparaison intelligente des fichiers Excel C6 avec la base de données QGIS</p>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid" style="margin-bottom: 3rem;">
                <div class="stat-card">
                    <div class="stat-value" style="color: #ec4899;">422</div>
                    <div class="stat-label">Lignes C6_vs_Bd.py</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: #3b82f6;">246</div>
                    <div class="stat-label">Lignes c6bd_workflow.py</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: #10b981;">7s</div>
                    <div class="stat-label">Temps analyse (19 études)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: #f59e0b;">-84%</div>
                    <div class="stat-label">Gain performance</div>
                </div>
            </div>

            <!-- Architecture Diagram C6 vs BD -->
            <div class="diagram-container" style="background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%);">
                <h3 class="diagram-title" style="color: #831843;">Architecture asynchrone non-bloquante</h3>
                <svg class="architecture-svg" viewBox="0 0 900 520" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <marker id="arrow-c6" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
                            <polygon points="0 0, 8 3, 0 6" fill="#ec4899"/>
                        </marker>
                        <marker id="arrow-c6-green" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
                            <polygon points="0 0, 8 3, 0 6" fill="#10b981"/>
                        </marker>
                        <linearGradient id="grad-c6-1" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#ec4899;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#db2777;stop-opacity:1" />
                        </linearGradient>
                        <filter id="shadow-c6" x="-10%" y="-10%" width="120%" height="120%">
                            <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.15"/>
                        </filter>
                    </defs>
                    
                    <!-- Background -->
                    <rect width="900" height="520" fill="transparent"/>
                    
                    <!-- Main Thread Zone -->
                    <rect x="20" y="50" width="540" height="200" rx="16" fill="rgba(255,255,255,0.6)" stroke="#3b82f6" stroke-width="2" stroke-dasharray="6 3"/>
                    <text x="40" y="75" fill="#1e40af" font-size="11" font-weight="700">MAIN THREAD</text>
                    
                    <!-- Step 0: START -->
                    <g filter="url(#shadow-c6)">
                        <rect x="40" y="95" width="120" height="70" rx="10" fill="white" stroke="#ec4899" stroke-width="2"/>
                        <rect x="40" y="95" width="120" height="24" rx="10" fill="url(#grad-c6-1)"/>
                        <text x="100" y="112" text-anchor="middle" fill="white" font-size="10" font-weight="700">START</text>
                        <text x="100" y="135" text-anchor="middle" fill="#831843" font-size="9" font-weight="600">start_analysis()</text>
                        <text x="100" y="150" text-anchor="middle" fill="#9d174d" font-size="8">Auto-detect champ</text>
                    </g>
                    <text x="100" y="178" text-anchor="middle" fill="#10b981" font-size="8" font-weight="600">5%</text>
                    
                    <!-- Arrow 0→1 -->
                    <line x1="160" y1="130" x2="175" y2="130" stroke="#ec4899" stroke-width="2" marker-end="url(#arrow-c6)"/>
                    
                    <!-- Step 1: Extract IN -->
                    <g filter="url(#shadow-c6)">
                        <rect x="180" y="95" width="120" height="70" rx="10" fill="white" stroke="#3b82f6" stroke-width="2"/>
                        <rect x="180" y="95" width="120" height="24" rx="10" fill="#3b82f6"/>
                        <text x="240" y="112" text-anchor="middle" fill="white" font-size="10" font-weight="700">STEP 1</text>
                        <text x="240" y="135" text-anchor="middle" fill="#1e40af" font-size="9" font-weight="600">extract_in()</text>
                        <text x="240" y="150" text-anchor="middle" fill="#2563eb" font-size="8">QgsSpatialIndex</text>
                    </g>
                    <text x="240" y="178" text-anchor="middle" fill="#10b981" font-size="8" font-weight="600">25%</text>
                    
                    <!-- Arrow 1→2 -->
                    <line x1="300" y1="130" x2="315" y2="130" stroke="#ec4899" stroke-width="2" marker-end="url(#arrow-c6)"/>
                    
                    <!-- Step 2: Extract OUT -->
                    <g filter="url(#shadow-c6)">
                        <rect x="320" y="95" width="120" height="70" rx="10" fill="white" stroke="#f59e0b" stroke-width="2"/>
                        <rect x="320" y="95" width="120" height="24" rx="10" fill="#f59e0b"/>
                        <text x="380" y="112" text-anchor="middle" fill="white" font-size="10" font-weight="700">STEP 2</text>
                        <text x="380" y="135" text-anchor="middle" fill="#92400e" font-size="9" font-weight="600">extract_out()</text>
                        <text x="380" y="150" text-anchor="middle" fill="#a16207" font-size="8">Hors périmètre</text>
                    </g>
                    <text x="380" y="178" text-anchor="middle" fill="#10b981" font-size="8" font-weight="600">40%</text>
                    
                    <!-- Arrow 2→3 -->
                    <line x1="440" y1="130" x2="455" y2="130" stroke="#ec4899" stroke-width="2" marker-end="url(#arrow-c6)"/>
                    
                    <!-- Step 3: Verify études -->
                    <g filter="url(#shadow-c6)">
                        <rect x="460" y="95" width="120" height="70" rx="10" fill="white" stroke="#8b5cf6" stroke-width="2"/>
                        <rect x="460" y="95" width="120" height="24" rx="10" fill="#8b5cf6"/>
                        <text x="520" y="112" text-anchor="middle" fill="white" font-size="10" font-weight="700">STEP 3</text>
                        <text x="520" y="135" text-anchor="middle" fill="#3730a3" font-size="9" font-weight="600">verify_etudes()</text>
                        <text x="520" y="150" text-anchor="middle" fill="#5b21b6" font-size="8">CAP FT vs C6</text>
                    </g>
                    <text x="520" y="178" text-anchor="middle" fill="#10b981" font-size="8" font-weight="600">50%</text>
                    
                    <!-- QTimer label -->
                    <rect x="200" y="188" width="200" height="20" rx="4" fill="#f0fdf4" stroke="#10b981" stroke-width="1"/>
                    <text x="300" y="202" text-anchor="middle" fill="#065f46" font-size="9" font-weight="600">QTimer 0ms entre chaque étape</text>
                    
                    <!-- Arrow Main→Worker -->
                    <path d="M 520 165 L 520 210 L 600 210 L 600 275" stroke="#10b981" stroke-width="3" fill="none" marker-end="url(#arrow-c6-green)"/>
                    <text x="570" y="245" text-anchor="middle" fill="#065f46" font-size="9" font-weight="700">QgsTask</text>
                    
                    <!-- Worker Thread Zone -->
                    <rect x="580" y="50" width="300" height="200" rx="16" fill="rgba(209,250,229,0.5)" stroke="#10b981" stroke-width="2"/>
                    <text x="600" y="75" fill="#065f46" font-size="11" font-weight="700">WORKER THREAD</text>
                    
                    <!-- Step 4: Async Task -->
                    <g filter="url(#shadow-c6)">
                        <rect x="600" y="95" width="260" height="130" rx="12" fill="white" stroke="#10b981" stroke-width="2"/>
                        <rect x="600" y="95" width="260" height="28" rx="12" fill="#10b981"/>
                        <text x="730" y="114" text-anchor="middle" fill="white" font-size="11" font-weight="700">STEP 4 - C6BdTask</text>
                        <text x="730" y="140" text-anchor="middle" fill="#065f46" font-size="10" font-weight="600">Worker Thread Non-bloquant</text>
                        <text x="620" y="160" fill="#047857" font-size="9">Lecture fichiers Excel C6</text>
                        <text x="620" y="175" fill="#047857" font-size="9">Filtrage intelligent auto</text>
                        <text x="620" y="190" fill="#047857" font-size="9">Fusion données QGIS</text>
                        <text x="620" y="205" fill="#047857" font-size="9">Export Excel 3 feuilles</text>
                    </g>
                    <text x="730" y="238" text-anchor="middle" fill="#10b981" font-size="9" font-weight="600">50% → 100%</text>
                    
                    <!-- Sources box -->
                    <g filter="url(#shadow-c6)">
                        <rect x="20" y="280" width="200" height="110" rx="10" fill="white" stroke="#64748b" stroke-width="2"/>
                        <rect x="20" y="280" width="200" height="24" rx="10" fill="#64748b"/>
                        <text x="120" y="296" text-anchor="middle" fill="white" font-size="10" font-weight="700">SOURCES</text>
                        <text x="35" y="320" fill="#475569" font-size="9" font-weight="600">Répertoire C6</text>
                        <text x="45" y="335" fill="#64748b" font-size="8">Filtrage: FicheAppui, C7, GESPOT</text>
                        <text x="45" y="350" fill="#64748b" font-size="8">Détection feuille/colonne auto</text>
                        <text x="35" y="370" fill="#475569" font-size="9" font-weight="600">Couche QGIS: infra_pt_pot</text>
                    </g>
                    
                    <!-- Arrow Sources→Results -->
                    <line x1="220" y1="335" x2="235" y2="335" stroke="#64748b" stroke-width="2" marker-end="url(#arrow-c6)"/>
                    
                    <!-- Results box -->
                    <g filter="url(#shadow-c6)">
                        <rect x="240" y="280" width="320" height="140" rx="10" fill="white" stroke="#ec4899" stroke-width="2"/>
                        <rect x="240" y="280" width="320" height="28" rx="10" fill="url(#grad-c6-1)"/>
                        <text x="400" y="299" text-anchor="middle" fill="white" font-size="11" font-weight="700">RÉSULTATS - Excel Multi-feuilles</text>
                        <rect x="255" y="320" width="140" height="28" rx="6" fill="#fef3c7"/>
                        <text x="325" y="339" text-anchor="middle" fill="#92400e" font-size="9" font-weight="600">ANALYSE C6 BD</text>
                        <text x="255" y="360" fill="#9d174d" font-size="8">Comparaison poteau par poteau</text>
                        <rect x="405" y="320" width="140" height="28" rx="6" fill="#fee2e2"/>
                        <text x="475" y="339" text-anchor="middle" fill="#991b1b" font-size="9" font-weight="600">HORS PERIMETRE</text>
                        <text x="405" y="360" fill="#9d174d" font-size="8">Poteaux FT non couverts</text>
                        <rect x="255" y="375" width="140" height="28" rx="6" fill="#fed7aa"/>
                        <text x="325" y="394" text-anchor="middle" fill="#9a3412" font-size="9" font-weight="600">VERIF ETUDES</text>
                        <text x="255" y="412" fill="#9d174d" font-size="8">Études sans C6 / C6 sans étude</text>
                    </g>
                    
                    <!-- Performance box -->
                    <g filter="url(#shadow-c6)">
                        <rect x="580" y="280" width="300" height="140" rx="10" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
                        <rect x="580" y="280" width="300" height="28" rx="10" fill="#f59e0b"/>
                        <text x="730" y="299" text-anchor="middle" fill="white" font-size="11" font-weight="700">PERFORMANCE</text>
                        <text x="730" y="340" text-anchor="middle" fill="#78350f" font-size="28" font-weight="700">7s</text>
                        <text x="730" y="360" text-anchor="middle" fill="#a16207" font-size="10">pour 19 études</text>
                        <line x1="620" y1="375" x2="840" y2="375" stroke="#f59e0b" stroke-width="1"/>
                        <text x="680" y="395" text-anchor="middle" fill="#92400e" font-size="10">Avant: ~45s</text>
                        <text x="780" y="395" text-anchor="middle" fill="#10b981" font-size="12" font-weight="700">-84%</text>
                    </g>
                    
                    <!-- Progress bar -->
                    <rect x="20" y="450" width="860" height="30" rx="8" fill="white" stroke="#e5e7eb" stroke-width="1"/>
                    <rect x="22" y="452" width="42" height="26" rx="6" fill="#ec4899"/>
                    <rect x="64" y="452" width="170" height="26" rx="0" fill="#3b82f6"/>
                    <rect x="234" y="452" width="130" height="26" rx="0" fill="#f59e0b"/>
                    <rect x="364" y="452" width="86" height="26" rx="0" fill="#8b5cf6"/>
                    <rect x="450" y="452" width="428" height="26" rx="6" fill="#10b981"/>
                    <text x="43" y="470" text-anchor="middle" fill="white" font-size="8" font-weight="600">5%</text>
                    <text x="149" y="470" text-anchor="middle" fill="white" font-size="8" font-weight="600">25%</text>
                    <text x="299" y="470" text-anchor="middle" fill="white" font-size="8" font-weight="600">40%</text>
                    <text x="407" y="470" text-anchor="middle" fill="white" font-size="8" font-weight="600">50%</text>
                    <text x="664" y="470" text-anchor="middle" fill="white" font-size="8" font-weight="600">100%</text>
                    <text x="450" y="500" text-anchor="middle" fill="#64748b" font-size="10">UI reste 100% réactive - Annulation possible à tout moment</text>
                </svg>
                
                <div class="legend" style="margin-top: 1.5rem;">
                    <div class="legend-item"><div class="legend-color" style="background: #ec4899;"></div><span>Orchestration</span></div>
                    <div class="legend-item"><div class="legend-color" style="background: #3b82f6;"></div><span>Extraction QGIS</span></div>
                    <div class="legend-item"><div class="legend-color" style="background: #10b981;"></div><span>Worker Thread</span></div>
                    <div class="legend-item"><div class="legend-color" style="background: #f59e0b;"></div><span>Performance</span></div>
                </div>
            </div>

            <!-- Features Cards -->
            <div class="cards-grid" style="margin-top: 3rem;">
                <article class="card">
                    <div class="card-icon blue">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                    </div>
                    <h3>Auto-détection champ étude</h3>
                    <p>Reconnaissance automatique via patterns regex: <code>nom_etudes</code>, <code>etudes</code>, <code>decoupage</code>, <code>zone</code>. Plus besoin de sélection manuelle.</p>
                </article>
                <article class="card">
                    <div class="card-icon green">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                    </div>
                    <h3>Filtrage intelligent</h3>
                    <p>Ignore automatiquement les fichiers non-C6: <code>FicheAppui_*.xlsx</code>, <code>*_C7*.xlsx</code>, <code>GESPOT_*.xlsx</code>. Zéro erreur de parsing.</p>
                </article>
                <article class="card">
                    <div class="card-icon orange">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
                    </div>
                    <h3>Index spatial O(n log m)</h3>
                    <p>Utilise <code>QgsSpatialIndex</code> pour intersections géométriques ultra-rapides. Cache géométries polygones CAP FT.</p>
                </article>
            </div>
        </section>

        <!-- Onglet 2: CAP FT - Architecture détaillée -->
        <section id="onglet-capft" style="margin-top: 5rem;">
            <div class="section-header">
                <h2>
                    <span style="display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; background: linear-gradient(135deg, #34d399, #10b981); border-radius: 10px; margin-right: 12px; color: white; font-weight: 700; font-size: 18px;">2</span>
                    Onglet 2 : CAP FT - Architecture complète
                </h2>
                <p>Vérification correspondance poteaux FT vs fiches appuis individuelles</p>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid" style="margin-bottom: 3rem;">
                <div class="stat-card">
                    <div class="stat-value" style="color: #34d399;">196</div>
                    <div class="stat-label">Lignes CapFt.py</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: #3b82f6;">118</div>
                    <div class="stat-label">Lignes capft_workflow.py</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: #10b981;">O(n+m)</div>
                    <div class="stat-label">Complexité index rapide</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" style="color: #f59e0b;">~95%</div>
                    <div class="stat-label">Gain temps traitement</div>
                </div>
            </div>

            <!-- Architecture Diagram CAP FT -->
            <div class="diagram-container" style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);">
                <h3 class="diagram-title" style="color: #065f46;">Architecture Main Thread + Worker Thread</h3>
                <svg class="architecture-svg" viewBox="0 0 900 540" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <marker id="arrow-cap" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
                            <polygon points="0 0, 8 3, 0 6" fill="#10b981"/>
                        </marker>
                        <marker id="arrow-cap-blue" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
                            <polygon points="0 0, 8 3, 0 6" fill="#3b82f6"/>
                        </marker>
                        <linearGradient id="grad-cap-1" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#34d399;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#10b981;stop-opacity:1" />
                        </linearGradient>
                        <filter id="shadow-cap" x="-10%" y="-10%" width="120%" height="120%">
                            <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.15"/>
                        </filter>
                    </defs>
                    
                    <!-- Background -->
                    <rect width="900" height="540" fill="transparent"/>
                    
                    <!-- Main Thread Zone -->
                    <rect x="20" y="50" width="380" height="220" rx="16" fill="rgba(255,255,255,0.6)" stroke="#3b82f6" stroke-width="2" stroke-dasharray="6 3"/>
                    <text x="40" y="75" fill="#1e40af" font-size="11" font-weight="700">MAIN THREAD</text>
                    
                    <!-- Step 1: Verification -->
                    <g filter="url(#shadow-cap)">
                        <rect x="40" y="95" width="160" height="70" rx="10" fill="white" stroke="#3b82f6" stroke-width="2"/>
                        <rect x="40" y="95" width="160" height="24" rx="10" fill="#3b82f6"/>
                        <text x="120" y="112" text-anchor="middle" fill="white" font-size="10" font-weight="700">1. Vérifications</text>
                        <text x="120" y="135" text-anchor="middle" fill="#1e40af" font-size="8" font-weight="600">verificationsDonneesCapft()</text>
                        <text x="120" y="150" text-anchor="middle" fill="#2563eb" font-size="8">Doublons / Poteaux hors zone</text>
                    </g>
                    
                    <!-- Arrow 1→2 -->
                    <line x1="200" y1="130" x2="215" y2="130" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrow-cap-blue)"/>
                    
                    <!-- Step 2: Extraction -->
                    <g filter="url(#shadow-cap)">
                        <rect x="220" y="95" width="160" height="70" rx="10" fill="white" stroke="#3b82f6" stroke-width="2"/>
                        <rect x="220" y="95" width="160" height="24" rx="10" fill="#3b82f6"/>
                        <text x="300" y="112" text-anchor="middle" fill="white" font-size="10" font-weight="700">2. Extraction</text>
                        <text x="300" y="135" text-anchor="middle" fill="#1e40af" font-size="8" font-weight="600">liste_poteau_cap_ft()</text>
                        <text x="300" y="150" text-anchor="middle" fill="#2563eb" font-size="8">Intersection spatiale</text>
                    </g>
                    
                    <!-- Arrow 2→3 -->
                    <path d="M 300 165 L 300 185 L 200 185 L 200 205" stroke="#8b5cf6" stroke-width="2" fill="none" marker-end="url(#arrow-cap)"/>
                    
                    <!-- Step 3: Launch -->
                    <g filter="url(#shadow-cap)">
                        <rect x="80" y="210" width="240" height="50" rx="10" fill="white" stroke="#8b5cf6" stroke-width="2"/>
                        <rect x="80" y="210" width="240" height="22" rx="10" fill="#8b5cf6"/>
                        <text x="200" y="226" text-anchor="middle" fill="white" font-size="10" font-weight="700">3. CapFtWorkflow.start_analysis()</text>
                        <text x="200" y="248" text-anchor="middle" fill="#3730a3" font-size="9">Lancement CapFtTask (QgsTask)</text>
                    </g>
                    
                    <!-- Arrow Main→Worker -->
                    <path d="M 320 235 L 380 235 L 420 120" stroke="#10b981" stroke-width="3" fill="none" marker-end="url(#arrow-cap)"/>
                    <text x="390" y="180" fill="#065f46" font-size="9" font-weight="700">QgsTask</text>
                    
                    <!-- Worker Thread Zone -->
                    <rect x="420" y="50" width="460" height="220" rx="16" fill="rgba(209,250,229,0.5)" stroke="#10b981" stroke-width="2"/>
                    <text x="440" y="75" fill="#065f46" font-size="11" font-weight="700">WORKER THREAD</text>
                    
                    <!-- Step 4: Lecture -->
                    <g filter="url(#shadow-cap)">
                        <rect x="440" y="95" width="130" height="80" rx="10" fill="white" stroke="#10b981" stroke-width="2"/>
                        <rect x="440" y="95" width="130" height="24" rx="10" fill="url(#grad-cap-1)"/>
                        <text x="505" y="112" text-anchor="middle" fill="white" font-size="10" font-weight="700">4. Lecture</text>
                        <text x="505" y="132" text-anchor="middle" fill="#065f46" font-size="8" font-weight="600">LectureFichiers</text>
                        <text x="505" y="145" text-anchor="middle" fill="#047857" font-size="7">FicheAppui_*.xlsx</text>
                        <text x="505" y="158" text-anchor="middle" fill="#047857" font-size="7">Par dossiers études</text>
                    </g>
                    
                    <!-- Arrow 4→5 -->
                    <line x1="570" y1="135" x2="585" y2="135" stroke="#10b981" stroke-width="2" marker-end="url(#arrow-cap)"/>
                    
                    <!-- Step 5: Comparaison -->
                    <g filter="url(#shadow-cap)">
                        <rect x="590" y="95" width="130" height="80" rx="10" fill="white" stroke="#f59e0b" stroke-width="2"/>
                        <rect x="590" y="95" width="130" height="24" rx="10" fill="#f59e0b"/>
                        <text x="655" y="112" text-anchor="middle" fill="white" font-size="10" font-weight="700">5. Comparaison</text>
                        <text x="655" y="132" text-anchor="middle" fill="#92400e" font-size="8" font-weight="600">traitementResultats</text>
                        <text x="655" y="145" text-anchor="middle" fill="#a16207" font-size="7">Index O(n+m)</text>
                        <text x="655" y="158" text-anchor="middle" fill="#a16207" font-size="7">Lookup O(1)</text>
                    </g>
                    
                    <!-- Arrow 5→6 -->
                    <line x1="720" y1="135" x2="735" y2="135" stroke="#10b981" stroke-width="2" marker-end="url(#arrow-cap)"/>
                    
                    <!-- Step 6: Export -->
                    <g filter="url(#shadow-cap)">
                        <rect x="740" y="95" width="120" height="80" rx="10" fill="white" stroke="#8b5cf6" stroke-width="2"/>
                        <rect x="740" y="95" width="120" height="24" rx="10" fill="#8b5cf6"/>
                        <text x="800" y="112" text-anchor="middle" fill="white" font-size="10" font-weight="700">6. Export</text>
                        <text x="800" y="132" text-anchor="middle" fill="#3730a3" font-size="8" font-weight="600">ecrireResultats</text>
                        <text x="800" y="145" text-anchor="middle" fill="#4338ca" font-size="7">ANALYSE CAP_FT</text>
                        <text x="800" y="158" text-anchor="middle" fill="#4338ca" font-size="7">Excel coloré</text>
                    </g>
                    
                    <!-- Normalisation box -->
                    <g filter="url(#shadow-cap)">
                        <rect x="440" y="190" width="200" height="70" rx="10" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
                        <rect x="440" y="190" width="200" height="22" rx="10" fill="#f59e0b"/>
                        <text x="540" y="206" text-anchor="middle" fill="white" font-size="9" font-weight="700">NORMALISATION</text>
                        <text x="455" y="225" fill="#78350f" font-size="8" font-weight="600">normalize_appui_num_bt()</text>
                        <text x="455" y="240" fill="#a16207" font-size="7">E000123, FicheAppui_E123.xlsx → 123</text>
                        <text x="455" y="252" fill="#065f46" font-size="7" font-weight="600">strip_e_prefix=True</text>
                    </g>
                    
                    <!-- Results box -->
                    <g filter="url(#shadow-cap)">
                        <rect x="660" y="190" width="200" height="70" rx="10" fill="white" stroke="#ec4899" stroke-width="2"/>
                        <rect x="660" y="190" width="200" height="22" rx="10" fill="#ec4899"/>
                        <text x="760" y="206" text-anchor="middle" fill="white" font-size="9" font-weight="700">RÉSULTATS</text>
                        <rect x="675" y="218" width="75" height="16" rx="4" fill="#fee2e2"/>
                        <text x="712" y="230" text-anchor="middle" fill="#991b1b" font-size="7" font-weight="600">ROUGE</text>
                        <rect x="760" y="218" width="85" height="16" rx="4" fill="#fed7aa"/>
                        <text x="802" y="230" text-anchor="middle" fill="#9a3412" font-size="7" font-weight="600">ORANGE</text>
                        <rect x="675" y="238" width="75" height="16" rx="4" fill="#d1fae5"/>
                        <text x="712" y="250" text-anchor="middle" fill="#065f46" font-size="7" font-weight="600">BLANC OK</text>
                        <text x="802" y="250" fill="#10b981" font-size="8" font-weight="700">Bidirectionnel</text>
                    </g>
                    
                    <!-- Signals Section -->
                    <g filter="url(#shadow-cap)">
                        <rect x="20" y="300" width="860" height="100" rx="12" fill="rgba(255,255,255,0.9)" stroke="#6366f1" stroke-width="2"/>
                        <text x="450" y="322" text-anchor="middle" fill="#3730a3" font-size="11" font-weight="700">SIGNAUX WORKFLOW → UI</text>
                        
                        <rect x="40" y="340" width="150" height="40" rx="6" fill="#dbeafe" stroke="#3b82f6" stroke-width="1"/>
                        <text x="115" y="358" text-anchor="middle" fill="#1e40af" font-size="9" font-weight="600">progress_changed</text>
                        <text x="115" y="372" text-anchor="middle" fill="#2563eb" font-size="7">0% → 100%</text>
                        
                        <rect x="210" y="340" width="150" height="40" rx="6" fill="#d1fae5" stroke="#10b981" stroke-width="1"/>
                        <text x="285" y="358" text-anchor="middle" fill="#065f46" font-size="9" font-weight="600">message_received</text>
                        <text x="285" y="372" text-anchor="middle" fill="#047857" font-size="7">Message + couleur</text>
                        
                        <rect x="380" y="340" width="150" height="40" rx="6" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
                        <text x="455" y="358" text-anchor="middle" fill="#92400e" font-size="9" font-weight="600">analysis_finished</text>
                        <text x="455" y="372" text-anchor="middle" fill="#a16207" font-size="7">Résultats analyse</text>
                        
                        <rect x="550" y="340" width="150" height="40" rx="6" fill="#e0e7ff" stroke="#6366f1" stroke-width="1"/>
                        <text x="625" y="358" text-anchor="middle" fill="#3730a3" font-size="9" font-weight="600">export_finished</text>
                        <text x="625" y="372" text-anchor="middle" fill="#4338ca" font-size="7">Confirmation</text>
                        
                        <rect x="720" y="340" width="150" height="40" rx="6" fill="#fee2e2" stroke="#ef4444" stroke-width="1"/>
                        <text x="795" y="358" text-anchor="middle" fill="#991b1b" font-size="9" font-weight="600">error_occurred</text>
                        <text x="795" y="372" text-anchor="middle" fill="#dc2626" font-size="7">Erreur critique</text>
                    </g>
                    
                    <!-- Performance box -->
                    <g filter="url(#shadow-cap)">
                        <rect x="20" y="420" width="420" height="100" rx="12" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
                        <rect x="20" y="420" width="420" height="28" rx="12" fill="#f59e0b"/>
                        <text x="230" y="440" text-anchor="middle" fill="white" font-size="11" font-weight="700">PERFORMANCE</text>
                        <text x="120" y="475" text-anchor="middle" fill="#78350f" font-size="24" font-weight="700">O(n+m)</text>
                        <text x="120" y="495" text-anchor="middle" fill="#a16207" font-size="10">Index rapide</text>
                        <line x1="220" y1="455" x2="220" y2="510" stroke="#f59e0b" stroke-width="1"/>
                        <text x="320" y="475" text-anchor="middle" fill="#78350f" font-size="24" font-weight="700">~95%</text>
                        <text x="320" y="495" text-anchor="middle" fill="#10b981" font-size="10" font-weight="600">Gain temps</text>
                    </g>
                    
                    <!-- UI Status -->
                    <g filter="url(#shadow-cap)">
                        <rect x="460" y="420" width="420" height="100" rx="12" fill="white" stroke="#10b981" stroke-width="2"/>
                        <rect x="460" y="420" width="420" height="28" rx="12" fill="#10b981"/>
                        <text x="670" y="440" text-anchor="middle" fill="white" font-size="11" font-weight="700">EXPÉRIENCE UTILISATEUR</text>
                        <text x="670" y="475" text-anchor="middle" fill="#065f46" font-size="12" font-weight="600">UI 100% réactive pendant traitement</text>
                        <text x="670" y="495" text-anchor="middle" fill="#047857" font-size="10">Annulation possible à tout moment via task.cancel()</text>
                        <text x="670" y="512" text-anchor="middle" fill="#10b981" font-size="10" font-weight="600">Deep copy données pour isolation thread-safe</text>
                    </g>
                </svg>
                
                <div class="legend" style="margin-top: 1.5rem;">
                    <div class="legend-item"><div class="legend-color" style="background: #3b82f6;"></div><span>Main Thread (QGIS API)</span></div>
                    <div class="legend-item"><div class="legend-color" style="background: #10b981;"></div><span>Worker Thread (Python pur)</span></div>
                    <div class="legend-item"><div class="legend-color" style="background: #f59e0b;"></div><span>Traitement intensif</span></div>
                    <div class="legend-item"><div class="legend-color" style="background: #6366f1;"></div><span>Communication async</span></div>
                </div>
            </div>

            <!-- Features Cards -->
            <div class="cards-grid" style="margin-top: 3rem;">
                <article class="card">
                    <div class="card-icon green">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                    </div>
                    <h3>Pattern FicheAppui_*.xlsx</h3>
                    <p>Structure: 1 fichier par poteau. Organisation par dossiers études. Extraction nom fichier → Numéro appui automatique.</p>
                </article>
                <article class="card">
                    <div class="card-icon orange">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
                    </div>
                    <h3>Normalisation robuste</h3>
                    <p>Gestion formats variables: <code>E000123</code>, <code>FicheAppui_E123.xlsx</code>, <code>E123/63041</code>. Fonction <code>normalize_appui_num_bt(strip_e_prefix=True)</code>.</p>
                </article>
                <article class="card">
                    <div class="card-icon blue">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
                    </div>
                    <h3>Détection terrains privés</h3>
                    <p>Extraction simultanée poteaux normaux et privés via champ spécifique. Retour: <code>(dict_poteaux, dict_poteaux_prives)</code>.</p>
                </article>
            </div>
        </section>

        <!-- Workflow Section -->
        <section id="workflow">
            <div class="section-header">
                <h2>Workflow d'utilisation</h2>
                <p>Processus étape par étape pour une utilisation optimale</p>
            </div>

            <div class="workflow">
                <div class="workflow-step">
                    <div class="step-number"><img src="../images/icon-layers.svg" alt="Layers" width="20" height="20"></div>
                    <div class="step-content">
                        <h4>Charger les couches QGIS</h4>
                        <p>Importez les couches nécessaires dans votre projet QGIS : <strong>infra_pt_pot</strong> (points), <strong>etude_cap_ft</strong> et <strong>etude_comac</strong> (polygones).</p>
                        <div class="code-block">
                            <code>
<span class="code-comment"># Couches requises</span>
infra_pt_pot    <span class="code-comment"># Table des poteaux (géométrie Point)</span>
etude_cap_ft    <span class="code-comment"># Périmètres CAP_FT (géométrie Polygon)</span>
etude_comac     <span class="code-comment"># Périmètres COMAC (géométrie Polygon)</span>
                            </code>
                        </div>
                    </div>
                </div>

                <div class="workflow-step">
                    <div class="step-number"><img src="../images/icon-settings.svg" alt="Settings" width="20" height="20"></div>
                    <div class="step-content">
                        <h4>Sélectionner le module d'analyse</h4>
                        <p>Ouvrez le plugin via le menu <strong>Extensions > Pôle Aérien</strong> et choisissez l'onglet correspondant à votre besoin (MAJ BD, CAP_FT, COMAC, etc.).</p>
                    </div>
                </div>

                <div class="workflow-step">
                    <div class="step-number"><img src="../images/icon-excel.svg" alt="Excel" width="20" height="20"></div>
                    <div class="step-content">
                        <h4>Configurer les paramètres</h4>
                        <p>Sélectionnez les couches sources, le fichier Excel d'import si applicable, et le répertoire de sortie pour les rapports d'analyse.</p>
                    </div>
                </div>

                <div class="workflow-step">
                    <div class="step-number"><img src="../images/icon-play.svg" alt="Play" width="20" height="20"></div>
                    <div class="step-content">
                        <h4>Lancer l'analyse</h4>
                        <p>Cliquez sur le bouton <strong>Lancer</strong>. La barre de progression indique l'avancement. Les résultats s'affichent dans le panneau de messages.</p>
                    </div>
                </div>

                <div class="workflow-step">
                    <div class="step-number"><img src="../images/icon-export.svg" alt="Export" width="20" height="20"></div>
                    <div class="step-content">
                        <h4>Exporter les résultats</h4>
                        <p>Utilisez le bouton <strong>Exporter</strong> pour sauvegarder les rapports d'analyse au format TXT ou Excel selon le module.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Modules Section -->
        <section id="modules">
            <div class="section-header">
                <h2>Détail des modules</h2>
                <p>Spécifications techniques de chaque composant</p>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Module</th>
                            <th>Fonction</th>
                            <th>Entrées</th>
                            <th>Sorties</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge badge-blue">MAJ FT/BT</span></td>
                            <td>Mise à jour des attributs poteaux depuis Excel</td>
                            <td>Fichier .xlsx, couches QGIS</td>
                            <td>Table modifiée, log</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-green">CAP_FT</span></td>
                            <td>Vérification fichiers capacitaires FT</td>
                            <td>Répertoire CAP_FT, couches</td>
                            <td>Rapport .xlsx</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-blue">COMAC</span></td>
                            <td>Contrôle données COMAC</td>
                            <td>Répertoire COMAC, couches</td>
                            <td>Rapport .xlsx</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-orange">C6 vs BD</span></td>
                            <td>Comparaison C6 / base de données</td>
                            <td>Fichiers C6, couches</td>
                            <td>Écarts identifiés</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-orange">C6/C3A/C7</span></td>
                            <td>Analyse croisée multi-fichiers</td>
                            <td>C6, C3A, C7, couches</td>
                            <td>Rapport consolidé</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-green">Police C6</span></td>
                            <td>Conformité GraceTHD</td>
                            <td>Fichiers C6, référentiel</td>
                            <td>Rapport conformité</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-orange">VERIF_SECURITE</span></td>
                            <td>Vérification portées câbles NFC 11201-A1</td>
                            <td>Excel COMAC, zone climatique</td>
                            <td>Feuille VERIF_SECURITE (OK/PORTEE MOLLE)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Zones Climatiques Section -->
        <section id="zones">
            <div class="zone-section">
                <div class="zone-header">
                    <span class="zone-badge">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                        Norme NFC 11201-A1
                    </span>
                    <h2>Zones Climatiques</h2>
                    <p>Comprendre l'impact du vent sur les portées maximales des câbles aériens</p>
                </div>

                <div class="zone-content" style="display:grid;grid-template-columns:1fr 320px;gap:24px;align-items:start;">
                    
                    <!-- Left column: Map + Search -->
                    <div style="display:flex;flex-direction:column;gap:16px;">
                        <!-- Interactive Wind Map -->
                        <div style="background:var(--card-bg);border-radius:12px;padding:16px;border:1px solid var(--border);">
                            <iframe id="windy-map"
                                src="https://embed.windy.com/embed2.html?lat=46.5&lon=2.5&zoom=5&level=surface&overlay=wind&menu=&message=true&marker=&calendar=&pressure=&type=map&location=coordinates&detail=&detailLat=46.5&detailLon=2.5&metricWind=km%2Fh&metricTemp=%C2%B0C&radarRange=-1"
                                style="width:100%;height:350px;border:none;border-radius:8px;"
                                allowfullscreen>
                            </iframe>
                            <p style="text-align:center;margin:10px 0 0 0;font-size:11px;color:var(--text-light);">
                                Carte interactive des vents en temps réel - Source: Windy.com
                            </p>
                        </div>
                        
                        <!-- Search commune panel -->
                        <div style="background:var(--card-bg);border-radius:12px;padding:16px;border:1px solid var(--border);">
                            <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
                                <h4 style="margin:0;color:var(--primary);display:flex;align-items:center;gap:8px;font-size:14px;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                                    Rechercher une commune
                                </h4>
                                <div style="flex:1;min-width:200px;position:relative;">
                                    <input type="text" id="commune-search" 
                                        placeholder="Ex: Clermont-Ferrand, Cantal, Pont-du-Château..."
                                        style="width:100%;padding:10px 40px 10px 12px;border:1px solid var(--border);border-radius:8px;background:var(--bg);color:var(--text);font-size:13px;box-sizing:border-box;"
                                        autocomplete="off"/>
                                    <button onclick="searchCommune()" style="position:absolute;right:4px;top:50%;transform:translateY(-50%);background:var(--primary);border:none;border-radius:6px;padding:6px 10px;cursor:pointer;">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                                    </button>
                                </div>
                                <div id="commune-info" style="padding:8px 12px;background:rgba(59,130,246,0.15);border-radius:6px;display:none;">
                                    <span style="font-weight:600;color:var(--primary);font-size:13px;" id="commune-name"></span>
                                    <span style="font-size:11px;color:var(--text-light);margin-left:8px;" id="commune-coords"></span>
                                </div>
                            </div>
                            <div id="search-results" style="margin-top:10px;display:flex;flex-wrap:wrap;gap:8px;"></div>
                        </div>
                        
                        <!-- Legend -->
                        <div style="display:flex;justify-content:center;gap:30px;">
                            <div class="map-legend-item" style="display:flex;align-items:center;gap:8px;">
                                <span class="map-legend-dot zvn"></span>
                                <span>ZVN - Vent Normal</span>
                            </div>
                            <div class="map-legend-item" style="display:flex;align-items:center;gap:8px;">
                                <span class="map-legend-dot zvf"></span>
                                <span>ZVF - Vent Fort</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right column: Portees Comparator -->
                    <div class="portees-comparator" style="height:fit-content;">
                        <div class="comparator-title">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>
                            Portées maximales autorisées (mètres)
                        </div>

                        <!-- 6 FO -->
                        <div class="portee-row">
                            <span class="portee-label">6 FO</span>
                            <div class="portee-bar-container">
                                <div class="portee-bar zvn" style="width: 100%;">81m</div>
                            </div>
                            <div class="portee-bar-container">
                                <div class="portee-bar zvf" style="width: 97.5%;">79m</div>
                            </div>
                        </div>

                        <!-- 12 FO -->
                        <div class="portee-row">
                            <span class="portee-label">12 FO</span>
                            <div class="portee-bar-container">
                                <div class="portee-bar zvn" style="width: 95%;">77m</div>
                            </div>
                            <div class="portee-bar-container">
                                <div class="portee-bar zvf" style="width: 91.3%;">74m</div>
                            </div>
                        </div>

                        <!-- 24 FO -->
                        <div class="portee-row">
                            <span class="portee-label">24 FO</span>
                            <div class="portee-bar-container">
                                <div class="portee-bar zvn" style="width: 90%;">73m</div>
                            </div>
                            <div class="portee-bar-container">
                                <div class="portee-bar zvf" style="width: 90%;">73m</div>
                            </div>
                        </div>

                        <!-- 48 FO -->
                        <div class="portee-row">
                            <span class="portee-label">48 FO</span>
                            <div class="portee-bar-container">
                                <div class="portee-bar zvn" style="width: 96.3%;">78m</div>
                            </div>
                            <div class="portee-bar-container">
                                <div class="portee-bar zvf" style="width: 96.3%;">78m</div>
                            </div>
                        </div>

                        <!-- 72 FO -->
                        <div class="portee-row">
                            <span class="portee-label">72 FO</span>
                            <div class="portee-bar-container">
                                <div class="portee-bar zvn" style="width: 95%;">77m</div>
                            </div>
                            <div class="portee-bar-container">
                                <div class="portee-bar zvf" style="width: 95%;">77m</div>
                            </div>
                        </div>

                        <div class="comparator-footer">
                            <div class="zone-info-card zvn">
                                <h4>ZVN</h4>
                                <p>Régions intérieures protégées</p>
                            </div>
                            <div class="zone-info-card zvf">
                                <h4>ZVF</h4>
                                <p>Littoral, montagnes, couloirs venteux</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <script>
        // Search commune and zoom
        async function searchCommune() {
            const input = document.getElementById('commune-search').value.trim();
            if (!input) return;
            try {
                const resp = await fetch(`https://api-adresse.data.gouv.fr/search/?q=${encodeURIComponent(input)}&type=municipality&limit=5`);
                const data = await resp.json();
                const resultsDiv = document.getElementById('search-results');
                resultsDiv.innerHTML = '';
                if (data.features && data.features.length > 0) {
                    data.features.forEach(f => {
                        const btn = document.createElement('button');
                        btn.style.cssText = 'text-align:left;padding:8px 12px;background:var(--bg);border:1px solid var(--border);border-radius:6px;cursor:pointer;color:var(--text);font-size:12px;';
                        btn.innerHTML = `<strong>${f.properties.city || f.properties.name}</strong> <span style="color:var(--text-light);">${f.properties.postcode}</span>`;
                        btn.onclick = () => zoomToCommune(f);
                        resultsDiv.appendChild(btn);
                    });
                } else {
                    resultsDiv.innerHTML = '<p style="color:var(--text-light);font-size:12px;">Aucune commune trouvée</p>';
                }
            } catch(e) { console.error('Erreur recherche:', e); }
        }
        function zoomToCommune(feature) {
            const [lon, lat] = feature.geometry.coordinates;
            const name = feature.properties.city || feature.properties.name;
            document.getElementById('windy-map').src = `https://embed.windy.com/embed2.html?lat=${lat}&lon=${lon}&zoom=10&level=surface&overlay=wind&menu=&message=true&marker=true&calendar=&pressure=&type=map&location=coordinates&detail=&detailLat=${lat}&detailLon=${lon}&metricWind=km%2Fh&metricTemp=%C2%B0C&radarRange=-1`;
            document.getElementById('commune-info').style.display = 'flex';
            document.getElementById('commune-name').textContent = name;
            document.getElementById('commune-coords').textContent = `${lat.toFixed(4)}, ${lon.toFixed(4)}`;
            document.getElementById('search-results').innerHTML = '';
        }
        document.getElementById('commune-search')?.addEventListener('keypress', e => { if (e.key === 'Enter') searchCommune(); });
        </script>

        <!-- FAQ Section -->
        <section id="faq">
            <div class="section-header">
                <h2>Foire aux questions</h2>
                <p>Tout ce qu'il faut savoir pour exploiter pleinement le plugin</p>
            </div>

            <div class="accordion">
                <!-- Catégorie: Général -->
                <div style="margin-bottom: 0.5rem; padding: 0.5rem 1rem; background: linear-gradient(135deg, #3b82f6, #1d4ed8); border-radius: 8px;">
                    <span style="color: white; font-weight: 600; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px;">Général</span>
                </div>

                <div class="accordion-item active">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>Quelle version de QGIS est requise ?</h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>Le plugin <strong>Pôle Aérien v2.3.0</strong> est compatible avec <strong>QGIS 3.28</strong> et les versions ultérieures (jusqu'à 3.99). Nous recommandons l'utilisation de la version <strong>3.28 LTS</strong> pour une stabilité optimale en environnement de production.</p>
                        <p style="margin-top: 0.75rem; padding: 0.75rem; background: #fef3c7; border-radius: 6px; border-left: 3px solid #f59e0b;">
                            <strong>Remarque :</strong> Les versions antérieures à 3.28 ne sont plus officiellement prises en charge. Si vous rencontrez des difficultés, vérifiez d'abord votre version de QGIS.
                        </p>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>Quelles sont les couches QGIS indispensables ?</h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>Selon les modules utilisés, les couches suivantes doivent être chargées dans votre projet :</p>
                        <ul style="margin: 0.75rem 0; padding-left: 1.5rem; line-height: 1.8;">
                            <li><strong>infra_pt_pot</strong> : Poteaux (points) avec les champs <code>inf_num</code>, <code>inf_type</code>, <code>etat</code></li>
                            <li><strong>etude_cap_ft</strong> : Zones d'études FT (polygones) avec le champ <code>nom_etudes</code></li>
                            <li><strong>etude_comac</strong> : Zones d'études BT (polygones) avec le champ <code>etudes</code></li>
                            <li><strong>bpe</strong> : Boîtes de protection équipement (points)</li>
                            <li><strong>attaches</strong> : Points d'attache (points)</li>
                            <li><strong>infra_pt_chb</strong> : Chambres (points) — requis pour Police C6</li>
                        </ul>
                        <p style="color: var(--text-light); font-size: 0.9rem;">Les noms des couches doivent correspondre exactement à ceux attendus par le plugin.</p>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>Est-il possible d'annuler une modification ?</h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>Oui, de plusieurs manières :</p>
                        <ul style="margin: 0.75rem 0; padding-left: 1.5rem; line-height: 1.8;">
                            <li><strong>Annulation immédiate :</strong> Utilisez <kbd>Ctrl</kbd>+<kbd>Z</kbd> dans QGIS juste après l'opération.</li>
                            <li><strong>Restauration :</strong> Rechargez la couche depuis la base de données si les modifications n'ont pas été enregistrées.</li>
                            <li><strong>Sauvegarde préalable :</strong> Nous conseillons vivement d'effectuer une sauvegarde de votre base de données avant toute mise à jour en lot.</li>
                        </ul>
                    </div>
                </div>

                <!-- Catégorie: Modules métier -->
                <div style="margin: 1.5rem 0 0.5rem 0; padding: 0.5rem 1rem; background: linear-gradient(135deg, #10b981, #059669); border-radius: 8px;">
                    <span style="color: white; font-weight: 600; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px;">Modules métier</span>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>Quels champs sont mis à jour par le module MAJ FT/BT ?</h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>Le module de mise à jour des poteaux FT/BT modifie les champs suivants :</p>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0.5rem; margin: 0.75rem 0;">
                            <span style="padding: 0.4rem 0.8rem; background: #e0f2fe; border-radius: 4px; font-family: monospace; font-size: 0.85rem;">inf_type</span>
                            <span style="padding: 0.4rem 0.8rem; background: #e0f2fe; border-radius: 4px; font-family: monospace; font-size: 0.85rem;">inf_propri</span>
                            <span style="padding: 0.4rem 0.8rem; background: #e0f2fe; border-radius: 4px; font-family: monospace; font-size: 0.85rem;">noe_usage</span>
                            <span style="padding: 0.4rem 0.8rem; background: #e0f2fe; border-radius: 4px; font-family: monospace; font-size: 0.85rem;">inf_mat</span>
                            <span style="padding: 0.4rem 0.8rem; background: #e0f2fe; border-radius: 4px; font-family: monospace; font-size: 0.85rem;">etat</span>
                            <span style="padding: 0.4rem 0.8rem; background: #e0f2fe; border-radius: 4px; font-family: monospace; font-size: 0.85rem;">dce</span>
                        </div>
                        <p style="margin-top: 0.75rem;">Les champs d'audit <code>modifie_par</code> et <code>date_modif</code> sont également renseignés automatiquement pour assurer la traçabilité.</p>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>Comment fonctionne le module C6 vs BD ?</h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>Ce module compare les fichiers Excel Annexe C6 avec les données présentes dans QGIS afin d'identifier les écarts :</p>
                        <ul style="margin: 0.75rem 0; padding-left: 1.5rem; line-height: 1.8;">
                            <li><strong>Extraction IN :</strong> Poteaux FT situés à l'intérieur des périmètres d'études CAP FT</li>
                            <li><strong>Extraction OUT :</strong> Poteaux FT hors périmètre (alerte potentielle)</li>
                            <li><strong>Vérification croisée :</strong> Études sans fichier C6 correspondant, et inversement</li>
                        </ul>
                        <p>Le résultat est exporté dans un fichier Excel comportant trois feuilles : <em>Analyse C6 BD</em>, <em>Poteaux hors périmètre</em> et <em>Vérification études</em>.</p>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>Qu'est-ce que la vérification des portées molles ?</h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>Le module <strong>VERIF CAP_COMAC</strong> analyse les portées de câbles fibre optique selon la norme <strong>NFC 11201-A1</strong>.</p>
                        <p style="margin: 0.75rem 0;">Le processus s'effectue comme suit :</p>
                        <ol style="padding-left: 1.5rem; line-height: 1.8;">
                            <li>Lecture des colonnes <strong>AO</strong> (type de ligne FO) et <strong>AU</strong> (portée en mètres) des fichiers COMAC</li>
                            <li>Détection de la capacité FO via les codes Prysmian (ex. : <code>L1092-xx-P</code>)</li>
                            <li>Comparaison avec les valeurs maximales autorisées selon la zone climatique (<strong>ZVN</strong> ou <strong>ZVF</strong>)</li>
                        </ol>
                        <p style="margin-top: 0.75rem; padding: 0.75rem; background: #fee2e2; border-radius: 6px; border-left: 3px solid #ef4444;">
                            Les dépassements sont signalés comme <strong>« PORTÉE MOLLE »</strong> et nécessitent une vérification terrain.
                        </p>
                    </div>
                </div>

                <!-- Catégorie: Police C6 & GraceTHD -->
                <div style="margin: 1.5rem 0 0.5rem 0; padding: 0.5rem 1rem; background: linear-gradient(135deg, #8b5cf6, #7c3aed); border-radius: 8px;">
                    <span style="color: white; font-weight: 600; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px;">Police C6 & GraceTHD</span>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>Comment fournir les données GraceTHD ?</h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>Le module <strong>Police C6</strong> requiert des données GraceTHD pour l'analyse. Deux méthodes d'import sont disponibles :</p>
                        <ul style="margin: 0.75rem 0; padding-left: 1.5rem; line-height: 1.8;">
                            <li><strong>Répertoire Shapefiles :</strong> Sélectionnez un dossier contenant les fichiers <code>t_cheminement.shp</code>, <code>t_cableline.shp</code>, <code>t_noeud.shp</code></li>
                            <li><strong>Fichier SQLite :</strong> Importez directement un fichier SQLite GraceTHD (les couches seront créées avec le suffixe <code>*_copy</code>)</li>
                        </ul>
                        <p style="margin-top: 0.75rem; padding: 0.75rem; background: #e0f2fe; border-radius: 6px; border-left: 3px solid #3b82f6;">
                            <strong>Astuce :</strong> L'import SQLite est généralement plus rapide et évite les problèmes d'encodage des fichiers CSV.
                        </p>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>Qu'est-ce que l'auto-détection du fichier C6 ?</h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>Lorsque vous sélectionnez une valeur dans le champ <strong>« Filtre Valeur »</strong> (ex. : <em>NGE-63A2D-73463-PA-21</em>), le plugin recherche automatiquement le fichier Excel C6 correspondant dans le répertoire de travail.</p>
                        <p style="margin: 0.75rem 0;"><strong>Motifs de recherche utilisés :</strong></p>
                        <div style="display: flex; flex-direction: column; gap: 0.4rem; margin: 0.75rem 0;">
                            <code style="padding: 0.4rem 0.8rem; background: #f1f5f9; border-radius: 4px; font-size: 0.85rem;">*nom_etudes*.xlsx</code>
                            <code style="padding: 0.4rem 0.8rem; background: #f1f5f9; border-radius: 4px; font-size: 0.85rem;">*Annexe*C6*nom_etudes*.xlsx</code>
                            <code style="padding: 0.4rem 0.8rem; background: #f1f5f9; border-radius: 4px; font-size: 0.85rem;">*C6*nom_etudes*.xlsx</code>
                        </div>
                        <p style="color: var(--text-light); font-size: 0.9rem;">Si aucun fichier n'est trouvé, vous pouvez toujours le sélectionner manuellement.</p>
                    </div>
                </div>

                <!-- Catégorie: Résolution de problèmes -->
                <div style="margin: 1.5rem 0 0.5rem 0; padding: 0.5rem 1rem; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 8px;">
                    <span style="color: white; font-weight: 600; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px;">Résolution de problèmes</span>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>Pourquoi certains numéros d'appui ne correspondent-ils pas ?</h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>La correspondance des numéros d'appui repose sur le couple <strong>N° appui + Nom d'études</strong>. Vérifiez les points suivants :</p>
                        <ul style="margin: 0.75rem 0; padding-left: 1.5rem; line-height: 1.8;">
                            <li><strong>Format :</strong> Le numéro doit être identique (ex. : <code>1016436/63041</code> est normalisé en <code>1016436</code>)</li>
                            <li><strong>Nom d'études :</strong> Les noms doivent correspondre exactement (attention aux variantes QSB/DTR)</li>
                            <li><strong>Espaces parasites :</strong> Des espaces en début ou fin de cellule peuvent fausser la correspondance</li>
                        </ul>
                        <p style="margin-top: 0.75rem; padding: 0.75rem; background: #e0f2fe; border-radius: 6px; border-left: 3px solid #3b82f6;">
                            <strong>Astuce :</strong> Utilisez la fonction SUPPRESPACE() dans Excel pour nettoyer vos données avant l'import.
                        </p>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>Que faire si le bouton « Exécuter » reste grisé ?</h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>Le bouton d'exécution s'active uniquement lorsque tous les prérequis sont satisfaits. Vérifiez :</p>
                        <ul style="margin: 0.75rem 0; padding-left: 1.5rem; line-height: 1.8;">
                            <li><strong>Couches sélectionnées :</strong> Toutes les couches obligatoires doivent être choisies dans les listes déroulantes</li>
                            <li><strong>Champs requis :</strong> Les couches doivent contenir les champs attendus (<code>inf_num</code>, <code>nom_etudes</code>, etc.)</li>
                            <li><strong>Fichiers Excel :</strong> Les chemins vers les fichiers doivent être valides et les fichiers accessibles</li>
                            <li><strong>Source GraceTHD :</strong> Pour Police C6, soit le chemin interne doit être valide, soit un fichier SQLite doit être sélectionné</li>
                        </ul>
                    </div>
                </div>

                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion(this)">
                        <h4>Comment signaler une anomalie ou suggérer une amélioration ?</h4>
                        <span class="accordion-icon">+</span>
                    </div>
                    <div class="accordion-content">
                        <p>Pour tout signalement, contactez <strong>Youcef ADDA</strong> en fournissant les informations suivantes :</p>
                        <ul style="margin: 0.75rem 0; padding-left: 1.5rem; line-height: 1.8;">
                            <li>Version de QGIS et du plugin Pôle Aérien</li>
                            <li>Message d'erreur complet (copie du panneau « Journal des messages »)</li>
                            <li>Étapes précises permettant de reproduire le problème</li>
                            <li>Captures d'écran si pertinent</li>
                        </ul>
                        <div style="display: flex; gap: 1rem; margin-top: 1rem; flex-wrap: wrap;">
                            <a href="mailto:yadda@nge-es.fr" style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.6rem 1.2rem; background: #3b82f6; color: white; border-radius: 6px; text-decoration: none; font-weight: 500;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                                yadda@nge-es.fr
                            </a>
                            <a href="https://www.linkedin.com/in/youcef-adda/" target="_blank" style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.6rem 1.2rem; background: #0077b5; color: white; border-radius: 6px; text-decoration: none; font-weight: 500;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                                LinkedIn
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Nouveautés v2.2.4 Section -->
        <section id="nouveautes" style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); padding: 3rem 2rem; border-radius: var(--radius); margin-top: 3rem;">
            <div class="section-header">
                <h2><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 8px;"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg> Nouveautés v2.2.4</h2>
                <p>Améliorations majeures pour simplifier votre workflow</p>
            </div>

            <div class="cards-grid" style="max-width: 1000px; margin: 0 auto;">
                <article class="card" style="border: 2px solid #3b82f6;">
                    <div class="card-icon blue">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>
                    </div>
                    <h3>Import GraceTHD simplifié</h3>
                    <p><strong>Double option d'import :</strong> Choisissez entre un répertoire de shapefiles ou un fichier SQLite pour vos données GraceTHD.</p>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border-left: 4px solid #3b82f6;">
                        <p style="margin: 0; font-size: 0.9rem; color: #1e40af;"><strong>SQLite recommandé</strong> : Plus rapide et sans problèmes d'encodage CSV</p>
                    </div>
                </article>

                <article class="card" style="border: 2px solid #10b981;">
                    <div class="card-icon green">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/><path d="M11 8v6"/><path d="M8 11h6"/></svg>
                    </div>
                    <h3>Auto-détection C6</h3>
                    <p><strong>Gain de temps considérable !</strong> Le fichier Excel C6 est automatiquement détecté dès que vous sélectionnez une étude dans "Filtre Valeur".</p>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border-left: 4px solid #10b981;">
                        <p style="margin: 0; font-size: 0.9rem; color: #065f46;"><strong>Exemple :</strong> Sélection de "NGE-63A2D-73463-PA-21" → Recherche auto de <code>*NGE-63A2D-73463-PA-21*.xlsx</code></p>
                    </div>
                </article>

                <article class="card" style="border: 2px solid #f59e0b;">
                    <div class="card-icon orange">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
                    </div>
                    <h3>Workflow Optimisé</h3>
                    <p><strong>Interface épurée</strong> : Moins de clics, moins d'erreurs. Le plugin anticipe vos besoins et pré-remplit les champs intelligemment.</p>
                    <ul style="margin-top: 1rem; padding-left: 1.5rem; color: var(--text-secondary); font-size: 0.9rem;">
                        <li><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="3" style="display: inline-block; vertical-align: middle; margin-right: 6px;"><polyline points="20 6 9 17 4 12"/></svg> Réduction de 2 étapes manuelles</li>
                        <li><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="3" style="display: inline-block; vertical-align: middle; margin-right: 6px;"><polyline points="20 6 9 17 4 12"/></svg> Moins de risques d'erreur de chemin</li>
                        <li><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="3" style="display: inline-block; vertical-align: middle; margin-right: 6px;"><polyline points="20 6 9 17 4 12"/></svg> Fallback manuel toujours disponible</li>
                    </ul>
                </article>
            </div>

            <!-- Schéma détaillé du workflow v2.2.4 -->
            <div class="diagram-container" style="margin-top: 3rem;">
                <h3 class="diagram-title">Workflow Police C6 - v2.2.4 avec auto-détection</h3>
                <svg class="architecture-svg" viewBox="0 0 1000 400" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <marker id="arrow-workflow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6"/>
                        </marker>
                        <filter id="glow">
                            <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                            <feMerge>
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                    </defs>
                    <rect width="1000" height="400" fill="#f8fafc"/>

                    <!-- Étape 1: Sélection étude -->
                    <g class="node">
                        <rect x="50" y="150" width="160" height="100" rx="12" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
                        <text x="130" y="180" text-anchor="middle" font-weight="600" fill="#1e40af" font-size="14">1. Sélection étude</text>
                        <text x="130" y="200" text-anchor="middle" fill="#1d4ed8" font-size="11">Filtre Valeur:</text>
                        <text x="130" y="215" text-anchor="middle" fill="#1d4ed8" font-size="10" font-weight="600">NGE-63A2D-73463-PA-21</text>
                        <circle cx="130" cy="235" r="8" fill="#10b981" opacity="0.8"/>
                        <polyline points="125,235 128,238 135,231" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" transform="translate(0, 0)"/>
                    </g>

                    <!-- Flèche 1 -->
                    <path d="M 210 200 L 270 200" stroke="#3b82f6" stroke-width="3" fill="none" marker-end="url(#arrow-workflow)" class="flow-arrow"/>
                    <text x="240" y="190" text-anchor="middle" fill="#10b981" font-size="11" font-weight="600">AUTO</text>

                    <!-- Étape 2: Auto-détection -->
                    <g class="node pulse">
                        <rect x="270" y="150" width="160" height="100" rx="12" fill="#d1fae5" stroke="#10b981" stroke-width="2" filter="url(#glow)"/>
                        <text x="350" y="180" text-anchor="middle" font-weight="600" fill="#065f46" font-size="14">2. Auto-détection</text>
                        <text x="350" y="200" text-anchor="middle" fill="#047857" font-size="10">Recherche patterns:</text>
                        <text x="350" y="215" text-anchor="middle" fill="#047857" font-size="9" font-family="monospace">*nom_etudes*.xlsx</text>
                        <text x="350" y="228" text-anchor="middle" fill="#047857" font-size="9" font-family="monospace">*C6*nom_etudes*.xlsx</text>
                        <circle cx="350" cy="240" r="6" fill="#10b981"/>
                        <animate attributeName="opacity" values="1;0.5;1" dur="2s" repeatCount="indefinite"/>
                    </g>

                    <!-- Flèche 2 -->
                    <path d="M 430 200 L 490 200" stroke="#3b82f6" stroke-width="3" fill="none" marker-end="url(#arrow-workflow)" class="flow-arrow"/>

                    <!-- Étape 3: GraceTHD (import manuel) -->
                    <g class="node">
                        <rect x="490" y="150" width="160" height="100" rx="12" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
                        <text x="570" y="180" text-anchor="middle" font-weight="600" fill="#92400e" font-size="14">3. GraceTHD</text>
                        <text x="570" y="200" text-anchor="middle" fill="#a16207" font-size="10">Import manuel requis:</text>
                        <text x="570" y="215" text-anchor="middle" fill="#a16207" font-size="9" font-family="monospace">Répertoire .shp</text>
                        <text x="570" y="228" text-anchor="middle" fill="#a16207" font-size="9" font-family="monospace">ou fichier SQLite</text>
                        <rect x="545" y="233" width="50" height="12" rx="3" fill="#f59e0b" opacity="0.2"/>
                        <text x="570" y="242" text-anchor="middle" fill="#92400e" font-size="9" font-weight="600">MANUEL</text>
                    </g>

                    <!-- Flèche 3 -->
                    <path d="M 650 200 L 710 200" stroke="#3b82f6" stroke-width="3" fill="none" marker-end="url(#arrow-workflow)" class="flow-arrow"/>

                    <!-- Étape 4: Analyse -->
                    <g class="node">
                        <rect x="710" y="150" width="160" height="100" rx="12" fill="#e0e7ff" stroke="#6366f1" stroke-width="2"/>
                        <text x="790" y="180" text-anchor="middle" font-weight="600" fill="#3730a3" font-size="14">4. Analyse</text>
                        <text x="790" y="200" text-anchor="middle" fill="#4338ca" font-size="10">Vérification:</text>
                        <text x="790" y="215" text-anchor="middle" fill="#4338ca" font-size="10">• Appuis</text>
                        <text x="790" y="228" text-anchor="middle" fill="#4338ca" font-size="10">• Câbles</text>
                        <text x="790" y="241" text-anchor="middle" fill="#4338ca" font-size="10">• EBP</text>
                    </g>

                    <!-- Annotations -->
                    <g opacity="0.7">
                        <rect x="50" y="280" width="200" height="80" rx="8" fill="white" stroke="#e2e8f0" stroke-width="1"/>
                        <text x="150" y="300" text-anchor="middle" font-weight="600" fill="#334155" font-size="11">Avant v2.2.4</text>
                        <text x="60" y="320" fill="#64748b" font-size="9">• Recherche manuelle fichier C6</text>
                        <text x="60" y="335" fill="#64748b" font-size="9">• Sélection manuelle fichier C6</text>
                        <text x="60" y="350" fill="#dc2626" font-size="9" font-weight="600">= 2 étapes supplémentaires</text>
                    </g>

                    <g opacity="0.7">
                        <rect x="280" y="280" width="200" height="80" rx="8" fill="#d1fae5" stroke="#10b981" stroke-width="1"/>
                        <text x="380" y="300" text-anchor="middle" font-weight="600" fill="#065f46" font-size="11">Maintenant v2.2.4</text>
                        <text x="290" y="320" fill="#047857" font-size="9">• Auto-détection fichier C6</text>
                        <text x="290" y="335" fill="#047857" font-size="9">• Import GraceTHD simplifié</text>
                        <text x="290" y="350" fill="#10b981" font-size="9" font-weight="600">= Workflow simplifié !</text>
                    </g>

                    <!-- Légende temps gagné -->
                    <g>
                        <rect x="520" y="290" width="140" height="60" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
                        <text x="590" y="310" text-anchor="middle" font-weight="700" fill="#92400e" font-size="13">Temps gagné</text>
                        <text x="590" y="330" text-anchor="middle" font-weight="700" fill="#ea580c" font-size="20">~30 sec</text>
                        <text x="590" y="345" text-anchor="middle" fill="#a16207" font-size="9">par analyse</text>
                    </g>
                </svg>

                <div class="legend" style="margin-top: 1.5rem;">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #dbeafe; border: 2px solid #3b82f6;"></div>
                        <span>Interaction utilisateur</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #d1fae5; border: 2px solid #10b981;"></div>
                        <span>Automatique (nouveau)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #fef3c7; border: 2px solid #f59e0b;"></div>
                        <span>Données internes</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #e0e7ff; border: 2px solid #6366f1;"></div>
                        <span>Traitement</span>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 2rem;">
                <div style="display: inline-block; padding: 1rem 2rem; background: white; border-radius: var(--radius); box-shadow: var(--shadow);">
                    <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 6px;"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg> <strong>Architecture mise à jour</strong> : 19 fichiers Python • 7418 lignes • 4 nouveaux modules sécurité</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-logo" style="display: flex; align-items: center; gap: 12px;">
                <img src="../images/icon-pole.svg" alt="Pole" width="32" height="32" style="filter: brightness(0) invert(1);">
                <span>Pole Aerien - Plugin QGIS</span>
            </div>
            <ul class="footer-links">
                <li><a href="mailto:yadda@nge-es.fr">Contact</a></li>
                <li><a href="https://www.linkedin.com/in/youcef-adda/" target="_blank">LinkedIn</a></li>
                <li><a href="#">Documentation</a></li>
                <li><a href="#">Licence GPL v2</a></li>
            </ul>
            <div style="display: flex; align-items: center; gap: 16px; margin-top: 1rem;">
                <img src="../images/logo_NGE.svg" alt="NGE" width="80" height="28">
                <p style="margin: 0;">&copy; 2022-2026 NGE Energie Solutions. Tous droits reserves.</p>
            </div>
        </div>
    </footer>

    <script>
        // Accordion functionality
        function toggleAccordion(header) {
            const item = header.parentElement;
            const isActive = item.classList.contains('active');
            
            // Close all
            document.querySelectorAll('.accordion-item').forEach(i => {
                i.classList.remove('active');
            });
            
            // Open clicked if was closed
            if (!isActive) {
                item.classList.add('active');
            }
        }

        // Diagram tabs functionality
        function showDiagram(diagramId) {
            // Hide all panels
            document.querySelectorAll('.diagram-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            // Deactivate all tabs
            document.querySelectorAll('.diagram-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected panel
            document.getElementById('diagram-' + diagramId).classList.add('active');
            
            // Activate clicked tab
            event.target.classList.add('active');
        }

        // Tooltip functionality for SVG nodes
        document.addEventListener('DOMContentLoaded', function() {
            const tooltip = document.getElementById('diagram-tooltip');
            
            document.querySelectorAll('.architecture-svg .node').forEach(node => {
                node.addEventListener('mouseenter', function(e) {
                    const info = this.getAttribute('data-info');
                    if (info) {
                        tooltip.textContent = info;
                        tooltip.classList.add('visible');
                    }
                });
                
                node.addEventListener('mousemove', function(e) {
                    tooltip.style.left = (e.pageX + 15) + 'px';
                    tooltip.style.top = (e.pageY - 10) + 'px';
                });
                
                node.addEventListener('mouseleave', function() {
                    tooltip.classList.remove('visible');
                });
            });
        });

        // Smooth scroll for nav links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Active nav link on scroll
        window.addEventListener('scroll', function() {
            const sections = document.querySelectorAll('section[id]');
            const navLinks = document.querySelectorAll('.nav-links a');
            
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (scrollY >= sectionTop) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        });

        // Animated Counter
        function animateCounters() {
            const counters = document.querySelectorAll('.counter-number');
            const speed = 200;

            counters.forEach(counter => {
                const target = +counter.getAttribute('data-target');
                const increment = target / speed;

                const updateCount = () => {
                    const count = +counter.innerText;
                    if (count < target) {
                        counter.innerText = Math.ceil(count + increment);
                        setTimeout(updateCount, 10);
                    } else {
                        counter.innerText = target.toLocaleString();
                    }
                };
                updateCount();
            });
        }

        // Intersection Observer for counters
        const counterSection = document.querySelector('.counter-section');
        if (counterSection) {
            const counterObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        animateCounters();
                        counterObserver.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.5 });
            counterObserver.observe(counterSection);
        }
    </script>
</body>
</html>
